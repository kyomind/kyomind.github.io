<!DOCTYPE html>
<html lang="zh-TW">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@kyomind">
<meta property="og:type" content="article"><meta name="twitter:title" content="Python API 開發：善用 Enum 的三大關鍵特性">
  <meta property="og:title" content="Python API 開發：善用 Enum 的三大關鍵特性"><meta name="twitter:description" content="本文分享我最近才開始把 Enum 應用在 API 開發中的經驗——從它的三大特性入手，並輔以一個實際問題情境。">
  <meta property="og:description" content="本文分享我最近才開始把 Enum 應用在 API 開發中的經驗——從它的三大特性入手，並輔以一個實際問題情境。"><meta name="twitter:image" content="https://i.imgur.com/5lvKO0a.jpeg">
  <meta property="og:image" content="https://i.imgur.com/5lvKO0a.jpeg">
<meta name="description" content="本文分享我最近才開始把 Enum 應用在 API 開發中的經驗——從它的三大特性入手，並輔以一個實際問題情境。" />


<meta property="og:locale" content="zh-TW" />
<meta property="og:site_name" content="Code and Me" />
<meta property="article:publisher" content="https://blog.kyomind.tw" />
<meta property="article:author" content="Kyo Huang" /><meta property="article:section" content="軟體開發" />
            

  <meta property="article:modified_time" content="2025-04-27T01:35:23+08:00" />




  <meta property="article:published_time" content="2024-04-19T09:11:47+08:00" />



<meta name="author" content="Kyo Huang" />
<meta http-equiv="content-language" content="zh-TW" />
<link rel="alternate" href="/atom.xml" title="Code and Me" type="application/atom+xml">
 
 





<link rel="icon" type="image/png" sizes="144x144" href="/favicon-144x144.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" href="/favicon.ico" sizes="any">


<link rel="canonical" href="https://blog.kyomind.tw/python-enum/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NL7WVE1X7Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL7WVE1X7Z');

</script><script defer src="https://umami.kyomind.tw/script.js" data-website-id="95c335c2-7917-4f3a-9638-a1b8cf36523f"></script><script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":false,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Python API 開發：善用 Enum 的三大關鍵特性 - Code and Me</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Code and Me</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/archives/" class="">
        <li class="mobile-menu-item">文章列表
          </li>
      </a><a href="/categories/" class="">
        <li class="mobile-menu-item">分類
          </li>
      </a><a href="/tags/" class="">
        <li class="mobile-menu-item">標籤
          </li>
      </a><a href="/ranking/" class="">
        <li class="mobile-menu-item">排名
          </li>
      </a><a href="/series/" class="">
        <li class="mobile-menu-item">系列
          </li>
      </a><a href="/subscribe/" class="subscribe-link ">
        <li class="mobile-menu-item">訂閱
          </li>
      </a><a href="/about/" class="">
        <li class="mobile-menu-item">關於
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Code and Me</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu"><li class="menu-item">
        <a class="menu-item-link" href="/archives/" >
          文章列表
          </a>
      </li>
    <li class="dropdown">
        <a class="menu-item-link" href="/categories/">
          分類 <b><span style="position: relative; top: -3px;">⌵</span></b>
          </a>
        <div class="dropdown-content">
          
            <a href="/categories/%E5%BF%83%E5%BE%97/">心得 (56)</a>
          
            <a href="/categories/Django/">Django (13)</a>
          
            <a href="/categories/Weekly-Review/">Weekly Review (44)</a>
          
            <a href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發 (44)</a>
          
            <a href="/categories/VS-Code/">VS Code (9)</a>
          
            <a href="/categories/Django-Ninja-%E7%B3%BB%E5%88%97/">Django Ninja 系列 (30)</a>
          
        </div>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/tags/" >
          標籤
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/ranking/" >
          排名
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/series/" >
          系列
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/subscribe/" style="color: #3b82f6;" >
          訂閱
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/about/" >
          關於
          </a>
      </li>
    </ul>
</nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Python API 開發：善用 Enum 的三大關鍵特性
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2024-04-19
        </span><span class="post-category">
            <a href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目錄</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E4%B8%BB%E6%97%A8%E8%88%87%E6%9E%B6%E6%A7%8B"><span class="toc-text">本文主旨與架構</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%95%8F%E9%A1%8C%E6%83%85%E5%A2%83"><span class="toc-text">第一部分：問題情境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%BE%80%E7%9A%84%E5%81%9A%E6%B3%95"><span class="toc-text">以往的做法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%97%E8%AD%89%E5%88%97%E8%88%89%E6%88%90%E5%93%A1"><span class="toc-text">驗證列舉成員</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%B5%90%EF%BC%9A%E7%9B%AE%E5%89%8D%E5%AF%AB%E6%B3%95%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="toc-text">小結：目前寫法的問題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E4%BB%8B%E7%B4%B9-Python-Enum-%E7%9A%84%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-text">第二部分：介紹 Python Enum 的三大特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Enum-%E9%A1%9E%E5%88%A5%E5%8F%AF%E4%BB%A5%E7%94%A8-for-%E8%BF%B4%E5%9C%88%E8%BF%AD%E4%BB%A3"><span class="toc-text">一、Enum 類別可以用 for 迴圈迭代</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BA%86%E8%A7%A3-Enum-%E5%AF%A6%E4%BE%8B"><span class="toc-text">二、了解 Enum 實例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enum-%E9%A1%9E%E5%88%A5%E5%B1%AC%E6%80%A7%E3%80%8C%E5%B0%B1%E6%98%AF%E3%80%8DEnum-%E5%AF%A6%E4%BE%8B"><span class="toc-text">Enum 類別屬性「就是」Enum 實例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enum-%E5%AF%A6%E4%BE%8B%E7%9A%84%E5%85%A9%E5%80%8B%E5%B1%AC%E6%80%A7"><span class="toc-text">Enum 實例的兩個屬性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Enum-%E5%AF%A6%E4%BE%8B%E4%B9%8B%E9%96%93%E5%8F%AF%E4%BB%A5%E9%80%B2%E8%A1%8C%E6%AF%94%E8%BC%83"><span class="toc-text">三、Enum 實例之間可以進行比較</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E4%BD%BF%E7%94%A8-Enum-%E6%94%B9%E9%80%B2%E5%8E%9F%E6%9C%89%E7%A8%8B%E5%BC%8F%EF%BC%81"><span class="toc-text">第三部分：使用 Enum 改進原有程式！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E9%81%8E%E3%80%8C%E5%BB%BA%E7%AB%8B-Enum-%E5%AF%A6%E4%BE%8B%E3%80%8D%E9%80%B2%E8%A1%8C%E9%A9%97%E8%AD%89"><span class="toc-text">透過「建立 Enum 實例」進行驗證</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%9C%E5%85%85%EF%BC%9AEnum-%E9%A1%9E%E5%88%A5%E5%9C%A8-Django-Ninja-%E4%B8%AD%E7%9A%84%E6%87%89%E7%94%A8"><span class="toc-text">補充：Enum 類別在 Django Ninja 中的應用</span></a></li></ol>
    </div>
  </div><div class="post-content"><p><img src="https://i.imgur.com/5lvKO0a.jpeg" alt="from Pixabay"><span class="cap">from Pixabay</span></p>
<p>想必你知道 Python 中有一個內建的特殊類別叫 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-tw/3.12/library/enum.html#enum.Enum">Enum</a>（來自 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-tw/3.12/library/enum.html">enum</a> 模組），專門用來處理「列舉」態型的資料集合。</p>
<p>如同 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-tw/3/library/collections.html">collection</a> 模組中的各種容器（比如：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-tw/3/library/collections.html#collections.deque"><code>deque</code></a>、<a target="_blank" rel="noopener" href="https://docs.python.org/zh-tw/3/library/collections.html#collections.Counter"><code>Counter</code></a>），Enum 已經定義好很多「<strong>內建特性（屬性、方法、行為）</strong>」供你使用。這些特性會讓你在<strong>處理特定情境</strong>時非常順手。</p>
<p>但是，這些特性也使得 Enum 類別與一般類別<strong>有著很大的差異，增加了學習門檻</strong>。</p>
<p>如你所見，Enum 的特性頗多，這讓人在學習、使用之前，難免有點<strong>望之卻步</strong>——至少我是這樣！</p>
<h2 id="本文主旨與架構"><a href="#本文主旨與架構" class="headerlink" title="本文主旨與架構"></a>本文主旨與架構</h2><p>本文分享我最近才開始把 Enum 應用在 API 開發中的經驗——從它的三大特性入手，並輔以一個實際問題情境。</p>
<p>Enum 的特性不少，但只要知曉這三件事，就可以在遇到「列舉」欄位時，善用 Enum 來提升開發效率，同時增進程式碼的簡潔與穩健。</p>
<p>不過話說回來，即使不是開發 API，也不影響你對本文的理解。只是我的經驗是從後端開發而來。</p>
<h3 id="本文架構"><a href="#本文架構" class="headerlink" title="本文架構"></a>本文架構</h3><p>為了讓你感受 Enum 的強大與美妙，<strong>本文的架構經過精心設計。</strong>共分為<strong>三個部分</strong>：</p>
<ol>
<li><strong>問題情境</strong>：我會先提出一個<strong>問題情境</strong>，突顯舊方法的不足。</li>
<li>然後再介紹 Enum 的<strong>三大特性</strong>，帶你進入 Enum 的世界。</li>
<li>最後看 Enum 特性在問題情境中<strong>如何有效發揮</strong>，讓程式碼變得更加優雅——也就是它<strong>解決的痛點</strong>。</li>
</ol>
<p>藉由這個流程，相信你對 Enum 會有更進一步的理解。</p>
<span id="more"></span>

<hr>
<p>話不多說，先從問題情境開始。</p>
<h2 id="第一部分：問題情境"><a href="#第一部分：問題情境" class="headerlink" title="第一部分：問題情境"></a>第一部分：問題情境</h2><p>為了有效講解，舉個<strong>實例</strong>是必要的，但我會<strong>盡可能簡化</strong>，只著眼於能夠彰顯 Enum 價值的部分。</p>
<p>作為一個 Django API 開發者，不管是什麼專案，幾乎都會出現「列舉型」資料。此時 Django ORM 中對應的就是「<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/5.0/ref/models/fields/#django.db.models.Field.choices">choices</a>」欄位。</p>
<p>假設我們現在要開發一個 Docker 相關的服務（這是我實際遇到的情境），其中一個 API 是「新增容器」。而容器有一個需要使用者輸入的設定是：restart policy。</p>
<p>從官方文件可知，Docker 容器的 restart policy <a target="_blank" rel="noopener" href="https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy">總共就只有 4 種而已</a>——沒錯，它屬於<strong>列舉型資料</strong>！</p>
<h3 id="Django-Model-欄位設計"><a href="#Django-Model-欄位設計" class="headerlink" title="Django Model 欄位設計"></a>Django Model 欄位設計</h3><p>此時，我們的 Django model 欄位會長這樣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    RESTART_POLICIES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;always&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">&#x27;unless-stopped&#x27;</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">&#x27;on-failure&#x27;</span>),</span><br><span class="line">    )</span><br><span class="line">    restart_policy = models.PositiveSmallIntegerField(</span><br><span class="line">        choices=RESTART_POLICIES, default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>為了方便講解與避免混淆，這裡我採用了「數字（0-3）」作為列舉成員。但實際工作中，我使用的是「字串」，也就是<code>&#39;no&#39;</code>、<code>&#39;always&#39;</code>等：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    RESTART_POLICIES = (</span><br><span class="line">        (<span class="string">&#x27;no&#x27;</span>, <span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;always&#x27;</span>, <span class="string">&#x27;always&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;unless-stopped&#x27;</span>, <span class="string">&#x27;unless-stopped&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;on-failure&#x27;</span>, <span class="string">&#x27;on-failure&#x27;</span>),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>這是一個<strong>重要的細節</strong>，以後會另篇討論：什麼時候列舉成員應該用數字，而什麼時候用字串更好。</p>
<p>為了專注於對 Enum 的學習，這裡採最常見的「數字」版本。</p>
<hr>
<h2 id="以往的做法"><a href="#以往的做法" class="headerlink" title="以往的做法"></a>以往的做法</h2><p>以前用 DRF（<a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/">Django REST framework</a>）開發 API 列舉資料時，除了在 model 增加了上述的 choices 限制，我並沒有使用 Enum。</p>
<p>這裡有一個問題：那前端人員怎麼知道列舉的「成員」<strong>有幾個、有哪些？</strong>當然只能靠 API 文件！</p>
<p>以往我們都是用 <a target="_blank" rel="noopener" href="https://apiblueprint.org/">API Blueprint</a> 寫 API 文件。說真的，<strong>我不喜歡（我的後端同事們也都不喜歡XD）</strong>，太多手刻細節了——難怪它的普及率不高🙂‍↔️</p>
<p>雖然在 codebase 中看不到 Enum 的身影，但是，為了增加<strong>程式碼可讀性</strong>，我們還是會額外設計這樣的類別（這是為了後端開發者們在維護上的考慮）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestartPolicy</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    所有容器重啟策略</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    NO = <span class="number">0</span></span><br><span class="line">    ALWAYS = <span class="number">1</span></span><br><span class="line">    UNLESS_STOPPED = <span class="number">2</span></span><br><span class="line">    ON_FAILURE = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>如何使用這個類別？</p>
<p>一個典型的情境是，在 view 函式中<strong>將變數值與列舉成員進行比較</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> restart_policy == RestartPolicy.UNLESS_STOPPED</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>有了<code>RestartPolicy</code>，程式碼變得更加<strong>直觀</strong>，<strong>易讀</strong>。</p>
<p>換句話說，我們<strong>不會</strong>直接這樣寫：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> restart_policy == <span class="number">2</span>  <span class="comment"># 咦，2 是什麼東西？</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="驗證列舉成員"><a href="#驗證列舉成員" class="headerlink" title="驗證列舉成員"></a>驗證列舉成員</h2><p>如果列舉資料只限於後端自行使用，那上述的寫法其實就足夠了。</p>
<p>但是，很多時候列舉資料是從<strong>前端（使用者輸入）</strong>來的。</p>
<p>此時你<strong>首先</strong>要驗證前端給的資料，<strong>是不是屬於這個列舉集合的成員</strong>！套用上面的寫法就會顯得囉嗦：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> payload.restart_policy <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">    RestartPolicy.NO,</span><br><span class="line">    RestartPolicy.ALWAYS,</span><br><span class="line">    RestartPolicy.UNLESS_STOPPED,</span><br><span class="line">    RestartPolicy.ON_FAILURE):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>為了不要讓程式這麼冗長，我們通常會幫這個類別加上一個簡單的<code>ALL</code>屬性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestartPolicy</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    所有容器重啟策略</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    NO = <span class="number">0</span></span><br><span class="line">    ALWAYS = <span class="number">1</span></span><br><span class="line">    UNLESS_STOPPED = <span class="number">2</span></span><br><span class="line">    ON_FAILURE = <span class="number">3</span></span><br><span class="line">    ALL = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>於是程式碼變成這樣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> payload.restart_policy <span class="keyword">not</span> <span class="keyword">in</span> RestartPolicy.ALL:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>好像還可以，不是嗎？——但這顯然<strong>不是最佳實踐</strong>。</p>
<p>雖然在這個例子中，restart policy 主要就這 4 種，而且也不太會變動。</p>
<p>但如果在別的列舉場合，偶爾甚至不時會增加成員時，我們的 ALL 屬性的值也要跟著修正，這會產生潛在的「同步」問題——<strong>忘記</strong>一併更新 ALL 屬性。</p>
<h3 id="使用序列化器驗證"><a href="#使用序列化器驗證" class="headerlink" title="使用序列化器驗證"></a>使用序列化器驗證</h3><p>話說回來，DRF 有<a target="_blank" rel="noopener" href="https://www.django-rest-framework.org/api-guide/serializers/">序列化器模組</a>，作為驗證輸入資料正確性的手段。</p>
<p>只要你有寫序列化器，通常也不需要像上述程式碼一般手工驗證。</p>
<p>本文適用於<strong>沒有序列化器輔助</strong>的情況，或者說，你就是要在某些自定義的邏輯進行手動驗證。</p>
<h2 id="小結：目前寫法的問題"><a href="#小結：目前寫法的問題" class="headerlink" title="小結：目前寫法的問題"></a>小結：目前寫法的問題</h2><p>假設沒有序列化器輔助，要在程式碼中進行手動驗證，則上述寫法有兩個不妥之處：</p>
<ol>
<li>要驗證 input 資料是否為合法列舉成員，太囉嗦、冗長了。</li>
<li>如果加上<code>ALL</code>這類自定義屬性，雖然可以減緩程式碼冗長問題，又產生了潛在的同步問題。</li>
</ol>
<p>事實上，即使沒有<code>ALL</code>屬性，<strong>第一種寫法一樣存在同步問題</strong>。因為你要<strong>手動</strong>維護這個驗證條件。</p>
<p><code>ALL</code>屬性只是把這個「<strong>新增、刪除列舉成員</strong>」的<strong>同步議題</strong>從 view 函式中（或任何其它用到的地方）抽離出來，統一移到類別中控管。</p>
<p>這或許可以算是一個<strong>改進</strong>：當情況變動時，需要跟著修改的地方<strong>只剩下一個</strong>——<code>ALL</code>本身。<strong>但依舊不是最佳解法。</strong></p>
<hr>
<h2 id="第二部分：介紹-Python-Enum-的三大特性"><a href="#第二部分：介紹-Python-Enum-的三大特性" class="headerlink" title="第二部分：介紹 Python Enum 的三大特性"></a>第二部分：介紹 Python Enum 的三大特性</h2><p>自從寫 <a target="_blank" rel="noopener" href="https://django-ninja.dev/">Django Ninja</a> 後，為了渲染出嚴謹的 API 文件，我不得不用 Enum 了（可參考文章最後的<a href="/python-enum/#%E8%A3%9C%E5%85%85%EF%BC%9AEnum-%E9%A1%9E%E5%88%A5%E5%9C%A8-Django-Ninja-%E4%B8%AD%E7%9A%84%E6%87%89%E7%94%A8">補充</a>部分），同時也感受到了它的強大！</p>
<p>我們來看看，採用 Enum 之後會有什麼改變。</p>
<p>在此之前，我們要先介紹 Enum 中，<strong>我認為最重要的三大特性</strong>。至少在我的例子中，知道這三個特性會<strong>非常有用</strong>。</p>
<p>我們看一下加入了 Enum 後的類別模樣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RestartPolicy</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    所有容器重啟策略</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    NO = <span class="number">0</span></span><br><span class="line">    ALWAYS = <span class="number">1</span></span><br><span class="line">    UNLESS_STOPPED = <span class="number">2</span></span><br><span class="line">    ON_FAILURE = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>我把<code>ALL</code>屬性移除了，因為它不再需要。</p>
<p>我們就以這個新類別為例，來看看 Enum 的三大特性。</p>
<hr>
<h2 id="一、Enum-類別可以用-for-迴圈迭代"><a href="#一、Enum-類別可以用-for-迴圈迭代" class="headerlink" title="一、Enum 類別可以用 for 迴圈迭代"></a>一、Enum 類別可以用 for 迴圈迭代</h2><p>一般的類別並不能以 for 迴圈迭代，因為沒有實作<code>__iter__</code>方法，<strong>但 Enum 有！</strong></p>
<p>對於「列舉」這種有限成員的情況，能迭代它非常重要。</p>
<p>還記得原來的<code>ALL</code>屬性嗎？ <code>ALL = [0, 1, 2, 3]</code></p>
<p>這個<code>ALL</code>屬性的值，其實就是<strong>為了取得類別中的每一個屬性值</strong>。但有了 Enum，我們不用這麼麻煩了！</p>
<p>那我要怎麼取得 Enum 類別中的所有屬性值？這就要看下面第二個特性。</p>
<h2 id="二、了解-Enum-實例"><a href="#二、了解-Enum-實例" class="headerlink" title="二、了解 Enum 實例"></a>二、了解 Enum 實例</h2><p>這段特別長，因為它包含了<strong>三個子命題</strong>，都和 Enum 實例有關。</p>
<p>這裡要先問：<strong>如何取得 Enum 實例？</strong></p>
<h3 id="Enum-實例的建構與條件"><a href="#Enum-實例的建構與條件" class="headerlink" title="Enum 實例的建構與條件"></a>Enum 實例的建構與條件</h3><p>沒錯，和一般的類別相同，都是從建構與初始化開始，依舊使用上面的例子，我們可以像這樣獲得 Enum 實例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = RestartPolicy(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>和一般類別<strong>不同</strong>的是，這裡的建構<strong>引數</strong>，<strong>只能</strong>是「<strong>任一 Enum 成員的屬性值</strong>」。也就是範例類別中的<code>0</code>、<code>1</code>、<code>2</code>、<code>3</code>。</p>
<p>這是 Enum 類別的<strong>限制</strong>，也是它的<strong>重要特性</strong>。</p>
<p>換句話說，<strong>所有 Enum 類別的實例，都一定是由 Enum 成員值（比如上述的 2）建構而來的</strong>。</p>
<p>此外，<strong>沒有引數也不行！</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 沒有引數會報錯</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy()</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">TypeError: EnumMeta.__call__() missing <span class="number">1</span> required positional argument: <span class="string">&#x27;value&#x27;</span></span><br></pre></td></tr></table></figure>

<p>而建構出的實例，就是<strong>「代表該成員」的 Enum 實例</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>)</span><br><span class="line">&lt;RestartPolicy.UNLESS_STOPPED: <span class="number">2</span>&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Enum-類別屬性「就是」Enum-實例"><a href="#Enum-類別屬性「就是」Enum-實例" class="headerlink" title="Enum 類別屬性「就是」Enum 實例"></a>Enum 類別屬性「就是」Enum 實例</h2><blockquote>
<p><strong>這是 Enum 最重要的特性之一，也是最容易讓人困惑的地方。</strong></p>
</blockquote>
<p>除了透過建構，其實<strong>直接呼叫類別屬性</strong>，也能夠得到<strong>同一個</strong> Enum 成員實例！</p>
<p>這是一般類別所<strong>難以想像</strong>的，因為一般類別呼叫類別屬性後，只會得到單純的<strong>值</strong>，比如本文一開始的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 這裡是非 Enum 版的 RestartPolicy</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy.UNLESS_STOPPED</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>回到 Enum。換言之，下面兩種寫法，獲得的結果<strong>完全相同</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>)</span><br><span class="line">&lt;RestartPolicy.UNLESS_STOPPED: <span class="number">2</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy.UNLESS_STOPPED</span><br><span class="line">&lt;RestartPolicy.UNLESS_STOPPED: <span class="number">2</span>&gt;</span><br></pre></td></tr></table></figure>
<p><strong>不了解這個特性，會讓你對 Enum 的使用產生很大困惑。</strong></p>
<h3 id="單例模式"><a href="#單例模式" class="headerlink" title="單例模式"></a>單例模式</h3><p>更進一步說，Enum 類別的每一個成員實例，實際上都是<strong>單例</strong>。</p>
<p>這意味著對於每個成員，無論你在程式碼中呼叫多少次，<strong>都是指向「同一個」物件。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p1 = RestartPolicy(<span class="number">2</span>)</span><br><span class="line"><span class="meta">... </span>p2 = RestartPolicy(<span class="number">2</span>)</span><br><span class="line"><span class="meta">... </span>p1 <span class="keyword">is</span> p2</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>) <span class="keyword">is</span> RestartPolicy.UNLESS_STOPPED</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>了解這一點，就能夠更好地利用 Enum 來處理列舉資料。</p>
<hr>
<h2 id="Enum-實例的兩個屬性"><a href="#Enum-實例的兩個屬性" class="headerlink" title="Enum 實例的兩個屬性"></a>Enum 實例的兩個屬性</h2><p>所有 Enum 成員實例都有兩個內建的屬性：<code>name</code>與<code>value</code>。</p>
<p><code>name</code>是<strong>成員的名稱</strong>，也就是<strong>類別屬性名稱</strong>；<code>value</code>則是<strong>成員的值</strong>。</p>
<p>我們分別使用<strong>兩種不同的實例取得方式</strong>來呼叫這兩個屬性！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>).name</span><br><span class="line"><span class="string">&#x27;UNLESS_STOPPED&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同於</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy.UNLESS_STOPPED.name</span><br><span class="line"><span class="string">&#x27;UNLESS_STOPPED&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy.UNLESS_STOPPED.value</span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同於</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>).value</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>綜上所述，如果用 for 迴圈迭代<code>RestartPolicy</code>，你將得到（這裡使用<code>repr</code>突顯）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> RestartPolicy:</span><br><span class="line"><span class="meta">... </span>   <span class="built_in">print</span>(<span class="built_in">repr</span>(i))</span><br><span class="line"></span><br><span class="line">&lt;RestartPolicy.NO: <span class="number">0</span>&gt;</span><br><span class="line">&lt;RestartPolicy.ALWAYS: <span class="number">1</span>&gt;</span><br><span class="line">&lt;RestartPolicy.UNLESS_STOPPED: <span class="number">2</span>&gt;</span><br><span class="line">&lt;RestartPolicy.ON_FAILURE: <span class="number">3</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>得到<code>RestartPolicy</code>的每一個成員實例。</strong></p>
<hr>
<h2 id="三、Enum-實例之間可以進行比較"><a href="#三、Enum-實例之間可以進行比較" class="headerlink" title="三、Enum 實例之間可以進行比較"></a>三、Enum 實例之間可以進行比較</h2><p>Enum 成員之間，支援身分比較（<code>is</code>）和等值（<code>==</code>）比較。</p>
<p>只不過，如前所述，每一個 Enum 成員都是「<strong>單例</strong>」。所以身分比較和等值比較對於 Enum 成員是<strong>等價</strong>的，也就是<strong>結果都相同</strong>。因為每個成員都是<strong>唯一</strong>的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>) == RestartPolicy.UNLESS_STOPPED</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">2</span>) <span class="keyword">is</span> RestartPolicy.UNLESS_STOPPED</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>我認為大部分時候，使用等值（<code>==</code>）比較就已經足夠了。</p>
<hr>
<h2 id="第三部分：使用-Enum-改進原有程式！"><a href="#第三部分：使用-Enum-改進原有程式！" class="headerlink" title="第三部分：使用 Enum 改進原有程式！"></a>第三部分：使用 Enum 改進原有程式！</h2><p>現在你對 Enum 的特性已經有了相當的了解。我們來看看原來的程式碼在使用 Enum 版本後，會發生什麼樣的變化。</p>
<p>回顧一下之前的問題：</p>
<ol>
<li>要驗證 input 資料是否為合法列舉成員，太囉嗦、冗長了。</li>
<li>如果加上<code>ALL</code>這類自定義屬性，雖然可以減緩程式碼冗長問題，又產生了潛在的同步問題。</li>
</ol>
<h3 id="對問題一的改善"><a href="#對問題一的改善" class="headerlink" title="對問題一的改善"></a>對問題一的改善</h3><p>現在，你想要驗證 input 值是否屬於列舉成員，可以這樣寫（我們假設 input 值為 2，代表<code>&#39;unless-stopped&#39;</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> payload.restart_policy <span class="keyword">in</span> [p.value <span class="keyword">for</span> p <span class="keyword">in</span> RestartPolicy]:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>因為 <code>RestartPolicy</code> 類別現在是可以用 <code>for</code> 迭代了！而每一個元素則是成員實例，需要透過<code>value</code>屬性取值，所以可以像上面那樣寫。</p>
<p>乍看之下，好像也沒有方便到哪去？確實如此😅，沒關係，我們還有<a href="#%E9%80%8F%E9%81%8E%E3%80%8C%E5%BB%BA%E7%AB%8B-Enum-%E5%AF%A6%E4%BE%8B%E3%80%8D%E9%80%B2%E8%A1%8C%E9%A9%97%E8%AD%89">後手</a>。</p>
<h3 id="Pydantic-預處理"><a href="#Pydantic-預處理" class="headerlink" title="Pydantic 預處理"></a>Pydantic 預處理</h3><p>如果你有用 Pydantic 對資料預處理（FastAPI、Django Ninja 等後端框架會自動做這件事），通常<code>payload.restart_policy</code>的值，就<strong>已經是一個 Enum 實例了。</strong></p>
<blockquote>
<p>當然，如果有用 Pydantic 預處理，這個驗證根本不需要XD，這裡只是為了舉例。</p>
</blockquote>
<p>無論如何，現在你有一個 Enum 實例，那驗證成員身分的寫法將<strong>異常簡單</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> payload.restart_policy <span class="keyword">in</span> RestartPolicy:</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>對，就這麼簡單！</p>
<p>也就是你可以輕鬆寫下這樣的句型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;Enum 實例&gt; <span class="keyword">in</span> &lt;Enum 類別&gt;:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h3 id="關於in運算子"><a href="#關於in運算子" class="headerlink" title="關於in運算子"></a>關於<code>in</code>運算子</h3><p>因為<code>in</code>運算子的內部，本來就會<strong>「視情況」迭代後面接的物件</strong>了——<code>in</code>會優先調用<code>__contains__</code>方法，沒有實作此方法，才退回<code>__iter__</code>，也就是所謂的迭代。</p>
<p>所以<code>in</code>後面可以接兩種物件，以落實成員的查找：</p>
<ol>
<li>有實作<code>__contains__</code>方法的物件。比如<code>set</code>、<code>dict</code>等。</li>
<li>有實作<code>__iter__</code>方法的物件。（所有的 iterable 都有）</li>
</ol>
<p><strong>而 Enum 類別正是一個 iterable——它實作了<code>__iter__</code>方法</strong>。</p>
<hr>
<h2 id="透過「建立-Enum-實例」進行驗證"><a href="#透過「建立-Enum-實例」進行驗證" class="headerlink" title="透過「建立 Enum 實例」進行驗證"></a>透過「建立 Enum 實例」進行驗證</h2><p>但如果你的<code>payload.restart_policy</code>，就<strong>只是一般的值</strong>，而不是 Enum 成員。那該怎麼辦？難道真的要像上面那樣，寫落落長的<code>[p.value in p in RestartPolicy]</code>嗎？</p>
<p>當然不！其實做法一樣非常簡單，那就是「<strong>直接用這個值來建立實例</strong>」。</p>
<p><a href="#Enum-%E5%AF%A6%E4%BE%8B%E7%9A%84%E5%BB%BA%E6%A7%8B%E8%88%87%E6%A2%9D%E4%BB%B6">前面</a>說過，Enum 實例<strong>只能由 Enum 成員值建構而來</strong>。所以，如果你輸入的值不是<strong>合法</strong>的 Enum 成員，建構實例時就會拋出<code>ValueError</code>。</p>
<p>換句話說，<strong>只要能成功建立實例，就是合法的成員</strong>！所以你可以這樣寫：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    RestartPolicy(payload.restart_policy)</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>如果是不合法的，比如 4，則會拋出<code>ValueError</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>RestartPolicy(<span class="number">4</span>)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">ValueError: <span class="number">4</span> <span class="keyword">is</span> <span class="keyword">not</span> a valid RestartPolicy</span><br></pre></td></tr></table></figure>

<p>總之，<strong>記得處理這個例外。</strong></p>
<h3 id="對問題二的改善"><a href="#對問題二的改善" class="headerlink" title="對問題二的改善"></a>對問題二的改善</h3><p>既然 Enum 類別本身就可以用 for 迭代以取得所有成員（甚至直接使用<code>in</code>運算子），那就<strong>完全沒必要</strong>再寫前面像<code>ALL</code>一樣的屬性，然後還要維護它。</p>
<p>由此可見，Enum 真的棒！</p>
<hr>
<h2 id="補充：Enum-類別在-Django-Ninja-中的應用"><a href="#補充：Enum-類別在-Django-Ninja-中的應用" class="headerlink" title="補充：Enum 類別在 Django Ninja 中的應用"></a>補充：Enum 類別在 Django Ninja 中的應用</h2><p>前面說到我會開始用 Enum，正是因為 Django Ninja。</p>
<p>Django Ninja 的 <a target="_blank" rel="noopener" href="https://django-ninja.dev/guides/response/">Schema</a> 實際上就是 Pydantic 的 <a target="_blank" rel="noopener" href="https://docs.pydantic.dev/latest/concepts/models/#validation">BaseModel</a>。</p>
<p>Schema 用來描述 API 輸入與輸出的資料結構。主要的功能有二：</p>
<ol>
<li><strong>驗證</strong>輸入資料是否符合規範。</li>
<li><strong>自動產生</strong> API 文件。</li>
</ol>
<p>我們看一下使用了 Enum 型別後的 Schema：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateContainerRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    ...</span><br><span class="line">    restart_policy: RestartPolicy</span><br></pre></td></tr></table></figure>

<p>直接將<code>restart_policy</code>欄位型別標記為<code>RestartPolicy</code>，如此渲染出的 API 文件，不止能限定輸入資料的型別，連「<strong>值域</strong>」也會有<strong>明確標示</strong>：</p>
<p><img src="https://i.imgur.com/A8RgBlS.png" alt="型別：integer；值域：僅限 0、1、2、3"><span class="cap">型別：integer；值域：僅限 0、1、2、3</span></p>
<p>甚至還能把<code>RestartPolicy</code>類別中的<code>docstring</code><strong>直接渲染成欄位說明</strong>，太貼心了吧！偉哉 Pydantic！</p>
<p>好處不止如此，一旦你<strong>變更</strong>了<code>RestartPolicy</code>的內容（比如<strong>增加了成員選項</strong>），API 文件也會<strong>自動更新</strong>。</p>
<p>不必再手動修改 API 文件，也不必修改 Schema 的 type hints，完全省去了「同步」的煩惱。</p>
<h3 id="使用「字串」列舉"><a href="#使用「字串」列舉" class="headerlink" title="使用「字串」列舉"></a>使用「字串」列舉</h3><p>除了上述的「<strong>數字列舉</strong>」版，我同時再附上「<strong>字串列舉</strong>」版本，看圖你應該就能理解，為何我一開始說，有時候列舉資料用字串會更好。</p>
<p><img src="https://i.imgur.com/9eCQcFB.png"></p>
<p>直接採用字串選項，對前端人員更加友善——<strong>更容易了解每個選項代表的意義。</strong></p>

      </div>

      

      
      

<div>
  <script type="text/javascript">
    document.write(
      "<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/kyomind/button?referrer=" +
      encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");
  </script>
<div>

<div class="article-cta">

    喜歡這篇文章？歡迎<a href="/subscribe/">訂閱本站</a>，或<a href="https://portaly.cc/kyomind/support" target="_blank">支持我的創作</a>。

</div>

    <b style="font-size:21px">
      相關文章
    </b><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/django-ninja-01/" title="Django Ninja 01：系列導讀 × 目標讀者" rel="bookmark">Django Ninja 01：系列導讀 × 目標讀者</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/robust-python-01/" title="《強健的 Python》筆記：如何有效導入 Type Hints" rel="bookmark">《強健的 Python》筆記：如何有效導入 Type Hints</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/django-ninja-12/" title="請求（四）Request Body 與 Schema 介紹" rel="bookmark">請求（四）Request Body 與 Schema 介紹</a></h3></div></li></ul><footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/Python/">Python</a>
            <a href="/tags/Django-Ninja/">Django Ninja</a>
            <a href="/tags/Pydantic/">Pydantic</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/weekly-review-27/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">正式入手《流暢的 Python》第二版</span>
        <span class="prev-text nav-mobile">正式入手《流暢的 Python》第二版</span>
      </a>
    <a class="next" href="/weekly-review-28/">
        <span class="next-text nav-default">28，去了 2 個月圖書館之後</span>
        <span class="next-text nav-mobile">28，去了 2 個月圖書館之後</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    
      

<div style="background-color: #e7e9ec; border-radius: 5px;">
  <div class="categories">
    <div class="categories-tags">
      <a class="category-link" href="/categories/Django/">Django<span class="category-count">13</span></a> <a class="category-link" href="/categories/Django-Ninja-%E7%B3%BB%E5%88%97/">Django Ninja 系列<span class="category-count">30</span></a> <a class="category-link" href="/categories/VS-Code/">VS Code<span class="category-count">9</span></a> <a class="category-link" href="/categories/Weekly-Review/">Weekly Review<span class="category-count">44</span></a> <a class="category-link" href="/categories/%E5%BF%83%E5%BE%97/">心得<span class="category-count">56</span></a> <a class="category-link" href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發<span class="category-count">44</span></a>
    </div>
  </div>
</div>
</article></div><div class="comments" id="comments"><div id="utterances-container"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:odinxp@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/kyomind" class="iconfont icon-github" title="github"></a>
        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kyo-huang/" class="iconfont icon-linkedin" title="linkedin"></a>
        <a target="_blank" rel="noopener" href="https://x.com/kyomind" class="iconfont icon-twitter" title="twitter"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">and</span>
  <span class="theme-info">
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2021 - 2025<span class="heart">
      <i class="iconfont icon-right"></i>
    </span>
    <span class="author">Kyo Huang</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script>
    var container = document.getElementById('utterances-container')
    var script = document.createElement('script')
    script.src = 'https://utteranc.es/client.js'
    script.setAttribute('repo', 'kyomind/blog-reply')
    script.setAttribute('issue-term', 'title')
    script.setAttribute('theme', 'github-light')
    script.setAttribute('label', 'utterances')
    script.crossorigin = 'anonymous'
    script.async = true

    container.appendChild(script)
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
