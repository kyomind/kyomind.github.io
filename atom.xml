<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Code and Me</title>
  <icon>https://blog.kyomind.tw/leaf.svg</icon>
  <subtitle>æˆ‘çš„ç¨‹å¼èˆ‡å­¸ç¿’å¿ƒå¾—</subtitle>
  <link href="https://blog.kyomind.tw/atom.xml" rel="self"/>
  
  <link href="https://blog.kyomind.tw/"/>
  <updated>2024-10-10T13:57:06.222Z</updated>
  <id>https://blog.kyomind.tw/</id>
  
  <author>
    <name>Kyo Huang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 28ï¼šèº«åˆ†èªè­‰â€”â€”Session èªè­‰èˆ‡å…¨åŸŸè¨­å®š</title>
    <link href="https://blog.kyomind.tw/django-ninja-28/"/>
    <id>https://blog.kyomind.tw/django-ninja-28/</id>
    <published>2024-10-10T01:42:57.000Z</published>
    <updated>2024-10-10T13:57:06.222Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>æ­¡è¿ä¾†åˆ°ç¬¬ä¸ƒç« ï¼æœ¬ç« ç¸½å…±æœ‰å…©ç¯‡å…§å®¹ï¼š</p><ul><li>å· 28ï¼šèº«åˆ†èªè­‰â€”â€”Session èªè­‰èˆ‡å…¨åŸŸè¨­å®š</li><li>å· 29ï¼šå–®å…ƒæ¸¬è©¦â€”â€”ä½¿ç”¨ Test Client èˆ‡ pytest æ¸¬è©¦ API</li></ul><p>é€™äº›ä¸»é¡Œçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œ<strong>ä¸¦éç”± Django Ninja å¯¦ä½œ</strong>ï¼Œä½†æ¡†æ¶ä»æä¾›äº†<strong>ä¸€å®šç¨‹åº¦çš„æ•´åˆ</strong>ã€‚ä¸¦ä¸”ï¼Œé€™äº›åŠŸèƒ½å°æ–¼ä»»ä½• Django å°ˆæ¡ˆä¾†èªªï¼Œéƒ½è‡³é—œé‡è¦ã€‚</p><p>æœ¬æ–‡ä»‹ç´¹å¹¾ä¹æ‰€æœ‰ API å°ˆæ¡ˆéƒ½éœ€è¦çš„â€”â€”<strong>èº«åˆ†èªè­‰</strong>ï¼ˆ<a href="https://django-ninja.dev/guides/authentication/">Authentication</a>ï¼‰ã€‚</p><p>æˆ‘å€‘å°‡æ¢è¨å¦‚ä½•åœ¨ Django Ninja ä¸­åˆ©ç”¨ Django å…§å»ºçš„ session-based èªè­‰ï¼Œå¯¦ç¾å®Œæ•´çš„ç™»å…¥é©—è­‰åŠŸèƒ½ï¼Œä¸¦é€²ä¸€æ­¥èªªæ˜å¦‚ä½•è¨­å®š<strong>å…¨åŸŸèªè­‰</strong>ï¼Œä»¥æ¸›å°‘ç¨‹å¼ç¢¼çš„é‡è¤‡ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/19">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="èªè­‰çš„å…©å€‹å±¤æ¬¡"><a href="#èªè­‰çš„å…©å€‹å±¤æ¬¡" class="headerlink" title="èªè­‰çš„å…©å€‹å±¤æ¬¡"></a>èªè­‰çš„å…©å€‹å±¤æ¬¡</h2><p>é€²å…¥å¯¦ä½œå‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£ï¼Œæ‰€è¬‚çš„<strong>èº«åˆ†èªè­‰</strong>ï¼Œç©¶ç«Ÿä»£è¡¨ä»€éº¼ã€‚</p><p>ä»¥ã€Œå¸³è™Ÿå¯†ç¢¼ + session èªè­‰ã€ç‚ºä¾‹ï¼Œèº«åˆ†èªè­‰çš„ç¯„åœä¸»è¦æ¶µè“‹<strong>å…©å€‹éšæ®µ</strong>ã€‚</p><p>é¦–å…ˆï¼Œç•¶ä½¿ç”¨è€…é€éå¸³è™Ÿå¯†ç¢¼é€²è¡Œç™»å…¥æ™‚ï¼Œç³»çµ±æœƒæª¢æŸ¥é€™äº›å…§å®¹ã€ç¢ºèªèº«åˆ†<strong>åˆæ³•</strong>ã€‚ç™»å…¥æˆåŠŸå¾Œï¼Œç³»çµ±æœƒå°‡ä½¿ç”¨è€…è³‡è¨Šï¼ˆæ¯”å¦‚ç”¨æˆ¶ idï¼‰å„²å­˜è‡³ sessionï¼Œä»¥<strong>ç¶­æŒç™»å…¥ç‹€æ…‹</strong>ã€‚</p><p>é€™æ˜¯<strong>ç™»å…¥æ™‚çš„èªè­‰</strong>ï¼Œä¹Ÿæ˜¯æˆ‘å€‘æœ€å¸¸èªªçš„èªè­‰ã€‚ï¼ˆ<strong>ç‹¹ç¾©çš„èªè­‰</strong>ï¼‰</p><p>æ¥è‘—ï¼Œç•¶ä½¿ç”¨è€…å˜—è©¦å­˜å–å—ã€Œ<strong>èªè­‰ä¿è­·</strong>ã€çš„ API æ™‚ï¼Œç³»çµ±æœƒæª¢æŸ¥ session ä¸¦ç¢ºèªèº«åˆ†ï¼Œç¢ºä¿æ¯å€‹ API è«‹æ±‚éƒ½ä¾†è‡ª<strong>åˆæ³•ç™»å…¥</strong>çš„ä½¿ç”¨è€…ã€‚</p><p>ç°¡è¨€ä¹‹ï¼š</p><ul><li>ç¬¬ä¸€éšæ®µï¼šåˆæ¬¡ç™»å…¥æ™‚çš„èº«åˆ†ç¢ºèªã€‚</li><li>ç¬¬äºŒéšæ®µï¼šå¾ŒçºŒè«‹æ±‚æ™‚çš„èº«åˆ†ç¢ºèªã€‚</li></ul><p>å…©å€‹å±¤æ¬¡ç›¸è¼”ç›¸æˆã€ä¸€é«”å…©é¢ï¼Œç¢ºä¿æœå‹™èƒ½å¤ åœ¨ä½¿ç”¨è€…<strong>ç™»å…¥</strong>å’Œ<strong>å¾ŒçºŒæ“ä½œ</strong>ä¸­ï¼Œæä¾›é©ç•¶çš„å®‰å…¨ä¿éšœã€‚</p><span id="more"></span><hr><h2 id="å¯¦ä½œã€Œä½¿ç”¨è€…ç™»å…¥ã€API"><a href="#å¯¦ä½œã€Œä½¿ç”¨è€…ç™»å…¥ã€API" class="headerlink" title="å¯¦ä½œã€Œä½¿ç”¨è€…ç™»å…¥ã€API"></a>å¯¦ä½œã€Œä½¿ç”¨è€…ç™»å…¥ã€API</h2><p>äº†è§£äº†ä¸Šè¿°å…©å€‹å±¤æ¬¡å¾Œï¼Œæˆ‘å€‘è¦å…ˆä¾†å¯¦ä½œã€Œ<strong>ç‹¹ç¾©</strong>ã€çš„èªè­‰â€”â€”ä¹Ÿå°±æ˜¯<strong>ç™»å…¥é©—è­‰</strong>æœ¬èº«ã€‚</p><p>æˆ‘å€‘å°‡å»ºç«‹ä¸€å€‹ã€Œä½¿ç”¨è€…ç™»å…¥ã€APIï¼Œä¸¦ç›´æ¥é€é Django çš„<code>authenticate</code>å’Œ<code>login</code>å‡½å¼è™•ç†<strong>å¸³è™Ÿå¯†ç¢¼é©—è­‰</strong>å’Œ<strong>ç™»å…¥ç‹€æ…‹</strong>â€”â€”éå¸¸æ–¹ä¾¿ï¼</p><p><code>authenticate</code>ç”¨ä¾†<strong>é©—è­‰</strong>ä½¿ç”¨è€…è¼¸å…¥çš„å¸³è™Ÿï¼ˆ<code>username</code>ï¼‰å’Œå¯†ç¢¼æ˜¯å¦æ­£ç¢ºï¼Œ<code>login</code>å‰‡å°‡ä½¿ç”¨è€…çš„ç™»å…¥ç‹€æ…‹<strong>å„²å­˜</strong>è‡³ sessionã€‚</p><h3 id="ç¨‹å¼ç¢¼å¯¦ä½œ"><a href="#ç¨‹å¼ç¢¼å¯¦ä½œ" class="headerlink" title="ç¨‹å¼ç¢¼å¯¦ä½œ"></a>ç¨‹å¼ç¢¼å¯¦ä½œ</h3><p>å…ˆæ–°å¢ä¸€å€‹ç™»å…¥è«‹æ±‚ Schemaï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># user/schemas.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    username: <span class="built_in">str</span> = Field(examples=[<span class="string">&#x27;Alice&#x27;</span>])</span><br><span class="line">    password: <span class="built_in">str</span> = Field(examples=[<span class="string">&#x27;password123&#x27;</span>])</span><br></pre></td></tr></table></figure><p>ç„¶å¾Œæ˜¯ view å‡½å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user.schemas <span class="keyword">import</span> CreateUserRequest, LoginRequest</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&#x27;/users/login/&#x27;</span>, summary=<span class="string">&#x27;ç™»å…¥ä½¿ç”¨è€…&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_user</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest, payload: LoginRequest</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ç™»å…¥ä½¿ç”¨è€…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    user = authenticate(</span><br><span class="line">        request,</span><br><span class="line">        username=payload.username,</span><br><span class="line">        password=payload.password</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        login(request, user)  <span class="comment"># å°‡ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹å„²å­˜è‡³ session</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç™»å…¥æˆåŠŸ&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> HttpError(<span class="number">401</span>, <span class="string">&#x27;å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤&#x27;</span>)</span><br></pre></td></tr></table></figure><p>éå¸¸ç°¡å–®ï¼</p><p>é™„å¸¶ä¸€æï¼Œæˆ‘ä¸å¤ªå–œæ­¡ç¨‹å¼ä¸­æœ‰ã€Œä¸å¿…è¦ã€çš„<code>else</code>ï¼Œæ­¤æ™‚çš„å¯«æ³•ä»ä¸ç›¡ç†æƒ³â€”â€”å› ç‚º<code>else</code><strong>å®Œå…¨å¯ä»¥çœç•¥</strong>ã€‚</p><p>åœ¨æœ€æ–°çš„ç¨‹å¼ç¢¼ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘å·²æ”¹æˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user = authenticate(...)</span><br><span class="line"><span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">raise</span> HttpError(<span class="number">401</span>, <span class="string">&#x27;å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤&#x27;</span>)</span><br><span class="line"></span><br><span class="line">login(request, user)  <span class="comment"># å°‡ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹å„²å­˜è‡³ session</span></span><br><span class="line"><span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ç™»å…¥æˆåŠŸ&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¨£çš„åšæ³•å³æ‰€è¬‚çš„ <a href="https://zh.wikipedia.org/zh-tw/%E5%8D%AB%E8%AF%AD%E5%8F%A5">Guard Clause</a> æˆ– <a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/early-return-coding-skill-9f3016d4b88d">Early Return</a>ï¼ˆé›–ç„¶é€™è£¡æ˜¯ raiseï¼‰ã€‚</p><h3 id="ç°¡è©•èˆ‡é‡è¦è£œå……"><a href="#ç°¡è©•èˆ‡é‡è¦è£œå……" class="headerlink" title="ç°¡è©•èˆ‡é‡è¦è£œå……"></a>ç°¡è©•èˆ‡é‡è¦è£œå……</h3><p><code>authenticate</code>å’Œ<code>login</code>çš„ç”¨æ³•å¹¾ä¹æ˜¯å›ºå®šçš„ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼š</p><ul><li><code>authenticate</code>åœ¨é©—è­‰æˆåŠŸæ™‚æœƒ return å°æ‡‰çš„<code>User</code>ç‰©ä»¶ï¼Œå¤±æ•—æ™‚å‰‡è¿”å›<code>None</code>ã€‚</li><li><code>login</code>ä¸æœƒ returnï¼Œä½†<code>request</code>å’Œ<code>user</code>ç‚ºå¿…è¦çš„åƒæ•¸ã€‚</li></ul><p>æˆåŠŸç™»å…¥å¾Œï¼Œä½ æœƒå¾—åˆ° 200 å›æ‡‰ï¼Œä¸¦ç²å¾—å…©çµ„ cookieï¼š</p><p><img src="https://i.imgur.com/c6gMBDY.png"></p><p>é€™å°æ–¼ API clientï¼ˆæ¯”å¦‚ Postmanï¼‰ä½¿ç”¨è€…å¾ˆé‡è¦ï¼Œç•¢ç«Ÿç€è¦½å™¨æœƒè‡ªå‹•å¹«ä½ å­˜ï¼Œä½†é€™äº›å·¥å…·å¯ä¸æœƒâ€”â€”å¥½å§ï¼Œæˆ‘éŒ¯äº†ï¼Œè‡³å°‘æˆ‘ç”¨çš„ RapidAPI æœƒ<strong>è‡ªå‹•å­˜å„²ã€ç™¼é€</strong>ï¼</p><p>ï¼ˆæˆ‘æ¸¬è©¦ API æ™‚é‚„è¦ºå¾—å¥‡æ€ªï¼Œæ€éº¼èªè­‰é˜²è­·éƒ½å¤±æ•ˆäº†ğŸ¤£ï¼‰</p><p>å¦‚æœå·¥å…·æ²’æœ‰å¹«ä½ åšï¼Œè¨˜å¾—è‡ªå·±åœ¨è«‹æ±‚çš„ headers åŠ ä¸Šï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/users/2/avatar/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">...</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>csrftoken=...; sessionid=...</span><br><span class="line"><span class="attribute">X-CSRFToken</span><span class="punctuation">: </span>...</span><br></pre></td></tr></table></figure><p><code>authenticate</code>é è¨­æ˜¯ä»¥<code>AbstractUser</code>çš„<code>username</code>æ¬„ä½å’Œå¯†ç¢¼ä½œç‚ºèªè­‰åŸºæº–ï¼Œå¦‚æœæƒ³ç”¨åˆ¥çš„æ¬„ä½ï¼Œæ¯”å¦‚<code>email</code>ï¼Œå‰‡è¦è‡ªå·±è¦†å¯« Django çš„èªè­‰å¾Œç«¯ã€‚</p><hr><h2 id="ç‚º-API-åŠ ä¸Šã€Œèªè­‰ä¿è­·ã€"><a href="#ç‚º-API-åŠ ä¸Šã€Œèªè­‰ä¿è­·ã€" class="headerlink" title="ç‚º API åŠ ä¸Šã€Œèªè­‰ä¿è­·ã€"></a>ç‚º API åŠ ä¸Šã€Œèªè­‰ä¿è­·ã€</h2><p>ç™»å…¥åŠŸèƒ½å®Œæˆå¾Œï¼Œæ¥ä¸‹ä¾†è¦å°‡ã€Œéœ€è¦ç™»å…¥æ‰èƒ½å­˜å–ã€çš„ APIï¼Œåˆ†åˆ¥åŠ ä¸Š<strong>èªè­‰ä¿è­·</strong>ï¼Œä½¿ç”¨ Django Ninja æä¾›çš„<code>django_auth</code>â€”â€”é€™æ˜¯å°ˆé–€çµ¦ Django å…§å»ºçš„ session èªè­‰ä½¿ç”¨ã€‚</p><p>æˆ‘å€‘ä»¥ã€Œä¸Šå‚³ avatarã€API ç‚ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ninja.security <span class="keyword">import</span> django_auth</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@router.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    path=<span class="string">&#x27;/users/&#123;int:user_id&#125;/avatar/&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&#x27;ä¸Šå‚³ avatar&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    auth=django_auth  <span class="comment"># åŠ ä¸Šé€™çµ„åƒæ•¸</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br></pre></td></tr></table></figure><p>é€™å€‹ä¾‹å­ä¸­ï¼Œ<code>auth=django_auth</code>ç¢ºä¿åªæœ‰ã€Œå·²ç™»å…¥çš„ä½¿ç”¨è€…ã€æ‰èƒ½å­˜å–æ­¤ APIï¼Œå¦å‰‡å°‡å¾—åˆ° 401 æˆ– 403 å›æ‡‰ã€‚</p><hr><h2 id="Django-Ninja-çš„-request-auth"><a href="#Django-Ninja-çš„-request-auth" class="headerlink" title="Django Ninja çš„ request.auth"></a>Django Ninja çš„ request.auth</h2><p>ä½†ä½ å¯èƒ½æœƒæƒ³åˆ°ï¼š</p><blockquote><p>å…‰æ˜¯é©—è­‰ã€Œå·²ç™»å…¥ã€é‚„ä¸å¤ å§ï¼Ÿ</p></blockquote><p>ã€Œä¸Šå‚³ avatarã€æ‡‰è©²åªèƒ½å¹«ã€Œ<strong>è‡ªå·±</strong>ã€ä¸Šå‚³ï¼Œç¸½ä¸èƒ½å¹«ã€Œ<strong>åˆ¥äºº</strong>ã€ä¸Šå‚³å¤§é ­ç…§å§ï¼</p><p>æ²’éŒ¯ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ <strong>view å‡½å¼å…§éƒ¨</strong>ï¼Œé‚„è¦<strong>å¤šä¸€å±¤é©—è­‰</strong>ã€‚</p><h3 id="Django-çš„request-user"><a href="#Django-çš„request-user" class="headerlink" title="Django çš„request.user"></a>Django çš„<code>request.user</code></h3><p>å‚³çµ±çš„ Django å°ˆæ¡ˆï¼Œæˆ‘å€‘æœƒé€éå‡½å¼çš„ç¬¬ä¸€åƒæ•¸â€”â€”<code>request</code>ï¼Œç”¨<code>request.user</code>ä¾†ç²å¾—<strong>ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š</strong>ï¼Œæ¯”å¦‚ï¼šï¼ˆåƒè€ƒ<a href="https://docs.djangoproject.com/en/5.1/topics/auth/default/#authentication-in-web-requests">æ–‡ä»¶</a>ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">    <span class="comment"># Do something for authenticated users.</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># Do something for anonymous users.</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>å…·é«”ä¾†èªªï¼š</p><ul><li>ç•¶ä½¿ç”¨è€…å·²ç™»å…¥ï¼Œ<code>request.user</code>æœƒæ˜¯ä¸€å€‹<code>User</code>å¯¦ä¾‹ï¼Œä»£è¡¨<strong>ç•¶å‰ç™»å…¥çš„ä½¿ç”¨è€…</strong>ã€‚</li><li>æœªç™»å…¥æ™‚ï¼Œ<code>request.user</code>å‰‡æ˜¯ä¸€å€‹<code>AnonymousUser</code>å¯¦ä¾‹ï¼Œä»£è¡¨<strong>æœªç™»å…¥ä½¿ç”¨è€…</strong>ã€‚</li></ul><p>ç•¶ä½¿ç”¨è€…å·²ç™»å…¥ï¼Œæˆ‘å€‘å¯ä»¥æª¢æŸ¥<code>request.user</code>çš„å±¬æ€§ï¼Œæ¯”å¦‚<code>request.user.id</code>ï¼Œä¾†ç¢ºèª<strong>æ˜¯å¦ç‚ºã€Œæœ¬äººã€</strong>ã€‚</p><h3 id="Django-Ninja-çš„request-auth"><a href="#Django-Ninja-çš„request-auth" class="headerlink" title="Django Ninja çš„request.auth"></a>Django Ninja çš„<code>request.auth</code></h3><p>ä½†å¯« Django Ninja å‰‡éœ€è¦ä½¿ç”¨å®ƒæä¾›çš„<code>request.auth</code>ï¼Œå¯¦ä½œçµæœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_avatar</span>(<span class="params">...</span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šå‚³ avatar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æª¢æŸ¥ç™»å…¥çš„ä½¿ç”¨è€…æ˜¯å¦ç‚ºã€Œæœ¬äººã€</span></span><br><span class="line">    <span class="keyword">if</span> request.auth.<span class="built_in">id</span> != user_id:</span><br><span class="line">        <span class="keyword">raise</span> HttpError(<span class="number">403</span>, <span class="string">&#x27;ç„¡æ¬Šé™ä¸Šå‚³å…¶ä»–ä½¿ç”¨è€…çš„ avatar&#x27;</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>æ¸¬è©¦ä¸€ä¸‹ï¼Œç™»å…¥å¾Œåœ¨ URL path æ‰“åˆ¥äººçš„ id ä¾†å‘¼å«æ­¤ APIï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 403 Forbidden</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç„¡æ¬Šé™ä¸Šå‚³å…¶ä»–ä½¿ç”¨è€…çš„ avatar&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>éå¸¸å¥½ï¼</p><hr><h2 id="request-auth-è§£æ"><a href="#request-auth-è§£æ" class="headerlink" title="request.auth è§£æ"></a>request.auth è§£æ</h2><p>é›–ç„¶é€™è£¡ç”¨<code>request.auth</code>ä¾†å–ä»£<code>request.user</code>ï¼Œä½†å…¶å¯¦å…©è€…çš„å…§æ¶µæœ‰<strong>å¾ˆå¤§çš„ä¸åŒ</strong>ã€‚</p><p>åœ¨ Django Ninja ä¸­ï¼Œ<code>request.auth</code>ä»£è¡¨çš„æ˜¯<strong>èªè­‰æµç¨‹ return çš„çµæœ</strong>ã€‚æ­¤å¤–ï¼ŒDjango Ninja å…è¨±ä½ <strong>è‡ªå®šç¾©èªè­‰æ–¹æ³•</strong>ï¼Œæ‰€ä»¥<code>request.auth</code>çš„å…§å®¹æ˜¯<strong>ä¸å›ºå®šçš„</strong>ã€‚</p><p>è®“æˆ‘å€‘æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚</p><h3 id="èªè­‰çµæœ"><a href="#èªè­‰çµæœ" class="headerlink" title="èªè­‰çµæœ"></a>èªè­‰çµæœ</h3><p><code>request.auth</code>åŒ…å«äº†<strong>ç•¶å‰èªè­‰æ–¹æ³•</strong>è¿”å›çš„å€¼ã€‚</p><ul><li>é€™å€‹å€¼å¯ä»¥æ˜¯<strong>ä»»ä½•é¡å‹</strong>ï¼Œå–æ±ºæ–¼ä½ <strong>å¦‚ä½•å¯¦ç¾èªè­‰é‚è¼¯</strong>ã€‚</li><li>é€™çµ¦äº†é–‹ç™¼è€…æ¥µå¤§çš„éˆæ´»æ€§ï¼Œå®ƒå¯ä»¥æ˜¯<code>User</code>ç‰©ä»¶ã€å­—ä¸²ã€Python å­—å…¸ç­‰ç­‰ã€‚</li></ul><h3 id="èªè­‰æ–¹æ³•èˆ‡å¸¸è¦‹ç”¨ä¾‹"><a href="#èªè­‰æ–¹æ³•èˆ‡å¸¸è¦‹ç”¨ä¾‹" class="headerlink" title="èªè­‰æ–¹æ³•èˆ‡å¸¸è¦‹ç”¨ä¾‹"></a>èªè­‰æ–¹æ³•èˆ‡å¸¸è¦‹ç”¨ä¾‹</h3><ul><li>ä½¿ç”¨ Django çš„ session èªè­‰æ™‚ï¼Œ<code>request.auth</code>æ˜¯ Django çš„<code>User</code>ç‰©ä»¶ã€‚</li><li>å°æ–¼ API key èªè­‰ï¼Œ<code>request.auth</code>å¯èƒ½æ˜¯ API key æœ¬èº«æˆ–èˆ‡ä¹‹ç›¸é—œçš„è³‡è¨Šã€‚</li><li>åœ¨ JWT èªè­‰ä¸­ï¼Œ<code>request.auth</code>å¯èƒ½åŒ…å«è§£ç¢¼å¾Œçš„ token è³‡è¨Šã€‚</li></ul><p>ç¸½ä¹‹ï¼Œåªè¦è¨˜å¾—ï¼Œæƒ³åœ¨ view å‡½å¼å…§é€²ä¸€æ­¥å–å¾—<strong>èªè­‰è³‡è¨Š</strong>ï¼Œè¦é€é<code>request.auth</code>ã€‚</p><hr><p>é€™æ¨£å°±å·²ç¶“å¯¦ä½œå®Œèªè­‰äº†ï¼Œä½†æˆ‘å€‘å¯ä»¥è®“äº‹æƒ…æ›´ã€Œç°¡å–®ã€ä¸€é»ã€‚</p><h2 id="å…¨åŸŸèªè­‰çš„è¨­å®šèˆ‡ä¾‹å¤–"><a href="#å…¨åŸŸèªè­‰çš„è¨­å®šèˆ‡ä¾‹å¤–" class="headerlink" title="å…¨åŸŸèªè­‰çš„è¨­å®šèˆ‡ä¾‹å¤–"></a>å…¨åŸŸèªè­‰çš„è¨­å®šèˆ‡ä¾‹å¤–</h2><p>ä¸€ä¸€å°æ¯å€‹ API è¨­å®šèªè­‰ä¿è­·ï¼Œæ„Ÿè¦ºæœ‰é»<strong>ç¹ç‘£</strong>â€”â€”å°¤å…¶åœ¨ API å¤šçš„æ™‚å€™ã€‚</p><p>å› æ­¤ï¼ŒDjango Ninja æ”¯æ´<strong>å…¨åŸŸèªè­‰</strong>ï¼Œè®“æ‰€æœ‰ API <strong>é è¨­éƒ½ç›´æ¥å—åˆ°ä¿è­·</strong>ï¼Œé–‹ç™¼è€…åªéœ€åœ¨ç‰¹å®šè·¯ç”±ä¸­é€²è¡Œ<strong>ä¾‹å¤–</strong>è™•ç†ï¼Œ<strong>æ’é™¤</strong>ä¸æƒ³å¥—ç”¨çš„ API å³å¯ã€‚</p><p>å¯¦ä½œä¸Šéå¸¸ç°¡å–®ï¼ŒDjango Ninja ç›´æ¥æä¾›äº†<code>SessionAuth</code>èªè­‰é¡åˆ¥ï¼Œç”¨ä¾†è™•ç†å…¨åŸŸçš„ session-based èªè­‰ã€‚</p><h3 id="å¯¦ä½œå…¨åŸŸèªè­‰ï¼šä½¿ç”¨SessionAuth"><a href="#å¯¦ä½œå…¨åŸŸèªè­‰ï¼šä½¿ç”¨SessionAuth" class="headerlink" title="å¯¦ä½œå…¨åŸŸèªè­‰ï¼šä½¿ç”¨SessionAuth"></a>å¯¦ä½œå…¨åŸŸèªè­‰ï¼šä½¿ç”¨<code>SessionAuth</code></h3><p>åœ¨å°ˆæ¡ˆçš„<code>api.py</code>ä¸­åŠ å…¥ä¸‹é¢å…§å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NinjaForum/api.py</span></span><br><span class="line"><span class="keyword">from</span> ninja.security <span class="keyword">import</span> SessionAuth</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">api = NinjaAPI(</span><br><span class="line">    auth=SessionAuth(),  <span class="comment"># è¨­å®šå…¨åŸŸèªè­‰</span></span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€ä¾†ï¼Œå…¨éƒ¨çš„ API éƒ½<strong>é è¨­æ“æœ‰èªè­‰ä¿è­·</strong>ï¼Œä½ å¯ä»¥åœ¨ç‰¹å®š API ä¸­æ’é™¤ï¼Œæ¯”å¦‚ã€Œç™»å…¥ä½¿ç”¨è€…ã€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params">path=<span class="string">&#x27;/users/login/&#x27;</span>, summary=<span class="string">&#x27;ç™»å…¥ä½¿ç”¨è€…&#x27;</span>, auth=<span class="literal">None</span></span>)</span></span><br></pre></td></tr></table></figure><p>åœ¨è·¯ç”±è£é£¾å™¨ä¸­ï¼ŒæŠŠ<code>auth</code>å®šç¾©ç‚º<code>None</code>ï¼Œ<strong>è§£é™¤</strong>èªè­‰ä¿è­·ã€‚</p><hr><h2 id="å°çµèˆ‡ä¸‹ä¸€æ­¥"><a href="#å°çµèˆ‡ä¸‹ä¸€æ­¥" class="headerlink" title="å°çµèˆ‡ä¸‹ä¸€æ­¥"></a>å°çµèˆ‡ä¸‹ä¸€æ­¥</h2><p>åœ¨é€™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘æ¢è¨äº† Django çš„ session èªè­‰èˆ‡ Django Ninja çš„æ•´åˆï¼Œå¯¦ä½œäº†ã€Œä½¿ç”¨è€…ç™»å…¥ã€APIï¼Œä¸¦ç‚ºå…¶ä»– API åŠ ä¸Šèªè­‰ä¿è­·ã€‚æœ€å¾Œé‚„ç¤ºç¯„äº†å¦‚ä½•å¯¦ç¾å…¨åŸŸèªè­‰ï¼Œè®“æ•´å€‹æµç¨‹æ›´åŠ ç°¡å–®ã€‚</p><p>é€™å€‹ç³»åˆ—çš„<strong>æœ€å¾Œå¯¦è¸</strong>ï¼Œæˆ‘å€‘è¦ä¾†ç‚ºå°ˆæ¡ˆâ€”â€”<strong>å¯«æ¸¬è©¦</strong>ï¼</p><p>ä¸‹ä¸€ç¯‡å°‡æ¢è¨ï¼Œå¦‚ä½•ä½¿ç”¨ test client å’Œ pytest ä¾†ç‚ºæˆ‘å€‘çš„ Django API æ’°å¯«<strong>å–®å…ƒæ¸¬è©¦</strong>ã€‚é€™ä¸åƒ…èƒ½å¹«åŠ©æˆ‘å€‘é©—è­‰ç¾æœ‰åŠŸèƒ½ï¼Œé‚„èƒ½ç‚ºæœªä¾†çš„é–‹ç™¼å’Œé‡æ§‹æä¾›å¤šä¸€å±¤çš„ä¿éšœã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ­¡è¿ä¾†åˆ°ç¬¬ä¸ƒç« ï¼æœ¬ç« ç¸½å…±æœ‰å…©ç¯‡å…§å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å· 28ï¼šèº«åˆ†èªè­‰â€”â€”Session èªè­‰èˆ‡å…¨åŸŸè¨­å®š&lt;/li&gt;
&lt;li&gt;å· 29ï¼šå–®å…ƒæ¸¬è©¦â€”â€”ä½¿ç”¨ Test Client èˆ‡ pytest æ¸¬è©¦ API&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›ä¸»é¡Œçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œ&lt;strong&gt;ä¸¦éç”± Django Ninja å¯¦ä½œ&lt;/strong&gt;ï¼Œä½†æ¡†æ¶ä»æä¾›äº†&lt;strong&gt;ä¸€å®šç¨‹åº¦çš„æ•´åˆ&lt;/strong&gt;ã€‚ä¸¦ä¸”ï¼Œé€™äº›åŠŸèƒ½å°æ–¼ä»»ä½• Django å°ˆæ¡ˆä¾†èªªï¼Œéƒ½è‡³é—œé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç´¹å¹¾ä¹æ‰€æœ‰ API å°ˆæ¡ˆéƒ½éœ€è¦çš„â€”â€”&lt;strong&gt;èº«åˆ†èªè­‰&lt;/strong&gt;ï¼ˆ&lt;a href=&quot;https://django-ninja.dev/guides/authentication/&quot;&gt;Authentication&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å°‡æ¢è¨å¦‚ä½•åœ¨ Django Ninja ä¸­åˆ©ç”¨ Django å…§å»ºçš„ session-based èªè­‰ï¼Œå¯¦ç¾å®Œæ•´çš„ç™»å…¥é©—è­‰åŠŸèƒ½ï¼Œä¸¦é€²ä¸€æ­¥èªªæ˜å¦‚ä½•è¨­å®š&lt;strong&gt;å…¨åŸŸèªè­‰&lt;/strong&gt;ï¼Œä»¥æ¸›å°‘ç¨‹å¼ç¢¼çš„é‡è¤‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/19&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;èªè­‰çš„å…©å€‹å±¤æ¬¡&quot;&gt;&lt;a href=&quot;#èªè­‰çš„å…©å€‹å±¤æ¬¡&quot; class=&quot;headerlink&quot; title=&quot;èªè­‰çš„å…©å€‹å±¤æ¬¡&quot;&gt;&lt;/a&gt;èªè­‰çš„å…©å€‹å±¤æ¬¡&lt;/h2&gt;&lt;p&gt;é€²å…¥å¯¦ä½œå‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£ï¼Œæ‰€è¬‚çš„&lt;strong&gt;èº«åˆ†èªè­‰&lt;/strong&gt;ï¼Œç©¶ç«Ÿä»£è¡¨ä»€éº¼ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ã€Œå¸³è™Ÿå¯†ç¢¼ + session èªè­‰ã€ç‚ºä¾‹ï¼Œèº«åˆ†èªè­‰çš„ç¯„åœä¸»è¦æ¶µè“‹&lt;strong&gt;å…©å€‹éšæ®µ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œç•¶ä½¿ç”¨è€…é€éå¸³è™Ÿå¯†ç¢¼é€²è¡Œç™»å…¥æ™‚ï¼Œç³»çµ±æœƒæª¢æŸ¥é€™äº›å…§å®¹ã€ç¢ºèªèº«åˆ†&lt;strong&gt;åˆæ³•&lt;/strong&gt;ã€‚ç™»å…¥æˆåŠŸå¾Œï¼Œç³»çµ±æœƒå°‡ä½¿ç”¨è€…è³‡è¨Šï¼ˆæ¯”å¦‚ç”¨æˆ¶ idï¼‰å„²å­˜è‡³ sessionï¼Œä»¥&lt;strong&gt;ç¶­æŒç™»å…¥ç‹€æ…‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ˜¯&lt;strong&gt;ç™»å…¥æ™‚çš„èªè­‰&lt;/strong&gt;ï¼Œä¹Ÿæ˜¯æˆ‘å€‘æœ€å¸¸èªªçš„èªè­‰ã€‚ï¼ˆ&lt;strong&gt;ç‹¹ç¾©çš„èªè­‰&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ¥è‘—ï¼Œç•¶ä½¿ç”¨è€…å˜—è©¦å­˜å–å—ã€Œ&lt;strong&gt;èªè­‰ä¿è­·&lt;/strong&gt;ã€çš„ API æ™‚ï¼Œç³»çµ±æœƒæª¢æŸ¥ session ä¸¦ç¢ºèªèº«åˆ†ï¼Œç¢ºä¿æ¯å€‹ API è«‹æ±‚éƒ½ä¾†è‡ª&lt;strong&gt;åˆæ³•ç™»å…¥&lt;/strong&gt;çš„ä½¿ç”¨è€…ã€‚&lt;/p&gt;
&lt;p&gt;ç°¡è¨€ä¹‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€éšæ®µï¼šåˆæ¬¡ç™»å…¥æ™‚çš„èº«åˆ†ç¢ºèªã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒéšæ®µï¼šå¾ŒçºŒè«‹æ±‚æ™‚çš„èº«åˆ†ç¢ºèªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…©å€‹å±¤æ¬¡ç›¸è¼”ç›¸æˆã€ä¸€é«”å…©é¢ï¼Œç¢ºä¿æœå‹™èƒ½å¤ åœ¨ä½¿ç”¨è€…&lt;strong&gt;ç™»å…¥&lt;/strong&gt;å’Œ&lt;strong&gt;å¾ŒçºŒæ“ä½œ&lt;/strong&gt;ä¸­ï¼Œæä¾›é©ç•¶çš„å®‰å…¨ä¿éšœã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 27ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸‹ï¼‰FilterSchema å¤šæ¬„ä½æŸ¥è©¢</title>
    <link href="https://blog.kyomind.tw/django-ninja-27/"/>
    <id>https://blog.kyomind.tw/django-ninja-27/</id>
    <published>2024-10-09T06:04:46.000Z</published>
    <updated>2024-10-09T13:01:53.719Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ä¸Šç¯‡ä¸­ï¼Œæˆ‘å€‘å­¸ç¿’äº† Django ORM çš„<code>Q</code>ç‰©ä»¶å’Œ Django Ninja çš„ FilterSchemaï¼Œä½†å¾Œè€…æ„Ÿè¦ºåªå­¸äº†ä¸€åŠã€‚</p><p>è¨è«–æ¯”è¼ƒå¤šçš„æ˜¯ï¼Œview å‡½å¼ä¸­ä½¿ç”¨ FilterSchema çš„<strong>åƒæ•¸å®šç¾©æ–¹å¼</strong>â€”â€”é€™ç¢ºå¯¦å¾ˆé‡è¦ï¼Œä½†é€™åªæ˜¯ FilterSchema çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æœ¬ç¯‡è¦ä¾†è£œå®Œå‰©ä¸‹çš„å…§å®¹ï¼š</p><ol><li>å®Œå–„ FilterSchemaï¼šä½¿ç”¨ã€Œ<strong>æ›´é“åœ°</strong>ã€çš„å¯«æ³•ï¼Œé‡‹æ”¾ FilterSchema <strong>çœŸæ­£çš„åŠ›é‡</strong>ã€‚</li><li>å¯¦ä½œæ›´é€²éšçš„æ¬„ä½æŸ¥è©¢åŠŸèƒ½ï¼š<strong>å¤šæ¬„ä½æŸ¥è©¢â€”â€”ç¯©é¸æ—¥æœŸå€é–“ã€‚</strong></li><li>è¿½åŠ å¯¦ä½œç¬¬ 20 ç¯‡å­¸åˆ°çš„ã€Œ<strong>è·¨æ¬„ä½é©—è­‰</strong>ã€ï¼šé©—è­‰æŸ¥è©¢åƒæ•¸çš„<strong>æ—¥æœŸå€é–“æ˜¯å¦åˆæ³•</strong>ã€‚</li></ol><p>çœ‹ä¾†åˆæ˜¯è³‡è¨Šæ»¿æ»¿çš„ä¸€ç¯‡ï¼Œè©±ä¸å¤šèªªï¼Œç›´æ¥é–‹å§‹å§ï¼</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/18">é€™å€‹ PR</a>ã€‚</p><span id="more"></span><hr><h2 id="ä¸€ã€å°‡æŸ¥è©¢é‚è¼¯é·ç§»åˆ°-FilterSchema"><a href="#ä¸€ã€å°‡æŸ¥è©¢é‚è¼¯é·ç§»åˆ°-FilterSchema" class="headerlink" title="ä¸€ã€å°‡æŸ¥è©¢é‚è¼¯é·ç§»åˆ° FilterSchema"></a>ä¸€ã€å°‡æŸ¥è©¢é‚è¼¯é·ç§»åˆ° FilterSchema</h2><p>é‚„è¨˜å¾—æˆ‘å€‘ä¸Šä¸€ç¯‡çš„ç¨‹å¼ç¢¼å¯¦ä½œå—ï¼Ÿ</p><p>æ˜æ˜å¤šå®šç¾©äº† FilterSchemaï¼Œä½† view å‡½å¼ä¸­çš„ç¨‹å¼ç¢¼<strong>ä¸åƒ…æ²’æœ‰æ¸›å°‘ï¼Œåè€Œé‚„å¢åŠ äº†</strong>ï¼ï¼ˆé›–ç„¶æŸ¥è©¢é‚è¼¯ä¹Ÿè®Šå¤šäº†ï¼Œå› ç‚ºè¦åŒæ™‚æŸ¥è©¢å…©å€‹æ¬„ä½ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.get(<span class="params">...</span>)</span></span><br><span class="line"><span class="meta">@paginate(<span class="params">CustomPagination</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    filters: PostFilterSchema = Query(<span class="params"></span>),  <span class="comment"># ä½¿ç”¨ FilterSchema</span></span></span><br><span class="line"><span class="params"></span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    posts = Post.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> filters.query:</span><br><span class="line">        q = Q(title__icontains=filters.query) | \</span><br><span class="line">            Q(content__icontains=filters.query)</span><br><span class="line">        posts = posts.<span class="built_in">filter</span>(q)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>é€™ç°¡ç›´è«åå…¶å¦™ğŸ¸</p><p>é‚£æ˜¯å› ç‚ºï¼ŒFilterSchema ä¸æ˜¯é€™éº¼ç”¨çš„ï¼</p><h3 id="FilterSchema-çš„ã€Œæ­£ç¢ºã€ç”¨æ³•"><a href="#FilterSchema-çš„ã€Œæ­£ç¢ºã€ç”¨æ³•" class="headerlink" title="FilterSchema çš„ã€Œæ­£ç¢ºã€ç”¨æ³•"></a>FilterSchema çš„ã€Œæ­£ç¢ºã€ç”¨æ³•</h3><p>æˆ‘å€‘æ‡‰è©²ç›¡å¯èƒ½å°‡æŸ¥è©¢é‚è¼¯<strong>å°è£åˆ° FilterSchema ä¸­</strong>ï¼Œé€™æ¨£å¯ä»¥è®“ view å‡½å¼æ›´ç°¡æ½”ï¼Œä¸¦é”åˆ°ã€Œ<strong>é—œæ³¨é»åˆ†é›¢</strong>ã€çš„æ•ˆæœã€‚</p><p>ä¾†çœ‹çœ‹æ›´åˆç†çš„å¯«æ³•â€”â€”å°‡æŸ¥è©¢é‚è¼¯é·ç§»åˆ° FilterSchemaï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PostFilterSchema</span>(<span class="title class_ inherited__">FilterSchema</span>):</span><br><span class="line">    query: <span class="built_in">str</span> | <span class="literal">None</span> = Field(</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">        q=[<span class="string">&#x27;title__icontains&#x27;</span>, <span class="string">&#x27;author__username__icontains&#x27;</span>],</span><br><span class="line">        min_length=<span class="number">2</span>,</span><br><span class="line">        max_length=<span class="number">10</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>ä¸»è¦çš„è®Šå‹•æ˜¯<code>query</code>æ¬„ä½çš„ Field éƒ¨åˆ†ï¼Œç¾åœ¨åŠ ä¸Šäº†<code>q=</code>åƒæ•¸å…§å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=[<span class="string">&quot;title__icontains&quot;</span>, <span class="string">&quot;author__name__icontains&quot;</span>]</span><br></pre></td></tr></table></figure><p>å¾ˆçœ¼ç†Ÿå§ï¼Ÿæ²’éŒ¯ï¼Œå®ƒå€‘å¯¦éš›ä¸Šå°±æ˜¯<code>Q</code>ç‰©ä»¶çš„<strong>æ¢ä»¶èªå¥</strong>ï¼ŒDjango Ninja æœƒåœ¨èƒŒå¾Œè‡ªå‹•èª¿ç”¨<code>Q</code>ç‰©ä»¶ä¾†åŸ·è¡Œé€™äº›æŸ¥è©¢ã€‚</p><h3 id="ä¾†è‡ª-Mypy-çš„æé†’"><a href="#ä¾†è‡ª-Mypy-çš„æé†’" class="headerlink" title="ä¾†è‡ª Mypy çš„æé†’"></a>ä¾†è‡ª Mypy çš„æé†’</h3><p>ä¸€æ—¦ä½¿ç”¨<code>q=</code>åƒæ•¸ï¼ŒMypy åˆæœƒæé†’ä½ ï¼š</p><blockquote><p>Unexpected keyword argument â€œqâ€ for â€œFieldâ€</p></blockquote><p>å®ƒèªªçš„ä¸¦æ²’æœ‰éŒ¯ï¼Œå› ç‚º Pydantic Field <strong>ç¢ºå¯¦æ²’æœ‰</strong>é€™å€‹åƒæ•¸â€”â€”é€™æ˜¯ Django Ninja è‡ªè¡Œå¯¦ä½œçš„ã€‚</p><p>ä½ å¯ä»¥ç„¡è¦–å®ƒï¼Œæˆ–åŠ ä¸Šå¿…è¦çš„è¨»è§£ã€‚</p><h3 id="View-å‡½å¼ç°¡åŒ–"><a href="#View-å‡½å¼ç°¡åŒ–" class="headerlink" title="View å‡½å¼ç°¡åŒ–"></a>View å‡½å¼ç°¡åŒ–</h3><p>å¦‚æ­¤ä¸€ä¾†ï¼Œview å‡½å¼<strong>åªéœ€è¦</strong>é€™æ¨£å¯«å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    filters: PostFilterSchema = Query(<span class="params"></span>),</span></span><br><span class="line"><span class="params"></span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    posts = Post.objects.select_related(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">    posts = filters.<span class="built_in">filter</span>(posts)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯<strong>ç°¡å–®å¾ˆå¤š</strong>ï¼Ÿ</p><p>å› ç‚ºæŸ¥è©¢é‚è¼¯å¾ view å‡½å¼ã€Œåˆ†é›¢ã€å‡ºä¾†äº†ï¼Œé€™ä½¿å¾— view å‡½å¼çš„è·è²¬æ›´å–®ä¸€ã€æ›´åˆ©æ–¼ç¶­è­·ã€‚</p><hr><h2 id="äºŒã€å¤šæ¬„ä½æŸ¥è©¢ï¼šæ–°å¢æ—¥æœŸç¯©é¸åŠŸèƒ½"><a href="#äºŒã€å¤šæ¬„ä½æŸ¥è©¢ï¼šæ–°å¢æ—¥æœŸç¯©é¸åŠŸèƒ½" class="headerlink" title="äºŒã€å¤šæ¬„ä½æŸ¥è©¢ï¼šæ–°å¢æ—¥æœŸç¯©é¸åŠŸèƒ½"></a>äºŒã€å¤šæ¬„ä½æŸ¥è©¢ï¼šæ–°å¢æ—¥æœŸç¯©é¸åŠŸèƒ½</h2><p>æ–°éœ€æ±‚ï¼šé™¤äº†å¯ä»¥æŸ¥æ–‡ç« æ¨™é¡Œæˆ–ä½œè€…åç¨±ï¼Œç¾åœ¨é‚„è¦åŠ å…¥å°ã€Œ<strong>ç™¼æ–‡æ—¥æœŸ</strong>ã€çš„éæ¿¾ï¼</p><p>æˆ‘å€‘å°‡å¼•å…¥å…©å€‹<strong>æ–°çš„ URL æŸ¥è©¢åƒæ•¸</strong>ï¼š</p><ul><li><code>start_date</code></li><li><code>end_date</code></li></ul><p>å…©è€…å°‡ç”¨ä¾†æŸ¥è©¢ã€éæ¿¾<code>Post</code>æ¨¡å‹ä¸­çš„<code>created_at</code>æ¬„ä½ï¼ˆå³ç™¼æ–‡æ—¥æœŸï¼‰ï¼Œä»¥ç¯©é¸ç‰¹å®šæ™‚é–“ç¯„åœå…§çš„æ–‡ç« è³‡æ–™ã€‚</p><p>é‚„æœ‰ä¸€å€‹<strong>é¡å¤–è¦æ±‚</strong>ï¼šå…©è€…å¿…é ˆã€Œ<strong>å…¨æœ‰å…¨ç„¡</strong>ã€â€”â€”å¯ä»¥éƒ½æ²’æœ‰ï¼Œä½†ä¸å¯ä»¥åªå¡«å…¶ä¸­ä¸€å€‹ã€‚</p><p>é€™æ˜¯ä¸€å€‹å…¸å‹çš„ã€Œ<strong>å¤šæ¬„ä½</strong>ã€æŸ¥è©¢ã€‚</p><h3 id="æ–°å¢ç¨‹å¼ç¢¼"><a href="#æ–°å¢ç¨‹å¼ç¢¼" class="headerlink" title="æ–°å¢ç¨‹å¼ç¢¼"></a>æ–°å¢ç¨‹å¼ç¢¼</h3><p>é€™æ˜¯åŠ å…¥äº†ä¸Šè¿°é‚è¼¯å¾Œçš„ FilterSchemaï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PostFilterSchema</span>(<span class="title class_ inherited__">FilterSchema</span>):</span><br><span class="line">    query: <span class="built_in">str</span> | <span class="literal">None</span> = Field(</span><br><span class="line">        <span class="literal">None</span>, q=[<span class="string">&quot;title__icontains&quot;</span>, <span class="string">&quot;author__username__icontains&quot;</span>])</span><br><span class="line">    start_date: <span class="built_in">str</span> | <span class="literal">None</span> = Field(<span class="literal">None</span>, q=<span class="string">&quot;created_at__gte&quot;</span>)</span><br><span class="line">    end_date: <span class="built_in">str</span> | <span class="literal">None</span> = Field(<span class="literal">None</span>, q=<span class="string">&quot;created_at__lte&quot;</span>)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>start_date</code>å’Œ<code>end_date</code>éƒ½æ˜¯å°æ¨¡å‹æ¬„ä½<code>created_at</code>çš„<strong>æŸ¥è©¢æ¢ä»¶</strong>ã€‚</p><p>æ‰€ä»¥æˆ‘å€‘ä½¿ç”¨<code>created_at__gte</code>å’Œ<code>created_at__lte</code>ä¾†<strong>æè¿°éæ¿¾é‚è¼¯</strong>ï¼ˆå®ƒå€‘éƒ½å°æ‡‰äº†å„è‡ªçš„<code>Q</code>ç‰©ä»¶ï¼‰ï¼Œä»¥<strong>ç¯©é¸</strong>å‡ºç¬¦åˆæ¢ä»¶çš„è³‡æ–™ã€‚</p><p>é‚£ view å‡½å¼å‘¢ï¼Ÿä½ çŒœå¾—æ²’éŒ¯â€”â€”<strong>å®Œå…¨ä¸ç”¨å‹•</strong>ï¼</p><p>é€™å°±æ˜¯ä½¿ç”¨ FilterSchema çš„å¥½è™•ã€‚</p><h3 id="API-æ–‡ä»¶æ¸²æŸ“å•é¡Œ"><a href="#API-æ–‡ä»¶æ¸²æŸ“å•é¡Œ" class="headerlink" title="API æ–‡ä»¶æ¸²æŸ“å•é¡Œ"></a>API æ–‡ä»¶æ¸²æŸ“å•é¡Œ</h3><p>æœ‰è¶£çš„æ˜¯ï¼Œç•¶æˆ‘è©¦è‘—ç‚ºé€™äº›æŸ¥è©¢åƒæ•¸åŠ ä¸Š<strong>æ–‡ä»¶ç¯„ä¾‹</strong>æ™‚ï¼Œå¦‚æœé€™æ¨£å¯«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start_date: <span class="built_in">str</span> | <span class="literal">None</span> = Field(</span><br><span class="line">    <span class="literal">None</span>, q=<span class="string">&#x27;created_at__gte&#x27;</span>, examples=[<span class="string">&#x27;2021-01-01&#x27;</span>]</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ API æ–‡ä»¶å°‡æœƒå¾—åˆ°ï¼š</p><blockquote><p>ğŸ˜±Â Could not renderÂ Parameters, see the console.</p></blockquote><p>ä½†å¯«<code>example=&#39;2021-01-01&#39;</code>å»å¯ä»¥æˆåŠŸã€‚</p><p>é€™å¯èƒ½æ˜¯ Django Ninja èˆ‡ Pydantic åœ¨æ•´åˆä¸Šçš„ä¸€å€‹ bugï¼Œæˆ‘å€‘æš«ä¸”å°±å…ˆç•¥éå§ï¼</p><h3 id="å®¢æˆ¶ç«¯æŸ¥è©¢ç¯„ä¾‹"><a href="#å®¢æˆ¶ç«¯æŸ¥è©¢ç¯„ä¾‹" class="headerlink" title="å®¢æˆ¶ç«¯æŸ¥è©¢ç¯„ä¾‹"></a>å®¢æˆ¶ç«¯æŸ¥è©¢ç¯„ä¾‹</h3><p>ç•¶æˆ‘å€‘è¦æŸ¥è©¢æŸæ®µæ™‚é–“å…§çš„æ–‡ç« æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ URL æŸ¥è©¢åƒæ•¸ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?start_date=2023-01-01&amp;end_date=2023-01-31</span><br></pre></td></tr></table></figure><p>é€™æ¨£å°±èƒ½è¼•é¬†æŸ¥è©¢å‡º 2023 å¹´ 1 æœˆä»½çš„æ‰€æœ‰æ–‡ç« ã€‚</p><p>é™„å¸¶ä¸€æï¼Œæ—¥æœŸä¸­çš„æ™‚é–“å› ç‚ºæ²’æœ‰æŒ‡å®šï¼Œé è¨­ä¸Šéƒ½æ˜¯ 0 é» 0 åˆ† 0 ç§’ã€‚æ‰€ä»¥å¦‚æœå¡«åŒä¸€å¤©ï¼Œå°±æŸ¥ä¸åˆ°ä»»ä½•æ±è¥¿ã€‚</p><p>é€™æ˜¯ä¸€å€‹éœ€è¦<strong>æ”¹å–„</strong>æˆ–<strong>é‡æ–°èª¿æ•´</strong>çš„ç´°ç¯€ï¼Œå¸¸è¦‹çš„åšæ³•æ˜¯åœ¨ç¨‹å¼å…§éƒ¨æŠŠ<code>end_date</code>åŠ  1 å¤©ï¼Œè€Œæˆ‘ç›´æ¥é¸æ“‡<strong>è®“å…©è€…ä¸èƒ½ç›¸åŒ</strong>XDã€‚å¯¦éš›è©²æ€éº¼åšï¼Œå–æ±ºæ–¼ä½ çš„éœ€æ±‚ã€‚</p><p>é™¤äº†å–®ç´”çš„æœŸé–“æŸ¥è©¢ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥æŸ¥è©¢<strong>æŸä½œè€…åœ¨æŸæ®µæ™‚é–“å…§</strong>çš„æ–‡ç« ï¼Œä»¥æŸ¥è©¢ä½œè€… Alice ç‚ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?start_date=2023-01-01&amp;end_date=2023-01-31&amp;query=alice</span><br></pre></td></tr></table></figure><p>çµæœé¡¯ç¤ºäº† Alice åœ¨ 2023 å¹´ 1 æœˆä»½çš„æ‰€æœ‰æ–‡ç« ã€‚</p><hr><h2 id="FilterSchema-çš„é è¨­æŸ¥è©¢æ¢ä»¶é—œä¿‚"><a href="#FilterSchema-çš„é è¨­æŸ¥è©¢æ¢ä»¶é—œä¿‚" class="headerlink" title="FilterSchema çš„é è¨­æŸ¥è©¢æ¢ä»¶é—œä¿‚"></a>FilterSchema çš„é è¨­æŸ¥è©¢æ¢ä»¶é—œä¿‚</h2><p>é€™éƒ¨åˆ†ä¸€å®šè¦ç‰¹åˆ¥ä»‹ç´¹ï¼Œä¾<a href="https://django-ninja.dev/guides/input/filtering/#combining-expressions">æ–‡ä»¶</a>æ‰€è¿°ï¼Œé è¨­ä¸Šï¼š</p><ul><li>Field-level expressions are joined together usingÂ <code>OR</code>Â operator.</li><li>The fields themselves are joined together usingÂ <code>AND</code>Â operator.</li></ul><p>æ„æ€å°±æ˜¯èªªï¼Œå–®ä¸€æ¬„ä½å…§çš„å¤šå€‹ Q èªå¥ï¼Œå½¼æ­¤æ˜¯ OR é—œä¿‚ï¼Œæ¯”å¦‚ä¸Šé¢<code>query</code>çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=[<span class="string">&#x27;title__icontains&#x27;</span>, <span class="string">&#x27;author__username__icontains&#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŸ¥è©¢æ–‡ç« æ¨™é¡Œã€Œ<strong>æˆ–</strong>ã€ä½œè€…åç¨±ã€‚</p><p>è€Œ<strong>ä¸åŒæ¬„ä½</strong>ä¸­çš„æ¢ä»¶ï¼ˆå¦‚æœéƒ½æœ‰ï¼‰ï¼Œå‰‡æ˜¯ AND é—œä¿‚â€”â€”å¿…é ˆ<strong>åŒæ™‚ç¬¦åˆ</strong>æ‰è¡Œã€‚æ‰€ä»¥ä½œè€…åç¨±èˆ‡æ—¥æœŸå€é–“ï¼Œå…©è€…çš„æ¢ä»¶å¿…é ˆåŒæ™‚ç¬¦åˆã€‚</p><p>é€™äº›é è¨­é‚è¼¯å¯ä»¥è‡ªè¡Œè®Šæ›´ï¼Œè©³æƒ…è«‹åƒè€ƒä¸Šè¿°æ–‡ä»¶å…§å®¹ã€‚</p><hr><h2 id="ä¸‰ã€æ—¥æœŸå€é–“é©—è­‰"><a href="#ä¸‰ã€æ—¥æœŸå€é–“é©—è­‰" class="headerlink" title="ä¸‰ã€æ—¥æœŸå€é–“é©—è­‰"></a>ä¸‰ã€æ—¥æœŸå€é–“é©—è­‰</h2><p>æœ¬ä¾‹ä¸­ï¼Œé™¤äº†æ¬„ä½æŸ¥è©¢ï¼Œæˆ‘å€‘é‚„è¦ç¢ºä¿ï¼Œä½¿ç”¨è€…è¼¸å…¥çš„é–‹å§‹æ—¥æœŸ<strong>å¿…é ˆæ—©æ–¼</strong>çµæŸæ—¥æœŸã€‚</p><p>ä¸¦ä¸”ï¼Œå…©å€‹æ¬„ä½çš„æŸ¥è©¢å€¼å¿…é ˆæ˜¯ã€Œå…¨æœ‰ã€æˆ–ã€Œå…¨ç„¡ã€ï¼ˆ<strong>å…¨ç„¡å‰‡ä¸å¿…é©—è­‰</strong>ï¼‰ã€‚</p><p>é€™å€‹éœ€æ±‚éå¸¸çœ¼ç†Ÿâ€”â€”ä¸å°±æ˜¯ç¬¬ 20 ç¯‡æåˆ°çš„ã€Œ<strong>è·¨æ¬„ä½é©—è­‰</strong>ã€å—ï¼Ÿ</p><p>æ²’éŒ¯ï¼Œæˆ‘å€‘è¦é€é Pydantic çš„<code>model_validator</code>ä¾†å¯¦ç¾ï¼Œå®ƒå…è¨±æˆ‘å€‘åœ¨é©—è­‰éç¨‹ä¸­ï¼Œå°è¼¸å…¥è³‡æ–™é€²è¡Œ<strong>è‡ªå®šç¾©çš„é‚è¼¯æª¢æŸ¥</strong>ã€‚</p><h3 id="ä½¿ç”¨-Pydantic-model-validator-å¯¦ä½œæ—¥æœŸå€é–“é©—è­‰"><a href="#ä½¿ç”¨-Pydantic-model-validator-å¯¦ä½œæ—¥æœŸå€é–“é©—è­‰" class="headerlink" title="ä½¿ç”¨ Pydantic model_validator å¯¦ä½œæ—¥æœŸå€é–“é©—è­‰"></a>ä½¿ç”¨ Pydantic model_validator å¯¦ä½œæ—¥æœŸå€é–“é©—è­‰</h3><p>ç¨‹å¼ç¢¼æœ‰é»å¤šï¼Œæˆ‘å€‘ç›´æ¥çœ‹é‡é»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PostFilterSchema</span>(<span class="title class_ inherited__">FilterSchema</span>):</span><br><span class="line">    ...</span><br><span class="line">    start_date: <span class="built_in">str</span> | <span class="literal">None</span> = Field(<span class="literal">None</span>, q=<span class="string">&#x27;created_at__gte&#x27;</span>)</span><br><span class="line">    end_date: <span class="built_in">str</span> | <span class="literal">None</span> = Field(<span class="literal">None</span>, q=<span class="string">&#x27;created_at__lte&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;after&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_date_range</span>(<span class="params">self</span>) -&gt; Self:</span><br><span class="line">        <span class="comment"># å¦‚æœé–‹å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸéƒ½æ˜¯ Noneï¼Œå‰‡ä¸é€²è¡Œä»»ä½•æª¢æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> self.start_date <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self.end_date <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>([self.start_date, self.end_date]):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;é–‹å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸå¿…é ˆåŒæ™‚æä¾›æˆ–åŒæ™‚ä¸æä¾›&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            start_date_dt = datetime.strptime(self.start_date, <span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">            end_date_dt = datetime.strptime(self.end_date, <span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;æ—¥æœŸæ ¼å¼ç„¡æ•ˆï¼Œæ‡‰ç‚º YYYY-MM-DD&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> start_date_dt &gt; end_date_dt:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;é–‹å§‹æ—¥æœŸå¿…é ˆæ—©æ–¼çµæŸæ—¥æœŸ&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure><p>å°æ–¼æŸ¥è©¢æ¢ä»¶ï¼Œæˆ‘å€‘ä½¿ç”¨ Pydantic çš„<code>model_validator</code>é€²è¡Œè·¨æ¬„ä½é©—è­‰ï¼Œç¢ºä¿ä½¿ç”¨è€…è¼¸å…¥çš„æ—¥æœŸæ˜¯<strong>æœ‰æ•ˆä¸”åˆç†</strong>çš„ã€‚</p><p>äº‹å¯¦ä¸Šï¼Œè·¨æ¬„ä½é©—è­‰å¾€å¾€è¦<strong>è€ƒæ…®å¾ˆå¤šç´°ç¯€</strong>ï¼Œå¦å‰‡å¯èƒ½æ›ä¸€æ¼è¬ï¼Œé–“æ¥ç”¢ç”Ÿæ–°çš„ bugã€‚</p><p>é€™å€‹ä¾‹å­å°±æ˜¯ä¸€å€‹å…¸å‹æ¡ˆä¾‹ã€‚</p><p>æˆ‘å€‘å¿…é ˆ<strong>å…¨ç›¤è€ƒæ…®</strong>å„ç¨®å¯èƒ½çš„è¼¸å…¥æƒ…æ³ï¼ŒåŒ…æ‹¬æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¢ºã€æ—¥æœŸç¯„åœæ˜¯å¦åˆç†ï¼Œä»¥åŠå…©å€‹æ—¥æœŸæ¬„ä½æ˜¯å¦åŒæ™‚å­˜åœ¨æˆ–åŒæ™‚ç‚ºç©ºã€‚</p><p><strong>ç´°ç·»çš„é©—è­‰é‚è¼¯</strong>èƒ½æå‡ API çš„<strong>å¯é æ€§</strong>ï¼Œé¿å…å› ç‚ºç„¡æ•ˆæˆ–ä¸åˆç†çš„è¼¸å…¥è€Œå°è‡´ç³»çµ±å‡ºç¾<strong>æ„å¤–è¡Œç‚º</strong>ã€‚è€Œç²—ç³™çš„é‚è¼¯å‰‡åä¹‹ã€‚</p><hr><h2 id="å°çµèˆ‡ä¸‹ä¸€æ­¥"><a href="#å°çµèˆ‡ä¸‹ä¸€æ­¥" class="headerlink" title="å°çµèˆ‡ä¸‹ä¸€æ­¥"></a>å°çµèˆ‡ä¸‹ä¸€æ­¥</h2><p>é€™å…©ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘ä»‹ç´¹äº† FilterSchema çš„æœ‰æ•ˆç”¨æ³•ï¼Œå®Œæˆäº†å¤šæ¬„ä½æŸ¥è©¢å’Œæ—¥æœŸç¯©é¸ï¼Œä¸¦ç¤ºç¯„å¦‚ä½•ä½¿ç”¨<code>model_validator</code>ä¾†å¼·åŒ–è³‡æ–™é©—è­‰ï¼Œç¢ºä¿æŸ¥è©¢é‚è¼¯çš„æ­£ç¢ºæ€§ã€‚</p><p>æˆ‘å€‘é‚„çœ‹äº†é€™äº›æ‡‰ç”¨å ´æ™¯çš„å¯¦ä¾‹ç¨‹å¼ç¢¼ï¼Œå¹«åŠ©è®€è€…æ›´å¥½åœ°ç†è§£æ¯å€‹æ­¥é©Ÿçš„ç”¨é€”å’Œæ•ˆæœã€‚</p><p>ä¸‹ä¸€ç« ï¼Œæˆ‘å€‘å°‡æ¢è¨ Django Ninja ä¸­çš„èªè­‰ï¼ˆAuthenticationï¼‰æ©Ÿåˆ¶ï¼Œä¸¦ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ pytest é€²è¡Œå–®å…ƒæ¸¬è©¦ï¼Œé€™äº›éƒ½æ˜¯å¾Œç«¯é–‹ç™¼ä¸­ï¼Œä¸å¯æˆ–ç¼ºçš„è¦ç´ ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šç¯‡ä¸­ï¼Œæˆ‘å€‘å­¸ç¿’äº† Django ORM çš„&lt;code&gt;Q&lt;/code&gt;ç‰©ä»¶å’Œ Django Ninja çš„ FilterSchemaï¼Œä½†å¾Œè€…æ„Ÿè¦ºåªå­¸äº†ä¸€åŠã€‚&lt;/p&gt;
&lt;p&gt;è¨è«–æ¯”è¼ƒå¤šçš„æ˜¯ï¼Œview å‡½å¼ä¸­ä½¿ç”¨ FilterSchema çš„&lt;strong&gt;åƒæ•¸å®šç¾©æ–¹å¼&lt;/strong&gt;â€”â€”é€™ç¢ºå¯¦å¾ˆé‡è¦ï¼Œä½†é€™åªæ˜¯ FilterSchema çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡è¦ä¾†è£œå®Œå‰©ä¸‹çš„å…§å®¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®Œå–„ FilterSchemaï¼šä½¿ç”¨ã€Œ&lt;strong&gt;æ›´é“åœ°&lt;/strong&gt;ã€çš„å¯«æ³•ï¼Œé‡‹æ”¾ FilterSchema &lt;strong&gt;çœŸæ­£çš„åŠ›é‡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¦ä½œæ›´é€²éšçš„æ¬„ä½æŸ¥è©¢åŠŸèƒ½ï¼š&lt;strong&gt;å¤šæ¬„ä½æŸ¥è©¢â€”â€”ç¯©é¸æ—¥æœŸå€é–“ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;è¿½åŠ å¯¦ä½œç¬¬ 20 ç¯‡å­¸åˆ°çš„ã€Œ&lt;strong&gt;è·¨æ¬„ä½é©—è­‰&lt;/strong&gt;ã€ï¼šé©—è­‰æŸ¥è©¢åƒæ•¸çš„&lt;strong&gt;æ—¥æœŸå€é–“æ˜¯å¦åˆæ³•&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹ä¾†åˆæ˜¯è³‡è¨Šæ»¿æ»¿çš„ä¸€ç¯‡ï¼Œè©±ä¸å¤šèªªï¼Œç›´æ¥é–‹å§‹å§ï¼&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/18&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 26ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸Šï¼‰FilterSchema ä»‹ç´¹</title>
    <link href="https://blog.kyomind.tw/django-ninja-26/"/>
    <id>https://blog.kyomind.tw/django-ninja-26/</id>
    <published>2024-10-08T02:31:58.000Z</published>
    <updated>2024-10-08T04:31:25.346Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ã€Œ<strong>æŸ¥è©¢</strong>ã€æ˜¯ API ä¸­å¸¸è¦‹çš„é™„åŠ éœ€æ±‚ï¼Œæœ¬è³ªä¸Šæ˜¯<strong>å°è³‡æ–™çš„éæ¿¾ï¼ˆfilteringï¼‰èˆ‡ç¯©é¸</strong>ã€‚</p><p>ç„¡è«–æ˜¯ç¯©é¸æ–‡ç« ã€å•†å“ï¼Œé‚„æ˜¯æŸ¥è©¢ç”¨æˆ¶ï¼Œ<strong>æ ¹æ“šä¸åŒæ¢ä»¶ä¾†éæ¿¾è³‡æ–™ä¸¦ç²å¾—çµæœ</strong>ï¼Œå¯èªªæ˜¯å¤§éƒ¨åˆ†å°ˆæ¡ˆçš„å¿…å‚™åŠŸèƒ½ã€‚</p><p>åœ¨ view å‡½å¼ä¸­ï¼Œå¯¦ä½œæŸ¥è©¢<strong>æœ€ç°¡å–®</strong>çš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ Django ORM çš„éæ¿¾æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥ç”¨<code>filter</code>æ–¹æ³•ä¾†æ ¹æ“šç‰¹å®šæ¢ä»¶ç¯©é¸ QuerySetã€‚</p><p>é€™ç¨®æ–¹æ³•ç°¡å–®ç›´æ¥ï¼Œé©åˆåŸºæœ¬çš„æŸ¥è©¢éœ€æ±‚ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿæœ‰å…¶<strong>å±€é™æ€§</strong>â€”â€”éš¨è‘—æ¬„ä½èˆ‡éœ€æ±‚çš„å¢åŠ ï¼ŒæŸ¥è©¢æ¢ä»¶å¯èƒ½è®Šå¾—<strong>è¶Šä¾†è¶Šè¤‡é›œ</strong>ï¼Œå°è‡´ç¨‹å¼ç¢¼<strong>å†—é•·</strong>ä¸”é›£ä»¥ç¶­è­·ã€‚</p><p>ç‚ºäº†è§£æ±ºé€™ä¸€å•é¡Œï¼ŒDjango Ninja æä¾›äº† FilterSchemaï¼Œè®“æˆ‘å€‘å¯ä»¥ç”¨æ›´ã€Œ<strong>çµæ§‹åŒ–</strong>ã€çš„æ–¹å¼ï¼Œå®šç¾©ä¸¦ç®¡ç†æŸ¥è©¢æ¢ä»¶ã€‚</p><p>æœ¬æ–‡å°‡ä»‹ç´¹ FilterSchemaï¼Œä¸€æ­¥æ­¥å¯¦ä½œèˆ‡è¬›è§£ï¼Œè®“ä½ äº†è§£å¦‚ä½•åœ¨ Django Ninja ä¸­ä½¿ç”¨ FilterSchemaï¼Œå¯¦ç¾<strong>æ›´åŠ éˆæ´»ã€æ¨¡çµ„åŒ–</strong>çš„ API æŸ¥è©¢åŠŸèƒ½ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/17">é€™å€‹ PR</a>ã€‚</p><span id="more"></span><hr><h2 id="å‚³çµ±æŸ¥è©¢æ–¹æ³•èˆ‡å•é¡Œ"><a href="#å‚³çµ±æŸ¥è©¢æ–¹æ³•èˆ‡å•é¡Œ" class="headerlink" title="å‚³çµ±æŸ¥è©¢æ–¹æ³•èˆ‡å•é¡Œ"></a>å‚³çµ±æŸ¥è©¢æ–¹æ³•èˆ‡å•é¡Œ</h2><p>ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ°ã€Œå–å¾—æ–‡ç« åˆ—è¡¨ã€APIï¼Œé‚„è¨˜å¾—æˆ‘å€‘åœ¨ã€ˆå·Â 11ï¼šè«‹æ±‚ï¼ˆä¸‰ï¼‰æŸ¥è©¢åƒæ•¸ï¼ˆQuery Parametersï¼‰ã€‰ç‚ºå®ƒåŠ ä¸Šçš„ã€Œ<strong>ä¾æ–‡ç« æ¨™é¡ŒæŸ¥è©¢</strong>ã€åŠŸèƒ½å—ï¼Ÿ</p><p>é€™æ˜¯ç›®å‰ç¨‹å¼ç¢¼çš„ç¾æ³ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    title: <span class="literal">None</span> | <span class="built_in">str</span> = Query(<span class="params"><span class="literal">None</span>, min_length=<span class="number">2</span>, max_length=<span class="number">10</span></span>),</span></span><br><span class="line"><span class="params"></span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    posts = Post.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> title:</span><br><span class="line">        posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">            title__icontains=title).select_related(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>é‚£æ™‚æˆ‘å€‘å°±æ˜¯ç”¨äº†<code>filter</code>æ–¹æ³•ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">posts.<span class="built_in">filter</span>(title__icontains=title).select_related(<span class="string">&#x27;author&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æœ€å¾Œçš„<code>select_related(&#39;author&#39;)</code>æ˜¯ç‚ºäº†é¿å…ã€ŒN+1ã€å•é¡Œï¼Œå’ŒæŸ¥è©¢é‚è¼¯<strong>ç„¡é—œ</strong>ï¼Œå¯ä»¥å…ˆä¸ç®¡ã€‚</p><h3 id="æ–°éœ€æ±‚ï¼šåŒæ™‚æŸ¥è©¢ä½œè€…åå­—"><a href="#æ–°éœ€æ±‚ï¼šåŒæ™‚æŸ¥è©¢ä½œè€…åå­—" class="headerlink" title="æ–°éœ€æ±‚ï¼šåŒæ™‚æŸ¥è©¢ä½œè€…åå­—"></a>æ–°éœ€æ±‚ï¼šåŒæ™‚æŸ¥è©¢ä½œè€…åå­—</h3><p>æ–°çš„éœ€æ±‚æ˜¯ï¼Œç”¨<strong>åŒä¸€å€‹é—œéµå­—</strong>ï¼Œ åŒæ™‚æŸ¥è©¢<strong>æ–‡ç« çš„æ¨™é¡Œæˆ–ä½œè€…çš„åå­—</strong>ï¼Œ åªè¦ä»»ä¸€ç¬¦åˆå°±é¡¯ç¤ºåœ¨çµæœä¸­ã€‚ï¼ˆäºŒè€…æ»¿è¶³å…¶ä¸€å³å¯ï¼Œä¹Ÿå¯ä»¥<strong>éƒ½ç¬¦åˆ</strong>ï¼‰</p><p>é€™éœ€æ±‚é¡ä¼¼æ–¼ iThome éµäººè³½å®˜ç¶²çš„<a href="https://ithelp.ithome.com.tw/2024ironman/signup/list">é€™å€‹æŸ¥è©¢åŠŸèƒ½</a>ï¼š</p><p><img src="https://i.imgur.com/nCU56Bk.png"></p><p>ä¸éæˆ‘å€‘åªèƒ½æŸ¥ 2 ç¨®ï¼Œè€Œå®ƒå¯ä»¥åŒæ™‚æŸ¥ 3 ç¨®ï¼šé¡Œç›®ã€ç°¡ä»‹ã€åƒè³½è€…æš±ç¨±ã€‚</p><p>ä½†æœ¬è³ªä¸Šæ˜¯ä¸€æ¨£çš„ã€‚</p><h3 id="ç”¨å‚³çµ±æ–¹æ³•å¯¦ä½œ"><a href="#ç”¨å‚³çµ±æ–¹æ³•å¯¦ä½œ" class="headerlink" title="ç”¨å‚³çµ±æ–¹æ³•å¯¦ä½œ"></a>ç”¨å‚³çµ±æ–¹æ³•å¯¦ä½œ</h3><p>é€™æ™‚å¦‚æœç”¨å‚³çµ±æ–¹æ³•å¯¦ä½œï¼ŒæŸ¥è©¢æœƒé•·é€™æ¨£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">    Q(title__icontains=title) | Q(author__name__icontains=title)</span><br><span class="line">).select_related(<span class="string">&#x27;author&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ­¤æ™‚æŸ¥è©¢åƒæ•¸ä¸é©åˆå†å«<code>title</code>ï¼Œå› ç‚ºå®ƒè¦æŸ¥è©¢<strong>å…©å€‹æ¬„ä½</strong>ã€‚æ²’é—œä¿‚ï¼Œæˆ‘å€‘ä¹‹å¾Œæœƒæ”¹æˆ<code>query</code>ã€‚</p><p>é€™æ®µç¨‹å¼ç¢¼é‚„æœ‰å…©å€‹é‡é»ï¼š</p><ol><li>æŸ¥è©¢æœç„¶<strong>è®Šé•·</strong>äº†ï¼ä¹‹å¾Œå¦‚æœé‚„æœ‰æ–°çš„æŸ¥è©¢æ¢ä»¶ï¼Œé‚£è±ˆä¸æ˜¯â€¦â€¦</li><li>é€™å€‹<code>Q</code>æ˜¯ä»€éº¼æ±è¥¿ï¼Ÿ</li></ol><p><code>Q</code>å‰‡æ˜¯ Django ORM çš„ <a href="https://docs.djangoproject.com/en/5.1/topics/db/queries/#complex-lookups-with-q-objects">Q ç‰©ä»¶</a>ï¼Œå®ƒåœ¨<strong>è¤‡é›œæŸ¥è©¢é‚è¼¯</strong>ä¸­ä½”æ“šäº†é‡è¦åœ°ä½ã€‚å› æ­¤ï¼Œæˆ‘å€‘æœ‰å¿…è¦å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹ã€‚</p><hr><h2 id="Django-Q-ç‰©ä»¶ç°¡ä»‹"><a href="#Django-Q-ç‰©ä»¶ç°¡ä»‹" class="headerlink" title="Django Q ç‰©ä»¶ç°¡ä»‹"></a>Django Q ç‰©ä»¶ç°¡ä»‹</h2><p>ç‚ºäº†æ”¹å–„<strong>å¤šæ¢ä»¶æŸ¥è©¢</strong>æ™‚ï¼Œç¨‹å¼<strong>çµæ§‹è¤‡é›œ</strong>çš„å•é¡Œï¼ŒDjango æä¾›äº†<code>Q</code>ç‰©ä»¶ã€‚</p><p><code>Q</code>ç‰©ä»¶å…è¨±æˆ‘å€‘<strong>éˆæ´»åœ°çµ„ç¹”æŸ¥è©¢æ¢ä»¶</strong>ï¼Œä½¿ç”¨<strong>é‚è¼¯é‹ç®—å­</strong>ï¼ˆå¦‚<code>&amp;</code>ã€<code>|</code>ï¼‰é€²è¡Œ<strong>æ¢ä»¶åˆä½µ</strong>ã€‚åœ¨è™•ç†<strong>è¤‡é›œæ¢ä»¶éæ¿¾</strong>æ™‚éå¸¸æœ‰ç”¨ã€‚</p><p>æ¯”å¦‚èªªï¼Œæˆ‘å€‘æƒ³è¦ç¯©é¸å‡ºæ¨™é¡ŒåŒ…å«ã€ŒNinjaã€<strong>ä¸¦ä¸”</strong>ä½œè€…åç¨±åŒ…å«ã€ŒAliceã€çš„æ–‡ç« ï¼Œå¯ä»¥é€™æ¨£å¯«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">    Q(title__icontains=<span class="string">&#x27;Ninja&#x27;</span>) &amp; Q(author__name__icontains=<span class="string">&#x27;Alice&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å¯«æ³•ï¼Œå…¶å¯¦å°±<strong>ç­‰åƒ¹</strong>æ–¼æˆ‘å€‘å¸¸è¦‹çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">    title__icontains=<span class="string">&#x27;Ninja&#x27;</span>, author__name__icontains=<span class="string">&#x27;Alice&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä½ é€šå¸¸ä¸æœƒåœ¨ã€ŒANDã€éœ€æ±‚æ™‚ä½¿ç”¨<code>Q</code>ç‰©ä»¶ã€‚</p><p>ã€ŒORã€æŸ¥è©¢æ¢ä»¶æ‰æ˜¯<code>Q</code>çš„<strong>ç¶“å…¸å ´æ™¯</strong>ã€‚</p><p>ç¾åœ¨æ¢ä»¶æ”¹ç‚ºâ€”â€”æ–‡ç« æ¨™é¡Œã€Œ<strong>æˆ–</strong>ã€ä½œè€…åå­—æœ‰ã€ŒAliceã€å°±è¡Œã€‚å¯ä»¥ä½¿ç”¨<code>|</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">    Q(title__icontains=<span class="string">&#x27;Ninja&#x27;</span>) | Q(author__name__icontains=<span class="string">&#x27;Alice&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>Q</code>ç‰©ä»¶è®“æŸ¥è©¢æ›´åŠ éˆæ´»ä¸”æ¸…æ™°ï¼Œç‰¹åˆ¥æ˜¯åœ¨é¢å°<strong>å¤šå€‹å¯é¸æ¢ä»¶</strong>æ™‚ã€‚</p><hr><h2 id="ä½¿ç”¨-FilterSchema-æ”¹é€²æŸ¥è©¢"><a href="#ä½¿ç”¨-FilterSchema-æ”¹é€²æŸ¥è©¢" class="headerlink" title="ä½¿ç”¨ FilterSchema æ”¹é€²æŸ¥è©¢"></a>ä½¿ç”¨ FilterSchema æ”¹é€²æŸ¥è©¢</h2><p>äº†è§£å‚³çµ±æŸ¥è©¢æ–¹æ³•å®¹æ˜“é€ æˆ<strong>ç¨‹å¼å†—é•·</strong>çš„å•é¡Œï¼Œä¸¦å­¸ç¿’äº†<code>Q</code>ç‰©ä»¶çš„åŸºç¤å¾Œï¼Œæˆ‘å€‘è¦é–‹å§‹ä»‹ç´¹ä»Šå¤©çš„ä¸»è§’â€”â€”<a href="https://django-ninja.dev/guides/input/filtering/">FilterSchema</a>ã€‚</p><p>Django Ninja æä¾›çš„ FilterSchemaï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯è®“æŸ¥è©¢èªå¥æ›´åŠ <strong>çµæ§‹åŒ–ã€æ¨¡çµ„åŒ–</strong>ï¼Œé¿å… view å‡½å¼è®Šå¾—å†—é•·ã€é›£è®€ã€‚</p><p>è€Œä¸”ï¼Œèˆ‡ Schema ä¸­çš„é©—è­‰æ–¹æ³•ç›¸åŒï¼Œå®ƒä¹Ÿä¸€å®šç¨‹åº¦å¯¦ç¾äº†ã€Œ<strong>é—œæ³¨é»åˆ†é›¢</strong>ã€åŸå‰‡â€”â€”è—‰ç”±å°‡æŸ¥è©¢é‚è¼¯å¾ view å‡½å¼ä¸­<strong>æŠ½é›¢</strong>å‡ºä¾†ã€‚</p><p>ä¸éï¼Œæˆ‘å€‘å…ˆä¸æ€¥è‘—ä¸€æ­¥åˆ°ä½ï¼Œå®¹æˆ‘<strong>åˆ†éšæ®µåœ°æ”¹é€²</strong>ç¨‹å¼ç¢¼ã€‚</p><p>é€™æ¨£é›–ç„¶æœ‰é»ç¬¨æ‹™ï¼Œä½†ä½ æœƒå° FilterSchema èˆ‡è¤‡é›œæŸ¥è©¢çš„å¯¦ä½œï¼Œæœ‰æ›´æ·±åˆ»çš„äº†è§£ã€‚</p><h2 id="ç¬¬ä¸€ç‰ˆã€Œæ”¹é€²ã€"><a href="#ç¬¬ä¸€ç‰ˆã€Œæ”¹é€²ã€" class="headerlink" title="ç¬¬ä¸€ç‰ˆã€Œæ”¹é€²ã€"></a>ç¬¬ä¸€ç‰ˆã€Œæ”¹é€²ã€</h2><p>æˆ‘å€‘å…ˆç”¨ FilterSchema å¯¦ç¾ä¸Šè¿°çš„ã€Œæ–°éœ€æ±‚ï¼šåŒæ™‚æŸ¥è©¢ä½œè€…åå­—ã€ã€‚</p><p>åœ¨<code>schemas.py</code>ä¸­å»ºç«‹æ–°çš„ Schemaï¼Œä¸éé€™æ¬¡æ˜¯ FilterSchemaï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># post/schemas.py</span></span><br><span class="line"><span class="keyword">from</span> ninja <span class="keyword">import</span> Field, FilterSchema, Schema</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PostFilterSchema</span>(<span class="title class_ inherited__">FilterSchema</span>):</span><br><span class="line">    query: <span class="built_in">str</span> | <span class="literal">None</span> = Field(<span class="literal">None</span>, min_length=<span class="number">2</span>, max_length=<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>é€™å€‹ FilterSchemaï¼Œå…¶å¯¦æ˜¯çµ¦ã€Œ<strong>æŸ¥è©¢åƒæ•¸</strong>ï¼ˆquery parametersï¼‰ã€ä½¿ç”¨çš„ã€‚æ‰€ä»¥å®ƒçš„æ¬„ä½ï¼ˆå±¬æ€§ï¼‰åç¨±ï¼Œå°±æ˜¯ä½ èªç‚ºå®¢æˆ¶ç«¯<strong>æ‡‰è©²ä½¿ç”¨çš„æŸ¥è©¢åƒæ•¸åç¨±</strong>ã€‚</p><p>å› ç‚ºåŒæ™‚è¦æŸ¥ã€Œæ–‡ç« æ¨™é¡Œã€å’Œã€Œä½œè€…åå­—ã€ï¼Œæ‰€ä»¥æˆ‘å‘½åç‚º<code>query</code>ã€‚</p><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘åœ¨ view å‡½å¼ä¸­ä½¿ç”¨å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.get(<span class="params">...</span>)</span></span><br><span class="line"><span class="meta">@paginate(<span class="params">CustomPagination</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    filters: PostFilterSchema = Query(<span class="params"></span>),  <span class="comment"># ä½¿ç”¨ FilterSchema</span></span></span><br><span class="line"><span class="params"></span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    posts = Post.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> filters.query:</span><br><span class="line">        q = Q(title__icontains=filters.query) | \</span><br><span class="line">            Q(author__username__icontains=filters.query)</span><br><span class="line">        posts = posts.<span class="built_in">filter</span>(q)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>PSï¼šé€™è£¡çš„<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/17/files">å°ˆæ¡ˆç¯„ä¾‹ç¨‹å¼ç¢¼</a><strong>æœ‰èª¤</strong>ï¼Œç¬¬äºŒå€‹<code>Q</code>æŸ¥è©¢èª¤æ¤ç‚ºã€Œ<code>content__icontains</code>ã€ï¼Œè«‹è®€è€…ç•™æ„ã€‚æˆ‘å·²åœ¨ä¸‹ä¸€å€‹åˆ†æ”¯ä¸­ä¿®å¾©ã€‚</p><p>çœ‹å®Œé€™å€‹æ–°çš„ view å‡½å¼ï¼Œä½ å¯èƒ½ä¸ç¦å¿ƒæƒ³ï¼š</p><blockquote><p>é€™æ˜¯åœ¨æç¬‘å§ï¼Ÿå®Œå…¨æ²’æœ‰è®Šç°¡å–®å•Šï¼</p></blockquote><p>æ²’éŒ¯ï¼Œå› ç‚ºé€™åªæ˜¯ FilterSchema çš„ã€Œ<strong>åŠæˆå“</strong>ã€ï¼Œæ‰€ä»¥çœ‹èµ·ä¾†æ¯”ä¸ç”¨é‚„å†—é•·ã€‚</p><p>å„˜ç®¡å¦‚æ­¤ï¼Œå…¶ä¸­é‚„æ˜¯æœ‰ä¸€äº›çœ‹é»ï¼Œå€¼å¾—æˆ‘å€‘äº†è§£ã€‚</p><h2 id="é‡é»è§£æ"><a href="#é‡é»è§£æ" class="headerlink" title="é‡é»è§£æ"></a>é‡é»è§£æ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">q = Q(title__icontains=filters.query) | \</span><br><span class="line">    Q(content__icontains=filters.query)</span><br><span class="line">posts = posts.<span class="built_in">filter</span>(q)</span><br></pre></td></tr></table></figure><p>å¾é€™æ®µèƒ½çœ‹å‡ºï¼Œ<code>Q</code>ç‰©ä»¶å¯ä»¥<strong>å–®ç¨é€²è¡Œå„ç¨®åˆä½µæ“ä½œ</strong>ï¼Œæœ€å¾Œå†ä¸Ÿçµ¦ Django <code>filter</code>æ–¹æ³•ä½œç‚ºåƒæ•¸ã€‚</p><h3 id="Django-Ninja-å¸¸è¦‹å¥å‹"><a href="#Django-Ninja-å¸¸è¦‹å¥å‹" class="headerlink" title="Django Ninja å¸¸è¦‹å¥å‹"></a>Django Ninja å¸¸è¦‹å¥å‹</h3><p>æœ¬ä¾‹ä¸­ï¼Œé€™æ¨£çš„ view <strong>å‡½å¼åƒæ•¸</strong>ã€Œå¥å‹ã€åœ¨ Django Ninja éå¸¸æ™®éï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filters: PostFilterSchema = Query()</span><br></pre></td></tr></table></figure><p>è€Œåˆå­¸è€…çœ‹äº†æœƒå¾ˆå®¹æ˜“ã€Œ<strong>èª¤è§£</strong>ã€ã€‚</p><p>ç‚ºä»€éº¼ï¼Ÿå› ç‚ºä½ å¯èƒ½æœƒä»¥ç‚ºï¼Œ<code>filters</code>çš„å‹åˆ¥æ˜¯<code>PostFilterSchema</code>ï¼ˆé€™æ²’å•é¡Œï¼‰ï¼Œç„¶å¾Œå®ƒçš„<strong>é è¨­å€¼</strong>æ˜¯<code>Query()</code>ï¼Œå› ç‚º Python å‡½å¼å°±æ˜¯é€™æ¨£å®šç¾©çš„ã€‚</p><p>ä½†ä¸¦ä¸æ˜¯ã€‚</p><p><code>Query()</code>ä¸¦ä¸æ˜¯<code>filters</code>åƒæ•¸çš„é è¨­å€¼ï¼Œå¦å‰‡å®ƒçš„å‹åˆ¥ä¸æ‡‰è©²æ˜¯<code>Query</code>å—ï¼Ÿ</p><p>äº‹å¯¦ä¸Šï¼Œ<code>= Query()</code>é€™æ®µæ¨™è¨˜<strong>ä¸æ˜¯çµ¦ä½ çœ‹çš„</strong>ï¼Œæ˜¯çµ¦ Django Ninja çœ‹çš„ï¼Œå®ƒç›¸ç•¶æ–¼æ˜¯åœ¨å‘Šè¨´ Django Ninjaï¼š</p><blockquote><p>é€™å€‹åƒæ•¸å…§å®¹æ‡‰è©²å¾ HTTP è«‹æ±‚ä¸­çš„æŸ¥è©¢åƒæ•¸ï¼ˆquery parametersï¼‰ä¸­å–å¾—ï¼Œè€Œä¸æ˜¯å¾ body æˆ– pathã€‚</p></blockquote><p>é€™æ¨£æƒ³å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚</p><p>Django Ninja æœƒè©¦åœ–å¾æŸ¥è©¢åƒæ•¸ç²å–å­—ä¸²ï¼Œæ‹†è§£å®ƒå€‘ï¼ˆå¦‚æœæœ‰è¤‡æ•¸å€‹æŸ¥è©¢å­—ä¸²ï¼‰ï¼Œç„¶å¾Œä¸€ä¸€ä¸Ÿçµ¦<code>PostFilterSchema</code>é€²è¡Œ<strong>åˆå§‹åŒ–èˆ‡é©—è­‰ï¼š</strong></p><ol><li>é©—è­‰å¤±æ•—ï¼šå›å‚³ 422ã€‚</li><li>é©—è­‰æˆåŠŸï¼šå°‡ Schema ç‰©ä»¶å‚³å…¥ view å‡½å¼ä½œç‚º<strong>å‡½å¼çš„åƒæ•¸</strong>ï¼ˆ<strong>å€åŸŸè®Šæ•¸</strong>ï¼‰ã€‚</li></ol><hr><h2 id="å°çµèˆ‡ä¸‹ä¸€æ­¥"><a href="#å°çµèˆ‡ä¸‹ä¸€æ­¥" class="headerlink" title="å°çµèˆ‡ä¸‹ä¸€æ­¥"></a>å°çµèˆ‡ä¸‹ä¸€æ­¥</h2><p>æœ¬ç¯‡å…ˆè¬›åˆ°é€™è£¡ï¼Œæˆ‘å€‘å·²ç¶“æ¥è§¸äº†å…©å€‹æ–°æ¦‚å¿µâ€”â€”Q ç‰©ä»¶å’Œ FilterSchemaã€‚</p><p>æˆ‘å€‘é‚„åˆ†æäº† Django Ninja ä¸­å¸¸è¦‹çš„ view å‡½å¼åƒæ•¸ã€Œå¥å‹ã€ï¼Œé€™å°æ–¼ç†è§£æ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ã€ç¿’æ…£éå¸¸é‡è¦ã€‚</p><p>é€™äº›æ¦‚å¿µéœ€è¦æ™‚é–“æ¶ˆåŒ–ï¼Œä½†æˆ‘å¯ä»¥å‘ä½ ä¿è­‰ï¼Œé€™æ¨£çš„é‹ªé™³æ˜¯å€¼å¾—çš„ã€‚</p><p>æ¯”èµ·ç›´æ¥æ·±å…¥ FilterSchema çš„é€²éšç”¨æ³•ï¼Œé€™ç¨®å¾ªåºæ¼¸é€²çš„å­¸ç¿’æ–¹å¼æ›´æœ‰åŠ©æ–¼ç†è§£ã€‚</p><p>ä¸‹ä¸€ç¯‡ä½ å°‡æœƒçœ‹åˆ°ï¼Œ<strong>ç‚ºä»€éº¼èªè­˜ Q ç‰©ä»¶å¾ˆé‡è¦</strong>ã€‚ä»¥åŠå¦‚ä½•é€é FilterSchemaï¼Œä¾†å»ºç«‹çµæ§‹åŒ–ã€ç¬¦åˆã€Œé—œæ³¨é»åˆ†é›¢ã€çš„<strong>å¤šæ¬„ä½æŸ¥è©¢</strong>ã€‚</p><p>æˆ‘å€‘ä¸‹ç¯‡è¦‹ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ã€Œ&lt;strong&gt;æŸ¥è©¢&lt;/strong&gt;ã€æ˜¯ API ä¸­å¸¸è¦‹çš„é™„åŠ éœ€æ±‚ï¼Œæœ¬è³ªä¸Šæ˜¯&lt;strong&gt;å°è³‡æ–™çš„éæ¿¾ï¼ˆfilteringï¼‰èˆ‡ç¯©é¸&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç„¡è«–æ˜¯ç¯©é¸æ–‡ç« ã€å•†å“ï¼Œé‚„æ˜¯æŸ¥è©¢ç”¨æˆ¶ï¼Œ&lt;strong&gt;æ ¹æ“šä¸åŒæ¢ä»¶ä¾†éæ¿¾è³‡æ–™ä¸¦ç²å¾—çµæœ&lt;/strong&gt;ï¼Œå¯èªªæ˜¯å¤§éƒ¨åˆ†å°ˆæ¡ˆçš„å¿…å‚™åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ view å‡½å¼ä¸­ï¼Œå¯¦ä½œæŸ¥è©¢&lt;strong&gt;æœ€ç°¡å–®&lt;/strong&gt;çš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ Django ORM çš„éæ¿¾æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥ç”¨&lt;code&gt;filter&lt;/code&gt;æ–¹æ³•ä¾†æ ¹æ“šç‰¹å®šæ¢ä»¶ç¯©é¸ QuerySetã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¨®æ–¹æ³•ç°¡å–®ç›´æ¥ï¼Œé©åˆåŸºæœ¬çš„æŸ¥è©¢éœ€æ±‚ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿæœ‰å…¶&lt;strong&gt;å±€é™æ€§&lt;/strong&gt;â€”â€”éš¨è‘—æ¬„ä½èˆ‡éœ€æ±‚çš„å¢åŠ ï¼ŒæŸ¥è©¢æ¢ä»¶å¯èƒ½è®Šå¾—&lt;strong&gt;è¶Šä¾†è¶Šè¤‡é›œ&lt;/strong&gt;ï¼Œå°è‡´ç¨‹å¼ç¢¼&lt;strong&gt;å†—é•·&lt;/strong&gt;ä¸”é›£ä»¥ç¶­è­·ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†è§£æ±ºé€™ä¸€å•é¡Œï¼ŒDjango Ninja æä¾›äº† FilterSchemaï¼Œè®“æˆ‘å€‘å¯ä»¥ç”¨æ›´ã€Œ&lt;strong&gt;çµæ§‹åŒ–&lt;/strong&gt;ã€çš„æ–¹å¼ï¼Œå®šç¾©ä¸¦ç®¡ç†æŸ¥è©¢æ¢ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°‡ä»‹ç´¹ FilterSchemaï¼Œä¸€æ­¥æ­¥å¯¦ä½œèˆ‡è¬›è§£ï¼Œè®“ä½ äº†è§£å¦‚ä½•åœ¨ Django Ninja ä¸­ä½¿ç”¨ FilterSchemaï¼Œå¯¦ç¾&lt;strong&gt;æ›´åŠ éˆæ´»ã€æ¨¡çµ„åŒ–&lt;/strong&gt;çš„ API æŸ¥è©¢åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/17&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 25ï¼šåˆ†é ï¼ˆä¸‹ï¼‰è‡ªå®šç¾©åˆ†é é¡åˆ¥</title>
    <link href="https://blog.kyomind.tw/django-ninja-25/"/>
    <id>https://blog.kyomind.tw/django-ninja-25/</id>
    <published>2024-10-07T02:44:36.000Z</published>
    <updated>2024-10-07T15:22:51.748Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ä¸Šä¸€ç¯‡æˆ‘å€‘ä»‹ç´¹äº† Django Ninja çš„å…§å»ºåˆ†é å™¨ï¼Œä¸¦ç”¨å®ƒå¯¦ä½œäº†ç°¡å–®çš„åˆ†é åŠŸèƒ½ã€‚</p><p>é›–ç„¶å…§å»ºçš„<code>PageNumberPagination</code>ç¢ºå¯¦æ–¹ä¾¿ï¼Œä½†åœ¨å¾ˆå¤šæ™‚å€™ï¼Œæˆ‘å€‘ä»éœ€è¦ä¸€äº›<strong>å®¢è£½åŒ–</strong>åŠŸèƒ½ã€‚</p><p>ç‚ºäº†å¯¦ç¾é€™å€‹ç›®çš„ï¼Œä½ éœ€è¦<strong>è‡ªå®šç¾©ä¸€å€‹åˆ†é é¡åˆ¥</strong>ã€‚</p><p>ä¸éåˆ¥æ“”å¿ƒï¼Œé€™ç¨®è‡ªå®šç¾©ï¼Œ<strong>ä¸¦éå¾é›¶é–‹å§‹</strong>ã€‚è€Œæ˜¯ç¹¼æ‰¿ Django Ninja æ‰€æä¾›çš„åŸºç¤åˆ†é é¡åˆ¥ï¼Œå†é€²è¡Œè‡ªå·±çš„ã€Œ<strong>åŠ å·¥</strong>ã€ã€‚</p><p>é€™ç¯‡æ–‡ç« å°±è¦ä¾†æ•™ä½ æ€éº¼åšã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/16">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="å®¢è£½åŒ–éœ€æ±‚"><a href="#å®¢è£½åŒ–éœ€æ±‚" class="headerlink" title="å®¢è£½åŒ–éœ€æ±‚"></a>å®¢è£½åŒ–éœ€æ±‚</h2><p>é™¤äº†åŸºæœ¬çš„åˆ†é ï¼Œæˆ‘å€‘é‚„å¸Œæœ›èƒ½å¤ ï¼š</p><ul><li><strong>å…è¨±å®¢æˆ¶ç«¯é¸æ“‡</strong>æ¯é é¡¯ç¤ºçš„è³‡æ–™æ•¸é‡ï¼Œ<strong>å¯é¸ç¯„åœ</strong>é™å®šåœ¨ 1 è‡³ 100 ä¹‹é–“ã€‚</li><li>åœ¨å›æ‡‰ä¸­<strong>æ–°å¢å…©å€‹æ¬„ä½</strong>ï¼Œé¡¯ç¤ºç•¶å‰çš„<strong>åˆ†é è³‡è¨Š</strong>ï¼š<ul><li>ç•¶å‰é æ•¸ï¼ˆ<code>page</code>ï¼‰ã€‚</li><li>æ¯é é¡¯ç¤ºæ•¸é‡ï¼ˆ<code>per_page</code>ï¼‰ã€‚</li></ul></li></ul><p>é€™ç„¡ç–‘æ˜¯å¾ˆå¸¸è¦‹çš„éœ€æ±‚ã€‚æˆ‘å€‘å°‡é€éè‡ªå®šç¾©åˆ†é é¡åˆ¥ï¼Œä¾†å¯¦ç¾é€™äº›åŠŸèƒ½ã€‚</p><p>è©±ä¸å¤šèªªï¼Œç›´æ¥é–‹å§‹ï¼</p><span id="more"></span><h2 id="å¯¦ä½œï¼šè‡ªå®šç¾©åˆ†é é¡åˆ¥"><a href="#å¯¦ä½œï¼šè‡ªå®šç¾©åˆ†é é¡åˆ¥" class="headerlink" title="å¯¦ä½œï¼šè‡ªå®šç¾©åˆ†é é¡åˆ¥"></a>å¯¦ä½œï¼šè‡ªå®šç¾©åˆ†é é¡åˆ¥</h2><p>åˆ†é å™¨ï¼ˆåˆ†é é¡åˆ¥ï¼‰é€šå¸¸æ˜¯æ˜¯<strong>ä¾›å…¨å°ˆæ¡ˆä½¿ç”¨</strong>ï¼Œæ‰€ä»¥ä¸é©åˆæ”¾åœ¨ Django app ç›®éŒ„ä¸­ã€‚ä½†ä¹Ÿä¸èƒ½åƒ exception handlers ä¸€æ¨£ï¼Œæ”¾åœ¨å°ˆæ¡ˆçš„<code>api.py</code>ï¼Œå› ç‚ºæœƒå¼•ç™¼<strong>å¾ªç’°å¼•ç”¨</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘åœ¨å°ˆæ¡ˆç›®éŒ„ NinjaForum å»ºç«‹ä¸€å€‹æ–°çš„ Python æ¨¡çµ„â€”â€”<code>pagination.py</code>ã€‚</p><p>åœ¨é€™å€‹æ–°æ¨¡çµ„ä¸­ï¼Œç›´æ¥æ’°å¯«ä¸€å€‹åç‚º<code>CustomPagination</code>çš„åˆ†é é¡åˆ¥ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db.models.query <span class="keyword">import</span> QuerySet</span><br><span class="line"><span class="keyword">from</span> ninja <span class="keyword">import</span> Field, Schema</span><br><span class="line"><span class="keyword">from</span> ninja.pagination <span class="keyword">import</span> PaginationBase</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomPagination</span>(<span class="title class_ inherited__">PaginationBase</span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Input</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">        page: <span class="built_in">int</span> = Field(<span class="number">1</span>, ge=<span class="number">1</span>)</span><br><span class="line">        per_page: <span class="built_in">int</span> = Field(<span class="number">10</span>, ge=<span class="number">1</span>, le=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Output</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">        items: <span class="built_in">list</span></span><br><span class="line">        page: <span class="built_in">int</span> = Field(examples=[<span class="number">1</span>])</span><br><span class="line">        per_page: <span class="built_in">int</span> = Field(examples=[<span class="number">10</span>])</span><br><span class="line">        total: <span class="built_in">int</span> = Field(examples=[<span class="number">100</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paginate_queryset</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        queryset: QuerySet,</span></span><br><span class="line"><span class="params">        pagination: Input,</span></span><br><span class="line"><span class="params">        **params: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        start = (pagination.page - <span class="number">1</span>) * pagination.per_page</span><br><span class="line">        end = start + pagination.per_page</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;items&#x27;</span>: queryset[start:end],</span><br><span class="line">            <span class="string">&#x27;page&#x27;</span>: pagination.page,</span><br><span class="line">            <span class="string">&#x27;per_page&#x27;</span>: pagination.per_page,</span><br><span class="line">            <span class="string">&#x27;total&#x27;</span>: queryset.count(),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>é€™å€‹åˆ†é é¡åˆ¥<strong>å…è¨±æˆ‘å€‘é€éæŸ¥è©¢åƒæ•¸</strong>â€”â€”<code>page</code>å’Œ<code>per_page</code>â€”â€”ä¾†æ±ºå®šåˆ†é çš„å¤§å°èˆ‡é æ•¸ï¼Œè€Œä¸”å›æ‡‰ä¸­<strong>é‚„å¤šäº†å…©å€‹åŒåçš„æ–°æ¬„ä½</strong>ï¼Œä½œç‚ºé¡å¤–çš„åˆ†é è³‡è¨Šã€‚</p><hr><h2 id="è‡ªå®šç¾©åˆ†é é¡åˆ¥è§£èªª"><a href="#è‡ªå®šç¾©åˆ†é é¡åˆ¥è§£èªª" class="headerlink" title="è‡ªå®šç¾©åˆ†é é¡åˆ¥è§£èªª"></a>è‡ªå®šç¾©åˆ†é é¡åˆ¥è§£èªª</h2><p>é›–ç„¶ç¨‹å¼ç¢¼çœ‹èµ·ä¾†ç´°ç¯€ç¹å¤šï¼Œä½†ä»”ç´°é–±è®€å¾Œï¼Œä½ æœƒç™¼ç¾å®ƒå…¶å¯¦ä¸é›£ç†è§£ã€‚</p><p>é™æ–¼ç¯‡å¹…ï¼Œæˆ‘å€‘åªæŒ‘ä¸€äº›é‡é»ä¾†è¬›ã€‚</p><h3 id="é‡é»ä¸€ï¼šæ•´é«”çµæ§‹ä¾†è‡ªç¹¼æ‰¿çš„é¡åˆ¥â€”â€”PaginationBase"><a href="#é‡é»ä¸€ï¼šæ•´é«”çµæ§‹ä¾†è‡ªç¹¼æ‰¿çš„é¡åˆ¥â€”â€”PaginationBase" class="headerlink" title="é‡é»ä¸€ï¼šæ•´é«”çµæ§‹ä¾†è‡ªç¹¼æ‰¿çš„é¡åˆ¥â€”â€”PaginationBase"></a>é‡é»ä¸€ï¼šæ•´é«”çµæ§‹ä¾†è‡ªç¹¼æ‰¿çš„é¡åˆ¥â€”â€”<code>PaginationBase</code></h3><p>ç¬¬ä¸€å€‹ç–‘æƒ‘æ‡‰è©²æ˜¯ï¼šã€Œå•Šæˆ‘<strong>æ€éº¼æœƒçŸ¥é“</strong>åˆ†é é¡åˆ¥è¦é€™æ¨£å¯«ï¼Ÿã€</p><p>æ²’éŒ¯ï¼Œæˆ‘å€‘<strong>ç•¶ç„¶ä¸çŸ¥é“</strong>ï¼Œæ‰€ä»¥è¦çœ‹<a href="https://django-ninja.dev/guides/response/pagination/#creating-custom-pagination-class">å®˜æ–¹æ–‡ä»¶</a>ï¼Œé‚„æœ‰<a href="https://github.com/vitalik/django-ninja/blob/master/ninja/pagination.py">åŸå§‹ç¢¼</a>ã€‚</p><p>å¾å®˜æ–¹æ–‡ä»¶æˆ‘å€‘å¯ä»¥å¾—çŸ¥ï¼Œè¦ç¹¼æ‰¿ä¸€å€‹å«<code>PaginationBase</code>çš„é¡åˆ¥ã€‚ä½†æ–‡ä»¶ä¸­å°è©²é¡åˆ¥çš„æå¯«é‚„æ˜¯æœ‰é»ç°¡ç•¥ï¼Œæ‰€ä»¥éœ€è¦çœ‹åŸå§‹ç¢¼ä¾†äº†è§£æ›´å¤šçš„å…·é«”è³‡è¨Šã€‚</p><p>ç„¶å¾Œæ¨¡ä»¿ä¸¦è¦†å¯«é¡åˆ¥ä¸­çš„ä¸€äº›å±¬æ€§ã€æ–¹æ³•â€”â€”å·®ä¸å¤šå°±æ˜¯å¦‚æ­¤ã€‚</p><h3 id="é‡é»äºŒï¼šInput-Schema"><a href="#é‡é»äºŒï¼šInput-Schema" class="headerlink" title="é‡é»äºŒï¼šInput Schema"></a>é‡é»äºŒï¼šInput Schema</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    page: <span class="built_in">int</span> = Field(<span class="number">1</span>, ge=<span class="number">1</span>)</span><br><span class="line">    per_page: <span class="built_in">int</span> = Field(<span class="number">10</span>, ge=<span class="number">1</span>, le=<span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>ä½ ä¸€å®šèƒ½çœ‹å‡ºä¾†ï¼Œé€™å€‹ Schema å°±æ˜¯æ‹¿ä¾†<strong>å®šç¾©å’Œé©—è­‰</strong>èˆ‡åˆ†é æœ‰é—œçš„ <strong>URL æŸ¥è©¢åƒæ•¸</strong>ã€‚</p><p>æ­¤å¤–ï¼Œ<code>Input</code>é¡åˆ¥æœƒä½œç‚º<strong>å¼•æ•¸</strong>å‚³å…¥<code>paginate_queryset</code>æ–¹æ³•ä¸­ï¼Œä½œç‚ºå¯¦ç¾åˆ†é é‚è¼¯çš„ä¸€éƒ¨åˆ†ã€‚</p><p><code>Input</code>ä¸­çš„æ¯ä¸€å€‹å±¬æ€§ï¼Œå°±<strong>ä»£è¡¨ä¸€å€‹æŸ¥è©¢åƒæ•¸</strong>ï¼ˆé™åˆ†é ç›¸é—œï¼‰â€”â€”è€Œä¸”ä¸€æ¨£å¯ä»¥ä½¿ç”¨<code>Field</code>ä¾†è¨­å®šç´°ç¯€ï¼</p><p>é€™è£¡çš„<code>Field</code>æ˜¯ Pydantic çš„<code>Field</code>ï¼Œæˆ‘å€‘åœ¨ç¬¬ 18 ç¯‡è©³ç´°ä»‹ç´¹éã€‚å®ƒå…è¨±æˆ‘å€‘ç‚ºæ¯å€‹åƒæ•¸è¨­å®š<strong>é è¨­å€¼</strong>ã€<strong>æ–‡ä»¶ç¯„ä¾‹</strong>å’Œ<strong>åŸºæœ¬çš„é©—è­‰è¦å‰‡</strong>ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œ<code>page</code>çš„é è¨­å€¼æ˜¯ 1ï¼Œä¸”å¿…é ˆå¤§æ–¼ç­‰æ–¼ 1ï¼›<code>per_page</code>çš„é è¨­å€¼æ˜¯ 10ï¼Œä¸”å¿…é ˆåœ¨ 1 åˆ° 100 ä¹‹é–“ã€‚é€™æ¨£å¯ä»¥ç¢ºä¿æˆ‘å€‘çš„åˆ†é åƒæ•¸<strong>å§‹çµ‚åœ¨åˆç†çš„ç¯„åœå…§</strong>ã€‚</p><p>åŒæ¨£çš„é“ç†ä¹Ÿé©ç”¨æ–¼<code>Output</code>ï¼Œå®ƒæ±ºå®šäº† HTTP å›æ‡‰ã€Œ<strong>æ‡‰è©²è¦æœ‰</strong>ã€çš„æ ¼å¼ï¼Œç›¸ç•¶æ–¼åˆ†é å›æ‡‰çš„ Schemaã€‚</p><h3 id="é‡é»ä¸‰ï¼špaginate-queryset-æ–¹æ³•"><a href="#é‡é»ä¸‰ï¼špaginate-queryset-æ–¹æ³•" class="headerlink" title="é‡é»ä¸‰ï¼špaginate_queryset æ–¹æ³•"></a>é‡é»ä¸‰ï¼špaginate_queryset æ–¹æ³•</h3><p>é€™å€‹æ–¹æ³•æ˜¯æ‰€æœ‰åˆ†é é¡åˆ¥çš„<strong>æ ¸å¿ƒ</strong>ï¼Œå®ƒå¯¦ç¾äº†<strong>å…·é«”çš„åˆ†é é‚è¼¯</strong>ã€‚</p><p>å®ƒçš„ç¬¬ä¸€åƒæ•¸æ˜¯<code>self</code>ï¼Œå¯è¦‹å®ƒæ˜¯ä¸€å€‹ã€Œ<strong>å¯¦ä¾‹æ–¹æ³•</strong>ã€ã€‚</p><p><strong>æœ€å€¼å¾—æ³¨æ„</strong>çš„æ˜¯<strong>ç¬¬äºŒåƒæ•¸</strong>â€”â€”<code>queryset</code>ï¼Œå®ƒå¯¦éš›ä¸Šå°±æ˜¯ view å‡½å¼çš„ return å€¼ï¼Œè€Œä¸”é¡å‹<strong>å¿…é ˆæ˜¯</strong> <a href="https://docs.djangoproject.com/en/5.1/ref/models/querysets/">QuerySet</a>ã€‚</p><p><code>paginate_queryset</code>æœƒåˆ©ç”¨æˆ‘å€‘ç†Ÿæ‚‰çš„ã€Œ<a href="https://vocus.cc/article/649392c3fd8978000166bbc5">åˆ‡ç‰‡èˆ‡ç´¢å¼•</a>ã€ï¼Œå°å‚³å…¥çš„ QuerySet é€²è¡Œã€Œåˆ‡å‰²ã€ã€‚é€™æ˜¯ Django ç‚º QuerySet è‡ªè¡Œå¯¦ä½œçš„åŠŸèƒ½ï¼Œè¡Œç‚ºä¸Šé¡ä¼¼ Python çš„<code>list</code>ã€<code>tuple</code>ç­‰å®¹å™¨ã€‚</p><p>ç•¶å®ƒå›æ‡‰çµ¦å®¢æˆ¶ç«¯æ™‚ï¼Œæˆ‘å€‘å°±å¾—åˆ°äº†<strong>åˆ‡ç‰‡å¾Œçš„ QuerySet</strong> å’Œ<strong>è‡ªå®šç¾©çš„å›æ‡‰æ ¼å¼</strong>ã€‚</p><hr><h2 id="æ¸¬è©¦è‡ªå®šç¾©åˆ†é "><a href="#æ¸¬è©¦è‡ªå®šç¾©åˆ†é " class="headerlink" title="æ¸¬è©¦è‡ªå®šç¾©åˆ†é "></a>æ¸¬è©¦è‡ªå®šç¾©åˆ†é </h2><p>å¯«å®Œä¸Šè¿°çš„è‡ªå®šç¾©é¡åˆ¥ï¼Œview å‡½å¼åªè¦å¤šä¸€è¡Œ<code>@paginate(CustomPagination)</code>å³å¯ï¼Œé€™è£¡å°±çœç•¥ç¨‹å¼ç¢¼ã€‚</p><p>ç›´æ¥çœ‹çµæœå§ï¼æˆ‘ä½¿ç”¨äº†<code>/?page=2&amp;per_page=5</code>ï¼ˆç¬¬ 2 é ã€æ¯é  5 ç­†ï¼‰æŸ¥è©¢åƒæ•¸ï¼š</p><p><img src="https://i.imgur.com/GuYj6Bk.png"></p><p>ååˆ†ç†æƒ³ï¼</p><p>é‚£å¦‚æœæ¯é æ•¸é‡è¨­å®šç‚º<strong>è¶…é 100</strong> æœƒæ€æ¨£å‘¢ï¼Ÿ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;less_than_equal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;query&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;per_page&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Input should be less than or equal to 100&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;le&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯ 422 å›æ‡‰ã€‚</p><hr><h2 id="åˆ†é åŠŸèƒ½ç¸½çµ"><a href="#åˆ†é åŠŸèƒ½ç¸½çµ" class="headerlink" title="åˆ†é åŠŸèƒ½ç¸½çµ"></a>åˆ†é åŠŸèƒ½ç¸½çµ</h2><p>é€éé€™å…©ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘å±•ç¤ºäº†å¦‚ä½•åœ¨ DjangoNinja ä¸­å¯¦ä½œåˆ†é ï¼Œå¾ç°¡å–®çš„å…§å»ºæ–¹æ³•ï¼Œåˆ°è¤‡é›œçš„è‡ªå®šç¾©åˆ†é é¡åˆ¥ã€‚</p><p>æ ¹æ“šå°ˆæ¡ˆéœ€æ±‚ï¼Œä½ å¯ä»¥é¸æ“‡<strong>é©åˆè‡ªå·±çš„åˆ†é ç­–ç•¥</strong>ï¼Œè®“æ¯ä¸€å€‹å›æ‡‰ï¼Œéƒ½èƒ½ä»¥æœ€é©åˆçš„æ–¹å¼å‘ˆç¾çµ¦ä½¿ç”¨è€…ã€‚</p><hr><h2 id="ç‚ºä»€éº¼ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¸å¯¦ç”¨ï¼Ÿ"><a href="#ç‚ºä»€éº¼ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¸å¯¦ç”¨ï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¸å¯¦ç”¨ï¼Ÿ"></a>ç‚ºä»€éº¼ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¸å¯¦ç”¨ï¼Ÿ</h2><p>é‚„è¨˜å¾—æˆ‘å€‘åœ¨ç¬¬ 13 ç¯‡ã€ç¬¬ 21 ç¯‡ç•™ä¸‹çš„<strong>ä¼ç­†</strong>å—ï¼Ÿ</p><p>åœ¨ã€ˆå· 13ï¼šå›æ‡‰ï¼ˆä¸€ï¼‰Django Ninja è™•ç† HTTP å›æ‡‰æ¦‚è«–ã€‰ä¸­æˆ‘æåˆ°ï¼š</p><blockquote><p>ä½†æˆ‘è¦ºå¾—é€™å€‹ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€è¨­å®šåœ¨å¯¦å‹™ä¸Š<strong>æ²’æœ‰å¾ˆå¯¦ç”¨</strong>ï¼Œç‚ºä½•ï¼Ÿæˆ‘å€‘å¾ŒçºŒå†è«‡ã€‚</p></blockquote><p>å¹«ä½ è¤‡ç¿’ä¸€ä¸‹ï¼Œã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€æŒ‡çš„æ˜¯é€™å€‹ç”¨æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    ...,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response=&#123;<span class="number">200</span>: Token, <span class="number">401</span>: Message, <span class="number">402</span>: Message&#125;  <span class="comment"># é€™è£¡</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br></pre></td></tr></table></figure><p>ç„¶å¾Œåœ¨ view å‡½å¼ä¸­ï¼Œä¾ç…§ä¸åŒæƒ…æ³ï¼Œçµ¦å‡ºä¸åŒçš„ returnã€‚</p><p>æˆ‘åœ¨ã€ˆå· 21ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸Šï¼‰HttpError èˆ‡è‡ªå®šç¾© HTTP å›æ‡‰ã€‰åˆèªªäº†ï¼š</p><blockquote><p>é€™æ¨£çœ‹èµ·ä¾†ç¢ºå¯¦ä¸éŒ¯ï¼Œä¹Ÿå¾ˆç¬¦åˆç›´è¦ºï¼Œæˆ‘ä»¥å‰å¯« Django REST frameworkï¼Œéƒ½æ˜¯é€™æ¨£å¯«çš„ã€‚</p></blockquote><blockquote><p>å¯æ˜¯ï¼Œé€™å€‹å¯«æ³•åœ¨ Django Ninja ä¸­ï¼Œä½¿ç”¨ã€Œåˆ†é è£é£¾å™¨ã€æ™‚ï¼Œå°±æœƒ<strong>è¸¢åˆ°éµæ¿</strong>äº†ã€‚</p></blockquote><blockquote><p>ç›®å‰<strong>æ™‚æ©Ÿæœªåˆ°</strong>ï¼Œåœ¨å¾ŒçºŒçš„ã€ˆå· 25ï¼šåˆ†é ï¼ˆä¸‹ï¼‰è‡ªå®šç¾©åˆ†é é¡åˆ¥ã€‰ä¸­ï¼Œæˆ‘å€‘å†æŠŠé€™ä»¶èªªæ¸…æ¥šã€‚</p></blockquote><p><strong>é€™ä¸å°±ä¾†äº†å—ï¼</strong></p><p>ç†ç”±å¾ˆç°¡å–®ï¼Œé—œéµå°±åœ¨æ–¼æœ¬æ–‡ã€Œé‡é»ä¸‰ï¼špaginate_queryset æ–¹æ³•ã€ä¸­çš„é‚£å¥ï¼š</p><blockquote><p>æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ç¬¬äºŒåƒæ•¸â€”â€”<code>queryset</code>ï¼Œå®ƒå¯¦éš›ä¸Šå°±æ˜¯ view å‡½å¼çš„ return å€¼ï¼Œè€Œä¸”é¡å‹<strong>å¿…é ˆæ˜¯ QuerySet</strong>ã€‚</p></blockquote><p>å› ç‚º<code>paginate_queryset</code>æ–¹æ³•ä¸­ï¼Œç¬¬äºŒåƒæ•¸çš„é¡å‹<strong>å¿…é ˆæ˜¯ QuerySetï¼</strong></p><p>åœ¨<code>paginate_queryset</code>å…§éƒ¨ï¼Œæˆ‘å€‘å°‡é€™å€‹åƒæ•¸è¦–ç‚º QuerySet ä½¿ç”¨ã€æ“ä½œã€‚è‹¥å‚³å…¥çš„<strong>ä¸æ˜¯</strong> QuerySetï¼Œåˆ†é é‚è¼¯å°±æœƒ<strong>å‡ºéŒ¯</strong>ã€‚</p><h3 id="ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€èˆ‡-paginate-queryset-æ–¹æ³•çš„è¡çª"><a href="#ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€èˆ‡-paginate-queryset-æ–¹æ³•çš„è¡çª" class="headerlink" title="ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€èˆ‡ paginate_queryset æ–¹æ³•çš„è¡çª"></a>ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€èˆ‡ paginate_queryset æ–¹æ³•çš„è¡çª</h3><p>ç„¶è€Œï¼Œå¤šé‡ç‹€æ…‹ç¢¼çš„å›æ‡‰ï¼Œreturn å‹åˆ¥<strong>æœªå¿…</strong>æ˜¯ QuerySetâ€”â€”å¾ˆå¯èƒ½æ˜¯<code>tuple</code>ã€‚</p><p>æˆ‘èˆ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­ä½ å°±æ‡‚ï¼Œæˆ‘å€‘æŠŠã€Œå–å¾—æ–‡ç« åˆ—è¡¨ã€API æ”¹æˆé€™æ¨£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    path=<span class="string">&quot;/posts&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response=&#123;<span class="number">200</span>: <span class="built_in">list</span>[PostResponse], <span class="number">404</span>: ErrorMessage&#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="meta">@paginate(<span class="params">CustomPagination</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params">...</span>) -&gt; QuerySet[Post] | <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">dict</span>]ï¼š</span><br><span class="line">    posts = Post.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> posts.exists()ï¼š</span><br><span class="line">        <span class="keyword">return</span> <span class="number">404</span>ï¼Œ &#123;<span class="string">&quot;message&quot;</span>ï¼š <span class="string">&quot;æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ–‡ç« &quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>é€™å€‹ä¾‹å­æ¸…æ¥šåœ°é¡¯ç¤ºäº†ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€èˆ‡åˆ†é å™¨ä¹‹é–“çš„<strong>è¡çª</strong>ï¼š</p><ul><li>ç•¶æŸ¥è©¢çµæœ<strong>æ­£å¸¸</strong>æ™‚ï¼Œview å‡½å¼ return ä¸€å€‹ <strong>QuerySet</strong>ï¼ˆå³<code>posts</code>ï¼‰ï¼Œä¸Ÿçµ¦åˆ†é å™¨é€²è¡Œåˆ†é ï¼Œä¸€åˆ‡é‹ä½œè‰¯å¥½ã€‚</li><li>ç•¶<strong>æ²’æœ‰æ‰¾åˆ°æ–‡ç« </strong>æ™‚ï¼Œview å‡½å¼è©¦åœ–å›å‚³ä¸€å€‹<code>tuple</code>ï¼ˆå› ç‚º Django Ninja é 200 å›æ‡‰å¿…é ˆæœ‰ç‹€æ…‹ç¢¼ï¼Œæ‰€ä»¥æ˜¯<code>tuple</code>ï¼‰ï¼Œè€Œ<strong>ä¸æ˜¯</strong> QuerySetã€‚</li></ul><p>é€™å°‡å°è‡´<code>paginate_queryset</code>æ–¹æ³•å‡ºéŒ¯ï¼Œå› ç‚ºå®ƒé æœŸæ¥æ”¶ä¸€å€‹ QuerySetï¼Œå¾ŒçºŒçš„å…§éƒ¨æ“ä½œä¹Ÿæ˜¯ä»¥æ­¤ç‚ºå‰æã€‚</p><hr><p>å¦‚æœå°ˆæ¡ˆä¸­æ‰€æœ‰çš„ API <strong>éƒ½æ²’æœ‰åˆ†é </strong>ï¼Œä½¿ç”¨ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¾†è™•ç†ã€Œé 200ã€å›æ‡‰æ˜¯<strong>å®Œå…¨å¯è¡Œ</strong>çš„ã€‚</p><p>ä½†<strong>åªè¦æœ‰ä¸€å€‹</strong> API éœ€è¦åˆ†é ï¼Œé€™å€‹æœ‰åˆ†é çš„ APIï¼Œç‚ºäº†é¿å…ä¸Šè¿°è¡çªï¼Œå°±è¦æ”¹ç”¨ä¸€æ¨£æ˜¯ç¬¬ 21 ç¯‡æåˆ°çš„æ–¹å¼â€”â€”<code>raise HttpError</code>ã€‚</p><p>è€ƒæ…®åˆ°<strong>å°ˆæ¡ˆæ•´é«”çš„ä¸€è‡´æ€§</strong>ï¼Œå…¶é¤˜çš„ APIï¼Œä¹Ÿæ‡‰è©²æ¡ç”¨<code>raise HttpError</code>é€™å€‹æ–¹å¼ã€‚</p><p>è€Œåˆ†é éœ€æ±‚æ˜¯<strong>å¦‚æ­¤çš„å¸¸è¦‹</strong>ï¼Œæ‰€ä»¥ã€Œå¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰ã€ä¹Ÿå°±æˆç‚ºäº†<strong>é›è‚‹</strong>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æˆ‘å€‘ä»‹ç´¹äº† Django Ninja çš„å…§å»ºåˆ†é å™¨ï¼Œä¸¦ç”¨å®ƒå¯¦ä½œäº†ç°¡å–®çš„åˆ†é åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶å…§å»ºçš„&lt;code&gt;PageNumberPagination&lt;/code&gt;ç¢ºå¯¦æ–¹ä¾¿ï¼Œä½†åœ¨å¾ˆå¤šæ™‚å€™ï¼Œæˆ‘å€‘ä»éœ€è¦ä¸€äº›&lt;strong&gt;å®¢è£½åŒ–&lt;/strong&gt;åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç‚ºäº†å¯¦ç¾é€™å€‹ç›®çš„ï¼Œä½ éœ€è¦&lt;strong&gt;è‡ªå®šç¾©ä¸€å€‹åˆ†é é¡åˆ¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éåˆ¥æ“”å¿ƒï¼Œé€™ç¨®è‡ªå®šç¾©ï¼Œ&lt;strong&gt;ä¸¦éå¾é›¶é–‹å§‹&lt;/strong&gt;ã€‚è€Œæ˜¯ç¹¼æ‰¿ Django Ninja æ‰€æä¾›çš„åŸºç¤åˆ†é é¡åˆ¥ï¼Œå†é€²è¡Œè‡ªå·±çš„ã€Œ&lt;strong&gt;åŠ å·¥&lt;/strong&gt;ã€ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« å°±è¦ä¾†æ•™ä½ æ€éº¼åšã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/16&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;å®¢è£½åŒ–éœ€æ±‚&quot;&gt;&lt;a href=&quot;#å®¢è£½åŒ–éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;å®¢è£½åŒ–éœ€æ±‚&quot;&gt;&lt;/a&gt;å®¢è£½åŒ–éœ€æ±‚&lt;/h2&gt;&lt;p&gt;é™¤äº†åŸºæœ¬çš„åˆ†é ï¼Œæˆ‘å€‘é‚„å¸Œæœ›èƒ½å¤ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…è¨±å®¢æˆ¶ç«¯é¸æ“‡&lt;/strong&gt;æ¯é é¡¯ç¤ºçš„è³‡æ–™æ•¸é‡ï¼Œ&lt;strong&gt;å¯é¸ç¯„åœ&lt;/strong&gt;é™å®šåœ¨ 1 è‡³ 100 ä¹‹é–“ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å›æ‡‰ä¸­&lt;strong&gt;æ–°å¢å…©å€‹æ¬„ä½&lt;/strong&gt;ï¼Œé¡¯ç¤ºç•¶å‰çš„&lt;strong&gt;åˆ†é è³‡è¨Š&lt;/strong&gt;ï¼š&lt;ul&gt;
&lt;li&gt;ç•¶å‰é æ•¸ï¼ˆ&lt;code&gt;page&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ¯é é¡¯ç¤ºæ•¸é‡ï¼ˆ&lt;code&gt;per_page&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™ç„¡ç–‘æ˜¯å¾ˆå¸¸è¦‹çš„éœ€æ±‚ã€‚æˆ‘å€‘å°‡é€éè‡ªå®šç¾©åˆ†é é¡åˆ¥ï¼Œä¾†å¯¦ç¾é€™äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è©±ä¸å¤šèªªï¼Œç›´æ¥é–‹å§‹ï¼&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 24ï¼šåˆ†é ï¼ˆä¸Šï¼‰Django Ninja çš„å…§å»ºåˆ†é å™¨</title>
    <link href="https://blog.kyomind.tw/django-ninja-24/"/>
    <id>https://blog.kyomind.tw/django-ninja-24/</id>
    <published>2024-10-06T04:11:19.000Z</published>
    <updated>2024-10-07T05:52:25.603Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>åˆ†é ï¼ˆ<a href="https://django-ninja.dev/guides/response/pagination/">pagination</a>ï¼‰åŠŸèƒ½ï¼Œå°±ç®—åœ¨è³‡æ–™é‡è¼ƒå°‘çš„å°å‹å°ˆæ¡ˆï¼Œä¹Ÿå…·æœ‰ç›¸ç•¶çš„é‡è¦æ€§ã€‚</p><p>æ²’åˆ†é ï¼ŒAPI ç…§æ¨£èƒ½é‹ä½œâ€”â€”åªæ˜¯æ•ˆèƒ½æœƒå—åˆ°å½±éŸ¿ï¼Œç‰¹åˆ¥æ˜¯åœ¨è³‡æ–™é‡å¤§çš„æƒ…æ³ä¸‹ã€‚</p><p>ç•¶ API ä¸€æ¬¡å›å‚³å¤§é‡è³‡æ–™æ™‚ï¼Œä¸åƒ…æœƒå¢åŠ ä¼ºæœå™¨è² æ“”ï¼Œé‚„å¯èƒ½å°è‡´å®¢æˆ¶ç«¯è™•ç†ç·©æ…¢ï¼Œç”šè‡³å‡ºç¾<strong>è¶…æ™‚</strong>æˆ–<strong>è¨˜æ†¶é«”ä¸è¶³</strong>ç­‰å•é¡Œã€‚</p><p>é€éåˆ†é ï¼Œæˆ‘å€‘å¯ä»¥é¿å…ä¸€æ¬¡æ€§å‚³è¼¸å¤§é‡è³‡æ–™ï¼Œæé«˜ API çš„æ•ˆèƒ½ï¼ŒåŒæ™‚æå‡ä½¿ç”¨è€…çš„é«”é©—ã€‚</p><p>é€™å€‹ä¸»é¡Œå°‡åˆ†ç‚º<strong>ä¸Šã€ä¸‹å…©ç¯‡</strong>ï¼Œä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ä½œåˆ†é åŠŸèƒ½â€”â€”å¾<strong>å…§å»ºçš„åˆ†é å™¨</strong>åˆ°<strong>è‡ªå®šç¾©åˆ†é é¡åˆ¥</strong>ï¼Œä»¥æ»¿è¶³ä¸åŒéœ€æ±‚ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/15">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="åˆ†é çš„é‡è¦æ€§"><a href="#åˆ†é çš„é‡è¦æ€§" class="headerlink" title="åˆ†é çš„é‡è¦æ€§"></a>åˆ†é çš„é‡è¦æ€§</h2><p>åˆ†é çš„<strong>æ ¸å¿ƒä½œç”¨</strong>æ˜¯<strong>å°‡å¤§é‡è³‡æ–™æ‹†åˆ†æˆå°éƒ¨åˆ†å‚³è¼¸ï¼Œæ¯æ¬¡åªçµ¦ä¸€äº›</strong>ï¼Œå¾è€Œé¿å…æ•ˆèƒ½å•é¡Œã€‚</p><p>å…·é«”è€Œè¨€ï¼Œåˆ†é èƒ½å¤ å¹«åŠ©æˆ‘å€‘ï¼š</p><ol><li><strong>æ¸›å°‘ä¼ºæœå™¨å£“åŠ›</strong>ï¼šä¸å¿…ä¸€æ¬¡å›å‚³å…¨éƒ¨è³‡æ–™ï¼Œåªéœ€è™•ç†<strong>å–®å€‹é é¢</strong>çš„è³‡æ–™ã€‚</li><li><strong>æå‡ç¶²è·¯å‚³è¼¸é€Ÿåº¦</strong>ï¼šå‚³è¼¸å¤ªå¤§é‡çš„è³‡æ–™æœƒå¢åŠ ç¶²è·¯å»¶é²å’Œè³‡æ–™ä¸Ÿå¤±çš„é¢¨éšªï¼Œé€šéåˆ†é ï¼Œèƒ½<strong>æœ‰æ•ˆé™ä½å‚³è¼¸éœ€æ±‚</strong>ã€‚</li><li><strong>æå‡ä½¿ç”¨è€…é«”é©—</strong>ï¼šå®¢æˆ¶ç«¯å¯ä»¥å¿«é€Ÿç²å–ä¸¦é¡¯ç¤ºåˆæ­¥è³‡æ–™ï¼Œç„¡éœ€ç­‰å¾…æ‰€æœ‰è³‡æ–™å‚³è¼¸å®Œæˆã€‚åŒæ™‚ï¼Œåˆ†é é‚„èƒ½<strong>æ¸›å°‘å®¢æˆ¶ç«¯è™•ç†å¤§é‡è³‡æ–™çš„å£“åŠ›</strong>ã€‚</li></ol><p>å› æ­¤ï¼Œç„¡è«–å°ˆæ¡ˆè¦æ¨¡å¤§å°ï¼Œå¯¦ä½œ<strong>é«˜æ•ˆçš„åˆ†é ç­–ç•¥</strong>ï¼Œå° API çš„æ“´å……æ€§èˆ‡ä½¿ç”¨è€…é«”é©—ï¼Œéƒ½æœ‰<strong>æ˜é¡¯å¹«åŠ©</strong>ã€‚</p><p>äº†è§£äº†åˆ†é çš„é‡è¦æ€§å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹å¯¦ä½œå§ï¼</p><span id="more"></span><hr><p>é€™æ¬¡çš„ç¯„ä¾‹ API æ˜¯â€”â€”ã€Œ<strong>å–å¾—æ–‡ç« åˆ—è¡¨</strong>ã€ã€‚</p><p>å› ç‚ºå°ˆæ¡ˆçš„è³‡æ–™åº«ä¸­å·²ç¶“æœ‰<strong>è¶…é 60 ç­†æ–‡ç« è³‡æ–™</strong>ï¼Œéå¸¸é©åˆæ¼”ç¤ºã€‚</p><p>ä»€éº¼ï¼Ÿä½ èªªä½ æ²’æœ‰ï¼Ÿæ­¡è¿åƒè€ƒã€ˆ<a href="/django-ninja-12/#%E4%B8%AD%E5%A0%B4%E4%BC%91%E6%81%AF%E8%88%87%E6%BA%96%E5%82%99">å·Â 12ï¼šè«‹æ±‚ï¼ˆå››ï¼‰Request Body èˆ‡ Schema ä»‹ç´¹</a>ã€‰çµå°¾çš„ã€Œ<a href="/django-ninja-12/#%E4%B8%AD%E5%A0%B4%E4%BC%91%E6%81%AF%E8%88%87%E6%BA%96%E5%82%99">ä¸­å ´ä¼‘æ¯èˆ‡æº–å‚™</a>ã€æ®µè½ã€‚</p><p>æœ¬ç¯‡æˆ‘å€‘å°‡ä½¿ç”¨ Django Ninja å…§å»ºçš„<code>PageNumberPagination</code>åˆ†é å™¨ï¼Œä¾†å¯¦ä½œç°¡å–®ã€æœ‰æ•ˆçš„åˆ†é åŠŸèƒ½ã€‚è‡ªå®šç¾©éƒ¨åˆ†ï¼Œå‰‡ç•™åœ¨ä¸‹ä¸€ç¯‡ã€‚</p><h2 id="Django-Ninja-å…§å»ºçš„åˆ†é å™¨"><a href="#Django-Ninja-å…§å»ºçš„åˆ†é å™¨" class="headerlink" title="Django Ninja å…§å»ºçš„åˆ†é å™¨"></a>Django Ninja å…§å»ºçš„åˆ†é å™¨</h2><p>åœ¨ Django Ninja ä¸­ï¼Œåˆ†é åŠŸèƒ½å¯ä»¥é€éå…§å»ºçš„<code>paginate</code>è£é£¾å™¨åŠ ä¸Š<strong>åˆ†é å™¨</strong>ï¼ˆå³<strong>åˆ†é é¡åˆ¥</strong>ï¼‰å¯¦ç¾ã€‚</p><p>Django Ninja æä¾›äº†å…©å€‹å…§å»ºåˆ†é å™¨ï¼Œç‚ºæ–¹ä¾¿ä½ ç†è§£ï¼Œä»¥ä¸‹æ˜¯å®ƒå€‘çš„<strong>ç™½è©±æ–‡ä»‹ç´¹</strong>ï¼š</p><ol><li><code>LimitOffsetPagination</code>ï¼šæ ¹æ“šã€Œ<strong>å¾å“ªä¸€ç­†è³‡æ–™é–‹å§‹</strong>ã€å’Œã€Œ<strong>è¦æŠ“å¤šå°‘ç­†è³‡æ–™</strong>ã€ä¾†é€²è¡Œåˆ†é ï¼Œé©åˆè³‡æ–™é‡å¾ˆå¤§æ™‚ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šã€Œå¾ç¬¬ 20 ç­†é–‹å§‹ï¼ŒæŠ“ 10 ç­†è³‡æ–™ã€ã€‚</li><li><code>PageNumberPagination</code>ï¼šé€é<strong>é ç¢¼</strong>é€²è¡Œåˆ†é ï¼Œç”¨æˆ¶åªéœ€è¦<strong>æŒ‡å®šæƒ³è¦çš„é æ•¸</strong>ï¼Œä¾‹å¦‚ã€ŒæŠ“ç¬¬ 2 é çš„è³‡æ–™ã€ã€‚æ¯é çš„<strong>è³‡æ–™æ•¸é‡</strong>å¯ä»¥ç”±é–‹ç™¼è€…è‡ªè¡Œè¨­å®šã€‚</li></ol><p>æˆ‘å€‹äººåå¥½ä½¿ç”¨<code>PageNumberPagination</code>ï¼Œæˆ–è‡ªå®šç¾©ä¸€å€‹é¡ä¼¼çš„ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯ä¸‹ä¸€ç¯‡çš„å…§å®¹ï¼‰ã€‚</p><p>ä½†<strong>é è¨­</strong>çš„åˆ†é å™¨æ˜¯<code>LimitOffsetPagination</code>ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨<code>paginate</code>è£é£¾å™¨æ™‚ï¼Œéœ€è¦ä½ <strong>ä¸»å‹•è²æ˜</strong>ç¬¬ä¸€åƒæ•¸ã€‚ç­‰ä¸€ä¸‹ä½ å°±çŸ¥é“äº†ã€‚</p><p>åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†å›é¡§ã€Œå–å¾—æ–‡ç« åˆ—è¡¨ã€çš„ API ç¾ç‹€ã€‚</p><h2 id="API-ç¾ç‹€"><a href="#API-ç¾ç‹€" class="headerlink" title="API ç¾ç‹€"></a>API ç¾ç‹€</h2><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œç”±æ–¼å°šæœªå¯¦ä½œåˆ†é åŠŸèƒ½ï¼Œå®ƒæœƒ<strong>ä¸€æ¬¡æ€§å›å‚³æ‰€æœ‰æ–‡ç« è³‡æ–™</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.get(<span class="params"><span class="string">&#x27;/posts/&#x27;</span>, response=<span class="built_in">list</span>[PostListResponse], ...</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    title: <span class="literal">None</span> | <span class="built_in">str</span> = Query(<span class="params"><span class="literal">None</span>, min_length=<span class="number">2</span>, max_length=<span class="number">10</span></span>),</span></span><br><span class="line"><span class="params"></span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    posts = Post.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">if</span> title:</span><br><span class="line">        posts = posts.<span class="built_in">filter</span>(</span><br><span class="line">            title__icontains=title).select_related(<span class="string">&#x27;author&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> posts</span><br></pre></td></tr></table></figure><p>é€™åœ¨æ–‡ç« å°‘çš„æ™‚å€™å¯ä»¥é‹ä½œå¦‚å¸¸ï¼Œä½†éš¨è‘—è³‡æ–™é‡å¢åŠ ï¼Œæ•ˆèƒ½å°‡æœƒ<strong>å—åˆ°å½±éŸ¿</strong>ã€‚</p><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦é€é Django Ninja å…§å»ºçš„åˆ†é å™¨ä¾†<strong>æ”¹å–„</strong>é€™å€‹å•é¡Œã€‚</p><hr><h2 id="PageNumberPagination-å¯¦ä½œåˆ†é "><a href="#PageNumberPagination-å¯¦ä½œåˆ†é " class="headerlink" title="PageNumberPagination å¯¦ä½œåˆ†é "></a>PageNumberPagination å¯¦ä½œåˆ†é </h2><p>ä½¿ç”¨å…§å»ºçš„<code>PageNumberPagination</code>ï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†ç‚º API åŠ ä¸Šåˆ†é åŠŸèƒ½ã€‚</p><p>åªè¦åœ¨ view å‡½å¼ä¸Šä½¿ç”¨<code>@paginate</code>è£é£¾å™¨ä¸¦åŠ å…¥åƒæ•¸ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ninja.pagination <span class="keyword">import</span> PageNumberPagination, paginate</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@router.get(<span class="params">...</span>)</span></span><br><span class="line"><span class="meta">@paginate(<span class="params">PageNumberPagination, page_size=<span class="number">10</span></span>)  </span><span class="comment"># åˆ†é å¯¦ä½œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_posts</span>(<span class="params">...</span>) -&gt; QuerySet[Post]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—æ–‡ç« åˆ—è¡¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>æˆ‘çœç•¥äº†å¤§éƒ¨åˆ†å…§å®¹ï¼Œé€™è£¡åªéœ€è¦é—œæ³¨åˆ†é çš„å¯¦ä½œã€‚</p><p>å¦‚å‰æ‰€è¿°ï¼Œç¬¬ä¸€åƒæ•¸<code>PageNumberPagination</code>å¿…é ˆç”±ä½ ä¸»å‹•è²æ˜â€”â€”å¦‚æœæ˜¯ç”¨<code>LimitOffsetPagination</code>å‰‡ä¸å¿…ã€‚</p><p>å¯¦ä½œçš„æ•ˆæœæ˜¯ï¼Œæ¯é æ”¹ç‚ºé¡¯ç¤º 10 ç­†æ–‡ç« ï¼Œé€™æ•¸é‡å¯ä»¥é€é<code>page_size</code>åƒæ•¸æ§åˆ¶ã€‚</p><p>å’¦ï¼Œé‚£<strong>æ›é </strong>æ€éº¼è¾¦ï¼Ÿæˆ‘å€‘çœ‹ä¸€ä¸‹<code>PageNumberPagination</code>çš„åŸå§‹ç¢¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PageNumberPagination</span>(<span class="title class_ inherited__">AsyncPaginationBase</span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Input</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">        page: <span class="built_in">int</span> = Field(<span class="number">1</span>, ge=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><code>Input</code>ä»£è¡¨è«‹æ±‚çš„<strong>æŸ¥è©¢åƒæ•¸</strong>ï¼ˆä¸‹ä¸€ç¯‡æœƒç´°è«–ï¼‰ï¼Œæ›å¥è©±èªªï¼Œä½ å¯ä»¥åœ¨ URL çš„<strong>æŸ¥è©¢åƒæ•¸</strong>ï¼ˆquery parametersï¼‰ä¸­ä½¿ç”¨åƒæ•¸<code>page</code>ä¾†æŒ‡å®šã€Œé ç¢¼ã€ï¼Œä»¥é”åˆ°æ›é æ•ˆæœã€‚</p><h3 id="æ¸¬è©¦åˆ†é æ•ˆæœ"><a href="#æ¸¬è©¦åˆ†é æ•ˆæœ" class="headerlink" title="æ¸¬è©¦åˆ†é æ•ˆæœ"></a>æ¸¬è©¦åˆ†é æ•ˆæœ</h3><p>å‘¼å« APIï¼Œä¸¦ä½¿ç”¨<code>?page=2</code>ä½œç‚ºæŸ¥è©¢åƒæ•¸ï¼Œçœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼š</p><p><img src="https://i.imgur.com/3H3ej9J.png"></p><p>ç¬¦åˆé æœŸï¼</p><p>å›æ‡‰ä¸­é¡¯ç¤ºçš„ç¢ºå¯¦æ˜¯ç¬¬ 2 é å…§å®¹â€”â€”æ–‡ç«  id å¾ 11 é–‹å§‹ï¼Œç¸½å…± 10 ç­†ã€‚</p><hr><h2 id="ä½¿ç”¨å…§å»ºåˆ†é å™¨çš„å„ªé»èˆ‡å±€é™"><a href="#ä½¿ç”¨å…§å»ºåˆ†é å™¨çš„å„ªé»èˆ‡å±€é™" class="headerlink" title="ä½¿ç”¨å…§å»ºåˆ†é å™¨çš„å„ªé»èˆ‡å±€é™"></a>ä½¿ç”¨å…§å»ºåˆ†é å™¨çš„å„ªé»èˆ‡å±€é™</h2><h3 id="å„ªé»"><a href="#å„ªé»" class="headerlink" title="å„ªé»"></a><strong>å„ªé»</strong></h3><ul><li>åªç”¨ç°¡å–®çš„<strong>åˆ†é è£é£¾å™¨ + å…§å»ºåˆ†é å™¨</strong>å³å¯å¯¦ç¾åˆ†é ï¼Œè€Œä¸”å¯ä»¥æ§åˆ¶æ¯é çš„æ•¸é‡ï¼Œéå¸¸æ–¹ä¾¿ä¸”å¯¦ç”¨ã€‚</li><li>é©åˆä¸éœ€è¦è¤‡é›œè‡ªå®šç¾©çš„æƒ…æ³ã€‚</li></ul><h3 id="å±€é™"><a href="#å±€é™" class="headerlink" title="å±€é™"></a><strong>å±€é™</strong></h3><ul><li>ç¼ºä¹éˆæ´»æ€§ï¼Œä¾‹å¦‚æˆ‘å€‘<strong>ç„¡æ³•è®“ä½¿ç”¨è€…æŒ‡å®š</strong>æ¯é é¡¯ç¤ºå¤šå°‘ç­†è³‡æ–™ã€‚</li><li>å›æ‡‰çš„æ¬„ä½èˆ‡æ ¼å¼æ˜¯<strong>å›ºå®š</strong>çš„â€”â€”è€Œä¸”æœ‰é»ç°¡ç•¥ã€‚</li></ul><hr><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€é Django Ninja å…§å»ºçš„åˆ†é å™¨ï¼Œæˆ‘å€‘èƒ½å¤ è¿…é€Ÿç‚º API åŠ å…¥åˆ†é åŠŸèƒ½ï¼Œç«‹å³å¯¦ç¾ç°¡å–®çš„åˆ†é éœ€æ±‚ã€‚</p><p>ç„¶è€Œï¼Œå…§å»ºåˆ†é å™¨åœ¨<strong>æ§åˆ¶éˆæ´»æ€§</strong>ä¸Šæœ‰æ‰€ä¸è¶³ï¼Œä¹Ÿç„¡æ³•å»ºç«‹å®¢è£½åŒ–å›æ‡‰ã€‚ç•¶åˆ†é éœ€æ±‚è®Šå¾—è¤‡é›œæ™‚ï¼Œå°±é¡¯å¾—æœ‰é»æ‰è¥Ÿè¦‹è‚˜ã€‚</p><p>æ­¤æ™‚ï¼Œ<strong>è‡ªå®šç¾©åˆ†é å™¨</strong>æœƒæ˜¯ä¸€å€‹æ›´å¥½çš„è§£æ±ºæ–¹æ¡ˆã€‚</p><p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘å€‘å°‡æ¢è¨å¦‚ä½•åœ¨ Django Ninja ä¸­è‡ªå®šç¾©åˆ†é é¡åˆ¥ï¼Œä»¥æ»¿è¶³é€™äº›é€²éšéœ€æ±‚ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;åˆ†é ï¼ˆ&lt;a href=&quot;https://django-ninja.dev/guides/response/pagination/&quot;&gt;pagination&lt;/a&gt;ï¼‰åŠŸèƒ½ï¼Œå°±ç®—åœ¨è³‡æ–™é‡è¼ƒå°‘çš„å°å‹å°ˆæ¡ˆï¼Œä¹Ÿå…·æœ‰ç›¸ç•¶çš„é‡è¦æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ²’åˆ†é ï¼ŒAPI ç…§æ¨£èƒ½é‹ä½œâ€”â€”åªæ˜¯æ•ˆèƒ½æœƒå—åˆ°å½±éŸ¿ï¼Œç‰¹åˆ¥æ˜¯åœ¨è³‡æ–™é‡å¤§çš„æƒ…æ³ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç•¶ API ä¸€æ¬¡å›å‚³å¤§é‡è³‡æ–™æ™‚ï¼Œä¸åƒ…æœƒå¢åŠ ä¼ºæœå™¨è² æ“”ï¼Œé‚„å¯èƒ½å°è‡´å®¢æˆ¶ç«¯è™•ç†ç·©æ…¢ï¼Œç”šè‡³å‡ºç¾&lt;strong&gt;è¶…æ™‚&lt;/strong&gt;æˆ–&lt;strong&gt;è¨˜æ†¶é«”ä¸è¶³&lt;/strong&gt;ç­‰å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;é€éåˆ†é ï¼Œæˆ‘å€‘å¯ä»¥é¿å…ä¸€æ¬¡æ€§å‚³è¼¸å¤§é‡è³‡æ–™ï¼Œæé«˜ API çš„æ•ˆèƒ½ï¼ŒåŒæ™‚æå‡ä½¿ç”¨è€…çš„é«”é©—ã€‚&lt;/p&gt;
&lt;p&gt;é€™å€‹ä¸»é¡Œå°‡åˆ†ç‚º&lt;strong&gt;ä¸Šã€ä¸‹å…©ç¯‡&lt;/strong&gt;ï¼Œä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ä½œåˆ†é åŠŸèƒ½â€”â€”å¾&lt;strong&gt;å…§å»ºçš„åˆ†é å™¨&lt;/strong&gt;åˆ°&lt;strong&gt;è‡ªå®šç¾©åˆ†é é¡åˆ¥&lt;/strong&gt;ï¼Œä»¥æ»¿è¶³ä¸åŒéœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/15&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;åˆ†é çš„é‡è¦æ€§&quot;&gt;&lt;a href=&quot;#åˆ†é çš„é‡è¦æ€§&quot; class=&quot;headerlink&quot; title=&quot;åˆ†é çš„é‡è¦æ€§&quot;&gt;&lt;/a&gt;åˆ†é çš„é‡è¦æ€§&lt;/h2&gt;&lt;p&gt;åˆ†é çš„&lt;strong&gt;æ ¸å¿ƒä½œç”¨&lt;/strong&gt;æ˜¯&lt;strong&gt;å°‡å¤§é‡è³‡æ–™æ‹†åˆ†æˆå°éƒ¨åˆ†å‚³è¼¸ï¼Œæ¯æ¬¡åªçµ¦ä¸€äº›&lt;/strong&gt;ï¼Œå¾è€Œé¿å…æ•ˆèƒ½å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;å…·é«”è€Œè¨€ï¼Œåˆ†é èƒ½å¤ å¹«åŠ©æˆ‘å€‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ¸›å°‘ä¼ºæœå™¨å£“åŠ›&lt;/strong&gt;ï¼šä¸å¿…ä¸€æ¬¡å›å‚³å…¨éƒ¨è³‡æ–™ï¼Œåªéœ€è™•ç†&lt;strong&gt;å–®å€‹é é¢&lt;/strong&gt;çš„è³‡æ–™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æå‡ç¶²è·¯å‚³è¼¸é€Ÿåº¦&lt;/strong&gt;ï¼šå‚³è¼¸å¤ªå¤§é‡çš„è³‡æ–™æœƒå¢åŠ ç¶²è·¯å»¶é²å’Œè³‡æ–™ä¸Ÿå¤±çš„é¢¨éšªï¼Œé€šéåˆ†é ï¼Œèƒ½&lt;strong&gt;æœ‰æ•ˆé™ä½å‚³è¼¸éœ€æ±‚&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æå‡ä½¿ç”¨è€…é«”é©—&lt;/strong&gt;ï¼šå®¢æˆ¶ç«¯å¯ä»¥å¿«é€Ÿç²å–ä¸¦é¡¯ç¤ºåˆæ­¥è³‡æ–™ï¼Œç„¡éœ€ç­‰å¾…æ‰€æœ‰è³‡æ–™å‚³è¼¸å®Œæˆã€‚åŒæ™‚ï¼Œåˆ†é é‚„èƒ½&lt;strong&gt;æ¸›å°‘å®¢æˆ¶ç«¯è™•ç†å¤§é‡è³‡æ–™çš„å£“åŠ›&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ï¼Œç„¡è«–å°ˆæ¡ˆè¦æ¨¡å¤§å°ï¼Œå¯¦ä½œ&lt;strong&gt;é«˜æ•ˆçš„åˆ†é ç­–ç•¥&lt;/strong&gt;ï¼Œå° API çš„æ“´å……æ€§èˆ‡ä½¿ç”¨è€…é«”é©—ï¼Œéƒ½æœ‰&lt;strong&gt;æ˜é¡¯å¹«åŠ©&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;äº†è§£äº†åˆ†é çš„é‡è¦æ€§å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹å¯¦ä½œå§ï¼&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 23ï¼šæª”æ¡ˆä¸Šå‚³â€”â€”Django UploadedFile ä»‹ç´¹</title>
    <link href="https://blog.kyomind.tw/django-ninja-23/"/>
    <id>https://blog.kyomind.tw/django-ninja-23/</id>
    <published>2024-10-05T08:33:59.000Z</published>
    <updated>2024-10-07T15:24:44.455Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ç¾ä»£ Web æœå‹™ä¸­ï¼Œ<strong>æª”æ¡ˆä¸Šå‚³</strong>æ˜¯ä¸€å€‹å¸¸è¦‹çš„æƒ…å¢ƒã€‚</p><p>ç„¡è«–æ˜¯ä½¿ç”¨è€…ä¸Šå‚³ç…§ç‰‡ã€å¤¾å¸¶é™„ä»¶ï¼Œæª”æ¡ˆä¸Šå‚³éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„åŠŸèƒ½ã€‚</p><p>æœ¬æ–‡ä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ç¾<strong>åœ–ç‰‡ä¸Šå‚³</strong>åŠŸèƒ½ï¼Œä»¥ä½¿ç”¨è€…ã€Œä¸Šå‚³å¤§é ­è²¼ã€ï¼ˆä»¥ä¸‹éƒ½ç¨±ç‚º avatarï¼Œå› ç‚ºå¤§é ­è²¼æ„Ÿè¦ºå¤ªå¯æ„›ğŸ¥¹ï¼‰API ç‚ºä¾‹ï¼Œå¸¶ä½ ä¸€æ­¥æ­¥äº†è§£é€™å€‹éç¨‹ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/14">é€™å€‹ PR</a>ã€‚</p><hr><p>ä¸éï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£ï¼Œæœ¬ç« æœ‰å“ªäº›ä¸»é¡Œã€‚</p><h2 id="ç¬¬å…­ç« ã€ŒAPI-é€²éšåŠŸèƒ½ã€ç°¡ä»‹"><a href="#ç¬¬å…­ç« ã€ŒAPI-é€²éšåŠŸèƒ½ã€ç°¡ä»‹" class="headerlink" title="ç¬¬å…­ç« ã€ŒAPI é€²éšåŠŸèƒ½ã€ç°¡ä»‹"></a>ç¬¬å…­ç« ã€ŒAPI é€²éšåŠŸèƒ½ã€ç°¡ä»‹</h2><p>å° API å°ˆæ¡ˆè€Œè¨€ï¼Œ<strong>é€²éšåŠŸèƒ½</strong>èƒ½å¹«åŠ©æˆ‘å€‘æ‡‰å°<strong>è¤‡é›œå ´æ™¯</strong>èˆ‡<strong>å¤§å‹å°ˆæ¡ˆ</strong>çš„æŒ‘æˆ°ã€‚</p><p>é›–ç„¶é€™æ˜¯ä¸€å€‹å…¥é–€æŒ‡å—ï¼Œä½†æˆ‘å€‘ä»æœƒæ¶µè“‹ä¸€äº›å¸¸è¦‹çš„é€²éšåŠŸèƒ½ï¼Œé€™äº›åŠŸèƒ½ä¸åƒ…æå‡ API çš„éˆæ´»æ€§ï¼Œé‚„èƒ½å¢å¼·äº†ç³»çµ±æ•ˆèƒ½èˆ‡ä½¿ç”¨è€…é«”é©—ã€‚</p><p>æœ¬ç« å°‡ä»‹ç´¹ 3 å€‹é‡è¦çš„é€²éšåŠŸèƒ½ï¼š</p><ul><li>å· 23ï¼šæª”æ¡ˆä¸Šå‚³â€”â€”Django UploadedFile ä»‹ç´¹</li><li>å· 24ï¼šåˆ†é ï¼ˆä¸Šï¼‰Django Ninja çš„å…§å»ºåˆ†é å™¨</li><li>å· 25ï¼šåˆ†é ï¼ˆä¸‹ï¼‰è‡ªå®šç¾©åˆ†é é¡åˆ¥</li><li>å· 26ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸Šï¼‰FilterSchema ä»‹ç´¹</li><li>å· 27ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸‹ï¼‰FilterSchema å¤šæ¬„ä½æŸ¥è©¢</li></ul><p>é€™äº›æŠ€è¡“ä¸åƒ…å°å¤§å‹å°ˆæ¡ˆè‡³é—œé‡è¦ï¼Œä¹Ÿè®“ä½ èƒ½åœ¨ API é–‹ç™¼ä¸­ï¼Œæœ‰æ•ˆæ‡‰å°å¤šè®Šçš„éœ€æ±‚ã€‚</p><span id="more"></span><hr><p>äº†è§£äº†æœ¬ç« é‡é»å¾Œï¼Œæˆ‘å€‘é–‹å§‹è¬›è¿°ç¬¬ä¸€å€‹åŠŸèƒ½â€”â€”æª”æ¡ˆä¸Šå‚³ã€‚</p><h2 id="æª”æ¡ˆä¸Šå‚³çš„ä¸»è§’â€”â€”UploadedFile"><a href="#æª”æ¡ˆä¸Šå‚³çš„ä¸»è§’â€”â€”UploadedFile" class="headerlink" title="æª”æ¡ˆä¸Šå‚³çš„ä¸»è§’â€”â€”UploadedFile"></a>æª”æ¡ˆä¸Šå‚³çš„ä¸»è§’â€”â€”UploadedFile</h2><p>åœ¨ Django Ninja ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨<code>UploadedFile</code>ä¾†æ¥æ”¶ä¸Šå‚³çš„æª”æ¡ˆï¼Œå®ƒæ˜¯ Django <code>UploadedFile</code>çš„<strong>é‡æ–°å°è£</strong>ï¼Œå…©è€…åŸºæœ¬ä¸Šå¤§åŒå°ç•°ã€‚</p><h3 id="UploadedFile-æ¦‚è¿°"><a href="#UploadedFile-æ¦‚è¿°" class="headerlink" title="UploadedFile æ¦‚è¿°"></a>UploadedFile æ¦‚è¿°</h3><p><a href="https://docs.djangoproject.com/en/5.1/ref/files/uploads/">UploadedFile</a> æ˜¯ Django è™•ç†æª”æ¡ˆä¸Šå‚³çš„æ ¸å¿ƒç‰©ä»¶ã€‚ç•¶ä½¿ç”¨è€…ä¸Šå‚³æª”æ¡ˆæ™‚ï¼ŒDjango æœƒè‡ªå‹•å°‡æª”æ¡ˆå°è£æˆ<code>UploadedFile</code>å¯¦ä¾‹ï¼Œæ–¹ä¾¿æˆ‘å€‘é€²è¡Œ<strong>å¾ŒçºŒçš„æª”æ¡ˆè™•ç†å’Œå„²å­˜</strong>ã€‚</p><p><code>UploadedFile</code>ç‰©ä»¶æœ‰å¾ˆå¤šå±¬æ€§ï¼Œå…¶ä¸­æ¯”è¼ƒå¸¸ç”¨çš„æœ‰ï¼š</p><ul><li><code>name</code>ï¼šä¸Šå‚³æª”æ¡ˆçš„åç¨±ã€‚é€™å¯ä»¥ç”¨ä¾†å­˜å–æª”æ¡ˆçš„<strong>åŸå§‹æª”å</strong>ã€‚</li><li><code>size</code>ï¼šæª”æ¡ˆçš„å¤§å°ï¼ˆä»¥<strong>ä½å…ƒçµ„</strong>è¨ˆç®—ï¼‰ã€‚æˆ‘å€‘å¯ä»¥ç”¨ä¾†é€²è¡Œæª”æ¡ˆå¤§å°çš„é©—è­‰ã€‚</li><li><code>content_type</code>ï¼šæª”æ¡ˆçš„ <a href="https://zh.wikipedia.org/zh-tw/%E5%A4%9A%E7%94%A8%E9%80%94%E4%BA%92%E8%81%AF%E7%B6%B2%E9%83%B5%E4%BB%B6%E6%93%B4%E5%B1%95">MIME</a> é¡å‹ã€‚é€™å°æ–¼é©—è­‰ä¸Šå‚³æª”æ¡ˆçš„<strong>æ ¼å¼</strong>éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ç¢ºä¿æª”æ¡ˆæ˜¯åœ–ç‰‡æ ¼å¼ã€‚æˆ‘å€‘å¾Œé¢æœƒç”¨åˆ°ï¼</li><li><code>read()</code>ï¼šç”¨ä¾†<strong>è®€å–æª”æ¡ˆçš„å…§å®¹</strong>ã€‚ç•¶éœ€è¦é€²è¡Œè‡ªè¨‚æª”æ¡ˆè™•ç†æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨é€™å€‹æ–¹æ³•ä¾†å–å¾—æª”æ¡ˆçš„äºŒé€²ä½è³‡æ–™ã€‚</li><li><code>chunks()</code>ï¼šç•¶æª”æ¡ˆéå¸¸å¤§æ™‚ï¼Œä½¿ç”¨é€™å€‹æ–¹æ³•å¯ä»¥<strong>åˆ†å¡Šè®€å–æª”æ¡ˆ</strong>ï¼Œé¿å…éå¤šçš„è¨˜æ†¶é«”ä½”ç”¨ã€‚</li></ul><p>é€™äº›ç‰¹æ€§ä½¿å¾—<code>UploadedFile</code>éå¸¸éˆæ´»ï¼Œèƒ½å¤ æ‡‰å°å„ç¨®ä¸Šå‚³éœ€æ±‚ï¼Œå¾ç°¡å–®çš„åœ–ç‰‡ä¸Šå‚³åˆ°å¤§å‹æª”æ¡ˆçš„è™•ç†ã€‚</p><p>OKï¼Œé—œæ–¼æª”æ¡ˆä¸Šå‚³ï¼Œäº†è§£<code>UploadedFile</code>é€™å€‹æ ¸å¿ƒå…ƒä»¶å°±è¶³å¤ äº†ã€‚</p><p>é–‹å§‹å¯¦ä½œã€Œä¸Šå‚³ avatarã€API çš„ç¨‹å¼ç¢¼ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆé€²è¡Œä¸€äº›ã€Œ<strong>å‰ç½®ä½œæ¥­</strong>ã€ã€‚</p><hr><p>æª”æ¡ˆä¸Šå‚³ï¼Œæœ‰å¾ˆå¤šéƒ¨åˆ†å…¶å¯¦<strong>å’Œ Django æ¯”è¼ƒæœ‰é—œ</strong>ï¼Œè€Œé Django Ninja ç¯„ç–‡ï¼Œæ‰€ä»¥æˆ‘æœƒé‡é»å¸¶éã€‚</p><h2 id="Django-å°ˆæ¡ˆç›¸é—œè¨­å®š"><a href="#Django-å°ˆæ¡ˆç›¸é—œè¨­å®š" class="headerlink" title="Django å°ˆæ¡ˆç›¸é—œè¨­å®š"></a>Django å°ˆæ¡ˆç›¸é—œè¨­å®š</h2><p>åœ¨å¯¦ä½œæª”æ¡ˆä¸Šå‚³åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆå‘Šè¨´ Djangoï¼š<strong>å¦‚ä½•è™•ç†ä¸Šå‚³çš„æª”æ¡ˆ</strong>ã€‚é€™æ¶‰åŠåˆ°<code>MEDIA_URL</code>å’Œ<code>MEDIA_ROOT</code>çš„è¨­å®šã€‚</p><h3 id="MEDIA-URLå’ŒMEDIA-ROOTè¨­å®š"><a href="#MEDIA-URLå’ŒMEDIA-ROOTè¨­å®š" class="headerlink" title="MEDIA_URLå’ŒMEDIA_ROOTè¨­å®š"></a><code>MEDIA_URL</code>å’Œ<code>MEDIA_ROOT</code>è¨­å®š</h3><ul><li><code>MEDIA_URL</code>ï¼šé€™æ˜¯æª”æ¡ˆçš„ URL å‰ç¶´ï¼Œæ‰€æœ‰ä¸Šå‚³çš„æª”æ¡ˆæœƒé€éé€™å€‹ URL ä¾†å­˜å–ã€‚</li><li><code>MEDIA_ROOT</code>ï¼šé€™æ˜¯ Django ä¼ºæœå™¨å…§éƒ¨ï¼Œå¯¦éš›å„²å­˜ä¸Šå‚³æª”æ¡ˆçš„è·¯å¾‘ã€‚</li></ul><p>åœ¨å°ˆæ¡ˆçš„<code>settings.py</code>æ–°å¢ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NinjaForum/settings.py</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">MEDIA_URL = <span class="string">&#x27;/media/&#x27;</span></span><br><span class="line">MEDIA_ROOT = BASE_DIR / <span class="string">&#x27;media&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€ä¾†ï¼Œä¸Šå‚³çš„æª”æ¡ˆæœƒå„²å­˜åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„çš„<code>media</code>è³‡æ–™å¤¾ä¸­ï¼Œä¸¦é€šé<code>/media/</code>è·¯å¾‘ä¾†å­˜å–ã€‚</p><h3 id="é–‹ç™¼ç’°å¢ƒä¸‹çš„æª”æ¡ˆå­˜å–"><a href="#é–‹ç™¼ç’°å¢ƒä¸‹çš„æª”æ¡ˆå­˜å–" class="headerlink" title="é–‹ç™¼ç’°å¢ƒä¸‹çš„æª”æ¡ˆå­˜å–"></a>é–‹ç™¼ç’°å¢ƒä¸‹çš„æª”æ¡ˆå­˜å–</h3><p>æˆ‘å€‘éœ€è¦ Django æä¾›çš„<code>static</code>æ–¹æ³•ï¼Œä¾†è®“<strong>é–‹ç™¼ç’°å¢ƒ</strong>èƒ½å¤ ç›´æ¥å­˜å–é€™äº›æª”æ¡ˆã€‚</p><p>åœ¨å°ˆæ¡ˆçš„<code>urls.py</code>åŠ ä¸Šé€™è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NinjaForum/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.conf.urls.static <span class="keyword">import</span> static</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, api.urls),</span><br><span class="line">    <span class="comment"># è®“é–‹ç™¼ç’°å¢ƒå¯ä»¥å­˜å–ä¸Šå‚³çš„æª”æ¡ˆï¼Œåƒ…ä¾›é–‹ç™¼ç’°å¢ƒä½¿ç”¨</span></span><br><span class="line">] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</span><br></pre></td></tr></table></figure><p>é€™æ®µç¨‹å¼ç¢¼å…è¨± Django åœ¨é–‹ç™¼ç’°å¢ƒä¸‹æä¾›éœæ…‹æª”æ¡ˆçš„å­˜å–ã€‚</p><h3 id="å»ºç«‹ImageFieldæ¬„ä½"><a href="#å»ºç«‹ImageFieldæ¬„ä½" class="headerlink" title="å»ºç«‹ImageFieldæ¬„ä½"></a>å»ºç«‹<code>ImageField</code>æ¬„ä½</h3><p><code>ImageField</code>æ˜¯ Django å°ˆé–€ç”¨ä¾†å­˜æ”¾åœ–ç‰‡çš„æ¬„ä½ï¼Œå®ƒå¯¦éš›ä¸Šæ˜¯å­˜å„²åœ–ç‰‡çš„<strong>æª”æ¡ˆè·¯å¾‘</strong>ã€‚é¡ä¼¼çš„æ¬„ä½é‚„æœ‰<code>FileField</code>ã€‚</p><p>ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># user/models.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class="line">    ...</span><br><span class="line">    avatar = models.ImageField(upload_to=<span class="string">&#x27;avatars/&#x27;</span>, null=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ­é…ä¹‹å‰çš„<code>settings.py</code>è¨­å®šï¼Œ<code>avatar</code>æ¬„ä½æœƒå°‡ä¸Šå‚³çš„åœ–ç‰‡å­˜åœ¨<code>media/avatars/</code>è³‡æ–™å¤¾ä¸­â€”â€”é€™å€‹è·¯å¾‘ç”±<code>MEDIA_ROOT</code>èˆ‡æ¬„ä½<code>upload_to</code>å…±åŒæ±ºå®šã€‚</p><p>ç§»è‡³æœ¬åˆ†æ”¯å¾Œï¼Œå°ˆæ¡ˆä¸­å·²ç¶“æœ‰æ–°çš„é·ç§»æª”ï¼Œè¨˜å¾—è¦<strong>è³‡æ–™åº«é·ç§»</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line">make migrate</span><br></pre></td></tr></table></figure><p>é™„å¸¶ä¸€æï¼Œ<code>ImageField</code>ä¾è³´ç¬¬ä¸‰æ–¹å¥—ä»¶â€”â€”<a href="https://pypi.org/project/pillow/">Pillow</a>ã€‚é€™å€‹å¥—ä»¶ç‚ºæ¬„ä½æä¾›äº†è™•ç†åœ–ç‰‡åŠŸèƒ½ï¼Œè¦å…ˆå®‰è£æ¬„ä½æ‰èƒ½æ­£å¸¸é‹ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line">poetry add pillow</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Poetry çš„è®€è€…ï¼Œç›´æ¥åœ¨åˆä½µå¾Œçš„åˆ†æ”¯<code>poetry install</code>å³å¯ã€‚</p><hr><h2 id="å¯¦ä½œï¼šä¸Šå‚³-avatar"><a href="#å¯¦ä½œï¼šä¸Šå‚³-avatar" class="headerlink" title="å¯¦ä½œï¼šä¸Šå‚³ avatar"></a>å¯¦ä½œï¼šä¸Šå‚³ avatar</h2><p>å‰ç½®ä½œæ¥­çµæŸï¼Œæˆ‘å€‘çµ‚æ–¼å¯ä»¥é€²å…¥é‡é ­æˆ²ã€‚</p><p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„ã€Œä¸Šå‚³ avatarã€åŠŸèƒ½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ninja <span class="keyword">import</span> File, Router, UploadedFile</span><br><span class="line"><span class="keyword">from</span> ninja.errors <span class="keyword">import</span> HttpError</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&#x27;/users/&#123;int:user_id&#125;/avatar/&#x27;</span>,summary=<span class="string">&#x27;ä¸Šå‚³ avatar&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_avatar</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest,</span></span><br><span class="line"><span class="params">    user_id: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">    avatar_file: UploadedFile = File(<span class="params"></span>)</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šå‚³ avatar</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æª¢æŸ¥æª”æ¡ˆé¡å‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> avatar_file.content_type.startswith(<span class="string">&#x27;image/&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> HttpError(<span class="number">400</span>, <span class="string">&#x27;æª”æ¡ˆå¿…é ˆæ˜¯åœ–ç‰‡æ ¼å¼&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    user = User.objects.get(<span class="built_in">id</span>=user_id)</span><br><span class="line">    user.avatar = avatar_file</span><br><span class="line">    user.save()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;detail&#x27;</span>: <span class="string">&#x27;åœ–ç‰‡ä¸Šå‚³æˆåŠŸ&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å°é€™æ®µç¨‹å¼ç¢¼çš„é‡é»è§£æã€‚</p><h3 id="ä¸€ã€UploadedFileåƒæ•¸å®šç¾©"><a href="#ä¸€ã€UploadedFileåƒæ•¸å®šç¾©" class="headerlink" title="ä¸€ã€UploadedFileåƒæ•¸å®šç¾©"></a>ä¸€ã€<code>UploadedFile</code>åƒæ•¸å®šç¾©</h3><p>åœ¨ view å‡½å¼çš„ç°½åä¸­ï¼Œ<code>UploadedFile</code>ä½œç‚º type hint ä½¿ç”¨ï¼Œè€Œ<code>avatar_file</code>åƒæ•¸å‰‡ä»£è¡¨ä¸Šå‚³çš„æª”æ¡ˆã€‚</p><p>ä½ å¯ä»¥<strong>ä»»æ„å‘½å</strong><code>avatar_file</code>é€™å€‹åƒæ•¸ï¼Œæ¯”å¦‚<a href="https://django-ninja.dev/guides/input/file-params/">æ–‡ä»¶ç¯„ä¾‹</a>ä¸­æ˜¯å«<code>file</code>ã€‚æˆ‘ç‰¹åœ°å–ä¸åŒåå­—ï¼Œå°±æ˜¯è¦å¼·èª¿å®ƒçš„åå­—æ˜¯<strong>å®Œå…¨å¯è‡ªè¨‚</strong>çš„ã€‚</p><p>ä½†æ˜¯ï¼ç„¡è«–ä½ å–ä»€éº¼åç¨±ï¼Œåœ¨ç™¼è«‹æ±‚æ™‚ï¼Œ<strong>body ä¸­çš„ key</strong> ä¹Ÿè¦ä½¿ç”¨<strong>ç›¸åŒçš„åç¨±</strong>ã€‚</p><p>æ­¤æ™‚çš„ body å¯èƒ½é•·é€™æ¨£ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /users/1/avatar/</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data; name=&quot;avatar_file&quot;; filename=&quot;example.jpg&quot;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>image/jpeg</span><br><span class="line"></span><br><span class="line">(binary image data here)</span><br><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span><br></pre></td></tr></table></figure><p>Header ä¸­çš„<code>Content-Type</code>ç‚º<code>multipart/form-data</code>ï¼Œè€Œä¸”æ¯å€‹ key-value å°éƒ½æ˜¯ä»¥<code>Content-Disposition: form-data;</code>é–‹é ­ã€‚é€™ç¨®æ ¼å¼å…è¨±<strong>åœ¨ä¸€å€‹è«‹æ±‚ä¸­åŒæ™‚å‚³é€å¤šå€‹ä¸åŒé¡å‹çš„è³‡æ–™</strong>ï¼ŒåŒ…æ‹¬æ–‡å­—å’ŒäºŒé€²ä½æª”æ¡ˆã€‚</p><p>å…¶ä¸­çš„ç´°ç¯€ï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ã€ˆ<a href="https://blog.errorbaker.tw/posts/cwc329/multipart-form-data/">multipart&#x2F;form-data åˆæ¢</a>ã€‰ã€‚</p><h3 id="äºŒã€Fileå‡½å¼"><a href="#äºŒã€Fileå‡½å¼" class="headerlink" title="äºŒã€Fileå‡½å¼"></a>äºŒã€<code>File</code>å‡½å¼</h3><p>å®šç¾©<code>=File()</code>çš„<strong>ç›®çš„</strong>æ˜¯åœ¨å‘Šè¨´ Django Ninjaï¼Œé€™å€‹åƒæ•¸<strong>æ‡‰è©²å¾ HTTP è«‹æ±‚ä¸­çš„ã€Œä¸Šå‚³æª”æ¡ˆã€éƒ¨åˆ†ç²å–</strong>ã€‚é¡ä¼¼åšæ³•é‚„æœ‰æˆ‘å€‘ç¬¬ 11 ç¯‡æåˆ°çš„<code>Query</code>ã€‚</p><p>å¦‚æœæ²’æœ‰é€™å€‹æ¨™è¨˜ï¼Œæ¡†æ¶å¯èƒ½ç„¡æ³•æ­£ç¢ºè­˜åˆ¥ä¸¦è™•ç†ä¸Šå‚³çš„å…§å®¹ã€‚</p><h3 id="ä¸‰ã€æª¢æŸ¥æª”æ¡ˆé¡å‹"><a href="#ä¸‰ã€æª¢æŸ¥æª”æ¡ˆé¡å‹" class="headerlink" title="ä¸‰ã€æª¢æŸ¥æª”æ¡ˆé¡å‹"></a>ä¸‰ã€æª¢æŸ¥æª”æ¡ˆé¡å‹</h3><p>æˆ‘å€‘ä½¿ç”¨äº†<code>UploadedFile</code>çš„<code>content_type</code>å±¬æ€§ï¼Œç²å¾—é€™å€‹ body å…§å®¹çš„æª”æ¡ˆé¡å‹ï¼Œç¢ºèªå®ƒæ˜¯åœ–ç‰‡ï¼Œç„¶å¾Œæ‰ç™¼è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æª¢æŸ¥æª”æ¡ˆé¡å‹</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> avatar_file.content_type.startswith(<span class="string">&#x27;image/&#x27;</span>):</span><br><span class="line">    <span class="keyword">raise</span> HttpError(<span class="number">400</span>, <span class="string">&#x27;æª”æ¡ˆå¿…é ˆæ˜¯åœ–ç‰‡æ ¼å¼&#x27;</span>)</span><br></pre></td></tr></table></figure><p>é€™å€‹æ–¹æ³•é›–ç„¶ç²—ç³™ï¼Œä½†å°æ–¼ç°¡å–®çš„åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½ä¾†èªªå·²ç¶“è¶³å¤ ã€‚</p><p>åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œä½ éœ€è¦<strong>æ›´åš´æ ¼çš„æª¢æŸ¥</strong>ï¼Œä¾‹å¦‚ä½¿ç”¨å°ˆé–€çš„åœ–ç‰‡è™•ç†å¥—ä»¶ä¾†é©—è­‰æª”æ¡ˆå…§å®¹ã€‚</p><h3 id="å››ã€å„²å­˜åœ–ç‰‡"><a href="#å››ã€å„²å­˜åœ–ç‰‡" class="headerlink" title="å››ã€å„²å­˜åœ–ç‰‡"></a>å››ã€å„²å­˜åœ–ç‰‡</h3><p>æœ€å¾Œï¼Œæˆ‘å€‘å°‡åœ–ç‰‡è³¦å€¼çµ¦<code>User</code>çš„<code>avatar</code>æ¬„ä½ï¼Œä¸¦å‘¼å«<code>save()</code>æ–¹æ³•ã€‚</p><p>Django æœƒè‡ªå‹•è™•ç†æª”æ¡ˆçš„å„²å­˜ï¼Œå¦‚æœ<strong>åç¨±é‡è¤‡</strong>ï¼Œå®ƒé‚„æœƒ<strong>è‡ªå‹•ç”¢ç”Ÿå”¯ä¸€çš„æª”å</strong>ï¼Œç„¶å¾ŒæŠŠæª”æ¡ˆæ”¾åˆ°æˆ‘å€‘ä¹‹å‰æŒ‡å®šçš„ä½ç½®ã€‚</p><p>é€é API ä¸Šå‚³äº†å…©æ¬¡ä¸€æ¨¡ä¸€æ¨£çš„ avatar å¾Œï¼Œæˆ‘å€‘åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä½¿ç”¨<code>tree</code>æŒ‡ä»¤çœ‹ä¸€ä¸‹çµæœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â¯ tree media</span><br><span class="line">media</span><br><span class="line">â””â”€â”€ avatars</span><br><span class="line">    â”œâ”€â”€ my-avatar.png</span><br><span class="line">    â””â”€â”€ my-avatar_gVwgCiG.png  <span class="comment"># ç›¸åŒæª”åç¬¬äºŒæ¬¡ä¸Šå‚³ï¼Œè‡ªå‹•æ›´å</span></span><br><span class="line"></span><br><span class="line">2 directories, 2 files</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡ä¸Šå‚³çš„åœ–ç‰‡è¢«ã€Œ<strong>è‡ªå‹•æ›´å</strong>ã€äº†ã€‚é€™<strong>ä¿è­‰</strong>äº†æª”åçš„<strong>å”¯ä¸€æ€§</strong>ã€‚</p><p>åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œæœ€å¥½è‡ªè¡Œå®šç¾©æª”æ¡ˆçš„çµ±ä¸€å‘½åæ ¼å¼ï¼Œä»¥ç¢ºä¿æ›´å¥½çš„ç®¡ç†å’Œå®‰å…¨æ€§ã€‚</p><hr><h2 id="å°çµèˆ‡ä¸‹ä¸€æ­¥"><a href="#å°çµèˆ‡ä¸‹ä¸€æ­¥" class="headerlink" title="å°çµèˆ‡ä¸‹ä¸€æ­¥"></a>å°çµèˆ‡ä¸‹ä¸€æ­¥</h2><p>æœ¬æ–‡ä»‹ç´¹äº†å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ä½œæª”æ¡ˆä¸Šå‚³åŠŸèƒ½ï¼Œå¾å‰ç½®è¨­å®šåˆ° API å¯¦ä½œï¼Œè©³è¿°äº†<code>UploadedFile</code>çš„ä½¿ç”¨æ–¹å¼ã€‚</p><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°‡ä»‹ç´¹å¦ä¸€é …é€²éšåŠŸèƒ½â€”â€”åˆ†é ï¼ˆPaginationï¼‰ï¼Œå®ƒèƒ½å¹«åŠ©ä½ åœ¨å›æ‡‰å¤§é‡è³‡æ–™æ™‚ï¼Œæœ‰æ•ˆæå‡æ•ˆèƒ½èˆ‡ä½¿ç”¨è€…é«”é©—ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç¾ä»£ Web æœå‹™ä¸­ï¼Œ&lt;strong&gt;æª”æ¡ˆä¸Šå‚³&lt;/strong&gt;æ˜¯ä¸€å€‹å¸¸è¦‹çš„æƒ…å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;ç„¡è«–æ˜¯ä½¿ç”¨è€…ä¸Šå‚³ç…§ç‰‡ã€å¤¾å¸¶é™„ä»¶ï¼Œæª”æ¡ˆä¸Šå‚³éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ç¾&lt;strong&gt;åœ–ç‰‡ä¸Šå‚³&lt;/strong&gt;åŠŸèƒ½ï¼Œä»¥ä½¿ç”¨è€…ã€Œä¸Šå‚³å¤§é ­è²¼ã€ï¼ˆä»¥ä¸‹éƒ½ç¨±ç‚º avatarï¼Œå› ç‚ºå¤§é ­è²¼æ„Ÿè¦ºå¤ªå¯æ„›ğŸ¥¹ï¼‰API ç‚ºä¾‹ï¼Œå¸¶ä½ ä¸€æ­¥æ­¥äº†è§£é€™å€‹éç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/14&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸éï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆäº†è§£ï¼Œæœ¬ç« æœ‰å“ªäº›ä¸»é¡Œã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç¬¬å…­ç« ã€ŒAPI-é€²éšåŠŸèƒ½ã€ç°¡ä»‹&quot;&gt;&lt;a href=&quot;#ç¬¬å…­ç« ã€ŒAPI-é€²éšåŠŸèƒ½ã€ç°¡ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬å…­ç« ã€ŒAPI é€²éšåŠŸèƒ½ã€ç°¡ä»‹&quot;&gt;&lt;/a&gt;ç¬¬å…­ç« ã€ŒAPI é€²éšåŠŸèƒ½ã€ç°¡ä»‹&lt;/h2&gt;&lt;p&gt;å° API å°ˆæ¡ˆè€Œè¨€ï¼Œ&lt;strong&gt;é€²éšåŠŸèƒ½&lt;/strong&gt;èƒ½å¹«åŠ©æˆ‘å€‘æ‡‰å°&lt;strong&gt;è¤‡é›œå ´æ™¯&lt;/strong&gt;èˆ‡&lt;strong&gt;å¤§å‹å°ˆæ¡ˆ&lt;/strong&gt;çš„æŒ‘æˆ°ã€‚&lt;/p&gt;
&lt;p&gt;é›–ç„¶é€™æ˜¯ä¸€å€‹å…¥é–€æŒ‡å—ï¼Œä½†æˆ‘å€‘ä»æœƒæ¶µè“‹ä¸€äº›å¸¸è¦‹çš„é€²éšåŠŸèƒ½ï¼Œé€™äº›åŠŸèƒ½ä¸åƒ…æå‡ API çš„éˆæ´»æ€§ï¼Œé‚„èƒ½å¢å¼·äº†ç³»çµ±æ•ˆèƒ½èˆ‡ä½¿ç”¨è€…é«”é©—ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« å°‡ä»‹ç´¹ 3 å€‹é‡è¦çš„é€²éšåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å· 23ï¼šæª”æ¡ˆä¸Šå‚³â€”â€”Django UploadedFile ä»‹ç´¹&lt;/li&gt;
&lt;li&gt;å· 24ï¼šåˆ†é ï¼ˆä¸Šï¼‰Django Ninja çš„å…§å»ºåˆ†é å™¨&lt;/li&gt;
&lt;li&gt;å· 25ï¼šåˆ†é ï¼ˆä¸‹ï¼‰è‡ªå®šç¾©åˆ†é é¡åˆ¥&lt;/li&gt;
&lt;li&gt;å· 26ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸Šï¼‰FilterSchema ä»‹ç´¹&lt;/li&gt;
&lt;li&gt;å· 27ï¼šè³‡æ–™æŸ¥è©¢èˆ‡éæ¿¾ï¼ˆä¸‹ï¼‰FilterSchema å¤šæ¬„ä½æŸ¥è©¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›æŠ€è¡“ä¸åƒ…å°å¤§å‹å°ˆæ¡ˆè‡³é—œé‡è¦ï¼Œä¹Ÿè®“ä½ èƒ½åœ¨ API é–‹ç™¼ä¸­ï¼Œæœ‰æ•ˆæ‡‰å°å¤šè®Šçš„éœ€æ±‚ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 22ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸‹ï¼‰å…¨åŸŸéŒ¯èª¤è™•ç†â€”â€”æ·±å…¥è§£æ Exception Handlers</title>
    <link href="https://blog.kyomind.tw/django-ninja-22/"/>
    <id>https://blog.kyomind.tw/django-ninja-22/</id>
    <published>2024-10-04T03:03:51.000Z</published>
    <updated>2024-10-07T05:52:25.623Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•æ“ä½œ<code>HttpError</code>ï¼Œä¸¦å»ºè­°ä½ <strong>åªåœ¨</strong> view å‡½å¼ä¸­ä½¿ç”¨å®ƒã€‚</p><p>ä½†å…‰æ˜¯é€™æ¨£ï¼Œå°ˆæ¡ˆ API çš„éŒ¯èª¤è™•ç†ï¼Œé‚„é é <strong>ä¸å¤ å®Œå–„</strong>ï¼Œè‡³å°‘æœ‰ 3 å€‹å¸¸è¦‹å•é¡Œå¾…è§£ï¼š</p><ol><li>Schema ä¸­çš„é©—è­‰æ–¹æ³• ï¼Œå¦‚æœä¸è¦<code>raise HttpError</code>ï¼Œé‚£è¦æ€éº¼åšæ‰å¥½ï¼Ÿ</li><li>æˆ‘å€‘æ‡‰è©²å¦‚ä½•è™•ç†<strong>å…¶ä»–é¡å‹çš„éŒ¯èª¤</strong>ï¼Œä¾‹å¦‚è³‡æ–™åº«æ“ä½œéŒ¯èª¤ï¼Ÿ</li><li>å¦‚ä½•ç¢ºä¿ä¸åŒ API éŒ¯èª¤çš„<strong>å›æ‡‰æ ¼å¼ä¸€è‡´</strong>ï¼Ÿ</li></ol><p>é€™äº›å•é¡Œéƒ½æŒ‡å‘äº†ä¸€å€‹<strong>æ›´å¤§çš„éœ€æ±‚</strong>ï¼šæˆ‘å€‘éœ€è¦ä¸€å€‹<strong>å…¨é¢çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶</strong>ã€‚</p><p>é€™ç¯‡æ–‡ç« ï¼Œå°±è¦ä¾†å›ç­”é€™äº›å•é¡Œã€‚æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/13">é€™å€‹ PR</a>ã€‚</p><span id="more"></span><hr><h2 id="æ”¹ç”¨-Django-ValidationError"><a href="#æ”¹ç”¨-Django-ValidationError" class="headerlink" title="æ”¹ç”¨ Django ValidationError"></a>æ”¹ç”¨ Django ValidationError</h2><p>é‚„è¨˜å¾—é©—è­‰æ–¹æ³•ä¸­ï¼Œæœ€åŸå§‹çš„ç‰ˆæœ¬æ˜¯æ‹‹å‡º<code>ValueError</code>å—ï¼Ÿ</p><p><code>ValueError</code>æœƒè¢« Django Ninja è‡ªå‹•æ•æ‰ä¸¦çµ¦å‡º 422 å›æ‡‰ï¼Œé€™æ˜¯å¥½äº‹ï¼Œä½†ä¸ç¬¦åˆæˆ‘å€‘çš„<strong>è‡ªå®šç¾©éœ€æ±‚</strong>ã€‚</p><p>æ‰€ä»¥å¾Œä¾†æˆ‘å€‘æ”¹æ¡äº†<code>HttpError</code>ï¼Œå®ƒé›–ç„¶ä¹Ÿæœƒè¢«æ•æ‰ï¼Œä½†å›æ‡‰çš„æ ¼å¼èˆ‡å…§å®¹æ¯”è¼ƒç°¡æ½”â€”â€”è€Œä¸”é™¤äº†éŒ¯èª¤è¨Šæ¯ï¼Œé‚„èƒ½<strong>è‡ªè¨‚ç‹€æ…‹ç¢¼</strong>ã€‚</p><p>ç„¶è€Œï¼Œå¦‚ä¸Šä¸€ç¯‡æ‰€è¿°ï¼Œé€™æ¨£åšé›–ç„¶ç°¡å–®ï¼Œå»ä¸¦ä¸åˆé©ã€‚</p><blockquote><p><strong>é‚£ç©¶ç«Ÿè¦æ‹‹å‡ºä»€éº¼éŒ¯èª¤ï¼Ÿ</strong></p></blockquote><h3 id="é¿å…ä½¿ç”¨-Pydantic-æˆ–-Django-Ninja-æä¾›çš„éŒ¯èª¤"><a href="#é¿å…ä½¿ç”¨-Pydantic-æˆ–-Django-Ninja-æä¾›çš„éŒ¯èª¤" class="headerlink" title="é¿å…ä½¿ç”¨ Pydantic æˆ– Django Ninja æä¾›çš„éŒ¯èª¤"></a>é¿å…ä½¿ç”¨ Pydantic æˆ– Django Ninja æä¾›çš„éŒ¯èª¤</h3><p>ä¸Šä¸€ç¯‡é‚„æåˆ°ï¼Œç„¡è«– Pydantic æˆ– Django Ninjaï¼Œéƒ½æœ‰è‡ªå·±å…§å»ºçš„<code>ValidationError</code>ã€‚</p><p>ä½†å®ƒå€‘æ›´å¤šæ˜¯<strong>ä¾›æ¡†æ¶å…§éƒ¨ä½¿ç”¨</strong>ï¼Œè€Œä¸”å›å‚³çš„éŒ¯èª¤æ ¼å¼éæ–¼è©³ç´°ï¼Œ<strong>åˆå§‹åŒ–æ–¹å¼ä¹Ÿå¾ˆé¾œæ¯›</strong>ã€‚æ¯”å¦‚ Django Ninja çš„é©—è­‰éŒ¯èª¤ï¼Œéœ€è¦é€™æ¨£åˆå§‹åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValidationError(</span><br><span class="line">    [&#123;<span class="string">&#x27;loc&#x27;</span>: (<span class="string">&#x27;confirm_password&#x27;</span>,),</span><br><span class="line">      <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;value_error&#x27;</span>&#125;])</span><br></pre></td></tr></table></figure><p>é€™ä¸æ˜¯æˆ‘å€‘ç†Ÿæ‚‰çš„ã€Œå¡ä¸€å€‹éŒ¯èª¤è¨Šæ¯å­—ä¸²ã€å°±å¥½äº†ã€‚</p><p>å› æ­¤ï¼Œæˆ‘<strong>ä¸¦ä¸æ¨è–¦</strong>åœ¨é©—è­‰é‚è¼¯ä¸­<strong>ç›´æ¥ä½¿ç”¨</strong>é€™äº›éŒ¯èª¤é¡å‹ã€‚</p><h3 id="è«‹æ„›ç”¨-Django-ValidationError"><a href="#è«‹æ„›ç”¨-Django-ValidationError" class="headerlink" title="è«‹æ„›ç”¨ Django ValidationError"></a>è«‹æ„›ç”¨ Django ValidationError</h3><p>åœ¨ Schema é©—è­‰é‚è¼¯ä¸­ï¼Œæˆ‘å€‘æ›´æ‡‰è©²ä½¿ç”¨ Django å…§å»ºçš„<code>ValidationError</code>ã€‚</p><p>å®ƒçš„è¨­è¨ˆå·²ç¶“<strong>å®Œæ•´è€ƒæ…®åˆ°äº†é–‹ç™¼è€…çš„éœ€æ±‚</strong>ï¼Œåˆå§‹åŒ–æ–¹å¼<strong>å¯ç°¡å–®</strong>ï¼ˆä½¿ç”¨å–®ä¸€å­—ä¸²ï¼‰<strong>å¯è¤‡é›œ</strong>ï¼ˆä½¿ç”¨<code>list</code>æˆ–<code>dict</code>ï¼‰ï¼Œé©åˆçµ•å¤§å¤šæ•¸å ´æ™¯ã€‚</p><p>é€™è£¡æˆ‘å€‘ç”¨<strong>å­—ä¸²</strong>ä¾†åˆå§‹åŒ–å³å¯ï¼Œç¨‹å¼ç¢¼ä¿®æ­£å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    confirm_password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;after&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_passwords_match</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.password != self.confirm_password:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å°‡åŸæœ¬çš„<code>HttpError</code>æ”¹ç‚ºäº† Django çš„<code>ValidationError</code>ã€‚</p><p>ä¸¦ä»¥ã€ŒéŒ¯èª¤è¨Šæ¯å­—ä¸²ã€ä½œç‚ºåˆå§‹åŒ–æ–¹å¼ï¼Œå°‘äº†åŸæœ¬çš„ç¬¬ä¸€åƒæ•¸ã€Œç‹€æ…‹ç¢¼ã€ã€‚</p><hr><h2 id="Django-Ninja-ä¸æœƒè‡ªå‹•è™•ç†é€™äº›éŒ¯èª¤"><a href="#Django-Ninja-ä¸æœƒè‡ªå‹•è™•ç†é€™äº›éŒ¯èª¤" class="headerlink" title="Django Ninja ä¸æœƒè‡ªå‹•è™•ç†é€™äº›éŒ¯èª¤"></a>Django Ninja ä¸æœƒè‡ªå‹•è™•ç†é€™äº›éŒ¯èª¤</h2><p>å°‡æ‹‹å‡ºçš„éŒ¯èª¤é¡å‹æ”¹ç‚º Django çš„<code>ValidationError</code> å¾Œï¼Œä½ å¯èƒ½æœƒæ³¨æ„åˆ°ä¸€å€‹å•é¡Œï¼šDjango Ninja <strong>ä¸¦ä¸æœƒ</strong>è‡ªå‹•æ•æ‰é€™äº›éŒ¯èª¤ï¼</p><p>ä¹Ÿå°±æ˜¯èªªï¼Œç•¶æˆ‘å€‘æ‹‹å‡º<code>ValidationError</code>æ™‚ï¼ŒDjango Ninja ä¸æœƒåƒè™•ç†<code>HttpError</code>ä¸€æ¨£ï¼Œè‡ªå‹•æ ¼å¼åŒ–ä¸¦è¿”å› 422 éŒ¯èª¤å›æ‡‰â€”â€”è€Œæ˜¯<strong>ç›´æ¥ 500</strong>ã€‚</p><p>é€™éƒ¨åˆ†æˆ‘å€‘åœ¨ã€ˆ<a href="/django-ninja-20/">å· 20ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸‹ï¼‰Pydantic model_validator å¯¦ç¾ã€Œè·¨æ¬„ä½ã€é©—è­‰</a>ã€‰çš„çµå°¾è™•æéã€‚</p><p>ç¾åœ¨ï¼Œå‰‡è¦ä»‹ç´¹<strong>å…·é«”çš„è§£æ±ºä¹‹é“</strong>â€”â€”<code>exception_handler</code>ã€‚</p><p>æˆ‘å€‘éœ€è¦<strong>è‡ªè¡Œè™•ç†</strong>é€™äº›æ‹‹å‡ºçš„éŒ¯èª¤ï¼Œé€™æ­£æ˜¯<code>exception_handler</code>ç™¼æ®ä½œç”¨çš„åœ°æ–¹ã€‚</p><hr><h2 id="å…¨åŸŸéŒ¯èª¤è™•ç†å™¨â€”â€”Exception-Handlers"><a href="#å…¨åŸŸéŒ¯èª¤è™•ç†å™¨â€”â€”Exception-Handlers" class="headerlink" title="å…¨åŸŸéŒ¯èª¤è™•ç†å™¨â€”â€”Exception Handlers"></a>å…¨åŸŸéŒ¯èª¤è™•ç†å™¨â€”â€”Exception Handlers</h2><p>ç‚ºäº†<strong>çµ±ä¸€è™•ç†</strong>é€™äº›<strong>ä¸åŒä¾†æº</strong>ï¼ˆä¸é™æ–¼ Schema é©—è­‰æ–¹æ³•ï¼‰çš„<strong>åŒé¡å‹</strong>éŒ¯èª¤ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Django Ninja æä¾›çš„<code>@api.exception_handler</code>è£é£¾å™¨ã€‚</p><p>é€™å€‹è£é£¾å™¨å…è¨±æˆ‘å€‘<strong>é‡å°ã€Œç‰¹å®šé¡å‹çš„éŒ¯èª¤ã€å®šç¾©å°ˆå±¬çš„å›æ‡‰é‚è¼¯</strong>ï¼Œä¸¦å¥—ç”¨åˆ°<strong>æ•´å€‹ API ç¯„åœ</strong>å…§ã€‚</p><h3 id="å®šç¾©exception-handler"><a href="#å®šç¾©exception-handler" class="headerlink" title="å®šç¾©exception_handler"></a>å®šç¾©<code>exception_handler</code></h3><p>æˆ‘å€‘å¯ä»¥ç‚º Django çš„<code>ValidationError</code>å®šç¾©ä¸€å€‹å…¨åŸŸéŒ¯èª¤è™•ç†å™¨ï¼Œç¢ºä¿ç•¶ä»»ä½•åœ°æ–¹<strong>æ‹‹å‡º</strong>é€™å€‹éŒ¯èª¤æ™‚ï¼Œhandler éƒ½æœƒ<strong>åŠ ä»¥æ•æ‰</strong>ï¼Œè®“ API è¿”å›æˆ‘å€‘<strong>è‡ªå®šç¾©çš„å›æ‡‰æ ¼å¼</strong>ã€‚</p><p>åœ¨å°ˆæ¡ˆ<code>api.py</code>ä¸­ï¼ŒåŠ å…¥ä¸‹åˆ—ç¨‹å¼ç¢¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NinjaForum/api.py</span></span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpRequest, HttpResponse</span><br><span class="line"><span class="keyword">from</span> ninja <span class="keyword">import</span> NinjaAPI</span><br><span class="line"></span><br><span class="line">api = NinjaAPI(...)</span><br><span class="line"></span><br><span class="line">api.add_router(...)</span><br><span class="line">api.add_router(...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢çš„ exception handler</span></span><br><span class="line"><span class="meta">@api.exception_handler(<span class="params">exc_class=ValidationError</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">django_validation_error_handler</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest, exception: ValidationError</span></span><br><span class="line"><span class="params"></span>) -&gt; HttpResponse:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è™•ç† Django ValidationError ä¾‹å¤–</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> api.create_response(</span><br><span class="line">        request, &#123;<span class="string">&#x27;detail&#x27;</span>: exception.message&#125;, status=<span class="number">400</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>æˆ‘å€‘å®šç¾©äº†ä¸€å€‹ exception handler å‡½å¼ï¼Œç•¶é‡åˆ° Django çš„<code>ValidationError</code>æ™‚ï¼Œæœƒå›å‚³ HTTP 400 å›æ‡‰ï¼ŒåŒ…å«<strong>è‡ªå®šç¾©éŒ¯èª¤è¨Šæ¯</strong>ï¼Œé€™æ¨£å¯ä»¥ä¿æŒ<strong>å›æ‡‰çš„æ ¼å¼ä¸€è‡´æ€§</strong>ã€‚</p><p>ç¨‹å¼ç¢¼å¾ˆç°¡å–®ï¼Œä½†å…¶ä¸­çš„é‡é»ä¸å°‘ï¼Œè®“æˆ‘å€‘é€ä¸€è§£æã€‚</p><hr><h2 id="Exception-Handlers-é‡é»è§£æ"><a href="#Exception-Handlers-é‡é»è§£æ" class="headerlink" title="Exception Handlers é‡é»è§£æ"></a>Exception Handlers é‡é»è§£æ</h2><p>æˆ‘å€‘å¾ã€Œå°ˆæ¡ˆçµ„ç¹”ã€é€™å€‹è­°é¡Œè¬›èµ·ã€‚</p><h3 id="ä¸€ã€Exception-Handlers-å‡½å¼æ”¾å“ªå¥½ï¼Ÿ"><a href="#ä¸€ã€Exception-Handlers-å‡½å¼æ”¾å“ªå¥½ï¼Ÿ" class="headerlink" title="ä¸€ã€Exception Handlers å‡½å¼æ”¾å“ªå¥½ï¼Ÿ"></a>ä¸€ã€Exception Handlers å‡½å¼æ”¾å“ªå¥½ï¼Ÿ</h3><p>å¦‚å‰æ‰€è¿°ï¼Œé€™å€‹éŒ¯èª¤è™•ç†å™¨çš„å½±éŸ¿ç¯„åœæ˜¯<strong>å…¨åŸŸ</strong>çš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå®ƒæ”¾åœ¨å°ˆæ¡ˆçš„<strong>ä»»ä½•åœ°æ–¹</strong>ã€‚</p><p>ä¸éï¼Œé‚„æ˜¯å»ºè­°å°‡å®ƒæ”¾åœ¨<strong>æœ€é©åˆçš„ä½ç½®</strong>ã€‚æˆ‘èªç‚ºä¸»è¦æœ‰<strong>å…©å€‹é¸æ“‡</strong>ï¼š</p><ol><li>å¦‚æœä½ çš„éŒ¯èª¤è™•ç†å‡½å¼ä¸å¤šï¼Œå¯ä»¥ç›´æ¥æ”¾åœ¨<strong>å°ˆæ¡ˆçš„</strong><code>api.py</code><strong>ä¸­</strong>â€”â€”æˆ‘å€‘çš„ä¾‹å­å°±æ˜¯é€™éº¼åšçš„ã€‚é€™ç¬¦åˆå°ˆæ¡ˆ<code>api.py</code>çš„<strong>å…¨åŸŸç®¡ç†</strong>å±¬æ€§ã€‚</li><li>å¦‚æœéŒ¯èª¤è™•ç†æ¯”è¼ƒå¤šï¼Œå»ºè­°ç¨ç«‹å‡ºä¸€å€‹ Python æ¨¡çµ„ä¾†ç®¡ç†ã€‚</li></ol><h3 id="äºŒã€å‡½å¼èˆ‡åƒæ•¸å‘½å"><a href="#äºŒã€å‡½å¼èˆ‡åƒæ•¸å‘½å" class="headerlink" title="äºŒã€å‡½å¼èˆ‡åƒæ•¸å‘½å"></a>äºŒã€å‡½å¼èˆ‡åƒæ•¸å‘½å</h3><p>åˆåˆ°äº†æˆ‘å–œèæ¨‚è¦‹çš„ã€Œ<strong>å‘½å</strong>ã€éƒ¨åˆ†â˜ºï¸</p><p>Exception handler æ˜¯ä¸€å€‹ï¼ˆè¢«è£é£¾çš„ï¼‰å‡½å¼ï¼Œç†è«–ä¸Šæ‡‰è©²è¦éµå¾ªã€Œ<strong>å‹•è©é–‹é ­</strong>ã€çš„<strong>å‡½å¼å‘½åæ…£ä¾‹</strong>ã€‚</p><p>ä½†æˆ‘å»ä½¿ç”¨äº†<code>django_validation_error_handler</code>é€™æ¨£åã€Œ<strong>åè©</strong>ã€çš„å‘½åã€‚</p><p>å› ç‚ºå®ƒçš„æœ¬è³ªæ›´æ¥è¿‘æ–¼ä¸€å€‹<strong>è™•ç†è£ç½®</strong>æˆ–<strong>æ©Ÿåˆ¶</strong>ï¼Œè€Œéå‚³çµ±æ„ç¾©ä¸Šçš„å‡½å¼ã€‚</p><p>ç•¶ç„¶ï¼Œé€™å–æ±ºæ–¼ä½ <strong>å¾ä»€éº¼è§’åº¦çœ‹</strong>ï¼ä½ ä¹Ÿå¯ä»¥èªªå®ƒå°±æ˜¯æœ‰ã€Œè™•ç†çš„è¡Œç‚ºã€ï¼Œæ‰€ä»¥é‚„æ˜¯å¾—ç”¨å‹•è©é–‹é ­ä¾†å‘½åã€‚æˆ‘å®Œå…¨åŒæ„ã€‚</p><p>æ¥è‘—æ˜¯<code>exception</code>åƒæ•¸ï¼ŒDjango Ninja <a href="https://django-ninja.dev/guides/errors/">æ–‡ä»¶</a>éƒ½æœƒå‘½åç‚º<code>exc</code>ï¼Œæˆ‘å€‹äººå¾ˆä¸å–œæ­¡ï¼Œå› ç‚ºæˆ‘è¦ºå¾—<code>exc</code><strong>ä¸€é»ä¹Ÿä¸ç›´è§€</strong>ï¼Œå±¬æ–¼<strong>å®Œå…¨æ²’å¿…è¦çš„ç¸®å¯«</strong>ã€‚</p><p>é€€ä¸€æ­¥ä¾†èªªï¼Œæˆ‘å¯§å¯ä½¿ç”¨å–®å­—æ¯<code>e</code>â€”â€”é¡ä¼¼ Pydantic é©—è­‰æ–¹æ³•ä¸­çš„<code>v</code>ã€‚</p><h3 id="ä¸‰ã€å‡½å¼é‚è¼¯è§£æ"><a href="#ä¸‰ã€å‡½å¼é‚è¼¯è§£æ" class="headerlink" title="ä¸‰ã€å‡½å¼é‚è¼¯è§£æ"></a>ä¸‰ã€å‡½å¼é‚è¼¯è§£æ</h3><p>Exception handler çš„å‡½å¼é‚è¼¯ï¼Œå¯é•·å¯çŸ­ã€å¯ç°¡å–®å¯è¤‡é›œï¼Œä½†<strong>ä¸å¤–ä¹åšé€™å…©ä»¶äº‹</strong>ï¼š</p><ol><li><strong>æ¥æ”¶ç‰¹å®šéŒ¯èª¤é¡å‹</strong>ã€‚</li><li><strong>è¿”å›ç‰¹å®š HTTP å›æ‡‰</strong>ã€‚</li></ol><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘å€‘æ¥æ”¶ Django çš„<code>ValidationError</code>ï¼Œä¸¦è¿”å›ã€Œ400 Bad Requestã€å›æ‡‰ï¼Œè€Œä¸”éŒ¯èª¤è¨Šæ¯çš„å…§å®¹<strong>ä¾†è‡ªæ–¼æ‹‹å‡ºçš„éŒ¯èª¤</strong>â€”â€”ç”±æˆ‘å€‘è‡ªè¡Œå®šç¾©ã€‚</p><p>é€™æ¨£çš„<strong>éŒ¯èª¤è™•ç†éˆæ´»æ€§</strong>å·²ç¶“ç®—ä¸éŒ¯ã€‚å¦‚æœä½ çš„<code>ValidationError</code>æ¡ç”¨<code>list</code>æˆ–<code>dict</code>åˆå§‹åŒ–ï¼Œé‚£é€™å€‹è™•ç†å‡½å¼å°±éœ€è¦å¯«å¾—æ›´è¤‡é›œä¸€äº›ã€‚</p><hr><h2 id="ç‰›åˆ€å°è©¦ï¼šä»¥è™•ç†-404-å›æ‡‰ç‚ºä¾‹"><a href="#ç‰›åˆ€å°è©¦ï¼šä»¥è™•ç†-404-å›æ‡‰ç‚ºä¾‹" class="headerlink" title="ç‰›åˆ€å°è©¦ï¼šä»¥è™•ç† 404 å›æ‡‰ç‚ºä¾‹"></a>ç‰›åˆ€å°è©¦ï¼šä»¥è™•ç† 404 å›æ‡‰ç‚ºä¾‹</h2><p>æˆ‘å€‘å†ä¾†å¯¦ä½œå¦ä¸€å€‹ exception handlerï¼Œè™•ç†å¸¸è¦‹çš„ 404ã€‚</p><p>ä»¥ã€Œå–å¾—å–®ä¸€æ–‡ç« è³‡è¨Šã€API ç‚ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.get(<span class="params">...</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_post</span>(<span class="params">request: HttpRequest, post_id: <span class="built_in">int</span></span>) -&gt; Post:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å–å¾—å–®ä¸€æ–‡ç« è³‡è¨Š</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    post = Post.objects.get(<span class="built_in">id</span>=post_id)</span><br><span class="line">    <span class="keyword">return</span> post</span><br></pre></td></tr></table></figure><p>ç›®å‰ï¼Œå¦‚æœå‰ç«¯è¼¸å…¥çš„æ–‡ç«  id ä¸å­˜åœ¨ï¼Œä¼ºæœå™¨å°‡ç›´æ¥ 500ï¼š</p><blockquote><p>raise self.model.DoesNotExist(<br>post.models.Post.DoesNotExist: <strong>Post matching query does not exist.</strong></p></blockquote><p>è€Œä¸”é‚„æ›éœ²å…§éƒ¨è¨Šæ¯â€”â€”é€™å¯¦åœ¨å¤ªçäº†ï¼ğŸ¤£</p><p>å› ç‚º Django ORM ä¸­ QuerySet çš„<code>get</code>æ–¹æ³•ï¼Œåœ¨<strong>æŸ¥è©¢ä¸åˆ°çµæœ</strong>æˆ–<strong>æŸ¥åˆ°è¤‡æ•¸çµæœ</strong>æ™‚ï¼Œéƒ½æœƒ<strong>æ‹‹å‡ºéŒ¯èª¤</strong>ã€‚è€Œæˆ‘å€‘ä¸¦æ²’æœ‰æ•æ‰æˆ–è™•ç†é€™äº›éŒ¯èª¤ï¼Œæ‰€ä»¥ä¼ºæœå™¨ç›´æ¥ 500 äº†ã€‚</p><p>å…©ç¨®éŒ¯èª¤ä¸¦ä¸ç›¸åŒâ€”â€”éŒ¯è¨Šè¨Šæ¯ä¹Ÿè¦ä¸åŒã€‚é€™è£¡å…ˆè™•ç†<strong>ç¬¬ä¸€ç¨®</strong>æƒ…æ³å°±å¥½ã€‚</p><h3 id="æŸ¥ç„¡çµæœæ™‚ï¼Œè¿”å›-404-å›æ‡‰"><a href="#æŸ¥ç„¡çµæœæ™‚ï¼Œè¿”å›-404-å›æ‡‰" class="headerlink" title="æŸ¥ç„¡çµæœæ™‚ï¼Œè¿”å› 404 å›æ‡‰"></a>æŸ¥ç„¡çµæœæ™‚ï¼Œè¿”å› 404 å›æ‡‰</h3><p>ç¶“éé€™å…©ç¯‡çš„ä»‹ç´¹ï¼Œä½ æœ‰<strong>å…©ç¨®æ–¹å¼</strong>ä¾†å›æ‡‰ 404ã€‚</p><p>ç¬¬ä¸€ï¼Œç›´æ¥ä½¿ç”¨<code>HttpError</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    post = Post.objects.get(<span class="built_in">id</span>=post_id)</span><br><span class="line"><span class="keyword">except</span> Post.DoesNotExist:</span><br><span class="line">    <span class="keyword">raise</span> HttpError(<span class="number">404</span>, <span class="string">&#x27;æ–‡ç« ä¸å­˜åœ¨&#x27;</span>)</span><br></pre></td></tr></table></figure><p>é€™æ˜¯æˆ‘å€‘å‰ä¸€ç¯‡çš„åšæ³•ï¼Œ<strong>ä¹Ÿç›¸ç•¶æ¨è–¦</strong>ã€‚</p><p>ç¬¬äºŒï¼Œä½¿ç”¨ exception handlerï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NinjaForum/api.py</span></span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ObjectDoesNotExist</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@api.exception_handler(<span class="params">exc_class=ObjectDoesNotExist</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">object_does_not_exist_handler</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: HttpRequest, exception: ObjectDoesNotExist</span></span><br><span class="line"><span class="params"></span>) -&gt; HttpResponse:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è™•ç† Django ObjectDoesNotExist ä¾‹å¤–</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> api.create_response(</span><br><span class="line">        request, &#123;<span class="string">&#x27;detail&#x27;</span>: <span class="string">&#x27;æŸ¥ç„¡è³‡æ–™&#x27;</span>&#125;, status=<span class="number">404</span>)</span><br></pre></td></tr></table></figure><p>é€™å€‹åšæ³•ç›¸æ¯”æ–¼ç¬¬ä¸€ç¨®ï¼Œæœ‰å…¶å„ªé»å’Œç¼ºé»ï¼š</p><ul><li>å„ªé»ï¼š<strong>ä¸å¿…è®Šæ›´</strong> view å‡½å¼çš„å…§å®¹ï¼ˆ<strong>å¯«æ³•æ›´ç°¡æ½”</strong>ï¼‰ï¼Œè€Œä¸”å¯ä»¥æ•æ‰<strong>æ‰€æœ‰ API</strong> æ‹‹å‡ºçš„<code>ObjectDoesNotExist</code>éŒ¯èª¤ã€‚ï¼ˆå®ƒæ˜¯<code>Post.DoesNotExist</code>çš„çˆ¶é¡åˆ¥ï¼‰</li><li>ç¼ºé»ï¼šç„¡æ³•è‡ªå®šç¾©ã€Œ<strong>è©³ç´°</strong>ã€çš„éŒ¯èª¤è¨Šæ¯â€”â€”å› ç‚ºæˆ‘å€‘ä¸çŸ¥é“<code>ObjectDoesNotExist</code>æ˜¯ç™¼ç”Ÿåœ¨æŸ¥è©¢ä»€éº¼æ¨¡å‹ç‰©ä»¶ã€‚<ul><li>ç•¶ç„¶ï¼Œå¦‚æœä½ é¡˜æ„ç‚º<strong>ä¸åŒéŒ¯èª¤</strong>å®šç¾©å„è‡ªçš„ exception handlerï¼Œå°±èƒ½å¤ å¯¦ç¾ï¼â€”â€”æ¯”å¦‚åªæ•æ‰<code>Post.DoesNotExist</code>ï¼ŒéŒ¯èª¤è¨Šæ¯å°±å¯ä»¥å¯«ã€Œæ–‡ç« ä¸å­˜åœ¨ã€ã€‚</li><li>ä½†å°±è¦å®šç¾©å¾ˆå¤šå€‹ exception handlersï¼Œæœ‰é»éº»ç…©å•¦ï¼</li></ul></li></ul><p>é¸æ“‡ç¬¬ä¸€ç¨®é‚„æ˜¯ç¬¬äºŒç¨®åšæ³•ï¼Œéœ€è¦ä½ <strong>è¦–æƒ…æ³è€Œå®š</strong>ã€‚</p><hr><h2 id="ç¬¬äº”ç« ç¸½çµ"><a href="#ç¬¬äº”ç« ç¸½çµ" class="headerlink" title="ç¬¬äº”ç« ç¸½çµ"></a>ç¬¬äº”ç« ç¸½çµ</h2><p>ç¬¬äº”ç« èªªçœŸçš„ï¼Œè³‡è¨Šé‡é —å¤§ï¼Œé€™ 4 ç¯‡æ–‡ç« æˆ‘å¯«äº†å¾ˆä¹…ï¼Œè€Œä¸”é‚„ã€Œ<strong>é‡æ§‹</strong>ã€éï¼â€”â€”æœ¬ä¾†åªæœ‰ 2 ç¯‡è€Œå·²ã€‚</p><p>æˆ‘å€‘å…ˆè¨è«–äº†å¦‚ä½•è‡ªå®šç¾©å–®ä¸€æ¬„ä½é©—è­‰ï¼Œä»¥åŠè·¨æ¬„ä½é©—è­‰ã€‚ç„¶å¾Œå†å¾ªåºæ¼¸é€²åœ°å­¸ç¿’å¦‚ä½•è™•ç† API æ‹‹å‡ºçš„éŒ¯èª¤â€”â€”<strong>æ„ˆä¾†æ„ˆå„ªé›…ã€æ„ˆä¾†æ„ˆå…¨é¢</strong>ã€‚</p><p>å¦‚æœä½ æ˜¯å¾ç¬¬ 1 ç¯‡çœ‹åˆ°é€™è£¡ï¼ŒçœŸçš„ï¼Œå®Œå…¨å¯ä»¥ç‚ºè‡ªå·±æ„Ÿåˆ°é©•å‚²ã€‚</p><h2 id="ä¸‹ä¸€æ­¥"><a href="#ä¸‹ä¸€æ­¥" class="headerlink" title="ä¸‹ä¸€æ­¥"></a>ä¸‹ä¸€æ­¥</h2><p>æ¥ä¸‹ä¾†ï¼Œæ¯”è¼ƒè¼•é¬†äº†å—ï¼Ÿâ€”â€”ä¸¦æ²’æœ‰ã€‚</p><p>æˆ‘å€‘è¦ä»‹ç´¹ API çš„<strong>å¸¸è¦‹é€²éšåŠŸèƒ½</strong>ã€‚</p><p>é€™äº›åŠŸèƒ½ç›¸æ¯”æ–¼è™•ç†è«‹æ±‚ã€å›æ‡‰ï¼Œå¯ä»¥èªªã€Œ<strong>ä¸ä¸€å®š</strong>ã€è¦æœ‰ï¼Œä½†å°è¨±å¤š API å°ˆæ¡ˆä¾†èªªä»ç›¸ç•¶é‡è¦ã€‚</p><p>ä¸‹ä¸€ç« ï¼Œæˆ‘å€‘å°‡é€ä¸€æ¢è¨é€™äº›é€²éšåŠŸèƒ½ï¼Œä¸¦å­¸ç¿’å¦‚ä½•åœ¨ Django Ninja ä¸­å¯¦ç¾å®ƒå€‘ã€‚è®“æˆ‘å€‘ç¹¼çºŒæ·±å…¥ API é–‹ç™¼çš„ä¸–ç•Œå§ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•æ“ä½œ&lt;code&gt;HttpError&lt;/code&gt;ï¼Œä¸¦å»ºè­°ä½ &lt;strong&gt;åªåœ¨&lt;/strong&gt; view å‡½å¼ä¸­ä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä½†å…‰æ˜¯é€™æ¨£ï¼Œå°ˆæ¡ˆ API çš„éŒ¯èª¤è™•ç†ï¼Œé‚„é é &lt;strong&gt;ä¸å¤ å®Œå–„&lt;/strong&gt;ï¼Œè‡³å°‘æœ‰ 3 å€‹å¸¸è¦‹å•é¡Œå¾…è§£ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Schema ä¸­çš„é©—è­‰æ–¹æ³• ï¼Œå¦‚æœä¸è¦&lt;code&gt;raise HttpError&lt;/code&gt;ï¼Œé‚£è¦æ€éº¼åšæ‰å¥½ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æˆ‘å€‘æ‡‰è©²å¦‚ä½•è™•ç†&lt;strong&gt;å…¶ä»–é¡å‹çš„éŒ¯èª¤&lt;/strong&gt;ï¼Œä¾‹å¦‚è³‡æ–™åº«æ“ä½œéŒ¯èª¤ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç¢ºä¿ä¸åŒ API éŒ¯èª¤çš„&lt;strong&gt;å›æ‡‰æ ¼å¼ä¸€è‡´&lt;/strong&gt;ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€™äº›å•é¡Œéƒ½æŒ‡å‘äº†ä¸€å€‹&lt;strong&gt;æ›´å¤§çš„éœ€æ±‚&lt;/strong&gt;ï¼šæˆ‘å€‘éœ€è¦ä¸€å€‹&lt;strong&gt;å…¨é¢çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« ï¼Œå°±è¦ä¾†å›ç­”é€™äº›å•é¡Œã€‚æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/13&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 21ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸Šï¼‰HttpError èˆ‡è‡ªå®šç¾© HTTP å›æ‡‰</title>
    <link href="https://blog.kyomind.tw/django-ninja-21/"/>
    <id>https://blog.kyomind.tw/django-ninja-21/</id>
    <published>2024-10-03T02:46:01.000Z</published>
    <updated>2024-10-07T05:52:25.603Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>åœ¨è»Ÿé«”é–‹ç™¼ä¸­ï¼Œ<strong>éŒ¯èª¤è™•ç†</strong>æ˜¯ä¸€å€‹ä¸å®¹å¿½è¦–â€”â€”ä½†<strong>å¸¸å¸¸è¢«å¿½è¦–</strong>â€”â€”çš„ç’°ç¯€ã€‚</p><p>ä¸èª‡å¼µåœ°èªªï¼ŒéŒ¯èª¤è™•ç†æ˜¯ä¸€å€‹ã€Œ<strong>åšå¾—å¥½æ²’äººèª‡ï¼Œåšä¸å¥½ç³»çµ±å°±æ…˜å…®å…®</strong>ã€çš„è­°é¡Œã€‚</p><p>æ²’é—œä¿‚ï¼Œæˆ‘å€‘é‚„æ˜¯<strong>ç›¡å¯èƒ½æŠŠè‡ªå·±åšå¥½</strong>ã€‚</p><p>Django Ninja ä½¿ç”¨ Pydantic é€²è¡Œè³‡æ–™é©—è­‰ï¼Œå¤±æ•—æ™‚ï¼Œé è¨­å›æ‡‰ã€Œ422 Unprocessable Entityã€ã€‚</p><p>ç„¶è€Œï¼Œæˆ‘å€‘æœ‰æ™‚å€™éœ€è¦å›æ‡‰ã€Œ400 Bad Requestã€æˆ–åˆ¥çš„ç‹€æ…‹ç¢¼ï¼Œä»¥ç¬¦åˆ<strong>ç¾å¯¦æ¥­å‹™éœ€æ±‚</strong>æˆ–<strong>åœ˜éšŠé–‹ç™¼ç¿’æ…£</strong>ã€‚</p><p>ç¸½ä¹‹ï¼Œç„¡è«–å‡ºæ–¼ä½•ç¨®åŸå› ï¼Œæˆ‘å€‘æƒ³<strong>è‡ªè¨‚éŒ¯èª¤è¨Šæ¯ã€æ ¼å¼ï¼Œä»¥åŠå›æ‡‰çš„ç‹€æ…‹ç¢¼</strong>ï¼Œè€Œ<strong>ä¸ä½¿ç”¨</strong> Django Ninja é è¨­çš„ 422 å›æ‡‰â€”â€”ä¸å¾—ä¸èªªï¼Œé€™å€‹åˆ¶å¼å›æ‡‰çš„è³‡è¨Šæœ‰é»å¤šã€çµæ§‹æœ‰é»è¤‡é›œï¼Œå› ç‚ºå®ƒè¦å…¼å®¹å„ç¨®æƒ…æ³ã€‚</p><p>æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•<strong>è‡ªå®šç¾©éŒ¯èª¤è™•ç†èˆ‡å›æ‡‰</strong>â€”â€”ä½¿ç”¨ Django Ninja å…§å»ºçš„<code>HttpError</code>ã€‚</p><p>æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/12">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="Django-Ninja-çš„è‡ªå‹•éŒ¯èª¤è™•ç†"><a href="#Django-Ninja-çš„è‡ªå‹•éŒ¯èª¤è™•ç†" class="headerlink" title="Django Ninja çš„è‡ªå‹•éŒ¯èª¤è™•ç†"></a>Django Ninja çš„è‡ªå‹•éŒ¯èª¤è™•ç†</h2><p>ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ°ï¼Œå¦‚æœä½ åœ¨ Schema çš„é©—è­‰æ–¹æ³•ä¸­ï¼Œæ‹‹å‡º<code>ValueError</code>éŒ¯èª¤ï¼ŒDjango Ninja å°‡æœƒ<strong>è‡ªå‹•æ•æ‰ä¸¦å›æ‡‰</strong>ã€‚</p><p>äº‹å¯¦ä¸Šï¼Œä¸æ­¢<code>ValueError</code>ï¼ŒDjango Ninja é‚„æœƒæ›¿ä½ è™•ç†ä»¥ä¸‹é€™å¹¾ç¨®éŒ¯èª¤ï¼š</p><ul><li><code>pydantic.ValidationError</code>ï¼Œä¾†è‡ª Pydantic çš„é©—è­‰éŒ¯èª¤ï¼Œé€™æ˜¯<strong>ç‚ºä½•</strong>ç•¶ Schema æ¬„ä½æœ‰å•é¡Œæ™‚ï¼Œæˆ‘å€‘æœƒç›´æ¥æ”¶åˆ° 422 å›æ‡‰ã€‚</li><li>æ­¤å¤–ï¼ŒDjango Ninja é‚„å…§å»ºäº†ä¸€å€‹ <code>ninja.errors.ValidationError</code>ï¼Œé€™äº›éŒ¯èª¤åŒæ¨£æœƒè¿”å› 422ã€‚</li><li><code>ninja.errors.HttpError</code>ï¼šé€™æ˜¯æœ¬æ–‡çš„é‡é»ï¼Œä¸‹é¢æœƒä»‹ç´¹ã€‚</li></ul><p>é€™äº›éƒ½æ˜¯ Django Ninja æœƒè‡ªå‹•æ•æ‰çš„éŒ¯èª¤ï¼Œä½†ä¸æ˜¯æ¯ä¸€ç¨®éƒ½çµ¦å‡ºåˆ¶å¼çš„ 422 å›æ‡‰â€”â€”ç¬¬ä¸‰ç¨®å°±ä¸æ˜¯ã€‚</p><span id="more"></span><hr><h2 id="æ–°éœ€æ±‚ï¼šé©—è­‰å¤±æ•—æ™‚ï¼Œæ”¹ç”¨-400-å›æ‡‰"><a href="#æ–°éœ€æ±‚ï¼šé©—è­‰å¤±æ•—æ™‚ï¼Œæ”¹ç”¨-400-å›æ‡‰" class="headerlink" title="æ–°éœ€æ±‚ï¼šé©—è­‰å¤±æ•—æ™‚ï¼Œæ”¹ç”¨ 400 å›æ‡‰"></a>æ–°éœ€æ±‚ï¼šé©—è­‰å¤±æ•—æ™‚ï¼Œæ”¹ç”¨ 400 å›æ‡‰</h2><p>å¦‚æœæˆ‘å€‘å¸Œæœ› Schema é©—è­‰å¤±æ•—æ™‚ï¼Œè¦è¿”å›ã€Œ400 Bad Requestã€è€Œä¸æ˜¯ 422ï¼Œæ€éº¼åšæœ€ç°¡å–®ï¼Ÿ</p><p>ç­”ï¼šä½¿ç”¨ Django Ninja çš„<code>HttpError</code>ã€‚</p><p>ä»¥ä¸‹æ˜¯ Schema çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œåªæ”¹äº†å…©è¡Œï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">from</span> ninja.errors <span class="keyword">import</span> HttpError  <span class="comment"># ç¬¬ä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;after&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_passwords_match</span>(<span class="params">self</span>) -&gt; Self:</span><br><span class="line">        <span class="keyword">if</span> self.password != self.confirm_password:</span><br><span class="line">            <span class="keyword">raise</span> HttpError(<span class="number">400</span>, <span class="string">&#x27;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&#x27;</span>)  <span class="comment"># ç¬¬äºŒè¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure><p>æ²’éŒ¯ï¼Œå°±é€™éº¼ç°¡å–®ï¼</p><p>åªæ˜¯æŠŠé©—è­‰æ–¹æ³•æ‹‹å‡ºçš„éŒ¯èª¤ï¼Œå¾<code>ValueError</code>æ›¿æ›ç‚º<code>HttpError</code>å³å¯ã€‚</p><p>å€¼å¾—ç•™æ„çš„æ˜¯ï¼Œ<code>HttpError</code>å¯¦ä¾‹çš„<strong>åˆå§‹åŒ–</strong>ï¼Œéœ€è¦<strong>å…©å€‹åƒæ•¸</strong>ï¼Œç¬¬ä¸€å€‹æ˜¯ HTTP ç‹€æ…‹ç¢¼ï¼Œç¬¬äºŒå€‹æ‰æ˜¯éŒ¯èª¤è¨Šæ¯ã€‚</p><h3 id="å›æ‡‰å…§å®¹"><a href="#å›æ‡‰å…§å®¹" class="headerlink" title="å›æ‡‰å…§å®¹"></a>å›æ‡‰å…§å®¹</h3><p>çœ‹çœ‹åŒæ¨£çš„é©—è­‰å¤±æ•—ï¼Œå›æ‡‰æœ‰ä½•ä¸åŒï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 400 Bad Request</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è®Šæˆæˆ‘å€‘ç†Ÿæ‚‰çš„æ ¼å¼â€”â€”åªæœ‰éŒ¯èª¤è¨Šæ¯ã€‚</p><hr><h2 id="åœ¨é©—è­‰æ–¹æ³•ä¸­ä½¿ç”¨-HttpError-çš„ä¸å¦¥ä¹‹è™•"><a href="#åœ¨é©—è­‰æ–¹æ³•ä¸­ä½¿ç”¨-HttpError-çš„ä¸å¦¥ä¹‹è™•" class="headerlink" title="åœ¨é©—è­‰æ–¹æ³•ä¸­ä½¿ç”¨ HttpError çš„ä¸å¦¥ä¹‹è™•"></a>åœ¨é©—è­‰æ–¹æ³•ä¸­ä½¿ç”¨ HttpError çš„ä¸å¦¥ä¹‹è™•</h2><p>ç›´æ¥åœ¨ Schema çš„é©—è­‰æ–¹æ³•ä¸­æ‹‹å‡º<code>HttpError</code>ï¼Œæ˜¯ä¸€ç¨®ä¾¿æ·çš„æ–¹å¼ï¼Œå› ç‚ºå®ƒèƒ½å¤ <strong>ç°¡åŒ–å›æ‡‰è™•ç†</strong>ã€‚</p><p>æˆ‘å€‘<strong>ç„¡éœ€</strong>é¡å¤–æ•æ‰éŒ¯èª¤æˆ–æ‰‹å‹•æŒ‡å®šå›æ‡‰æ ¼å¼ã€‚é©—è­‰å¤±æ•—æ™‚ï¼ŒAPI æœƒ<strong>ç›´æ¥å›æ‡‰</strong>æˆ‘å€‘å®šç¾©çš„ç‹€æ…‹ç¢¼å’ŒéŒ¯èª¤è¨Šæ¯ï¼Œæ—¢ç°¡å–®åˆæ–¹ä¾¿ã€‚</p><p>ç„¶è€Œï¼Œé€™éº¼åšå…¶å¯¦<strong>ä¸¦ä¸å¦¥ç•¶</strong>ï¼Œä¸»è¦æœ‰å¹¾å€‹å•é¡Œï¼Œæ¯”å¦‚é™ä½å¯æ¸¬è©¦æ€§ã€é™åˆ¶å›æ‡‰çš„éˆæ´»æ€§ç­‰ç­‰ã€‚ä½†å…¶ä¸­<strong>æœ€é—œéµ</strong>çš„ï¼Œé‚„æ˜¯æ˜¯æˆ‘å€‘ä¸Šä¸€ç¯‡æåˆ°çš„â€”â€”ã€Œ<strong>é—œæ³¨é»åˆ†é›¢</strong>ã€ã€‚</p><h3 id="é•åã€Œé—œæ³¨é»åˆ†é›¢ã€"><a href="#é•åã€Œé—œæ³¨é»åˆ†é›¢ã€" class="headerlink" title="é•åã€Œé—œæ³¨é»åˆ†é›¢ã€"></a>é•åã€Œé—œæ³¨é»åˆ†é›¢ã€</h3><p><strong>é€™å€‹åšæ³•é•åäº†ã€Œé—œæ³¨é»åˆ†é›¢ã€åŸå‰‡ã€‚</strong></p><p>é©—è­‰é‚è¼¯çš„è·è²¬æ˜¯æª¢æŸ¥è³‡æ–™çš„æ­£ç¢ºæ€§ï¼Œè€Œ<strong>å›æ‡‰</strong>æ‡‰è©²ç”± view å‡½å¼è² è²¬ã€‚</p><p>å°‡å›æ‡‰é‚è¼¯æ··å…¥é©—è­‰éç¨‹ä¸­ï¼Œæœƒè®“é©—è­‰å’Œå›æ‡‰é€™å…©å€‹<strong>æœ¬æ‡‰ç¨ç«‹</strong>çš„éƒ¨åˆ†<strong>è€¦åˆåœ¨ä¸€èµ·</strong>ï¼Œå°è‡´<strong>è·è²¬æ··äº‚</strong>ï¼Œä¸åˆ©æ–¼ç¨‹å¼ç¢¼ç¶­è­·ã€‚</p><p>å› æ­¤ï¼Œé›–ç„¶åœ¨é©—è­‰æ–¹æ³•å…§ä½¿ç”¨<code>HttpError</code>ï¼Œçœ‹ä¼¼èƒ½å¤ æ–¹ä¾¿åœ°å¯¦ç¾éœ€æ±‚ï¼Œä½†å¾<strong>æ¶æ§‹è¨­è¨ˆ</strong>çš„è§’åº¦è€ƒæ…®ï¼Œå°‡<strong>å›æ‡‰è™•ç†</strong>æ”¾åœ¨ view å‡½å¼ä¸­ï¼Œæ‰æ˜¯ä¸€å€‹æ›´åˆç†çš„é¸æ“‡ã€‚</p><p>åˆ¥æ“”å¿ƒï¼Œä¸‹ä¸€ç¯‡æˆ‘å€‘æœƒæ›å€‹åšæ³•ï¼Œä½†æœ¬æ–‡çš„ä¸»è§’é‚„æ˜¯<code>HttpError</code>ã€‚</p><hr><h2 id="HttpError-çš„å…¸å‹æƒ…å¢ƒï¼šåœ¨-view-å‡½å¼ä¸­ä½¿ç”¨"><a href="#HttpError-çš„å…¸å‹æƒ…å¢ƒï¼šåœ¨-view-å‡½å¼ä¸­ä½¿ç”¨" class="headerlink" title="HttpError çš„å…¸å‹æƒ…å¢ƒï¼šåœ¨ view å‡½å¼ä¸­ä½¿ç”¨"></a>HttpError çš„å…¸å‹æƒ…å¢ƒï¼šåœ¨ view å‡½å¼ä¸­ä½¿ç”¨</h2><p>ç›¸æ¯”æ–¼åœ¨ Schema ä¸­ä½¿ç”¨<code>HttpError</code>ï¼ŒæŠŠå®ƒæ”¾åœ¨ view å‡½å¼è£¡åŸ·è¡Œï¼Œæ–¹ç‚ºæ­£é“ã€‚</p><p>ä»¥ä¸‹å°±æ˜¯ä¸€å€‹ç¶“å…¸å ´æ™¯ã€‚</p><p>å„˜ç®¡è³‡æ–™é©—è­‰é‚è¼¯æ‡‰ç›¡å¯èƒ½æ”¾åœ¨ Schema ä¸­ï¼Œ<strong>ä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„é©—è­‰éƒ½é©åˆä¸Ÿçµ¦ Schema åš</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œä½¿ç”¨è€…çš„ email æ¬„ä½å…·æœ‰ã€Œ<strong>å”¯ä¸€æ€§</strong>ã€â€”â€”ä¸èƒ½é‡è¤‡ã€‚æ‰€ä»¥æˆ‘å€‘å¸Œæœ›å…ˆç¢ºèªä½¿ç”¨è€…è¼¸å…¥çš„ email <strong>æ˜¯å¦å’Œ db ä¸­çš„è³‡æ–™é‡è¤‡</strong>ï¼Œæ˜¯çš„è©±ï¼Œç›´æ¥å›æ‡‰<code>409 Conflict</code>ã€‚</p><p>é€™ç„¡ç–‘ä¹Ÿæ˜¯ä¸€ç¨®<strong>é©—è­‰</strong>ï¼Œä½†å®ƒæ¶‰åŠäº†ã€Œ<strong>è³‡æ–™åº«æŸ¥è©¢</strong>ã€ã€‚</p><p>é€™ç¨®æ¶‰åŠè³‡æ–™åº«æŸ¥è©¢çš„é©—è­‰ï¼Œæ›´é©åˆåœ¨ view å‡½å¼ä¸­é€²è¡Œï¼Œè€Œä¸æ˜¯åœ¨ Schema è£¡ã€‚å› ç‚ºè³‡æ–™åº«æŸ¥è©¢å±¬æ–¼<strong>æ¯”è¼ƒé‡çš„å‹•æ…‹æ“ä½œ</strong>ï¼Œèˆ‡ Schema çš„<strong>éœæ…‹è³‡æ–™æª¢æŸ¥</strong>æœ‰è‘—<strong>æœ¬è³ªçš„ä¸åŒ</strong>ã€‚</p><p>å› æ­¤ï¼Œæˆ‘å€‘æ›´å¸¸åœ¨ view å‡½å¼ä¸­ä½¿ç”¨<code>HttpError</code>è™•ç†é€™é¡éœ€æ±‚ã€‚</p><p>æ–°å¢ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params">...</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">..., payload: CreateUserRequest</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ–°å¢ä½¿ç”¨è€…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> User.objects.<span class="built_in">filter</span>(email=payload.email).exists():</span><br><span class="line">        <span class="keyword">raise</span> HttpError(<span class="number">409</span>, <span class="string">&#x27;ä½¿ç”¨è€… email å·²å­˜åœ¨&#x27;</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ã€Œé å…ˆæŸ¥è©¢ã€ï¼Œå’Œä¸‹é¢é€™å€‹å¯«æ³•ï¼Œåœ¨çµæœä¸Šæ˜¯é¡ä¼¼çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user.save()</span><br><span class="line"><span class="keyword">except</span> IntegrityError:  <span class="comment"># Django ORM å”¯ä¸€æ€§éŒ¯èª¤</span></span><br><span class="line">    <span class="keyword">raise</span> HttpError(<span class="number">409</span>, <span class="string">&#x27;ä½¿ç”¨è€… email å·²å­˜åœ¨&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åªä¸éä¸€å€‹æ˜¯<strong>äº‹å‰é©—è­‰ä¸¦æ‹‹å‡ºéŒ¯èª¤</strong>ï¼Œä¸€å€‹æ˜¯<strong>äº‹å¾Œæ•æ‰éŒ¯èª¤</strong>ï¼ˆç„¶å¾Œå†æ‹‹å‡ºï¼‰ã€‚</p><p>é©—è­‰å¤±æ•—çš„å›æ‡‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 409 Conflict</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½¿ç”¨è€… email å·²å­˜åœ¨&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¢ºå¯¦é‚„ä¸éŒ¯ï¼</p><hr><h2 id="ç‚ºä»€éº¼ä¸ç›´æ¥-return-409-å›æ‡‰å°±å¥½ï¼Ÿ"><a href="#ç‚ºä»€éº¼ä¸ç›´æ¥-return-409-å›æ‡‰å°±å¥½ï¼Ÿ" class="headerlink" title="ç‚ºä»€éº¼ä¸ç›´æ¥ return 409 å›æ‡‰å°±å¥½ï¼Ÿ"></a>ç‚ºä»€éº¼ä¸ç›´æ¥ return 409 å›æ‡‰å°±å¥½ï¼Ÿ</h2><p>è°æ˜çš„ä½ å¯èƒ½æœƒæƒ³åˆ°ï¼š</p><blockquote><p>å’¦ï¼Œé‚£æˆ‘<strong>ä½•ä¸ç›´æ¥ return</strong> ä¸€å€‹å¸¶æœ‰éŒ¯èª¤è¨Šæ¯çš„ Python å­—å…¸å°±å¥½äº†ï¼Ÿç‚ºä»€éº¼éå¾—åœ¨ view å‡½å¼ä¸­<code>raise HttpError</code>ï¼Ÿ</p></blockquote><p>é€™å€‹æƒ³æ³•ï¼Œå¤§æ¦‚çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&#x27;/users/&#x27;</span>, response=&#123;<span class="number">201</span>: <span class="built_in">dict</span>, <span class="number">409</span>: <span class="built_in">dict</span>&#125;, ...</span>)</span></span><br><span class="line"><span class="keyword">def</span> (...) -&gt; <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ–°å¢ä½¿ç”¨è€…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> User.objects.<span class="built_in">filter</span>(email=payload.email).exists():</span><br><span class="line">        <span class="keyword">return</span> <span class="number">409</span>, &#123;<span class="string">&quot;detail&quot;</span>: <span class="string">&quot;ä½¿ç”¨è€… email å·²å­˜åœ¨&quot;</span>&#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>é€™æ¨£ä¸æ˜¯<strong>æ›´åŠ ç›´è§€</strong>å—ï¼Ÿ</p><p>é€™æ˜¯ä¸€å€‹<strong>å¥½å•é¡Œ</strong>ã€‚</p><h3 id="é‡é»è§£æ"><a href="#é‡é»è§£æ" class="headerlink" title="é‡é»è§£æ"></a>é‡é»è§£æ</h3><p>æˆ‘å€‘é‚„æ˜¯å…ˆä¾†çœ‹ä¸€ä¸‹ï¼Œé€™æ®µç¨‹å¼ç¢¼ä¸­æœ‰å“ªäº›é‡é»ï¼š</p><ul><li><code>response=&#123;201: dict, 409: dict&#125;</code>ï¼šç¬¬ 13 ç¯‡æéçš„ã€Œ<strong>å¤šé‡ç‹€æ…‹ç¢¼å›æ‡‰</strong>ã€ï¼Œé€™ä¸å°±æ´¾ä¸Šç”¨å ´äº†ï¼</li><li>ç”¨<code>return</code>å–ä»£<code>raise</code>ã€‚</li><li>å¦‚æœæƒ³é©—è­‰éŒ¯èª¤è¨Šæ¯æ ¼å¼ï¼Œå¯ä»¥å®šç¾©ä¸€å€‹ Schemaã€‚é€™å€‹ä¾‹å­åªæ˜¯ç°¡åŒ–ç‰ˆã€‚</li></ul><p>çœ‹èµ·ä¾†ç¢ºå¯¦ä¸éŒ¯ï¼Œä¹Ÿå¾ˆç¬¦åˆç›´è¦ºï¼Œå…¶å¯¦æˆ‘ä»¥å‰å¯« Django REST frameworkï¼Œ<strong>éƒ½æ˜¯</strong>é€™æ¨£å¯«çš„ã€‚</p><p><strong>å¯æ˜¯</strong>ï¼Œé€™å€‹å¯«æ³•åœ¨ Django Ninja ä¸­ï¼Œä½¿ç”¨ã€Œåˆ†é è£é£¾å™¨ã€æ™‚ï¼Œå°±æœƒ<strong>è¸¢åˆ°éµæ¿</strong>äº†ã€‚</p><p>ç›®å‰æ™‚æ©Ÿæœªåˆ°ï¼Œåœ¨å¾ŒçºŒçš„ã€ˆå· 25ï¼šåˆ†é ï¼ˆä¸‹ï¼‰è‡ªå®šç¾©åˆ†é é¡åˆ¥ã€‰ä¸­ï¼Œæˆ‘å€‘å†æŠŠé€™ä»¶äº‹èªªæ¸…æ¥šã€‚</p><p>ç¸½ä¹‹ï¼Œç¾éšæ®µæˆ‘å€‘åªè¦çŸ¥é“ï¼Œé¡ä¼¼æƒ…æ³é‚„æ˜¯<code>raise HttpError</code>æœƒæ¯”è¼ƒå¦¥ç•¶ã€‚</p><hr><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>åœ¨é€™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•ä½¿ç”¨ Django Ninja å…§å»ºçš„<code>HttpError</code>ä¾†è‡ªå®šç¾©éŒ¯èª¤å›æ‡‰ï¼Œä»¥é¿å…é è¨­çš„ 422ã€‚</p><p>ä¸¦è§£é‡‹äº†ç‚ºä½•<code>HttpError</code>ä¸é©åˆç”¨åœ¨ Schema ä¸­ï¼ˆé›–ç„¶æˆ‘å€‘æš«æ™‚é€™éº¼åšäº†ğŸ˜…ï¼‰ï¼Œè€Œæ˜¯æ‡‰è©²æ”¾åˆ° view å‡½å¼è£¡ã€‚</p><p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘å€‘å°‡æ”¹å–„ Schema æ‹‹å‡ºçš„éŒ¯èª¤ã€æ¢è¨å…¨åŸŸéŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œä¸¦ä¸”ä½¿ç”¨ Django Ninja æ‰€æä¾›çš„<code>exception_handler</code>è£é£¾å™¨ï¼Œé€²ä¸€æ­¥æå‡ API çš„éŒ¯èª¤è™•ç†èƒ½åŠ›ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è»Ÿé«”é–‹ç™¼ä¸­ï¼Œ&lt;strong&gt;éŒ¯èª¤è™•ç†&lt;/strong&gt;æ˜¯ä¸€å€‹ä¸å®¹å¿½è¦–â€”â€”ä½†&lt;strong&gt;å¸¸å¸¸è¢«å¿½è¦–&lt;/strong&gt;â€”â€”çš„ç’°ç¯€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸èª‡å¼µåœ°èªªï¼ŒéŒ¯èª¤è™•ç†æ˜¯ä¸€å€‹ã€Œ&lt;strong&gt;åšå¾—å¥½æ²’äººèª‡ï¼Œåšä¸å¥½ç³»çµ±å°±æ…˜å…®å…®&lt;/strong&gt;ã€çš„è­°é¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ²’é—œä¿‚ï¼Œæˆ‘å€‘é‚„æ˜¯&lt;strong&gt;ç›¡å¯èƒ½æŠŠè‡ªå·±åšå¥½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Django Ninja ä½¿ç”¨ Pydantic é€²è¡Œè³‡æ–™é©—è­‰ï¼Œå¤±æ•—æ™‚ï¼Œé è¨­å›æ‡‰ã€Œ422 Unprocessable Entityã€ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘å€‘æœ‰æ™‚å€™éœ€è¦å›æ‡‰ã€Œ400 Bad Requestã€æˆ–åˆ¥çš„ç‹€æ…‹ç¢¼ï¼Œä»¥ç¬¦åˆ&lt;strong&gt;ç¾å¯¦æ¥­å‹™éœ€æ±‚&lt;/strong&gt;æˆ–&lt;strong&gt;åœ˜éšŠé–‹ç™¼ç¿’æ…£&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç¸½ä¹‹ï¼Œç„¡è«–å‡ºæ–¼ä½•ç¨®åŸå› ï¼Œæˆ‘å€‘æƒ³&lt;strong&gt;è‡ªè¨‚éŒ¯èª¤è¨Šæ¯ã€æ ¼å¼ï¼Œä»¥åŠå›æ‡‰çš„ç‹€æ…‹ç¢¼&lt;/strong&gt;ï¼Œè€Œ&lt;strong&gt;ä¸ä½¿ç”¨&lt;/strong&gt; Django Ninja é è¨­çš„ 422 å›æ‡‰â€”â€”ä¸å¾—ä¸èªªï¼Œé€™å€‹åˆ¶å¼å›æ‡‰çš„è³‡è¨Šæœ‰é»å¤šã€çµæ§‹æœ‰é»è¤‡é›œï¼Œå› ç‚ºå®ƒè¦å…¼å®¹å„ç¨®æƒ…æ³ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•&lt;strong&gt;è‡ªå®šç¾©éŒ¯èª¤è™•ç†èˆ‡å›æ‡‰&lt;/strong&gt;â€”â€”ä½¿ç”¨ Django Ninja å…§å»ºçš„&lt;code&gt;HttpError&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/12&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;Django-Ninja-çš„è‡ªå‹•éŒ¯èª¤è™•ç†&quot;&gt;&lt;a href=&quot;#Django-Ninja-çš„è‡ªå‹•éŒ¯èª¤è™•ç†&quot; class=&quot;headerlink&quot; title=&quot;Django Ninja çš„è‡ªå‹•éŒ¯èª¤è™•ç†&quot;&gt;&lt;/a&gt;Django Ninja çš„è‡ªå‹•éŒ¯èª¤è™•ç†&lt;/h2&gt;&lt;p&gt;ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ°ï¼Œå¦‚æœä½ åœ¨ Schema çš„é©—è­‰æ–¹æ³•ä¸­ï¼Œæ‹‹å‡º&lt;code&gt;ValueError&lt;/code&gt;éŒ¯èª¤ï¼ŒDjango Ninja å°‡æœƒ&lt;strong&gt;è‡ªå‹•æ•æ‰ä¸¦å›æ‡‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼Œä¸æ­¢&lt;code&gt;ValueError&lt;/code&gt;ï¼ŒDjango Ninja é‚„æœƒæ›¿ä½ è™•ç†ä»¥ä¸‹é€™å¹¾ç¨®éŒ¯èª¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pydantic.ValidationError&lt;/code&gt;ï¼Œä¾†è‡ª Pydantic çš„é©—è­‰éŒ¯èª¤ï¼Œé€™æ˜¯&lt;strong&gt;ç‚ºä½•&lt;/strong&gt;ç•¶ Schema æ¬„ä½æœ‰å•é¡Œæ™‚ï¼Œæˆ‘å€‘æœƒç›´æ¥æ”¶åˆ° 422 å›æ‡‰ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼ŒDjango Ninja é‚„å…§å»ºäº†ä¸€å€‹ &lt;code&gt;ninja.errors.ValidationError&lt;/code&gt;ï¼Œé€™äº›éŒ¯èª¤åŒæ¨£æœƒè¿”å› 422ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ninja.errors.HttpError&lt;/code&gt;ï¼šé€™æ˜¯æœ¬æ–‡çš„é‡é»ï¼Œä¸‹é¢æœƒä»‹ç´¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€™äº›éƒ½æ˜¯ Django Ninja æœƒè‡ªå‹•æ•æ‰çš„éŒ¯èª¤ï¼Œä½†ä¸æ˜¯æ¯ä¸€ç¨®éƒ½çµ¦å‡ºåˆ¶å¼çš„ 422 å›æ‡‰â€”â€”ç¬¬ä¸‰ç¨®å°±ä¸æ˜¯ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 20ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸‹ï¼‰Pydantic model_validator å¯¦ç¾ã€Œè·¨æ¬„ä½ã€é©—è­‰</title>
    <link href="https://blog.kyomind.tw/django-ninja-20/"/>
    <id>https://blog.kyomind.tw/django-ninja-20/</id>
    <published>2024-10-02T03:31:23.000Z</published>
    <updated>2024-10-07T15:26:42.181Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p>ä¸Šä¸€ç¯‡æˆ‘å€‘è¬›å®Œäº†å–®ä¸€æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰ï¼Œé€™ç¯‡å‰‡è¦ä¾†è¨è«–<strong>è·¨æ¬„ä½</strong>ä¹‹é–“çš„é©—è­‰ã€‚</p><p>è·¨æ¬„ä½é©—è­‰åŒæ¨£æ˜¯ API é–‹ç™¼ä¸­ååˆ†å¸¸è¦‹çš„éœ€æ±‚ï¼Œä¾‹å¦‚è¨»å†Šå¸³è™Ÿæ™‚ï¼Œè¦ä¿è­‰ã€Œå¯†ç¢¼ã€èˆ‡ã€Œç¢ºèªå¯†ç¢¼ã€å…©å€‹æ¬„ä½å…§å®¹ç›¸åŒï¼›é¸æ“‡<strong>æ—¥æœŸæœŸé–“</strong>æ™‚ï¼Œé–‹å§‹æ—¥æœŸä¸èƒ½æ™šæ–¼çµæŸæ—¥æœŸç­‰ã€‚</p><p>é€™äº›é©—è­‰å ´æ™¯<strong>ç„¡æ³•</strong>é€éå–®ä¸€æ¬„ä½é©—è­‰å¯¦ç¾ï¼Œå› ç‚ºå®ƒå€‘éœ€è¦åŒæ™‚æª¢æŸ¥<strong>å¤šå€‹æ¬„ä½ä¹‹é–“çš„é‚è¼¯é—œè¯</strong>ï¼Œä¾†ç¢ºä¿æ•´é«”è³‡æ–™çš„<strong>ä¸€è‡´æ€§å’Œæ­£ç¢ºæ€§</strong>ã€‚</p><p>æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•é€é Pydantic ä¾†å¯¦ç¾è·¨æ¬„ä½é©—è­‰éœ€æ±‚â€”â€”ä»¥ã€Œç¢ºèªå¯†ç¢¼ã€ç‚ºä¾‹ï¼Œå±•ç¤ºé€™å€‹åŠŸèƒ½çš„å¯¦éš›æ‡‰ç”¨ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/11">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢"><a href="#è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢" class="headerlink" title="è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢"></a>è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢</h2><p>å…¶å¯¦ï¼Œç„¡è«–æ˜¯å–®ä¸€æ¬„ä½é‚„æ˜¯è·¨æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰ï¼Œéƒ½<strong>ä¸ä¸€å®š</strong>è¦è—‰ç”± Pydantic ä¾†å®Œæˆã€‚</p><p>ç†è«–ä¸Šï¼Œè³‡æ–™é©—è­‰å¯ä»¥<strong>ç›´æ¥</strong>åœ¨ view å‡½å¼ä¸­é€²è¡Œï¼Œä¾‹å¦‚å–å‡ºè¼¸å…¥çš„æ¬„ä½å€¼ï¼Œæ‰‹å‹•é©—è­‰å®ƒçš„åˆæ³•æ€§ã€‚è·¨æ¬„ä½é©—è­‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>ç„¶è€Œï¼Œé€™æ˜¯ä¸€ç¨®æ–¹ä¾¿ä½†ã€Œ<strong>ç²—ç³™</strong>ã€çš„åšæ³•â€”â€”åªé©åˆç”¨åœ¨é©—è­‰é‚è¼¯éå¸¸å–®ç´”çš„æƒ…æ³ã€‚</p><p>é€é Pydantic é€²è¡Œè³‡æ–™é©—è­‰ï¼Œå‰‡èƒ½å¤ å¸¶ä¾†ä¸€å€‹æ˜é¡¯çš„å¥½è™•ï¼š<strong>é—œæ³¨é»åˆ†é›¢</strong>ã€‚</p><span id="more"></span><h3 id="é—œæ³¨é»åˆ†é›¢"><a href="#é—œæ³¨é»åˆ†é›¢" class="headerlink" title="é—œæ³¨é»åˆ†é›¢"></a>é—œæ³¨é»åˆ†é›¢</h3><p><a href="https://zh.wikipedia.org/zh-tw/%E5%85%B3%E6%B3%A8%E7%82%B9%E5%88%86%E7%A6%BB">é—œæ³¨é»åˆ†é›¢</a>ï¼ˆSeparation of Concernsï¼‰æ˜¯ä¸€ç¨®<strong>è¨­è¨ˆåŸå‰‡</strong>ã€‚ä¸»å¼µå°‡ç¨‹å¼ä¸­ä¸åŒåŠŸèƒ½çš„è·è²¬åŠƒåˆ†åˆ°<strong>ç¨ç«‹</strong>çš„æ¨¡çµ„æˆ–å±¤æ¬¡ä¸­ã€‚</p><p>æ¯å€‹æ¨¡çµ„ä¸»è¦<strong>å°ˆæ³¨æ–¼ä¸€å€‹å…·é«”çš„æ–¹å‘æˆ–ç›®æ¨™</strong>ï¼Œå¾è€Œ<strong>é¿å…æŠŠå¤šå€‹ä¸åŒçš„åŠŸèƒ½è€¦åˆ</strong>åœ¨ä¸€èµ·ã€‚é€™æ¨£çš„åŠƒåˆ†å¯ä»¥è®“ç¨‹å¼æ›´æ˜“æ–¼æ¸¬è©¦ã€ç¶­è­·å’Œæ“´å……ã€‚</p><p>ä¾ç…§é—œæ³¨é»åˆ†é›¢ï¼Œ<strong>è³‡æ–™é©—è­‰</strong>çš„é‚è¼¯æ‡‰è©²é›†ä¸­åœ¨ Schemaï¼Œè€Œä¸æ˜¯åœ¨ view å‡½å¼ä¸­é€²è¡Œã€‚</p><p>å¦‚æ­¤ä¸€ä¾†ï¼Œview å¯ä»¥<strong>å°ˆæ³¨æ–¼è™•ç†æ ¸å¿ƒæ¥­å‹™é‚è¼¯</strong>ï¼Œè€Œå°‡è³‡æ–™é©—è­‰äº¤ç”±å°ˆé–€çš„å…ƒä»¶è² è²¬ã€‚</p><p>é€é Pydantic çš„é©—è­‰æ©Ÿåˆ¶ï¼Œæˆ‘å€‘å¯ä»¥å¯¦ç¾é—œæ³¨é»åˆ†é›¢ï¼Œè®“è³‡æ–™é©—è­‰èˆ‡æ¥­å‹™é‚è¼¯åˆ†é–‹ï¼Œé€™ä¸åƒ…æå‡äº†ç¨‹å¼ç¢¼çš„çµæ§‹ï¼Œä¹Ÿè®“é–‹ç™¼æµç¨‹æ›´åŠ æ¸…æ¥šã€ç©©å®šã€‚</p><hr><h2 id="æ–°éœ€æ±‚ï¼šç¢ºèªå¯†ç¢¼"><a href="#æ–°éœ€æ±‚ï¼šç¢ºèªå¯†ç¢¼" class="headerlink" title="æ–°éœ€æ±‚ï¼šç¢ºèªå¯†ç¢¼"></a>æ–°éœ€æ±‚ï¼šç¢ºèªå¯†ç¢¼</h2><p>æˆ‘å€‘è¦å¯¦ä½œä¸€å€‹éå¸¸ç°¡å–®ï¼Œä½†è¶³ä»¥<strong>å……åˆ†èªªæ˜</strong>è·¨æ¬„ä½é©—è­‰åƒ¹å€¼çš„åŠŸèƒ½ï¼š<strong>ç¢ºèªå¯†ç¢¼</strong>ã€‚</p><p>å…ˆå›é¡§ä¸Šä¸€ç¯‡çµæŸæ™‚ï¼Œã€Œæ–°å¢ä½¿ç”¨è€…ã€API çš„è«‹æ±‚ Schema å…§å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    username: <span class="built_in">str</span> = Field(examples=[<span class="string">&#x27;Alice&#x27;</span>])</span><br><span class="line">    email: <span class="built_in">str</span> = Field(examples=[<span class="string">&#x27;alice@example.com&#x27;</span>])</span><br><span class="line">    password: <span class="built_in">str</span> = Field(min_length=<span class="number">8</span>, examples=[<span class="string">&#x27;password123&#x27;</span>])</span><br><span class="line">    bio: <span class="built_in">str</span> | <span class="literal">None</span> = Field(</span><br><span class="line">        default=<span class="literal">None</span>, examples=[<span class="string">&#x27;Hello, I am Alice.&#x27;</span>])</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>é€™å€‹ Schema çš„è¨­è¨ˆï¼Œé¡¯ç„¶<strong>æœ‰æ‰€ä¸è¶³</strong>ã€‚</p><p>å› ç‚ºç”¨æˆ¶è¨»å†Šæ™‚ï¼Œå¯†ç¢¼é€šå¸¸éœ€è¦<strong>è¼¸å…¥å…©æ¬¡</strong>ï¼Œç¬¬äºŒæ¬¡çš„ä½œç”¨æ˜¯ã€Œ<strong>ç¢ºèª</strong>ã€â€”â€”é‡è¦çš„äº‹æƒ…èªªå…©æ¬¡å˜›ï¼</p><p>æ‰€ä»¥ï¼Œæˆ‘å€‘è¦æ–°å¢ä¸€å€‹<code>confirm_password</code>æ¬„ä½ï¼Œå’Œ<code>password</code>é€²è¡Œ<strong>è·¨æ¬„ä½é©—è­‰ï¼šç¢ºèªå…©è€…å…§å®¹ç›¸åŒ</strong>ã€‚</p><p>å„˜ç®¡å…¶ä¸­çš„é©—è­‰é‚è¼¯éå¸¸ç°¡å–®ï¼Œä½†é€™æ­£æ˜¯è·¨æ¬„ä½é©—è­‰çš„<strong>çµ•ä½³èˆå°</strong>ã€‚</p><hr><h2 id="å¯¦ä½œè·¨æ¬„ä½é©—è­‰ï¼šä½¿ç”¨-model-validator"><a href="#å¯¦ä½œè·¨æ¬„ä½é©—è­‰ï¼šä½¿ç”¨-model-validator" class="headerlink" title="å¯¦ä½œè·¨æ¬„ä½é©—è­‰ï¼šä½¿ç”¨ model_validator"></a>å¯¦ä½œè·¨æ¬„ä½é©—è­‰ï¼šä½¿ç”¨ model_validator</h2><p>Pydantic v2 å¼•å…¥äº†<code>@model_validator</code>è£é£¾å™¨ä¾†è™•ç†è·¨æ¬„ä½é©—è­‰ï¼Œé€™æ˜¯å° Pydantic v1 ä¸­<code>@root_validator</code>çš„æ”¹é€²å’Œæ›¿ä»£ã€‚</p><p>é€™è£¡çš„ modelï¼ŒæŒ‡çš„æ˜¯ Pydantic çš„ <a href="https://docs.pydantic.dev/latest/api/base_model/">BaseModel</a>â€”â€”ä¹Ÿå°±æ˜¯æˆ‘å€‘çš„ Schemaï¼Œè€Œä¸æ˜¯ Django çš„ <a href="https://docs.djangoproject.com/en/5.1/topics/db/models/">Models</a>ã€‚</p><p>æˆ‘å€‘é€é<code>@model_validator</code>ä¾†å¼·åŒ–ã€Œæ–°å¢ä½¿ç”¨è€…ã€APIï¼ŒåŠ ä¸Šã€Œç¢ºèªå¯†ç¢¼ã€åŠŸèƒ½ã€‚</p><p>ç›´æ¥çœ‹ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    ...</span><br><span class="line">    password: <span class="built_in">str</span> = Field(min_length=<span class="number">8</span>, examples=[<span class="string">&#x27;password123&#x27;</span>])</span><br><span class="line">    confirm_password: <span class="built_in">str</span> = Field(</span><br><span class="line">        min_length=<span class="number">8</span>, examples=[<span class="string">&#x27;password123&#x27;</span>])</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @model_validator(<span class="params">mode=<span class="string">&#x27;after&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_passwords_match</span>(<span class="params">self</span>) -&gt; Self:</span><br><span class="line">        <span class="keyword">if</span> self.password != self.confirm_password:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br></pre></td></tr></table></figure><h3 id="é‡é»è§£æ"><a href="#é‡é»è§£æ" class="headerlink" title="é‡é»è§£æ"></a>é‡é»è§£æ</h3><ul><li>æ–°å¢äº†ä¸€å€‹<code>confirm_password</code>æ¬„ä½ã€‚</li><li>ä½¿ç”¨<code>@model_validator(mode=&#39;after&#39;)</code>è£é£¾å™¨ä¾†å®šç¾©è·¨æ¬„ä½çš„é©—è­‰æ–¹æ³•ã€‚<ul><li><code>mode</code>ç¸½å…±æœ‰ä¸‰ç¨®ï¼šbeforeã€after å’Œ wrapã€‚å…¶ä¸­çš„ç´°ç¯€é —å¤šï¼Œé™æ–¼ç¯‡å¹…ï¼Œæœ¬æ–‡ç„¡æ³•å±•é–‹ï¼ˆå¯èƒ½ç­‰ç•ªå¤–ç¯‡å†è¡Œè£œå……ï¼‰ã€‚</li><li>ä½ åªè¦çŸ¥é“ï¼Œ<strong>å¤§éƒ¨åˆ†æ™‚å€™æ˜¯ç”¨ after æ¨¡å¼</strong>ï¼Œæ­¤æ™‚çš„é©—è­‰æ–¹æ³•æ˜¯ä¸€å€‹ã€Œ<strong>å¯¦ä¾‹æ–¹æ³•</strong>ã€ï¼Œ<code>self</code>åƒæ•¸ä»£è¡¨ Schema å¯¦ä¾‹æœ¬èº«ï¼ˆå¾ input è³‡æ–™åˆå§‹åŒ–è€Œä¾†ï¼‰ã€‚</li></ul></li><li>é©—è­‰æ–¹æ³•<code>check_passwords_match</code>æ¯”è¼ƒ<code>password</code>å’Œ<code>confirm_password</code>æ¬„ä½ï¼Œå¦‚æœæ¬„ä½å…§å®¹ä¸ç›¸åŒï¼Œå‰‡æ‹‹å‡º<code>ValueError</code>ã€‚<ul><li>å¦‚å‰æ‰€è¿°ï¼Œå„˜ç®¡é‚è¼¯éå¸¸ç°¡å–®ï¼Œä½†å®ƒç¢ºå¯¦ç¾äº†<strong>å…©å€‹æ¬„ä½ä¹‹é–“</strong>çš„é©—è­‰ã€‚</li></ul></li><li>è·¨æ¬„ä½é©—è­‰åœ¨<strong>æ‰€æœ‰å–®ä¸€æ¬„ä½é©—è­‰å®Œæˆå¾Œ</strong>æ‰æœƒåŸ·è¡Œã€‚</li></ul><h3 id="é—œæ³¨é»åˆ†é›¢çš„å¯¦éš›æ‡‰ç”¨"><a href="#é—œæ³¨é»åˆ†é›¢çš„å¯¦éš›æ‡‰ç”¨" class="headerlink" title="é—œæ³¨é»åˆ†é›¢çš„å¯¦éš›æ‡‰ç”¨"></a>é—œæ³¨é»åˆ†é›¢çš„å¯¦éš›æ‡‰ç”¨</h3><p>ä½ æœƒç™¼ç¾ï¼Œåœ¨é€™æ¬¡æ–°å¢ã€Œç¢ºèªå¯†ç¢¼ã€çš„åŠŸèƒ½å¯¦ä½œä¸­ï¼Œview å‡½å¼<strong>å®Œå…¨æ²’æœ‰è®Šå‹•</strong>ï¼â€”â€”é€™æ­£æ˜¯é—œæ³¨é»åˆ†é›¢åŸå‰‡çš„é«”ç¾ã€‚</p><p>ç›¸è¼ƒæ–¼ç›´æ¥åœ¨ view å‡½å¼ä¸­å¯¦ä½œé©—è­‰é‚è¼¯ï¼ˆéœ€è¦åŒæ™‚ä¿®æ”¹ view å’Œ Schemaï¼‰ï¼Œé€™æ¨£çš„å¯¦ä½œæ–¹å¼ç„¡ç–‘æ›´åŠ ä¹¾æ·¨ã€è§£è€¦ã€‚</p><hr><h2 id="é©—è­‰å¤±æ•—æ™‚çš„-HTTP-å›æ‡‰"><a href="#é©—è­‰å¤±æ•—æ™‚çš„-HTTP-å›æ‡‰" class="headerlink" title="é©—è­‰å¤±æ•—æ™‚çš„ HTTP å›æ‡‰"></a>é©—è­‰å¤±æ•—æ™‚çš„ HTTP å›æ‡‰</h2><p>æœ€å¾Œï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ï¼Œç•¶è³‡æ–™é©—è­‰å¤±æ•—æ™‚ï¼Œæœƒå¾—åˆ°ä»€éº¼æ¨£çš„ HTTP å›æ‡‰ã€‚</p><h3 id="é•åå¯†ç¢¼é•·åº¦é™åˆ¶"><a href="#é•åå¯†ç¢¼é•·åº¦é™åˆ¶" class="headerlink" title="é•åå¯†ç¢¼é•·åº¦é™åˆ¶"></a>é•åå¯†ç¢¼é•·åº¦é™åˆ¶</h3><p>å›æ‡‰çµæœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string_too_short&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;body&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;payload&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;password&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String should have at least 8 characters&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;min_length&quot;</span><span class="punctuation">:</span> <span class="number">8</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>é€™æ˜¯ Django Ninja æ•æ‰ Pydantic é©—è­‰éŒ¯èª¤æ‰€çµ¦å‡ºçš„ã€Œç³»çµ±ç´šã€å›æ‡‰ï¼Œç‹€æ…‹ç¢¼ç‚º 422ã€‚</p><h3 id="é•åã€Œå¿…é ˆåŒ…å«æ•¸å­—ã€è¦å‰‡ã€ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´"><a href="#é•åã€Œå¿…é ˆåŒ…å«æ•¸å­—ã€è¦å‰‡ã€ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´" class="headerlink" title="é•åã€Œå¿…é ˆåŒ…å«æ•¸å­—ã€è¦å‰‡ã€ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´"></a>é•åã€Œå¿…é ˆåŒ…å«æ•¸å­—ã€è¦å‰‡ã€ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´</h3><p>è¼¸å…¥çš„å¯†ç¢¼ä¸­æ²’æœ‰æ•¸å­—ï¼Œå›æ‡‰çµæœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value_error&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;body&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;payload&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;password&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Value error, å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¥½åƒ<strong>å·®ä¸å¤š</strong>è€¶ï¼Ÿæ²’éŒ¯ï¼Œå› ç‚ºé€™ä¹Ÿæ˜¯ Django Ninja çš„<strong>è‡ªå‹•å›æ‡‰æ ¼å¼</strong>â€”â€”é™¤äº†éŒ¯èª¤è¨Šæ¯ä¸­<strong>åŒ…å«</strong>æˆ‘å€‘è‡ªå®šç¾©çš„å…§å®¹ã€‚</p><p>ä½†äº‹å¯¦ä¸Šï¼Œé€™æ˜¯å› ç‚ºæˆ‘å€‘åœ¨é©—è­‰æ–¹æ³•ä¸­æ‹‹å‡ºçš„æ˜¯<code>ValueError</code>ï¼Œæ‰€ä»¥ Django Ninja æœƒè‡ªå‹•å¹«ä½ è™•ç†ã€‚</p><p>é¡ä¼¼çš„å›æ‡‰ä¹Ÿç™¼ç”Ÿåœ¨<strong>ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´</strong>æ™‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value_error&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;body&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;payload&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Value error, å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ctx&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼å¿…é ˆç›¸åŒ&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>é‚£å¦‚æœæ‹‹å‡ºçš„<strong>åˆ¥ç¨®éŒ¯èª¤</strong>ï¼Œæ¯”å¦‚ Django çš„<code>ValidationError</code>ï¼Œç”šè‡³æ˜¯æˆ‘å€‘<strong>è‡ªå·±å®šç¾©çš„éŒ¯èª¤</strong>ï¼ŒDjango Ninja é‚„æœƒè‡ªå‹•è™•ç†å—ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸æœƒ</strong>ã€‚</p><p>ä½ æœƒå¾—åˆ°ã€Œ<strong>500 Internal Server Error</strong>ã€â€”â€”é€™å°‡æ˜¯æˆ‘å€‘ä¸‹ä¸‹ç¯‡çš„é‡é»ã€‚</p><hr><h2 id="å°çµèˆ‡ä¸‹ä¸€æ­¥"><a href="#å°çµèˆ‡ä¸‹ä¸€æ­¥" class="headerlink" title="å°çµèˆ‡ä¸‹ä¸€æ­¥"></a>å°çµèˆ‡ä¸‹ä¸€æ­¥</h2><p>æœ¬æ–‡ä¸­ï¼Œæˆ‘å€‘ä»‹ç´¹äº†å¦‚ä½•é€é<code>@model_validator</code>ä¾†å¯¦ç¾è·¨æ¬„ä½é©—è­‰çš„éœ€æ±‚ï¼ŒåŒæ™‚è½å¯¦é—œæ³¨é»åˆ†é›¢åŸå‰‡ã€‚</p><p>å­¸ç¿’å®Œé€™å…©ç¯‡ä»¥å¾Œï¼Œä½ å° <strong>Django Ninja è³‡æ–™é©—è­‰</strong>çš„äº†è§£ï¼Œå·²ç¶“è¶…è¶Šå¤§éƒ¨åˆ†äººã€‚</p><p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°‡æ·±å…¥æ¢è¨ï¼Œç•¶è³‡æ–™é©—è­‰å¤±æ•—æ™‚ï¼Œè¦å¦‚ä½•å„ªé›…åœ°è™•ç†éŒ¯èª¤â€”â€”ä¸¦å›æ‡‰ï¼Œä»¥æå‡ API çš„ä½¿ç”¨é«”é©—ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æˆ‘å€‘è¬›å®Œäº†å–®ä¸€æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰ï¼Œé€™ç¯‡å‰‡è¦ä¾†è¨è«–&lt;strong&gt;è·¨æ¬„ä½&lt;/strong&gt;ä¹‹é–“çš„é©—è­‰ã€‚&lt;/p&gt;
&lt;p&gt;è·¨æ¬„ä½é©—è­‰åŒæ¨£æ˜¯ API é–‹ç™¼ä¸­ååˆ†å¸¸è¦‹çš„éœ€æ±‚ï¼Œä¾‹å¦‚è¨»å†Šå¸³è™Ÿæ™‚ï¼Œè¦ä¿è­‰ã€Œå¯†ç¢¼ã€èˆ‡ã€Œç¢ºèªå¯†ç¢¼ã€å…©å€‹æ¬„ä½å…§å®¹ç›¸åŒï¼›é¸æ“‡&lt;strong&gt;æ—¥æœŸæœŸé–“&lt;/strong&gt;æ™‚ï¼Œé–‹å§‹æ—¥æœŸä¸èƒ½æ™šæ–¼çµæŸæ—¥æœŸç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é€™äº›é©—è­‰å ´æ™¯&lt;strong&gt;ç„¡æ³•&lt;/strong&gt;é€éå–®ä¸€æ¬„ä½é©—è­‰å¯¦ç¾ï¼Œå› ç‚ºå®ƒå€‘éœ€è¦åŒæ™‚æª¢æŸ¥&lt;strong&gt;å¤šå€‹æ¬„ä½ä¹‹é–“çš„é‚è¼¯é—œè¯&lt;/strong&gt;ï¼Œä¾†ç¢ºä¿æ•´é«”è³‡æ–™çš„&lt;strong&gt;ä¸€è‡´æ€§å’Œæ­£ç¢ºæ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•é€é Pydantic ä¾†å¯¦ç¾è·¨æ¬„ä½é©—è­‰éœ€æ±‚â€”â€”ä»¥ã€Œç¢ºèªå¯†ç¢¼ã€ç‚ºä¾‹ï¼Œå±•ç¤ºé€™å€‹åŠŸèƒ½çš„å¯¦éš›æ‡‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼æ”¹å‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/11&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢&quot;&gt;&lt;a href=&quot;#è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢&quot; class=&quot;headerlink&quot; title=&quot;è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢&quot;&gt;&lt;/a&gt;è·¨æ¬„ä½é©—è­‰èˆ‡é—œæ³¨é»åˆ†é›¢&lt;/h2&gt;&lt;p&gt;å…¶å¯¦ï¼Œç„¡è«–æ˜¯å–®ä¸€æ¬„ä½é‚„æ˜¯è·¨æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰ï¼Œéƒ½&lt;strong&gt;ä¸ä¸€å®š&lt;/strong&gt;è¦è—‰ç”± Pydantic ä¾†å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ç†è«–ä¸Šï¼Œè³‡æ–™é©—è­‰å¯ä»¥&lt;strong&gt;ç›´æ¥&lt;/strong&gt;åœ¨ view å‡½å¼ä¸­é€²è¡Œï¼Œä¾‹å¦‚å–å‡ºè¼¸å…¥çš„æ¬„ä½å€¼ï¼Œæ‰‹å‹•é©—è­‰å®ƒçš„åˆæ³•æ€§ã€‚è·¨æ¬„ä½é©—è­‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œé€™æ˜¯ä¸€ç¨®æ–¹ä¾¿ä½†ã€Œ&lt;strong&gt;ç²—ç³™&lt;/strong&gt;ã€çš„åšæ³•â€”â€”åªé©åˆç”¨åœ¨é©—è­‰é‚è¼¯éå¸¸å–®ç´”çš„æƒ…æ³ã€‚&lt;/p&gt;
&lt;p&gt;é€é Pydantic é€²è¡Œè³‡æ–™é©—è­‰ï¼Œå‰‡èƒ½å¤ å¸¶ä¾†ä¸€å€‹æ˜é¡¯çš„å¥½è™•ï¼š&lt;strong&gt;é—œæ³¨é»åˆ†é›¢&lt;/strong&gt;ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="Pydantic" scheme="https://blog.kyomind.tw/tags/Pydantic/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
  <entry>
    <title>Django Ninja æ•™å­¸ 19ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸Šï¼‰å–®ä¸€æ¬„ä½é©—è­‰â€”â€”ä½¿ç”¨ Pydantic field_validator</title>
    <link href="https://blog.kyomind.tw/django-ninja-19/"/>
    <id>https://blog.kyomind.tw/django-ninja-19/</id>
    <published>2024-10-01T02:31:53.000Z</published>
    <updated>2024-10-07T05:52:25.623Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/5gGprsq.png" alt="2024 iThome éµäººè³½"><span class="cap">2024 iThome éµäººè³½</span></p><p><strong>è³‡æ–™é©—è­‰</strong>æ˜¯ API é–‹ç™¼ä¸­çš„é—œéµéœ€æ±‚ä¹‹ä¸€ï¼Œå®ƒè² è²¬ç¢ºä¿å¾å®¢æˆ¶ç«¯æäº¤çš„è³‡æ–™æ˜¯<strong>ç¬¦åˆé æœŸ</strong>çš„ï¼Œå¾è€Œé¿å…æ½›åœ¨çš„éŒ¯èª¤å’Œå®‰å…¨å•é¡Œã€‚</p><p>æœ‰æ•ˆçš„è³‡æ–™é©—è­‰å¯ä»¥åœ¨ API æ¥æ”¶åˆ°éŒ¯èª¤è³‡æ–™æ™‚ï¼Œçµ¦å‡º<strong>å³æ™‚ä¸”å‹å–„</strong>çš„å›æ‡‰ï¼Œæå‡ç³»çµ±çš„ç©©å®šæ€§å’Œ<strong>ä½¿ç”¨è€…é«”é©—</strong>ã€‚</p><p>Django Ninja ä¸­ï¼Œè³‡æ–™é©—è­‰çš„æ ¸å¿ƒå·¥å…·æ˜¯ <strong>Pydantic</strong>ã€‚å®ƒæä¾›äº†å¼·å¤§çš„é©—è­‰åŠŸèƒ½ï¼Œä¸åƒ…èƒ½å°è³‡æ–™å‹åˆ¥é€²è¡Œæª¢æŸ¥ï¼Œé‚„èƒ½è¼•é¬†å¯¦ç¾<strong>è‡ªå®šç¾©é©—è­‰</strong>ã€‚</p><p>æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­ä½¿ç”¨ Pydantic å¯¦ä½œ<strong>å–®ä¸€æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰</strong>ï¼›ä¸‹ä¸€ç¯‡å‰‡è¬›è¿°<strong>è·¨æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰</strong>ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ<a href="https://github.com/kyomind/Django-Ninja-Tutorial/pull/10">é€™å€‹ PR</a>ã€‚</p><hr><h2 id="ç¬¬äº”ç« ç¸½è«–"><a href="#ç¬¬äº”ç« ç¸½è«–" class="headerlink" title="ç¬¬äº”ç« ç¸½è«–"></a>ç¬¬äº”ç« ç¸½è«–</h2><p>è³‡æ–™é©—è­‰å¾ˆé‡è¦ï¼Œè€Œé©—è­‰å¤±æ•—æ™‚ï¼Œç¨‹å¼å¾€å¾€æœƒæ‹‹å‡º<strong>é©—è­‰éŒ¯èª¤</strong>ã€‚å¦‚ä½•æœ‰æ•ˆè™•ç†é€™äº›éŒ¯èª¤ï¼Œå‰‡æ˜¯ã€Œ<strong>éŒ¯èª¤è™•ç†</strong>ã€è¦è¨è«–çš„ç¯„ç–‡ã€‚</p><p>æœ¬ç« å°‡æ¢è¨é€™å…©å€‹<strong>å¯†åˆ‡ç›¸é—œ</strong>çš„ä¸»é¡Œï¼Œå…±è¨ˆ 4 ç¯‡æ–‡ç« ï¼š</p><ul><li>å· 19ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸Šï¼‰å–®ä¸€æ¬„ä½é©—è­‰â€”â€”ä½¿ç”¨ Pydantic field_validatorï¼ˆæœ¬æ–‡ï¼‰</li><li>å· 20ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸‹ï¼‰Pydantic model_validator å¯¦ç¾ã€Œè·¨æ¬„ä½ã€é©—è­‰</li><li>å· 21ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸Šï¼‰HttpError èˆ‡è‡ªå®šç¾© HTTP å›æ‡‰</li><li>å· 22ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸‹ï¼‰å…¨åŸŸéŒ¯èª¤è™•ç†â€”â€”æ·±å…¥è§£æ Exception Handlers</li></ul><p>å‰å…©ç¯‡ï¼Œæˆ‘å€‘æœƒå­¸ç¿’å¦‚ä½•å¯¦ç¾éˆæ´»çš„è³‡æ–™é©—è­‰ï¼Œä»¥ç¢ºä¿è¼¸å…¥è³‡æ–™ç¬¦åˆé æœŸï¼Œä¸¦åœ¨å¿…è¦æ™‚æ‹‹å‡ºéŒ¯èª¤ã€‚</p><p>å¾Œå…©ç¯‡ï¼Œæˆ‘å€‘å°‡è¨è«–å¦‚ä½•è™•ç† API æµç¨‹ä¸­å¯èƒ½å‡ºç¾çš„å„ç¨®éŒ¯èª¤ï¼ˆä¸é™æ–¼é©—è­‰éŒ¯èª¤ï¼‰ï¼Œä»¥æä¾›æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—ã€‚</p><p>Django Ninja çš„è³‡æ–™é©—è­‰èˆ‡éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œç›¸è¼ƒ Django REST framework <strong>æ›´åŠ è¤‡é›œ</strong>ï¼Œå› æ­¤æˆ‘å€‘å¾—ç”¨<strong>å®Œæ•´çš„ç¯‡å¹…</strong>ä¾†ä»‹ç´¹ï¼Œå¹«åŠ©ä½ æ¸…æ¥šåœ°ç†è§£å®ƒå€‘ã€‚</p><span id="more"></span><hr><h2 id="API-ä¿®æ­£"><a href="#API-ä¿®æ­£" class="headerlink" title="API ä¿®æ­£"></a>API ä¿®æ­£</h2><p>æˆ‘å€‘æœƒä»¥ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ–°å»ºç«‹çš„ APIâ€”â€”<strong>æ–°å¢ä½¿ç”¨è€…</strong>â€”â€”ç‚ºä¾‹ã€‚</p><p>ç¹¼çºŒæ”¹å–„å®ƒï¼ŒåŠ ä¸Šè‡ªå®šç¾©é©—è­‰ï¼Œè®“å®¢æˆ¶ç«¯å‚³ä¾†çš„è³‡æ–™æ›´å¯é ã€‚</p><p>ä¸éæˆ‘è¦å…ˆåšä¸€äº›<strong>éŒ¯èª¤ä¿®æ­£</strong>ï¼Œä¿®æ­£å¾Œçš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&#x27;/users/&#x27;</span>, summary=<span class="string">&#x27;æ–°å¢ä½¿ç”¨è€…&#x27;</span>, response=&#123;<span class="number">201</span>: <span class="built_in">dict</span>&#125;</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">...</span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ–°å¢ä½¿ç”¨è€…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    user = User(</span><br><span class="line">        username=payload.username,</span><br><span class="line">        email=payload.email,</span><br><span class="line">        bio=payload.bio,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ set_password æ–¹æ³•åŠ å¯†å¯†ç¢¼</span></span><br><span class="line">    user.set_password(raw_password=payload.password)</span><br><span class="line">    user.save()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">201</span>, &#123;<span class="string">&#x27;id&#x27;</span>: user.<span class="built_in">id</span>, <span class="string">&#x27;username&#x27;</span>: user.username&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ”¹æ­£äº†é€™å…©è™•ï¼š</p><ol><li>åœ¨<code>router</code>è£é£¾å™¨<strong>æ–°å¢</strong>äº†<code>response=&#123;201: dict&#125;</code>åƒæ•¸ã€‚æœ¬ä¾†æ²’æœ‰å®šç¾©ï¼Œå¯¦éš›ä½¿ç”¨é€™å€‹ API æ™‚æœƒå‡ºç¾éŒ¯èª¤ã€‚å› ç‚º<strong>é è¨­åªæœ‰ 200 å›æ‡‰</strong>ï¼Œæƒ³è¦ 200 ä»¥å¤–çš„å›æ‡‰ï¼Œè¦é€é<code>response</code>åƒæ•¸è²æ˜æ‰è¡Œã€‚</li><li>ä½¿ç”¨<code>set_password</code>æ–¹æ³•å°ç”¨æˆ¶è¼¸å…¥çš„å¯†ç¢¼é€²è¡Œ<strong>åŠ å¯†</strong>ã€‚é€™æ˜¯ Django å…§å»ºçš„åŠŸèƒ½ï¼Œé˜²æ­¢å¯†ç¢¼ç›´æ¥å„²å­˜åœ¨ db ä¸­ã€‚å¯†ç¢¼ä¸èƒ½æ˜æ–‡å­˜å„²ï¼Œç„¡ç–‘æ˜¯ç¾ä»£é–‹ç™¼çš„ ABCã€‚</li></ol><hr><p>ä¿®æ­£çµæŸï¼Œæˆ‘å€‘æ­£å¼é€²å…¥ä¸»é¡Œã€‚</p><h2 id="ä¸åŒã€Œå±¤æ¬¡ã€çš„é©—è­‰"><a href="#ä¸åŒã€Œå±¤æ¬¡ã€çš„é©—è­‰" class="headerlink" title="ä¸åŒã€Œå±¤æ¬¡ã€çš„é©—è­‰"></a>ä¸åŒã€Œå±¤æ¬¡ã€çš„é©—è­‰</h2><p>æ—¢ç„¶æ˜¯é©—è­‰ï¼Œä¸»è¦ç•¶ç„¶æ˜¯è·Ÿä¾†è‡ªå®¢æˆ¶ç«¯çš„<strong>è«‹æ±‚</strong>æœ‰é—œâ€”â€”<strong>é©—è­‰è«‹æ±‚å…§å®¹ã€‚</strong></p><p>Django Ninja ä¸­ï¼Œæ¯å€‹ API å¯ä»¥é€éå®šç¾© Schemaï¼Œä¾†<strong>æè¿° API æ‰€æ¥æ”¶çš„è³‡æ–™çµæ§‹</strong>ã€‚é€™äº› Schema åŸºæ–¼ Pydanticï¼Œèƒ½è‡ªå‹•å°è«‹æ±‚ä¸­çš„è³‡æ–™é€²è¡Œé©—è­‰ã€‚</p><p>Schema ä¸­çš„ type hints å¯ä»¥é©—è­‰è³‡æ–™<strong>å‹åˆ¥</strong>ï¼Œé€™æ˜¯æœ€åŸºæœ¬çš„é©—è­‰ã€‚</p><p>å‰ä¸€ç¯‡æåˆ°çš„ Pydantic Fieldï¼Œå‰‡å¯ä»¥å°è³‡æ–™çš„é•·åº¦ã€ç¯„åœç­‰ç‰¹æ€§é€²è¡Œé©—è­‰ã€‚é€™éƒ¨åˆ†åœ¨å¾Œé¢æœƒç¤ºç¯„ã€‚</p><p>é€™äº›éƒ½æ˜¯åã€Œå½¢å¼ä¸Šã€çš„é©—è­‰ï¼Œè€Œæœ¬æ–‡å°‡èšç„¦æ–¼æ›´è¤‡é›œçš„ã€Œ<strong>è‡ªå®šç¾©é©—è­‰</strong>ã€â€”â€”åŸºæ–¼ä¸€å®šçš„<strong>è¦å‰‡</strong>ã€‚</p><h3 id="ç¯„ä¾‹-API-çš„-Schema-ç¾ç‹€"><a href="#ç¯„ä¾‹-API-çš„-Schema-ç¾ç‹€" class="headerlink" title="ç¯„ä¾‹ API çš„ Schema ç¾ç‹€"></a>ç¯„ä¾‹ API çš„ Schema ç¾ç‹€</h3><p>ä»¥ã€Œæ–°å¢ä½¿ç”¨è€…ã€ç‚ºä¾‹ï¼Œrequest body æ¥æ”¶<code>username</code>ã€<code>email</code>ã€<code>password</code>å’Œ<code>bio</code>ç­‰æ¬„ä½ã€‚é€éæˆ‘å€‘å®šç¾©çš„ Schemaï¼Œèƒ½å®Œæˆæœ€åŸºæœ¬çš„<strong>è³‡æ–™å‹åˆ¥é©—è­‰</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    bio: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä¸€ç¯‡æ‰€è¿°ï¼Œåªæœ‰<code>bio</code>æ¬„ä½æ˜¯å¯é¸çš„ï¼Œå…¶é¤˜å‰‡ç‚ºå¿…å¡«â€”â€”ç¼ºå°‘å°±æœƒå¾—åˆ° 422 å›æ‡‰ã€‚æ‰€ä»¥ Schema åŒæ™‚ä¹Ÿé©—è­‰äº†è³‡æ–™çš„ã€Œ<strong>å­˜åœ¨æ€§</strong>ã€ã€‚</p><p>ç›®å‰çœ‹èµ·ä¾†é‚„ä¸éŒ¯ï¼ä½†æˆ‘å€‘ä¸¦ä¸å°±æ­¤æ»¿è¶³ã€‚</p><hr><h2 id="æ–°éœ€æ±‚ï¼šå¯†ç¢¼è¦å‰‡"><a href="#æ–°éœ€æ±‚ï¼šå¯†ç¢¼è¦å‰‡" class="headerlink" title="æ–°éœ€æ±‚ï¼šå¯†ç¢¼è¦å‰‡"></a>æ–°éœ€æ±‚ï¼šå¯†ç¢¼è¦å‰‡</h2><p>æˆ‘å€‘è¦æ±‚ä½¿ç”¨è€…åœ¨è¨­å®šå¯†ç¢¼æ™‚ï¼Œéµå®ˆä»¥ä¸‹å…©å€‹è¦å‰‡ï¼š</p><ol><li>å¯†ç¢¼é•·åº¦è‡³å°‘ 8 å€‹å­—å…ƒã€‚</li><li>å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—ã€‚</li></ol><p>é€™äº›è¦å‰‡æœ‰åŠ©æ–¼æé«˜å¸³è™Ÿçš„å®‰å…¨æ€§ï¼Œé˜²æ­¢ç”¨æˆ¶è¨­å®šéæ–¼ç°¡å–®çš„å¯†ç¢¼ã€‚</p><p>è€ƒæ…®åˆ°<strong>æ•™å­¸ç›®çš„</strong>ï¼Œæˆ‘æ²’æœ‰è®“è¦å‰‡éæ–¼è¤‡é›œã€‚é€™å…©æ¢è¦å‰‡éƒ½æœ‰å…¶<strong>ç‰¹å®šçš„æ•™å­¸æ„ç¾©</strong>ï¼š</p><ol><li>æœ€å°é•·åº¦é™åˆ¶å¯ä»¥<strong>ç›´æ¥é€é Pydantic Field å¯¦ç¾</strong>ï¼Œä¸å¿…è‡ªè¡Œå¯¦ä½œã€‚</li><li>ç¬¬äºŒå€‹è¦å‰‡æ˜¯é‡é ­æˆ²ï¼Œæˆ‘å€‘æœƒä½¿ç”¨ Pydantic çš„<code>@field_validator</code>è£é£¾å™¨ï¼Œè‡ªè¡Œå®šç¾©æ¬„ä½çš„é©—è­‰è¦å‰‡ã€‚</li></ol><hr><h2 id="å¯¦ä½œå¯†ç¢¼è¦å‰‡é©—è­‰ï¼šä½¿ç”¨-field-validator"><a href="#å¯¦ä½œå¯†ç¢¼è¦å‰‡é©—è­‰ï¼šä½¿ç”¨-field-validator" class="headerlink" title="å¯¦ä½œå¯†ç¢¼è¦å‰‡é©—è­‰ï¼šä½¿ç”¨ field_validator"></a>å¯¦ä½œå¯†ç¢¼è¦å‰‡é©—è­‰ï¼šä½¿ç”¨ field_validator</h2><p>æ ¹æ“šéœ€æ±‚ï¼Œæˆ‘å€‘å¯ä»¥å…ˆåˆ©ç”¨ Pydantic çš„<code>Field</code>ä¾†è¨­å®š<strong>æœ€å°é•·åº¦é™åˆ¶</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password: <span class="built_in">str</span> = Field(min_length=<span class="number">8</span>, examples=[<span class="string">&#x27;password123&#x27;</span>])</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œæˆ‘å€‘åªéœ€è¦æ–°å¢ä¸€å€‹<code>min_length=8</code>åƒæ•¸å³å¯ã€‚</p><p>è‡³æ–¼ã€Œå¿…é ˆåŒ…å«æ•¸å­—ã€çš„é©—è­‰ï¼Œå‰‡è¦ç”¨<code>@field_validator</code>è£é£¾å™¨ä¾†å¯¦ä½œã€‚</p><h3 id="field-validator-è£é£¾å™¨"><a href="#field-validator-è£é£¾å™¨" class="headerlink" title="field_validator è£é£¾å™¨"></a>field_validator è£é£¾å™¨</h3><p>åœ¨ Pydantic v1 ä¸­ï¼Œé€™å€‹è£é£¾å™¨çš„åç¨±æ˜¯<code>validator</code>ï¼Œv2 æ‰æ”¹ç‚º<code>field_validator</code>ã€‚</p><p>Pydantic å¾ v1 åˆ° v2ï¼Œæœ‰<strong>è¨±å¤š</strong> <a href="https://en.wiktionary.org/wiki/breaking_change">breaking change</a>ï¼Œæ¯”å¦‚ä¹‹å‰æéçš„<code>example</code>åƒæ•¸è®Šæˆ<code>examples</code>ï¼Œå³æ˜¯ä¸€ä¾‹ã€‚é€™éƒ¨åˆ†å€¼å¾—ç•™æ„ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¿®æ”¹å¾Œçš„ Schemaï¼Œæˆ‘å€‘åªé—œæ³¨<code>field_validator</code>éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUserRequest</span>(<span class="title class_ inherited__">Schema</span>):</span><br><span class="line">    ...</span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @field_validator(<span class="params"><span class="string">&#x27;password&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_password_contains_number</span>(<span class="params">cls, v: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é©—è­‰å¯†ç¢¼è‡³å°‘åŒ…å«ä¸€å€‹æ•¸å­—</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&#x27;\d&#x27;</span>, v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;å¯†ç¢¼å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹æ•¸å­—&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br></pre></td></tr></table></figure><h3 id="é‡é»è§£æ"><a href="#é‡é»è§£æ" class="headerlink" title="é‡é»è§£æ"></a>é‡é»è§£æ</h3><ol><li><code>field_validator</code>è£é£¾å™¨<strong>å¿…é ˆä½¿ç”¨åƒæ•¸</strong>ï¼Œåˆæ³•å€¼æ˜¯<strong>æ¬„ä½åç¨±</strong>ï¼Œå¦‚<code>password</code>ã€‚</li><li>é›–ç„¶ç¯„ä¾‹ä¸­æ²’æœ‰æ¼”ç¤ºï¼Œä½†å®ƒå¯ä»¥å¥—ç”¨åœ¨<strong>å¤šå€‹æ¬„ä½</strong>ã€‚<ol><li>å¯«æ³•ç‚º<code>@field_validator(&#39;æ¬„ä½1&#39;, &#39;æ¬„ä½2&#39;, ...)</code>ï¼Œä½ ç”šè‡³å¯ä»¥ç›´æ¥å¯«æˆ<code>@field_validator(&#39;*&#39;)</code>â€”â€”å¥—ç”¨åˆ°<strong>å…¨éƒ¨</strong>æ¬„ä½ã€‚</li><li>ä½†è«‹æ³¨æ„ï¼Œé€™äº›æ¬„ä½æœƒåŸ·è¡Œ<strong>åŒä¸€å€‹é©—è­‰é‚è¼¯</strong>ï¼Œæ‰€ä»¥å®ƒå€‘ç†è«–ä¸Šæ˜¯<strong>é‚è¼¯é¡ä¼¼</strong>çš„æ¬„ä½ã€‚</li></ol></li><li><strong>é©—è­‰æ–¹æ³•çš„åç¨±</strong>å¯ä»¥è‡ªè¨‚ï¼Œä½ æƒ³æ€éº¼å‘½åéƒ½è¡Œï¼Œåªè¦è‡ªå·±å¥½æ‡‚å³å¯ã€‚<ol><li>å› ç‚º Pydantic ä¸»è¦æ˜¯çœ‹è£é£¾å™¨ä¸Šçš„æ¬„ä½åç¨±ã€‚</li><li>é€™å’Œ Django REST framework çš„é©—è­‰æ–¹æ³•æ˜¯æ¡ç”¨<code>validate_&lt;æ¬„ä½å&gt;</code>çš„å‘½åæ¨¡å¼ï¼Œæœ‰<strong>å¾ˆå¤§çš„ä¸åŒ</strong>ã€‚</li></ol></li><li>Pydantic é©—è­‰æ–¹æ³•çš„åƒæ•¸åç¨±å‘½åæ…£ä¾‹æ˜¯<code>v</code>ï¼Œè€Œ Django REST framework å‰‡æ˜¯<code>value</code>ã€‚</li><li>æ…£ä¾‹äºŒï¼šé©—è­‰æ–¹æ³•åœ¨<strong>æˆåŠŸæ™‚æœƒåŸå°ä¸å‹• return è¼¸å…¥å€¼</strong>ï¼›å¤±æ•—æ™‚å‰‡æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚</li><li>Pydantic çš„é©—è­‰æ–¹æ³•æ˜¯ä¸€å€‹ã€Œ<strong>é¡åˆ¥æ–¹æ³•</strong>ã€ï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹åƒæ•¸æ˜¯<code>cls</code>ã€‚ç‰¹åˆ¥çš„æ˜¯ï¼Œä½ <strong>å¯ä»¥çœç•¥</strong><code>@classmethod</code>è£é£¾å™¨ï¼Œå› ç‚º Pydantic å·²ç¶“åœ¨å…§éƒ¨è™•ç†äº†ã€‚<ol><li>ä¸é<a href="https://docs.pydantic.dev/latest/concepts/validators/#field-validators">å®˜æ–¹æ–‡ä»¶</a>ä»å»ºè­°ä½ ä½¿ç”¨<code>@classmethod</code>ï¼Œæˆ‘å€‘å¾å–„å¦‚æµã€‚</li><li>å¦‚æœæœ‰è²æ˜<code>@classmethod</code>è£é£¾å™¨ï¼Œå®ƒçš„ä½ç½®å¿…é ˆ<strong>æœ€é è¿‘</strong>é©—è­‰æ–¹æ³•ã€‚</li></ol></li></ol><p>æƒ³ä¸åˆ°å§ï¼ŸçŸ­çŸ­å¹¾è¡Œï¼Œç«Ÿç„¶æœ‰é€™éº¼å¤š<strong>çœ‹é»</strong>ï¼</p><hr><h2 id="å°çµ"><a href="#å°çµ" class="headerlink" title="å°çµ"></a>å°çµ</h2><p>é€™ä¸€ç¯‡ï¼Œæˆ‘å€‘å­¸ç¿’äº†å¦‚ä½•é€é Pydanticï¼Œå°å–®ä¸€æ¬„ä½é€²è¡Œè³‡æ–™é©—è­‰ï¼Œå¯¦ä½œäº†å¯†ç¢¼å¼·åº¦æª¢æŸ¥è¦å‰‡ã€‚</p><p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘å€‘è¦ç¹¼çºŒé€™å€‹ä¸»é¡Œï¼Œå¯¦ç¾æ›´è¤‡é›œçš„<strong>è·¨æ¬„ä½é©—è­‰</strong>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/5gGprsq.png&quot; alt=&quot;2024 iThome éµäººè³½&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è³‡æ–™é©—è­‰&lt;/strong&gt;æ˜¯ API é–‹ç™¼ä¸­çš„é—œéµéœ€æ±‚ä¹‹ä¸€ï¼Œå®ƒè² è²¬ç¢ºä¿å¾å®¢æˆ¶ç«¯æäº¤çš„è³‡æ–™æ˜¯&lt;strong&gt;ç¬¦åˆé æœŸ&lt;/strong&gt;çš„ï¼Œå¾è€Œé¿å…æ½›åœ¨çš„éŒ¯èª¤å’Œå®‰å…¨å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ•ˆçš„è³‡æ–™é©—è­‰å¯ä»¥åœ¨ API æ¥æ”¶åˆ°éŒ¯èª¤è³‡æ–™æ™‚ï¼Œçµ¦å‡º&lt;strong&gt;å³æ™‚ä¸”å‹å–„&lt;/strong&gt;çš„å›æ‡‰ï¼Œæå‡ç³»çµ±çš„ç©©å®šæ€§å’Œ&lt;strong&gt;ä½¿ç”¨è€…é«”é©—&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Django Ninja ä¸­ï¼Œè³‡æ–™é©—è­‰çš„æ ¸å¿ƒå·¥å…·æ˜¯ &lt;strong&gt;Pydantic&lt;/strong&gt;ã€‚å®ƒæä¾›äº†å¼·å¤§çš„é©—è­‰åŠŸèƒ½ï¼Œä¸åƒ…èƒ½å°è³‡æ–™å‹åˆ¥é€²è¡Œæª¢æŸ¥ï¼Œé‚„èƒ½è¼•é¬†å¯¦ç¾&lt;strong&gt;è‡ªå®šç¾©é©—è­‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°‡ä»‹ç´¹å¦‚ä½•åœ¨ Django Ninja ä¸­ä½¿ç”¨ Pydantic å¯¦ä½œ&lt;strong&gt;å–®ä¸€æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰&lt;/strong&gt;ï¼›ä¸‹ä¸€ç¯‡å‰‡è¬›è¿°&lt;strong&gt;è·¨æ¬„ä½çš„è‡ªå®šç¾©é©—è­‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰€æœ‰çš„ç¨‹å¼ç¢¼è®Šå‹•ï¼Œå¯åƒè€ƒ&lt;a href=&quot;https://github.com/kyomind/Django-Ninja-Tutorial/pull/10&quot;&gt;é€™å€‹ PR&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;ç¬¬äº”ç« ç¸½è«–&quot;&gt;&lt;a href=&quot;#ç¬¬äº”ç« ç¸½è«–&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬äº”ç« ç¸½è«–&quot;&gt;&lt;/a&gt;ç¬¬äº”ç« ç¸½è«–&lt;/h2&gt;&lt;p&gt;è³‡æ–™é©—è­‰å¾ˆé‡è¦ï¼Œè€Œé©—è­‰å¤±æ•—æ™‚ï¼Œç¨‹å¼å¾€å¾€æœƒæ‹‹å‡º&lt;strong&gt;é©—è­‰éŒ¯èª¤&lt;/strong&gt;ã€‚å¦‚ä½•æœ‰æ•ˆè™•ç†é€™äº›éŒ¯èª¤ï¼Œå‰‡æ˜¯ã€Œ&lt;strong&gt;éŒ¯èª¤è™•ç†&lt;/strong&gt;ã€è¦è¨è«–çš„ç¯„ç–‡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç« å°‡æ¢è¨é€™å…©å€‹&lt;strong&gt;å¯†åˆ‡ç›¸é—œ&lt;/strong&gt;çš„ä¸»é¡Œï¼Œå…±è¨ˆ 4 ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å· 19ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸Šï¼‰å–®ä¸€æ¬„ä½é©—è­‰â€”â€”ä½¿ç”¨ Pydantic field_validatorï¼ˆæœ¬æ–‡ï¼‰&lt;/li&gt;
&lt;li&gt;å· 20ï¼šè³‡æ–™é©—è­‰ï¼ˆä¸‹ï¼‰Pydantic model_validator å¯¦ç¾ã€Œè·¨æ¬„ä½ã€é©—è­‰&lt;/li&gt;
&lt;li&gt;å· 21ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸Šï¼‰HttpError èˆ‡è‡ªå®šç¾© HTTP å›æ‡‰&lt;/li&gt;
&lt;li&gt;å· 22ï¼šéŒ¯èª¤è™•ç†ï¼ˆä¸‹ï¼‰å…¨åŸŸéŒ¯èª¤è™•ç†â€”â€”æ·±å…¥è§£æ Exception Handlers&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰å…©ç¯‡ï¼Œæˆ‘å€‘æœƒå­¸ç¿’å¦‚ä½•å¯¦ç¾éˆæ´»çš„è³‡æ–™é©—è­‰ï¼Œä»¥ç¢ºä¿è¼¸å…¥è³‡æ–™ç¬¦åˆé æœŸï¼Œä¸¦åœ¨å¿…è¦æ™‚æ‹‹å‡ºéŒ¯èª¤ã€‚&lt;/p&gt;
&lt;p&gt;å¾Œå…©ç¯‡ï¼Œæˆ‘å€‘å°‡è¨è«–å¦‚ä½•è™•ç† API æµç¨‹ä¸­å¯èƒ½å‡ºç¾çš„å„ç¨®éŒ¯èª¤ï¼ˆä¸é™æ–¼é©—è­‰éŒ¯èª¤ï¼‰ï¼Œä»¥æä¾›æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—ã€‚&lt;/p&gt;
&lt;p&gt;Django Ninja çš„è³‡æ–™é©—è­‰èˆ‡éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œç›¸è¼ƒ Django REST framework &lt;strong&gt;æ›´åŠ è¤‡é›œ&lt;/strong&gt;ï¼Œå› æ­¤æˆ‘å€‘å¾—ç”¨&lt;strong&gt;å®Œæ•´çš„ç¯‡å¹…&lt;/strong&gt;ä¾†ä»‹ç´¹ï¼Œå¹«åŠ©ä½ æ¸…æ¥šåœ°ç†è§£å®ƒå€‘ã€‚&lt;/p&gt;</summary>
    
    
    <content src="https://i.imgur.com/5gGprsq.png" type="image"/>
    
    
    <category term="Django Ninja ç³»åˆ—" scheme="https://blog.kyomind.tw/categories/Django-Ninja-%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Django" scheme="https://blog.kyomind.tw/tags/Django/"/>
    
    <category term="Django Ninja" scheme="https://blog.kyomind.tw/tags/Django-Ninja/"/>
    
    <category term="Pydantic" scheme="https://blog.kyomind.tw/tags/Pydantic/"/>
    
    <category term="éµäººè³½" scheme="https://blog.kyomind.tw/tags/%E9%90%B5%E4%BA%BA%E8%B3%BD/"/>
    
  </entry>
  
</feed>
