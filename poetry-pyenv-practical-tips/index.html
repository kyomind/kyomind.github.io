<!DOCTYPE html>
<html lang="zh-TW">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@kyomind">
<meta property="og:type" content="article"><meta name="twitter:title" content="Poetry + pyenv 教學：常用指令與注意事項">
  <meta property="og:title" content="Poetry + pyenv 教學：常用指令與注意事項"><meta name="twitter:description" content="透過本文，我希望能夠提供更全面、更實用的 Poetry 使用建議，讓讀者在使用 Poetry 和 pyenv 時能夠充分發揮它們的優勢，並減少不必要的困惑。">
  <meta property="og:description" content="透過本文，我希望能夠提供更全面、更實用的 Poetry 使用建議，讓讀者在使用 Poetry 和 pyenv 時能夠充分發揮它們的優勢，並減少不必要的困惑。"><meta name="twitter:image" content="https://i.imgur.com/npnmhFE.jpg">
  <meta property="og:image" content="https://i.imgur.com/npnmhFE.jpg">
<meta name="description" content="透過本文，我希望能夠提供更全面、更實用的 Poetry 使用建議，讓讀者在使用 Poetry 和 pyenv 時能夠充分發揮它們的優勢，並減少不必要的困惑。" />


<meta property="og:locale" content="zh-TW" />
<meta property="og:site_name" content="Code and Me" />
<meta property="article:publisher" content="https://blog.kyomind.tw" />
<meta property="article:author" content="Kyo Huang" /><meta property="article:section" content="軟體開發" />
            

  <meta property="article:modified_time" content="2024-06-24T06:03:03+08:00" />




  <meta property="article:published_time" content="2023-06-05T15:01:08+08:00" />



<meta name="author" content="Kyo Huang" />
<meta http-equiv="content-language" content="zh-TW" />
<link rel="alternate" href="/atom.xml" title="Code and Me" type="application/atom+xml">
 
 





<link rel="icon" type="image/png" sizes="144x144" href="/favicon-144x144.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" href="/favicon.ico" sizes="any">


<link rel="canonical" href="https://blog.kyomind.tw/poetry-pyenv-practical-tips/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NL7WVE1X7Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL7WVE1X7Z');

</script><script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":false,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Poetry + pyenv 教學：常用指令與注意事項 - Code and Me</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Code and Me</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/archives/">
        <li class="mobile-menu-item">文章列表
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分類
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">標籤
          </li>
      </a><a href="/ranking/">
        <li class="mobile-menu-item">排名
          </li>
      </a><a href="/series/">
        <li class="mobile-menu-item">系列
          </li>
      </a><a href="/subscribe/">
        <li class="mobile-menu-item">訂閱
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">關於
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Code and Me</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu"><li class="menu-item">
        <a class="menu-item-link" href="/archives/">
          文章列表
          </a>
      </li>
    <li class="dropdown">
        <a class="menu-item-link" href="/categories/">
          分類 <b><span style="position: relative; top: -3px;">⌵</span></b>
          </a>
        <div class="dropdown-content">
          
            <a href="/categories/%E6%9B%B8%E8%A9%95-%C3%97-%E7%AD%86%E8%A8%98/">書評 × 筆記 (13)</a>
          
            <a href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發 (24)</a>
          
            <a href="/categories/Django/">Django (12)</a>
          
            <a href="/categories/%E5%BF%83%E5%BE%97/">心得 (38)</a>
          
            <a href="/categories/Weekly-Review/">Weekly Review (38)</a>
          
            <a href="/categories/VS-Code/">VS Code (9)</a>
          
            <a href="/categories/Docker/">Docker (2)</a>
          
            <a href="/categories/Django-Ninja-%E7%B3%BB%E5%88%97/">Django Ninja 系列 (26)</a>
          
        </div>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/tags/">
          標籤
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/ranking/">
          排名
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/series/">
          系列
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/subscribe/">
          訂閱
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/about/">
          關於
          </a>
      </li>
    </ul>
</nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Poetry + pyenv 教學：常用指令與注意事項
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2023-06-05
        </span><span class="post-update">
            →  2024-04-26
          </span>
        <span class="post-category">
            <a href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目錄</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E4%B8%BB%E6%97%A8"><span class="toc-text">本文主旨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AF%84%E4%BE%8B%E8%88%87%E7%92%B0%E5%A2%83%E4%BB%8B%E7%B4%B9"><span class="toc-text">範例與環境介紹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-Poetry%E3%80%81pyenv"><span class="toc-text">安裝 Poetry、pyenv</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Poetry-%E8%88%87-pyenv-%E7%9A%84%E6%95%B4%E5%90%88"><span class="toc-text">Poetry 與 pyenv 的整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96-Poetry-%E5%B0%88%E6%A1%88"><span class="toc-text">一、初始化 Poetry 專案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%82%BA%E5%B0%88%E6%A1%88%E5%BB%BA%E7%AB%8B-Python-%E8%99%9B%E6%93%AC%E7%92%B0%E5%A2%83"><span class="toc-text">二、為專案建立 Python 虛擬環境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8C%87%E5%AE%9A%E5%B0%88%E6%A1%88%E7%9A%84-Python-%E7%89%88%E6%9C%AC"><span class="toc-text">三、指定專案的 Python 版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%8D%E5%90%8C%E5%B0%88%E6%A1%88%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C-Python-%E7%89%88%E6%9C%AC"><span class="toc-text">四、不同專案使用不同 Python 版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%A6%82%E4%BD%95%E7%A7%BB%E9%99%A4-Poetry-%E8%99%9B%E6%93%AC%E7%92%B0%E5%A2%83%EF%BC%9F"><span class="toc-text">五、如何移除 Poetry 虛擬環境？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6%E8%87%B3-main-dependencies"><span class="toc-text">六、安裝套件至 main dependencies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AE%89%E8%A3%9D%E5%A5%97%E4%BB%B6%E8%87%B3-dev-dependencies"><span class="toc-text">七、安裝套件至 dev dependencies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81poetry-install-sync"><span class="toc-text">八、poetry install --sync</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Docker-%E7%92%B0%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-Poetry"><span class="toc-text">九、Docker 環境中使用 Poetry</span></a></li></ol>
    </div>
  </div><div class="post-content"><p><img src="https://i.imgur.com/npnmhFE.jpg" alt="from Pixabay"><span class="cap">from Pixabay</span></p>
<blockquote>
<p><code>2024/04/26</code>：重新編輯全文，提升文字清晰與流暢度。<br><code>2024/01/09</code>：刪除部分內容，使文章更緊湊、好讀。</p>
</blockquote>
<p>〈<a href="https://blog.kyomind.tw/python-poetry/">Python 套件管理器——Poetry 完全入門指南</a>〉發表至今，已過了 2 年，這意味著我使用 Poetry 達 2 年了。</p>
<p>對我而言，Poetry 已是 Python 專案開發<strong>不可或缺</strong>的要素。</p>
<p>它不僅提供了更加便捷的<strong>套件管理</strong>和<strong>版本控制</strong>。而且，Poetry 以 pyproject.toml 作為設定檔，讓我可以<strong>同時透過 pyproject.toml 管理其它工具</strong>，比如 Mypy、Ruff 等。</p>
<blockquote>
<p>相關文章：<a href="/pyproject-toml/">Python 開發：pyproject.toml 介紹 + 使用教學</a></p>
</blockquote>
<p>這是我喜歡的方式。</p>
<h3 id="系列：Python-Poetry-三部曲"><a href="#系列：Python-Poetry-三部曲" class="headerlink" title="系列：Python Poetry 三部曲"></a>系列：Python Poetry 三部曲</h3><blockquote>
<ol>
<li><a href="/python-poetry/">Python 套件管理器——Poetry 完全入門指南</a></li>
<li><strong>Poetry + pyenv 教學：常用指令與注意事項</strong></li>
<li>Docker 教學：Dockerfile 多階段建構 Poetry 虛擬環境（待發表）</li>
</ol>
</blockquote>
<span id="more"></span>

<hr>
<h2 id="本文主旨"><a href="#本文主旨" class="headerlink" title="本文主旨"></a>本文主旨</h2><p>本文將補充第一篇中「<a href="/python-poetry/#Poetry-%E5%B8%B8%E8%A6%8B%E4%BD%BF%E7%94%A8%E6%83%85%E5%A2%83%E8%88%87%E6%93%8D%E4%BD%9C-QA">情境與使用</a>」方面的不足，尤其針對<strong>同時使用 Poetry 和 pyenv</strong>可能出現的問題進行討論。這是第一篇所遺漏的內容。</p>
<p>透過本文，我希望能夠提供更全面、更實用的 Poetry 使用建議，讓讀者在使用 Poetry 和 pyenv 時能夠充分發揮它們的優勢，並減少不必要的困惑。</p>
<h2 id="範例與環境介紹"><a href="#範例與環境介紹" class="headerlink" title="範例與環境介紹"></a>範例與環境介紹</h2><p>poetry-demo 是本文作為例示的專案模版，但我們不會安裝太多套件，僅各取一個作為示範之用。</p>
<p>有一個簡單的具體實例，比單純描述要容易理解。</p>
<p>我們會從一台全新的 Linux VM（Ubuntu 20.04）開始，安裝 pyenv，再安裝 Poetry，最後再一起使用它們，建立 Python 專案與虛擬環境。</p>
<h3 id="Poetry-版本：1-5-1"><a href="#Poetry-版本：1-5-1" class="headerlink" title="Poetry 版本：1.5.1"></a>Poetry 版本：1.5.1</h3><p>Poetry 在 1.2 版後，對於部分指令進行有較大的改動，導致舊有的指令<strong>不完全相容</strong>，這次會採用<strong>當前</strong>（2023 年 6 月）的最新版——<a target="_blank" rel="noopener" href="https://github.com/python-poetry/poetry/releases/tag/1.5.1">1.5.1</a>——來進行示範。</p>
<h3 id="pyenv-版本：2-3-18"><a href="#pyenv-版本：2-3-18" class="headerlink" title="pyenv 版本：2.3.18"></a>pyenv 版本：2.3.18</h3><p>pyenv 在 v2.3.0 以後，已經<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv#set-up-your-shell-environment-for-pyenv">大幅簡化了設定操作</a>。本文使用版本：<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv/releases/tag/v2.3.18">v2.3.18</a>。</p>
<p>相關文章也有就新版設定內容進行更新，可參考：</p>
<blockquote>
<ul>
<li><a href="/ubuntu-pyenv/#%E8%A8%AD%E5%AE%9A-pyenv">Ubuntu 安裝使用 pyenv + pyenv-virtualenv</a></li>
<li><a href="/pyenv-setup/#%E5%AE%89%E8%A3%9D%E3%80%81%E8%A8%AD%E5%AE%9A-pyenv">告別 Anaconda：在 macOS 上使用 pyenv 建立 Python 開發環境</a></li>
</ul>
</blockquote>
<hr>
<h2 id="安裝-Poetry、pyenv"><a href="#安裝-Poetry、pyenv" class="headerlink" title="安裝 Poetry、pyenv"></a>安裝 Poetry、pyenv</h2><p>請直接參考〈<a href="/linux-dev-setup/">Python 開發環境設定：zsh、zinit、pyenv、Poetry、Docker</a>〉中的「<a href="/linux-dev-setup/#%E4%B8%89%E3%80%81%E8%A8%AD%E5%AE%9A-pyenv">三、設定 pyenv</a>」、「<a href="/linux-dev-setup/#%E5%9B%9B%E3%80%81%E8%A8%AD%E5%AE%9A-Poetry">四、設定 Poetry</a>」部分。</p>
<p>不只是安裝，還包括<strong>設定 PATH</strong> 等環節，這些步驟都是<strong>必要</strong>的。完成後，我們就能使用 Poetry 和 pyenv 的指令了。</p>
<h3 id="透過-pyenv-安裝-Python-3-10-11"><a href="#透過-pyenv-安裝-Python-3-10-11" class="headerlink" title="透過 pyenv 安裝 Python 3.10.11"></a>透過 pyenv 安裝 Python 3.10.11</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.10.11</span><br></pre></td></tr></table></figure>

<p>pyenv 是為了方便我們管理多個 Python 版本，下面我們會探討不同專案分別使用多個 Python 版本時的 Poetry + pyenv 操作注意事項。</p>
<p>這裡至少要先有一個 Python 版本，才能順利安裝我們的專案，在此以 <a target="_blank" rel="noopener" href="https://www.python.org/downloads/release/python-31011/">3.10.11</a> 為例。</p>
<h2 id="Poetry-與-pyenv-的整合"><a href="#Poetry-與-pyenv-的整合" class="headerlink" title="Poetry 與 pyenv 的整合"></a>Poetry 與 pyenv 的整合</h2><p>安裝完後，是否要設定<code>pyenv local 3.10.11</code>或<code>pyenv global 3.10.11</code>，取決於你是否有「<strong>多專案、多 Python 版本</strong>」需求——通常一定會有☺️</p>
<h3 id="設定-pyenv-global-與-local"><a href="#設定-pyenv-global-與-local" class="headerlink" title="設定 pyenv global 與 local"></a>設定 pyenv global 與 local</h3><p>如果只需要一種 Python 版本，那將其設定為<code>global</code>已足：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv global 3.10.11</span><br></pre></td></tr></table></figure>

<p>但你也可以<strong>同時設定兩者</strong>，這樣在特定專案中會使用特定 Python 版本，而在<strong>不指定</strong>時則使用<code>global</code>設定的 Python 版本。</p>
<blockquote>
<p><code>2024/06/21</code>補充：Poetry 有時就是不鳥你的<code>pyenv global</code>設定，而直接使用作業系統的預設 Python 版本。所以<strong>最好</strong>還是用<code>pyenv local</code>。</p>
</blockquote>
<p>比如幫某個舊專案設定為 3.8.12：（要先<code>cd</code>至該專案目錄）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv <span class="built_in">local</span> 3.8.12</span><br></pre></td></tr></table></figure>

<p><strong>此時專案中會新增一個<code>.python-version</code>檔案</strong>，內容就是你設定的 Python 版本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.8.12</span><br></pre></td></tr></table></figure>

<h3 id="建議：不要使用-pyenv-virtualenv"><a href="#建議：不要使用-pyenv-virtualenv" class="headerlink" title="建議：不要使用 pyenv-virtualenv"></a>建議：不要使用 pyenv-virtualenv</h3><p>如前文所言：</p>
<blockquote>
<p>因為 Poetry 自帶了虛擬環境管理功能，容易和 pyenv-virtualenv <strong>疊床架屋</strong>，徒增<strong>管理上的混淆</strong>，所以<strong>我現在一律只用 Poetry + venv 來管理 Python 虛擬環境</strong>。</p>
</blockquote>
<p>即使在不同專案需要多版本 Python 情況下，pyenv-virtualenv 也不是必須。只要善用<code>pyenv local</code>和<code>poetry env use</code>兩大指令即可。</p>
<p>綜上所述，這也是為什麼我認為 Poetry 的教學<strong>應該涵蓋對 pyenv 的整合</strong>，因為在「虛擬環境管理」方面，兩者的功能有一定重疊。</p>
<p>退萬步言，當你的 Python 專案愈來愈多的時候，你就會深深感受到「一個專案<strong>只</strong>對應一個虛擬環境」（而且<strong>最好直接放在專案裡</strong>）的<strong>必要性</strong>。</p>
<h3 id="小結：最佳實踐"><a href="#小結：最佳實踐" class="headerlink" title="小結：最佳實踐"></a>小結：最佳實踐</h3><p>所以，不要麻煩了！</p>
<p>直接使用 Poetry 的虛擬環境管理功能，並將<code>virtualenvs.in-project</code>設為<code>true</code>，就是<strong>我認為的最佳實踐</strong>。</p>
<p>什麼，你還沒打開？沒關係，給你指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry config virtualenvs.in-project <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<p>前置作業總算大功告成，我們開始建立 poetry-demo 吧！</p>
<h2 id="一、初始化-Poetry-專案"><a href="#一、初始化-Poetry-專案" class="headerlink" title="一、初始化 Poetry 專案"></a>一、初始化 Poetry 專案</h2><p>先確認一下當前的 Poetry 版本，使用<code>poetry --version</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ poetry --version</span><br><span class="line">Poetry (version 1.4.2)</span><br></pre></td></tr></table></figure>

<p>我的 Poetry 是一段時間前安裝的 1.4.2，需要升級，以符合本文使用的版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry self update</span><br></pre></td></tr></table></figure>

<p>你也可以<strong>指定</strong>想要升級的版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry self update 1.5.1</span><br></pre></td></tr></table></figure>

<h3 id="使用poetry-init初始化專案"><a href="#使用poetry-init初始化專案" class="headerlink" title="使用poetry init初始化專案"></a>使用<code>poetry init</code>初始化專案</h3><p>確認完 Poetry 版本，開始建立專案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> poetry-demo</span><br><span class="line"><span class="built_in">cd</span> poetry-demo</span><br><span class="line">poetry init</span><br></pre></td></tr></table></figure>

<p><code>poetry init</code>後會出現互動式訊息，上一篇<a href="https://blog.kyomind.tw/python-poetry/#%E5%88%9D%E5%A7%8B%E5%8C%96-Poetry">已有詳細介紹</a>。</p>
<p>初始化後的<code>pyproject.toml</code>內容：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.poetry]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;poetry-demo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;kyo &lt;odinxp@gmail.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">readme</span> = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;^3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-system]</span></span><br><span class="line"><span class="attr">requires</span> = [<span class="string">&quot;poetry-core&quot;</span>]</span><br><span class="line"><span class="attr">build-backend</span> = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>

<p>比起一開始使用的 v1.19，新版多了這行：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readme</span> = <span class="string">&quot;README.md&quot;</span></span><br></pre></td></tr></table></figure>

<p>我習慣——<strong>直接刪除</strong>。</p>
<p>因為沒有<code>README.md</code>，反而會造成錯誤。如果有就可以保留。</p>
<hr>
<h2 id="二、為專案建立-Python-虛擬環境"><a href="#二、為專案建立-Python-虛擬環境" class="headerlink" title="二、為專案建立 Python 虛擬環境"></a>二、為專案建立 Python 虛擬環境</h2><p>這裡是<strong>重頭戲</strong>之一，但做法上<strong>並不是那麼直觀</strong>，容易讓人混淆。僅使用 pyenv 的前提下，再安裝<code>pyenv-virtualenv</code>來建立虛擬環境，確實不難。</p>
<p>但現在有了 Poetry，兩者的<strong>搭配使用方式</strong>就很重要，這也是為什麼我一再強調，有了 Poetry，乾脆就不要再裝<code>pyenv-virtualenv</code>了。</p>
<h3 id="使用-Poetry-建立虛擬環境"><a href="#使用-Poetry-建立虛擬環境" class="headerlink" title="使用 Poetry 建立虛擬環境"></a>使用 Poetry 建立虛擬環境</h3><p>在第一篇文章中，雖然我提過<code>poetry shell</code>有時候可以替代<code>poetry env use</code>，作為快速建立虛擬環境的便捷手段。</p>
<p>但是，當你還沒有為專案建立虛擬環境，且作業系統中包含了不止一個 Python 版本時，<strong>建議就不要</strong>用<code>poetry shell</code>來建立虛擬環境——因為它<strong>很可能會選擇不是你要的 Python 版本</strong>。</p>
<p>儘管我們使用 pyenv 來管理 Python，但完整的 Linux 發行版往往都自帶了系統的 Python。比如我的 Ubuntu 就自帶了 3.8.x，這正是為何上面<code>pyproject.toml</code>會有一行「<code>python = &quot;^3.8&quot;</code>」而不是<code>^3.10</code>——因為 Poetry 偵測到的是系統預設的 Python，而不是 pyenv 的 Poetry。</p>
<p>換句話說，<strong>無論透過 pyenv 安裝了幾個 Python 版本，這些資訊對 Poetry 而言，依舊是陌生的。</strong></p>
<p>為了讓 Poetry 在建立虛擬環境時，能確實使用<strong>你想要的 Python 版本</strong>，我們必須善用<code>poetry env use</code>指令才行。</p>
<hr>
<h2 id="三、指定專案的-Python-版本"><a href="#三、指定專案的-Python-版本" class="headerlink" title="三、指定專案的 Python 版本"></a>三、指定專案的 Python 版本</h2><p>在有多個 Python 版本的情況下，想讓 Poetry 使用<strong>特定</strong>的 Python 版本，有時真的不是那麼容易😂</p>
<h3 id="指定虛擬環境-Python-版本的官方做法（experimental）"><a href="#指定虛擬環境-Python-版本的官方做法（experimental）" class="headerlink" title="指定虛擬環境 Python 版本的官方做法（experimental）"></a>指定虛擬環境 Python 版本的官方做法（experimental）</h3><p>在使用 pyenv 的情況下，<a target="_blank" rel="noopener" href="https://python-poetry.org/docs/managing-environments/">Poetry 官方文件</a>有補充一個方法，讓你能指定虛擬環境中的 Python 版本：</p>
<blockquote>
<p>If you use a tool like <strong><a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv">pyenv</a></strong> to manage different Python versions, you can set the <strong>experimental</strong> <code>virtualenvs.prefer-active-python</code> option to <code>true</code>. Poetry will then try to find the current <code>python</code> of your shell.</p>
</blockquote>
<p>「experimental」表示這是一個實驗性功能，我不偏好這個做法，在此省略。有興趣的讀者可以自行參考文件。</p>
<h3 id="我偏好的做法：poetry-env-use"><a href="#我偏好的做法：poetry-env-use" class="headerlink" title="我偏好的做法：poetry env use"></a>我偏好的做法：<code>poetry env use</code></h3><p>將想用的 Python 版本設定為<code>global</code>或<code>local</code>後，使用<code>poetry env use</code>指令來<strong>確保</strong>專案虛擬環境的 Python 版本，是<strong>簡單且穩健</strong>的做法。</p>
<p><code>poetry env use</code>有下列幾種表示方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use /full/path/to/python</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use python</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use python3.7</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use 3.7</span><br></pre></td></tr></table></figure>

<p>後三者的<code>python</code>、<code>python3.7</code>或<code>3.7</code>，都和你的<code>PATH</code>有關。</p>
<p>換句話說，如果你在終端機打<code>python3.7</code>，有成功進入「<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/visualstudio/python/python-interactive-repl-in-visual-studio?view=vs-2022">Python 互動式視窗</a>」，那就表示這個版本的 Python 確實存在<code>PATH</code>中。</p>
<h3 id="使用which指令確認-Python-版本是否存在PATH中"><a href="#使用which指令確認-Python-版本是否存在PATH中" class="headerlink" title="使用which指令確認 Python 版本是否存在PATH中"></a>使用<code>which</code>指令確認 Python 版本是否存在<code>PATH</code>中</h3><p>不想進入 REPL，只想確認 Python 版本是否存在<code>PATH</code>中，可以使用<code>which</code>指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ <span class="built_in">which</span> python3.9</span><br><span class="line">/home/kyo/.pyenv/shims/python3.9</span><br><span class="line">❯ <span class="built_in">which</span> python3.10</span><br><span class="line">/home/kyo/.pyenv/shims/python3.10</span><br><span class="line">❯ <span class="built_in">which</span> python</span><br><span class="line">/home/kyo/.pyenv/shims/python</span><br></pre></td></tr></table></figure>

<p>聰明的你應該猜到了，我們只要確保 Python 版本已存在於<code>PATH</code>，透過<code>poetry env use &lt;指定的python版本&gt;</code>即可確定專案使用的 Python 版本。</p>
<p>不過，這個<code>&lt;指定的python版本&gt;</code>必須要先透過 pyenv 安裝好，<strong>而且你通常要將其設定為<code>global</code>或<code>local</code>，系統才找得到。</strong></p>
<h3 id="poetry-demo-操作"><a href="#poetry-demo-操作" class="headerlink" title="poetry-demo 操作"></a>poetry-demo 操作</h3><p>回到案例，這裡我們已經將 3.10.11 設為<code>global</code>。所以輸入<code>python3.10</code>指令時，會進入互動式視窗。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Python 3.10.11 (main, Apr  7 2023, 16:41:32) [Clang 14.0.3 (clang-1403.0.22.14.1)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>此時只要使用下列指令建立 Poetry 虛擬環境，基本上可以確定，使用的 Python 版本為 3.10.11：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use 3.10.11</span><br></pre></td></tr></table></figure>

<p>保險起見，使用指令時還是建議輸入<strong>完整的版本號</strong>，例如<code>3.10.11</code>，而不是<code>3.10</code>。尤其是當你的 pyenv 中有多個 3.10.x 版本時，這樣可以避免混淆。</p>
<hr>
<h2 id="四、不同專案使用不同-Python-版本"><a href="#四、不同專案使用不同-Python-版本" class="headerlink" title="四、不同專案使用不同 Python 版本"></a>四、不同專案使用不同 Python 版本</h2><p>透過<code>pyenv local</code>+<code>poetry env use</code>，可以為不同專案設定不同的 Python 版本。</p>
<p>假設你有 a、b、c 三個專案，分別要使用 Python 3.7.11、3.9.12、3.10.11，依前面的介紹，我們可以這麼做。</p>
<p>首先，<code>pyenv versions</code>確認這三個版本的 Python 都已經由 pyenv 安裝完成：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">❯ pyenv versions</span><br><span class="line">  system</span><br><span class="line">  3.7.11</span><br><span class="line">  3.9.12</span><br><span class="line">* 3.10.11 (<span class="built_in">set</span> by /home/kyo/.pyenv/version)</span><br></pre></td></tr></table></figure>

<p>接下來就很簡單了，為各專案設定好<code>pyenv local</code>（好讓<code>PATH</code>可以成功找到對應的 Python 執行檔），然後再<code>poetry env use &lt;指定的python版本&gt;</code>。</p>
<p>假設 b 專案要使用 3.9.12，則做法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> b</span><br><span class="line">pyenv <span class="built_in">local</span> 3.9.12</span><br><span class="line">poetry <span class="built_in">env</span> use 3.9.12</span><br></pre></td></tr></table></figure>

<p>其餘專案以此類推。</p>
<h2 id="五、如何移除-Poetry-虛擬環境？"><a href="#五、如何移除-Poetry-虛擬環境？" class="headerlink" title="五、如何移除 Poetry 虛擬環境？"></a>五、如何移除 Poetry 虛擬環境？</h2><p>參考<a target="_blank" rel="noopener" href="https://python-poetry.org/docs/managing-environments/#deleting-the-environments">文件</a>，標準做法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> remove /full/path/to/python</span><br><span class="line">poetry <span class="built_in">env</span> remove python3.7</span><br><span class="line">poetry <span class="built_in">env</span> remove 3.7</span><br><span class="line">poetry <span class="built_in">env</span> remove test-O3eWbxRl-py3.7</span><br></pre></td></tr></table></figure>

<p>然而，因為我們已經將<code>virtualenvs.in-project</code>改設為<code>true</code>，也就是直接在專案中建立名為<code>.venv</code>的虛擬環境。</p>
<p>上述的指令基本都沒有作用了。</p>
<blockquote>
<p>但我就真的需要砍掉重練啊！怎麼辦？</p>
</blockquote>
<h3 id="兩個方法"><a href="#兩個方法" class="headerlink" title="兩個方法"></a>兩個方法</h3><p>此時還有兩個簡單的方法可用。</p>
<h4 id="方法一：直接砍掉-venv"><a href="#方法一：直接砍掉-venv" class="headerlink" title="方法一：直接砍掉.venv"></a>方法一：直接砍掉<code>.venv</code></h4><p>簡單有效！我都是用這招：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf .venv</span><br></pre></td></tr></table></figure>

<p>此時我們再次體會到，「虛擬環境就是一個資料夾」的真理，以及<strong>把虛擬環境放在專案目錄下</strong>的好處。</p>
<h4 id="方法二：使用poetry-env-remove-all"><a href="#方法二：使用poetry-env-remove-all" class="headerlink" title="方法二：使用poetry env remove --all"></a>方法二：使用<code>poetry env remove --all</code></h4><p>使用下列指令，優雅地移除它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ poetry <span class="built_in">env</span> remove --all</span><br><span class="line">Deleted virtualenv: /home/kyo/poetry-demo/.venv</span><br></pre></td></tr></table></figure>

<hr>
<p>光是<strong>專案初始化</strong>與<strong>虛擬環境管理</strong>就用掉大半篇幅，可見其複雜。現在我們進入第二部分——套件的安裝與管理。</p>
<h2 id="六、安裝套件至-main-dependencies"><a href="#六、安裝套件至-main-dependencies" class="headerlink" title="六、安裝套件至 main dependencies"></a>六、安裝套件至 main dependencies</h2><p>使用<code>poetry add</code>指令。</p>
<p>參考<a target="_blank" rel="noopener" href="https://python-poetry.org/docs/cli/#add">文件</a>，可以發現<code>add</code>指令的「<strong>版本範圍條件</strong>」寫法還挺多元的！這部分可以參考前一篇後來更新的「<a href="https://blog.kyomind.tw/python-poetry/#%E6%8C%87%E5%AE%9A%E5%A5%97%E4%BB%B6%E3%80%8C%E7%89%88%E6%9C%AC%E3%80%8D%E7%AF%84%E5%9C%8D">指定套件版本範圍</a>」。</p>
<p>除此之外，我覺得對一般使用者而言，<code>poetry add</code>還有<strong>兩個重點</strong>：</p>
<ol>
<li>了解<code>poetry add</code>的「<strong>多階段行為</strong>」。</li>
<li>了解<code>--group</code>參數用法。</li>
</ol>
<h3 id="重點一：poetry-add多階段行為"><a href="#重點一：poetry-add多階段行為" class="headerlink" title="重點一：poetry add多階段行為"></a>重點一：<code>poetry add</code>多階段行為</h3><p>如前文所言，<code>poetry add</code>實際上會做這 <strong>3 件事</strong>，依序為：</p>
<ol>
<li>更新<code>pyproject.toml</code>。</li>
<li>依照<code>pyproject.toml</code>的內容，更新<code>poetry.lock</code>——相當於執行<code>poetry lock</code>指令。</li>
<li>依照<code>poetry.lock</code>的內容，更新虛擬環境——相當於<code>poetry install</code>指令。</li>
</ol>
<blockquote>
<p>為什麼知道這個<strong>很重要？</strong></p>
</blockquote>
<p>因為當你不是使用<code>poetry add</code>指令，而是直接修改<code>pyproject.toml</code>時，此時上述的第 2、3 步<strong>都不會自動執行</strong>。</p>
<p>但你手動修改 toml 檔，最終就是為了變更虛擬環境，所以在更新完<code>pyproject.toml</code>後，我們還要再使用<code>poetry lock</code>與<code>poetry install</code>指令才行！</p>
<p>對於不熟悉上述流程的初學者，<strong>很容易遺漏，並感到困惑。</strong></p>
<h3 id="重點二：-group"><a href="#重點二：-group" class="headerlink" title="重點二：--group"></a>重點二：<code>--group</code></h3><p><strong>舊版</strong>（1.1.x）只有 main 和 dev 兩種虛擬環境設定，<strong>新版</strong>（1.2.0）增加了<code>--group</code>參數，讓你可以除了 main 和 dev 外，還有能自訂多種 group，增加使用上的彈性。</p>
<p>比如可以命名不同的群組如下：</p>
<ul>
<li>test</li>
<li>dev</li>
<li>prod</li>
</ul>
<p>基本語法（後續還會提及）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry add pytest --group dev</span><br></pre></td></tr></table></figure>

<p>在新版（1.2）的<code>pyproject.toml</code>中會如此記載：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.poetry.group.dev.dependencies]</span></span><br><span class="line"><span class="attr">pytest</span> = <span class="string">&quot;^6.0.0&quot;</span></span><br><span class="line"><span class="attr">pytest-mock</span> = <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<p>而舊版則是：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Poetry pre-1.2.x style, understood by Poetry 1.0–1.2</span></span><br><span class="line"><span class="section">[tool.poetry.dev-dependencies]</span></span><br><span class="line"><span class="attr">pytest</span> = <span class="string">&quot;^6.0.0&quot;</span></span><br><span class="line"><span class="attr">pytest-mock</span> = <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<p>兩者的<strong>差異</strong>，是版本過渡時要特別注意的。</p>
<p>雖然彈性變大，但我個人目前還是只有使用 main 和 dev 而已，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry add black --group dev</span><br></pre></td></tr></table></figure>

<h3 id="poetry-demo-操作-1"><a href="#poetry-demo-操作-1" class="headerlink" title="poetry-demo 操作"></a>poetry-demo 操作</h3><p>至此，我們來安裝 Django 3.2.x 至 main dependencies 中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">❯ poetry add django@^3.2</span><br><span class="line"></span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (0.5s)</span><br><span class="line"></span><br><span class="line">Package operations: 5 installs, 0 updates, 0 removals</span><br><span class="line"></span><br><span class="line">  • Installing typing-extensions (4.6.3)</span><br><span class="line">  • Installing asgiref (3.7.2)</span><br><span class="line">  • Installing pytz (2023.3)</span><br><span class="line">  • Installing sqlparse (0.4.4)</span><br><span class="line">  • Installing django (3.2.19)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、安裝套件至-dev-dependencies"><a href="#七、安裝套件至-dev-dependencies" class="headerlink" title="七、安裝套件至 dev dependencies"></a>七、安裝套件至 dev dependencies</h2><p>上篇文章中，我們已經探討過「<a href="https://blog.kyomind.tw/python-poetry/#%E6%96%B0%E5%A2%9E%E5%A5%97%E4%BB%B6%E8%87%B3-dev-dependencies">明確區分開發環境專用的套件</a>」的重要性。</p>
<p>舊版的指令是這樣的，以<code>black</code>為例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry add black --dev</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">poetry add black -D</span><br></pre></td></tr></table></figure>

<p>然而<code>--dev (-D)</code>在新版<a target="_blank" rel="noopener" href="https://python-poetry.org/docs/cli/#options-4">已棄用</a>：</p>
<blockquote>
<p>• <code>--dev (-D)</code>: Add package as development dependency. (Deprecated, use <code>-G dev</code> instead)</p>
</blockquote>
<p>因為加入了 group 機制，新版的指令<strong>略有不同</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry add black --group dev</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">poetry add black -G dev</span><br></pre></td></tr></table></figure>

<p>講白了就是變囉嗦了！</p>
<p>此時的 toml 檔內容如下：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.poetry]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;poetry-demo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;kyo &lt;odinxp@gmail.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">packages</span> = [&#123;include = <span class="string">&quot;poetry_demo&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;^3.8&quot;</span></span><br><span class="line"><span class="attr">django</span> = <span class="string">&quot;^3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.group.dev.dependencies]</span></span><br><span class="line"><span class="attr">black</span> = <span class="string">&quot;^23.3.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-system]</span></span><br><span class="line"><span class="attr">requires</span> = [<span class="string">&quot;poetry-core&quot;</span>]</span><br><span class="line"><span class="attr">build-backend</span> = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、poetry-install-sync"><a href="#八、poetry-install-sync" class="headerlink" title="八、poetry install --sync"></a>八、<code>poetry install --sync</code></h2><p>不久前才發現，虛擬環境用久了，安裝的套件似乎和 lock 檔不完全一致！我一直以為兩者是一定同步的🐸，顯然不是。</p>
<p>參考<a target="_blank" rel="noopener" href="https://python-poetry.org/docs/managing-dependencies/#synchronizing-dependencies">文件</a>，可用下列指令確保同步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry install --<span class="built_in">sync</span></span><br></pre></td></tr></table></figure>

<h2 id="九、Docker-環境中使用-Poetry"><a href="#九、Docker-環境中使用-Poetry" class="headerlink" title="九、Docker 環境中使用 Poetry"></a>九、Docker 環境中使用 Poetry</h2><p>前文中有<a href="https://blog.kyomind.tw/python-poetry/#%E4%BA%94%E3%80%81%E7%82%BA%E4%BB%80%E9%BA%BC%E6%88%91%E4%B8%8D%E5%9C%A8-Docker-%E7%92%B0%E5%A2%83%E4%B8%AD%E4%BD%BF%E7%94%A8-Poetry%EF%BC%9F">這麼一段</a>，闡述我不在 Docker 中使用 Poetry 的<strong>理由</strong>與<strong>替代方案</strong>：</p>
<blockquote>
<p>所幸 Poetry 依舊可以輸出<code>requirements.txt</code>，Docker 部署環境就繼續使用這個舊方案即可，而且 Poetry 本來主要就是用於「開發」時的套件管理，對部署差別不大。</p>
</blockquote>
<p>說是這樣說，但一年多用下來，我發現這個做法也<strong>不盡理想</strong>，它至少存在<strong>兩個問題</strong>：</p>
<ol>
<li>套件有變動時，常常會<strong>忘記匯出</strong><code>requirements.txt</code>。你可以說這是人的問題，但這個 export <code>requirements.txt</code>做法，就<strong>真的</strong>很容易讓人忘記🤣</li>
<li>由 Poetry 匯出的<code>requirements.txt</code>，不一定能透過 pip 正常安裝套件——兩者存在<strong>輕微的相容性問題</strong>。</li>
</ol>
<p>怎麼解？我在原文也已經補充了：</p>
<blockquote>
<p>使用 <strong><a target="_blank" rel="noopener" href="https://docs.docker.com/build/building/multi-stage/">multi-stage builds</a></strong> 的 Dockerfile，可以在第一階段安裝 Poetry，第二階段再把 Poetry 捨棄，這樣就不會有多餘的耦合與依賴了。日後會專文介紹。</p>
</blockquote>
<p>對，所以系列的第三篇會把這部分補完。</p>

      </div>

      

      
      

<div>
  <script type="text/javascript">
    document.write(
      "<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/kyomind/button?referrer=" +
      encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");
  </script>
<div>

<div>
  <a href="https://portaly.cc/kyomind/support" target="_blank" class="cta">
    <span>支持我的創作</span>
    <svg viewBox="0 0 13 10" height="10px" width="15px">
      <path d="M1,5 L11,5"></path>
      <polyline points="8 1 12 5 8 9"></polyline>
    </svg>
  </a>
</div>
<br>

    <b style="font-size:21px">
      相關文章
    </b><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/python-poetry/" title="Python 套件管理器——Poetry 完全入門指南" rel="bookmark">Python 套件管理器——Poetry 完全入門指南</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/pyenv-setup/" title="告別 Anaconda：在 macOS 上使用 pyenv 建立 Python 開發環境" rel="bookmark">告別 Anaconda：在 macOS 上使用 pyenv 建立 Python 開發環境</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/ubuntu-pyenv/" title="Ubuntu 安裝使用 pyenv + pyenv-virtualenv" rel="bookmark">Ubuntu 安裝使用 pyenv + pyenv-virtualenv</a></h3></div></li></ul><footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/Python/">Python</a>
            <a href="/tags/pyproject-toml/">pyproject.toml</a>
            <a href="/tags/Docker/">Docker</a>
            <a href="/tags/pyenv/">pyenv</a>
            <a href="/tags/virtualenv/">virtualenv</a>
            <a href="/tags/Poetry/">Poetry</a>
            <a href="/tags/pip/">pip</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/weekly-review-18/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">18，論軟體工程師常見的「路徑依賴」問題（上）</span>
        <span class="prev-text nav-mobile">18，論軟體工程師常見的「路徑依賴」問題（上）</span>
      </a>
    <a class="next" href="/weekly-review-19/">
        <span class="next-text nav-default">19，AI 時代的生存指南（二）數位斷捨離</span>
        <span class="next-text nav-mobile">19，AI 時代的生存指南（二）數位斷捨離</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    
      

<div style="background-color: #e7e9ec; border-radius: 5px;">
  <div class="categories">
    <div class="categories-tags">
      <a class="category-link" href="/categories/Django/">Django<span class="category-count">12</span></a> <a class="category-link" href="/categories/Django-Ninja-%E7%B3%BB%E5%88%97/">Django Ninja 系列<span class="category-count">26</span></a> <a class="category-link" href="/categories/Docker/">Docker<span class="category-count">2</span></a> <a class="category-link" href="/categories/VS-Code/">VS Code<span class="category-count">9</span></a> <a class="category-link" href="/categories/Weekly-Review/">Weekly Review<span class="category-count">38</span></a> <a class="category-link" href="/categories/%E5%BF%83%E5%BE%97/">心得<span class="category-count">38</span></a> <a class="category-link" href="/categories/%E6%9B%B8%E8%A9%95-%C3%97-%E7%AD%86%E8%A8%98/">書評 × 筆記<span class="category-count">13</span></a> <a class="category-link" href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發<span class="category-count">24</span></a>
    </div>
  </div>
</div>
</article></div><div class="comments" id="comments"><div id="utterances-container"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:odinxp@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://x.com/kyomind" class="iconfont icon-twitter" title="twitter"></a>
        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/kyo-huang/" class="iconfont icon-linkedin" title="linkedin"></a>
        <a target="_blank" rel="noopener" href="https://github.com/kyomind" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">and</span>
  <span class="theme-info">
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2021 - 2024<span class="heart">
      <i class="iconfont icon-right"></i>
    </span>
    <span class="author">Kyo Huang</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script>
    var container = document.getElementById('utterances-container')
    var script = document.createElement('script')
    script.src = 'https://utteranc.es/client.js'
    script.setAttribute('repo', 'kyomind/blog-reply')
    script.setAttribute('issue-term', 'title')
    script.setAttribute('theme', 'github-light')
    script.setAttribute('label', 'utterances')
    script.crossorigin = 'anonymous'
    script.async = true

    container.appendChild(script)
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
