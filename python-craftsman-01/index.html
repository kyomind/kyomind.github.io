<!DOCTYPE html>
<html lang="zh-TW">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@kyomind">
<meta property="og:type" content="article"><meta name="twitter:title" content="《Python 工匠》筆記（一）如何寫好註解">
  <meta property="og:title" content="《Python 工匠》筆記（一）如何寫好註解"><meta name="twitter:description" content="寫好程式碼註解，一直都不是件容易的事。本書討論了三種常見的註解錯誤，從而提出寫好註解的基本原則與建議。">
  <meta property="og:description" content="寫好程式碼註解，一直都不是件容易的事。本書討論了三種常見的註解錯誤，從而提出寫好註解的基本原則與建議。"><meta name="twitter:image" content="https://i.imgur.com/beoEztr.png">
  <meta property="og:image" content="https://i.imgur.com/beoEztr.png">
<meta name="description" content="寫好程式碼註解，一直都不是件容易的事。本書討論了三種常見的註解錯誤，從而提出寫好註解的基本原則與建議。" />


<meta property="og:locale" content="zh-TW" />
<meta property="og:site_name" content="Code and Me" />
<meta property="article:publisher" content="https://blog.kyomind.tw" />
<meta property="article:author" content="Kyo" /><meta property="article:section" content="書評 × 筆記" />
            <meta property="og:tag" content="書" />
    <meta property="og:tag" content="Python" />
    <meta property="og:tag" content="Clean Code" />
    <meta property="og:tag" content="閱讀筆記" />
    

  <meta property="article:modified_time" content="2024-03-03T05:43:21+08:00" />





  <meta property="article:published_time" content="2024-02-28T04:40:57+08:00" />



<meta name="keywords" content="Python, 程式, 寫作, Notion, VS Code, Logseq" />
<meta name="author" content="Kyo" />
<meta http-equiv="content-language" content="zh-TW" />
<link rel="alternate" href="/atom.xml" title="Code and Me" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/leaf.svg?v=2.11.0" />
<link rel="canonical" href="https://blog.kyomind.tw/python-craftsman-01/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NL7WVE1X7Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL7WVE1X7Z');

</script><script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":false,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>《Python 工匠》筆記（一）如何寫好註解 - Code and Me</title>
  <meta name="generator" content="Hexo 6.3.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Code and Me</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/archives/">
        <li class="mobile-menu-item">文章列表
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分類
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">標籤
          </li>
      </a><a href="/top/">
        <li class="mobile-menu-item">熱門
          </li>
      </a><a href="/subscribe/">
        <li class="mobile-menu-item">訂閱
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">關於
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Code and Me</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu"><li class="menu-item">
        <a class="menu-item-link" href="/archives/">
          文章列表
          </a>
      </li>
    <li class="dropdown">
        <a class="menu-item-link" href="/categories/">
          分類 <b><span style="position: relative; top: -3px;">⌵</span></b>
          </a>
        <div class="dropdown-content">
          
            <a href="/categories/%E5%BF%83%E5%BE%97/">心得 (34)</a>
          
            <a href="/categories/%E6%9B%B8%E8%A9%95-%C3%97-%E7%AD%86%E8%A8%98/">書評 × 筆記 (7)</a>
          
            <a href="/categories/Django/">Django (5)</a>
          
            <a href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發 (19)</a>
          
            <a href="/categories/VS-Code/">VS Code (9)</a>
          
            <a href="/categories/Docker/">Docker (2)</a>
          
            <a href="/categories/Weekly-Review/">Weekly Review (24)</a>
          
        </div>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/tags/">
          標籤
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/top/">
          熱門
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/subscribe/">
          訂閱
          </a>
      </li>
    <li class="menu-item">
        <a class="menu-item-link" href="/about/">
          關於
          </a>
      </li>
    </ul>
</nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">《Python 工匠》筆記（一）如何寫好註解
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2024-02-28
        </span><span class="post-update">
            →  2024-03-03
          </span>
        <span class="post-category">
            <a href="/categories/%E6%9B%B8%E8%A9%95-%C3%97-%E7%AD%86%E8%A8%98/">書評 × 筆記</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目錄</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%AB%E5%A5%BD-Python-%E8%A8%BB%E8%A7%A3"><span class="toc-text">如何寫好 Python 註解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python-%E8%A8%BB%E8%A7%A3%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98"><span class="toc-text">Python 註解基礎知識</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E6%89%8B%E5%B8%B8%E7%8A%AF%E7%9A%84%E4%B8%89%E7%A8%AE%E8%A8%BB%E8%A7%A3%E9%8C%AF%E8%AA%A4"><span class="toc-text">新手常犯的三種註解錯誤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%9B%B4%E6%8E%A5%E8%A8%BB%E8%A7%A3%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="toc-text">一、直接註解程式碼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%83%85%E7%94%A8%E8%A8%BB%E8%A7%A3%E3%80%8C%E9%87%8D%E8%BF%B0%E3%80%8D%E7%A8%8B%E5%BC%8F%E7%A2%BC%E8%A1%8C%E7%82%BA"><span class="toc-text">二、僅用註解「重述」程式碼行為</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%BC%95%E5%9E%8B%E8%A8%BB%E8%A7%A3"><span class="toc-text">指引型註解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E7%85%89%E7%82%BA%E7%8D%A8%E7%AB%8B%E5%87%BD%E5%BC%8F"><span class="toc-text">提煉為獨立函式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%BC%84%E9%8C%AF%E8%A8%BB%E8%A7%A3%E7%9A%84%E3%80%8C%E5%8F%97%E7%9C%BE%E3%80%8D"><span class="toc-text">三、弄錯註解的「受眾」</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E8%A8%80%E8%87%AA%E8%AA%9E%E7%9A%84%E8%A8%BB%E8%A7%A3"><span class="toc-text">自言自語的註解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docstring-%E8%88%87%E8%AE%80%E8%80%85%E6%84%8F%E8%AD%98"><span class="toc-text">Docstring 與讀者意識</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%BD%E7%9A%84%E7%A8%8B%E5%BC%8F%E7%A2%BC%E5%88%B0%E5%BA%95%E9%9C%80%E4%B8%8D%E9%9C%80%E8%A6%81%E8%A8%BB%E8%A7%A3%EF%BC%9F"><span class="toc-text">好的程式碼到底需不需要註解？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E8%80%85%E7%9A%84%E8%A7%80%E9%BB%9E%E8%88%87%E6%88%91%E7%9A%84%E7%9C%8B%E6%B3%95"><span class="toc-text">作者的觀點與我的看法</span></a></li></ol>
    </div>
  </div><div class="post-content"><p><img src="https://i.imgur.com/beoEztr.png" alt="Python 工匠"><span class="cap">Python 工匠</span></p>
<p>這是《<a target="_blank" rel="noopener" href="https://www.tenlong.com.tw/products/9786263245174">Python 工匠｜案例、技巧與開發實戰</a>》筆記的第 1 篇，你可以把它當作是一則重點整理，加上我個人的開發經驗與心得。</p>
<p>從書名推敲，我們並不容易知道本書的主題為何。事實上，和《<a target="_blank" rel="noopener" href="https://www.tenlong.com.tw/products/9789865027711">Python 功力提升的樂趣</a>》類似，這是一本關於「<strong>Clean Code in Python</strong>」的書。</p>
<p>而且我認為它的<strong>難度適中</strong>（好吧，後半部難度比較高，而且本書<strong>「不適合」</strong>初學者），非常推薦看完《Python 功力提升的樂趣》後，想要更進一步寫出 Pythonic 程式碼的讀者與開發人員。</p>
<p>我覺得，兩本恰恰都是屬於「從書名看很容易被忽略」的好書。因此，作為喜歡本書的讀者，我覺得自己有<strong>義務</strong>，向你們轉述書中一些值得傳誦的內容。</p>
<p>這也是「<a href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/">閱讀筆記</a>」系列的核心精神。</p>
<span id="more"></span>

<hr>
<h2 id="如何寫好-Python-註解"><a href="#如何寫好-Python-註解" class="headerlink" title="如何寫好 Python 註解"></a>如何寫好 Python 註解</h2><p>本文整理第一章的其中一部分——關於「如何寫好註解」的討論。</p>
<p>之所以要特別寫成筆記，是因為這是我目前看過的書中，討論註解時講最得好的一本。尤其是一些使用上的建議，和我的開發經驗與價值觀可謂非常吻合！</p>
<p>本書作者朱雷（<a target="_blank" rel="noopener" href="https://github.com/piglei">piglei</a>），擁有超過 10 年的 Python 開發經驗，精通 Python 語言特性，對如何開發高品質的大型 Python 專案有獨到見解。</p>
<p>其實我一直也想整理一篇關於寫好註解的基本守則，但遲遲沒有行動。但現在有這本書，我只要整理書中的內容，並加上自己的看法即可。</p>
<p>有關 Python 註解或 docstring 的討論，我在過去多篇文章中都有提到，可參考如下：</p>
<ul>
<li><a href="https://blog.kyomind.tw/beyond-the-basic-stuff-with-python-03/#%E4%B8%80%E3%80%81Docstring-%E7%9C%9F%E7%9A%84%E5%BE%88%E9%87%8D%E8%A6%81">Docstring 真的很重要</a></li>
<li><a href="https://blog.kyomind.tw/beyond-the-basic-stuff-with-python-01/#%E8%A8%BB%E8%A7%A3%E6%98%AF%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%EF%BC%9F">註解是不需要的？</a></li>
<li><a href="https://blog.kyomind.tw/good-vscode-extensions/#Python-docstring-%E4%B9%8B%E6%88%91%E8%A6%8B">Python docstring 之我見</a></li>
</ul>
<p>開始正文。</p>
<hr>
<h2 id="Python-註解基礎知識"><a href="#Python-註解基礎知識" class="headerlink" title="Python 註解基礎知識"></a>Python 註解基礎知識</h2><p>Python 中，一般我們講到註解，指的是程式碼中的註解，用<code>#</code>來實現。</p>
<p>而 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Docstring">docstring</a> 則是另一種更具有 Python 特色的註解。主要寫在模組、類別、與函式的開頭，並透過物件的<code>__doc__</code>屬性，自然地化為程式碼的一部分。</p>
<p>書中提到了 docstring 的幾種常見風格（畢竟它本質只是一堆字串，所以怎麼寫都行），最常見的為 Sphinx 文件風格。而我個人在工作上最常用的，則是 <a target="_blank" rel="noopener" href="https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html">Google 風格</a>。</p>
<p>簡言之，下面提到「註解」二字時，對上述兩種 Python 註解都適用。</p>
<h2 id="新手常犯的三種註解錯誤"><a href="#新手常犯的三種註解錯誤" class="headerlink" title="新手常犯的三種註解錯誤"></a>新手常犯的三種註解錯誤</h2><p>你可能聽過「很多註解都是爛註解」這種說法。不得不承認，這相當程度是對的！我確實看過很多爛註解——但這不是我們因此不寫註解的理由。</p>
<p>實務上會有很多爛註解，正是因為我們沒有正視註解的價值，認真學習如何寫好註解。</p>
<p>因此，<strong>就讓我們用書中所舉三種常見的註解錯誤，作為學習的切入點。</strong></p>
<p>書中提到的這三點——尤其是第 3 點，應盡可能避免。作者也提出了相應的解決之道，而我會適時補充我的看法。</p>
<p>附帶一提，本書是從作者過去的網路文章整理、出版——但內容增加了很多。而且作者也很大方，在網路上公開了部分的內容。而本文整理的部分恰恰是公開的部分。有興趣的話可以直接參考<a target="_blank" rel="noopener" href="https://www.piglei.com/book/ch01_variables.html">本頁</a>。</p>
<p>當然，我還是強烈建議，為自己入手一本，你絕對不會後悔。</p>
<hr>
<h2 id="一、直接註解程式碼"><a href="#一、直接註解程式碼" class="headerlink" title="一、直接註解程式碼"></a>一、直接註解程式碼</h2><p>把已經寫完但暫不需要（以後是否需要還不確定）的程式碼，先註解起來，方便日後需要時可以快速「還原」，絕對是我們非常熟悉的手段。</p>
<p>我回想一下，不得不說，這類被註解的程式碼，<strong>十之八九都是不會再用到了！</strong>如果這類「程式碼註解」愈積愈多，真的會讓人看了很「阿雜」！</p>
<p>所以基本上，現在比較正規的做法，都是建議你直接刪除，以後真的需要時，再透過版控回復即可。</p>
<p>對此我基本認同，所以工作上 code review 時，我「不會」放行這種直接註解的程式碼。</p>
<h3 id="僅有的例外"><a href="#僅有的例外" class="headerlink" title="僅有的例外"></a>僅有的例外</h3><p>但，你我都知道，有時事情也沒那麼簡單。</p>
<p>用 Git 版控回復的前提是：你的團隊 commit 記錄要寫好！不然真的要「回復」的時候，你可能連它在哪一個 commit 都要找好一陣子。</p>
<p>所以，基於方便與實際考量，事實上我還是有<strong>一點點折衷</strong>：原則上不可以註解程式碼，但如果確定只是「<strong>暫時</strong>」用不到，等別的元件完成後，就會繼續開發、使用，例外可以暫時註解就好——但必須加上 <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0350/">codetag</a> 標記。</p>
<p>一般我們用 <code>TODO</code> 這個 codetag。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TODO 日後改回一對一時，請用下面方式重寫：</span></span><br><span class="line"><span class="comment"># user = User.objects.select_related(&#x27;oversee_tenant&#x27;)</span></span><br><span class="line"><span class="comment"># .prefetch_related(&#x27;oversee_projects&#x27;).get(user_uuid=user_uuid)</span></span><br></pre></td></tr></table></figure>

<p>不過<strong>大原則</strong>還是：</p>
<blockquote>
<p><strong>別註解了，刪除吧！</strong></p>
</blockquote>
<hr>
<h2 id="二、僅用註解「重述」程式碼行為"><a href="#二、僅用註解「重述」程式碼行為" class="headerlink" title="二、僅用註解「重述」程式碼行為"></a>二、僅用註解「重述」程式碼行為</h2><p>這應該是我們最常看到的爛註解的形式，也是你在所有討論程式碼註解的書中，一定會提及的。</p>
<p>而且它真的爛，沒有藉口。比如這樣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化 x 為 0</span></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 檢查 x 是否小於 10</span></span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">10</span>:</span><br><span class="line">    <span class="comment"># 印出 x 小於 10</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x is less than 10&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>這當然是一個誇張的例子🤣。但在日常開發中，這種「脫褲子放屁」的註解還真的不算少見。</p>
<p>確實，如果我常常看到這樣的註解，恐怕真的會忍不住說出「你還別寫註解了吧！」</p>
<p>但，請不要放棄治療！</p>
<p>想避免這個問題，請遵守一個簡單且常見的大原則，如書中所言：</p>
<blockquote>
<p>應該儘量提供那些讀者<strong>無法</strong>從程式碼裡讀出來的資訊。描述程式<strong>為什麼</strong>要這麼做，而不是簡單複述程式碼本身。</p>
</blockquote>
<p>不過，光寫「為什麼」註解，有時候還是遠遠不夠的。</p>
<h2 id="指引型註解"><a href="#指引型註解" class="headerlink" title="指引型註解"></a>指引型註解</h2><p>因此，本書更進一步提出所謂的「<strong>指引性註解</strong>」：</p>
<blockquote>
<p>這種註解並不「直接」複述程式，而是簡明扼地概括程式碼功能，起到「<strong>程式碼導讀</strong>」的效果。</p>
</blockquote>
<p>書中的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化存取服務的 client 物件</span></span><br><span class="line">token = token_service.get_token()</span><br><span class="line">service_client = ServiceClient(token=token)</span><br><span class="line">service_client.ready()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 呼叫服務取得資料，然後進行過濾</span></span><br><span class="line">data = service_client.fetch_full_data()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">if</span> item.value &gt; SOME_VALUE:</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>不難看出，這種描述「程式碼流程大綱」的指引型註解，<strong>很像 docstring 在做的事</strong>。從這個角度，我們可以說 docstring <strong>也是</strong>一種指引型註解。</p>
<p>但是，docstring 畢竟只出現在元件的「<strong>開頭</strong>」，對複雜的程式而言，在元件的內部，往往也需要這樣的註解，作為閱讀<strong>複雜程式碼</strong>的指引。</p>
<p>要寫好指引型註解，甚至知曉「什麼時候」應該要寫下指引型註解，需要你內心清楚——「這段程式碼的哪些部分，別人可能會看不懂！」</p>
<p>這是為什麼我總說，要寫好註解，就一定要培養好「<strong>讀者意識</strong>」的理由。</p>
<h3 id="指引型註解的價值"><a href="#指引型註解的價值" class="headerlink" title="指引型註解的價值"></a>指引型註解的價值</h3><p>前面提到，寫註解時「應該儘量提供那些讀者<strong>無法從程式碼裡讀出來</strong>的資訊」，這是我們寫註解的大原則。</p>
<p>但指引性註解和上述註解<strong>所有區別</strong>，它的<strong>獨特價值</strong>，如書中所言：</p>
<blockquote>
<p>指引性註解<strong>並不提供</strong>程式碼裡<strong>讀不到</strong>的東西——如果沒有註解，耐心讀完所有程式碼，你也能知道程式做了什麼事。指引性註解的主要作用是<strong>降低程式碼的認知成本</strong>，讓我們能<strong>更容易理解</strong>程式碼的<strong>意圖</strong>。</p>
</blockquote>
<p>說得非常好。</p>
<h2 id="提煉為獨立函式"><a href="#提煉為獨立函式" class="headerlink" title="提煉為獨立函式"></a>提煉為獨立函式</h2><p>對於複雜而冗長的程式流程，書寫「指引性註解」是一個協助閱讀理解的好方法。</p>
<p>而另一個有效的方法，就是把這些程式碼片段<strong>獨立成一個又一個的函式</strong>，透過<strong>有意義的函式名稱</strong>來描述流程、展現意圖，此時就可以刪除指引性註解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service_client = make_client()</span><br><span class="line">data = fetch_and_filter(service_client)</span><br></pre></td></tr></table></figure>

<p>其中的重點在於，你要能判斷，什麼時候該寫「指引性註解」，而什麼時候則適合獨立成函式、方法。</p>
<p>這當然需要經驗累積，但我們心中要先有這樣的意識，不是嗎？</p>
<hr>
<h2 id="三、弄錯註解的「受眾」"><a href="#三、弄錯註解的「受眾」" class="headerlink" title="三、弄錯註解的「受眾」"></a>三、弄錯註解的「受眾」</h2><p>本書這段主要適用的是 docstring，不過我覺得「指引型註解」也有類似議題，所以本段提到「註解」一詞時，皆包括這兩者。</p>
<p>註解的正確<strong>受眾</strong>，或說<strong>讀者</strong>，應該是誰？我想基本上是這兩種人：</p>
<ol>
<li><strong>未來</strong>的自己（注意「未來」二字）</li>
<li>專案<strong>協作者</strong>（同事、主管）</li>
</ol>
<p>我們先看看書中所舉的「反例」：（我直接引用<a target="_blank" rel="noopener" href="https://www.piglei.com/book/ch01_variables.html">網頁</a>上的內容，所以技術名詞並非台灣用語，還請見諒）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">resize_image</span>(<span class="params">image, size</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;將圖片縮放為指定尺寸，並返回新的圖片。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    該函數將使用 Pilot 模塊讀取文件對象，然後調用 .resize() 方法將其縮放為指定尺寸。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    但由於 Pilot 模塊自身限制，這個函數不能很好的處理尺寸過大的文件，當文件大小</span></span><br><span class="line"><span class="string">    超過 5MB 時，resize() 方法的性能就會因為內存分配問題急劇下降，詳見 Pilot 模塊的</span></span><br><span class="line"><span class="string">    Issue #007。因此，對於超過 5MB 的圖片文件，請使用 resize_big_image() 替代，後者</span></span><br><span class="line"><span class="string">    基於 Pillow 模塊開發，很好的解決了內存分配問題，性能更好。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param image: 圖片文件對象</span></span><br><span class="line"><span class="string">    :param size: 包含寬高的元組：（width, height）</span></span><br><span class="line"><span class="string">    :return: 新圖片對象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>這個例子的最大問題，是寫了太多「實作細節」，講白了就是提供了「太多」程式碼的讀者<strong>並不關心</strong>的內容！</p>
<blockquote>
<p>為什麼這樣是不妥的？細節不是很好嗎？</p>
</blockquote>
<p>對，但大部分時候，docstring 或「指引型註解」的主要寫作<strong>目的</strong>，是為了讓讀者<strong>不用一行一行閱讀程式碼</strong>，就能夠快速知道目前程式碼的<strong>流程與意圖</strong>。</p>
<p>這種過多細節的寫法，恰恰與這個目標<strong>背道而馳</strong>——增加了太多理解上的「<strong>雜訊</strong>」。</p>
<p>書中給出的改善版本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">resize_image</span>(<span class="params">image, size</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;將圖片縮放為指定尺寸，並返回新的圖片。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    注意：當文件超過 5MB 時，請使用 resize_big_image()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param image: 圖片文件對象</span></span><br><span class="line"><span class="string">    :param size: 包含寬高的元組：（width, height）</span></span><br><span class="line"><span class="string">    :return: 新圖片對象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>以下主要是我自己的看法。</p>
<h2 id="自言自語的註解"><a href="#自言自語的註解" class="headerlink" title="自言自語的註解"></a>自言自語的註解</h2><p>你有沒有一個疑問，為什麼說註解寫了太多細節，是「弄錯受眾」？</p>
<p>我是這樣看的：留下這麼多細節的註解，與其說是註解，更像寫給自己看的<strong>筆記</strong>——而且是給「現在」的自己，真的就像在作筆記一樣！</p>
<p>我想強調，<strong>「現在的自己」並不是註解的受眾！</strong>因為現在的自己對程式細節非常清楚，即使沒有註解也能讀懂程式碼。</p>
<p>相反的，註解是為<strong>沒時間慢慢讀程式碼</strong>的人服務的。</p>
<p>未來的你，再回來看這段程式，絕對不會想要在 docstring 看到這麼多「<strong>廢話</strong>」。這種寫法無疑是搞錯了對象。</p>
<p>當然，你的同事也不會想看這麼多雜訊——同事往往更關心「這函式到底要怎麼用」！</p>
<h3 id="抽象層次混亂"><a href="#抽象層次混亂" class="headerlink" title="抽象層次混亂"></a>抽象層次混亂</h3><p>我覺得還有另一種「弄錯受眾」的註解也很經典，甚至更加常見！那就是混合底層實作與業務邏輯：</p>
<blockquote>
<p>註解中參雜了業務邏輯，又不時會出現底層實作的細節描述。</p>
</blockquote>
<p>事實上，我倒覺得實務中會願意寫一大串 docstring 的人，可以說是少之又少。大部分的問題其實是：有寫，但寫得「<strong>零零落落</strong>」。</p>
<h2 id="Docstring-與讀者意識"><a href="#Docstring-與讀者意識" class="headerlink" title="Docstring 與讀者意識"></a>Docstring 與讀者意識</h2><p>Docstring 絕對能看出一個人的<strong>基本寫作能力</strong>，以及是否具備「<strong>讀者意識</strong>」。</p>
<p>說真的，這不止是作為一個軟體工程師的核心技能——更是任何<strong>表達者</strong>的核心技能。而程式，只是表達的其中一種形式。</p>
<p>我很想要寫一篇「如何寫好 docstring」，這需要再構思一番。但常見的錯誤不外乎：</p>
<ol>
<li><strong>預知能力</strong>：知曉「函式以外」的事、不僅知道函式會怎麼、何時被調用，還會在 docstring 中寫下呼叫時的情境細節——<strong>你知道的太多了！</strong></li>
<li><strong>太多底層細節</strong>：跟前面的書中內容相似，只是我覺得現實中，往往是<strong>東寫一點、西寫一點</strong>，不會像寫筆記一般完整——所以讀起來更痛苦，真的是自言自語！除了開發者自己，誰能輕易讀懂那些細節？</li>
<li><strong>業務邏輯與底層實作的用詞混雜</strong>：一下子是「無法取得租戶資訊」一下子卻又是「防止 SQL insert 錯誤、RabbitMQ 如何如何」——讓人大腦很混亂。</li>
</ol>
<p>總的來說，無論是「自言自語」還是「抽象層次混亂」，它們的本質都差不多——這些註解都像是寫給「<strong>現在的自己</strong>」看的<strong>筆記</strong>。</p>
<p>但就像前面說的，現在的自己是<strong>最不需要看註解的人</strong>！所以才說是「弄錯受眾」了。</p>
<hr>
<p>最後不免俗地，我們要討論，提到「程式碼註解」就<strong>一定避不開的問題</strong>：</p>
<blockquote>
<p><strong>到底要不要寫註解</strong>？</p>
</blockquote>
<h2 id="好的程式碼到底需不需要註解？"><a href="#好的程式碼到底需不需要註解？" class="headerlink" title="好的程式碼到底需不需要註解？"></a>好的程式碼到底需不需要註解？</h2><p>寫程式到底要不要寫註解，一直有兩派說法，是個老掉牙又爭論不休的問題。我們先來看看這兩派的觀點。（ ChatGPT 整理）</p>
<h3 id="寫註解的一派"><a href="#寫註解的一派" class="headerlink" title="寫註解的一派"></a>寫註解的一派</h3><p>這派人認為註解是<strong>程式碼的一部分</strong>，應該寫註解，主要論點為：</p>
<ol>
<li><strong>可讀性提升</strong>：註解能夠幫助人們<strong>更快理解程式碼的意圖和複雜的邏輯</strong>，尤其是對於那些<strong>不那麼直觀的部分</strong>。</li>
<li><strong>溝通工具</strong>：註解被視為開發者之間的<strong>溝通方式</strong>，尤其在團隊協作時，能夠快速傳遞開發者的想法和注意事項。</li>
<li><strong>提醒與說明</strong>：註解可以用來提醒未來可能的問題，或是對程式碼中的決策提供背景說明。</li>
</ol>
<h3 id="不寫註解的一派"><a href="#不寫註解的一派" class="headerlink" title="不寫註解的一派"></a>不寫註解的一派</h3><p>相對的，這派人認為好的程式碼應該是<strong>自解釋</strong>的，不需要註解，主要論點為：</p>
<ol>
<li><strong>程式碼即文件</strong>：好的程式碼應該是自解釋的，如果你需要註解來解釋你的程式碼，那麼問題可能出在程式碼本身。</li>
<li><strong>增加維護難度</strong>：註解需要維護，<strong>不一致的註解比沒有註解更糟</strong>，因為它會導致誤解和混淆。</li>
<li><strong>過度依賴註解</strong>：過多的註解可能會讓開發者過度依賴於它們來理解程式碼，忽視了提高程式碼品質的重要性。</li>
</ol>
<hr>
<h2 id="作者的觀點與我的看法"><a href="#作者的觀點與我的看法" class="headerlink" title="作者的觀點與我的看法"></a>作者的觀點與我的看法</h2><p>細看這兩派的主張，我們可以看出，都有一定的道理——不然也不會爭論不休了。</p>
<h3 id="作者觀點"><a href="#作者觀點" class="headerlink" title="作者觀點"></a>作者觀點</h3><p>我們先來看看本書作者的觀點（引用難免斷章取義，完整上下文請參見本書第 15 頁），下面內容主要是回應「不寫註解的一派」：</p>
<blockquote>
<p>但我倒是認為事情沒那麼絕對。<strong>無論程式碼寫得多好，多麼「自說明」，跟讀程式碼相比，讀註解通常讓人覺得更輕鬆</strong>。</p>
</blockquote>
<blockquote>
<p>註解會讓人們<strong>覺得親切</strong>（尤其當註解是中文時），<strong>高品質的指引性註解確實會讓程式碼更易讀</strong>。有時抽象一個新函式，不見得就一定比一行註解加上幾行程式碼更好。</p>
</blockquote>
<p>第一段引用，其實就跟我在「<a href="https://blog.kyomind.tw/good-vscode-extensions/#Python-docstring-%E4%B9%8B%E6%88%91%E8%A6%8B">Python docstring 之我見</a>」中的主張一致：</p>
<blockquote>
<p>在我看來，無論程式寫得如何簡潔易讀，對一些比較複雜的函式或類別而言，docstring 終究是不可少的。<strong>因為文字的詮釋能力和程式碼相比，絕不在同一個層次</strong>，相信這也是為何 docstring 會有屬於自己的獨立 PEP 加以規範的理由。</p>
</blockquote>
<h3 id="我的看法"><a href="#我的看法" class="headerlink" title="我的看法"></a>我的看法</h3><p>既然都寫了這篇文章，想當然爾我是「<strong>支持</strong>」寫註解的一派。</p>
<p>不過，反對派說註解會<strong>增加維護難度</strong>，以及可能讓人<strong>更加依賴註解</strong>而忽略了提升程式碼品質，我覺得這樣的擔憂還是挺有道理的。</p>
<p>所以，對我來說，問題不在於「要不要寫註解？」，而是<strong>「怎麼樣才能寫好註解？」</strong>。這也是本文的創作初衷。</p>
<p>我的結論是：寫註解，<strong>但也要適度</strong>。並保持對「<strong>讀者意識</strong>」的敏感：<strong>不寫多餘的註解，也不寫自言自語的註解。</strong></p>
<h3 id="延伸閱讀"><a href="#延伸閱讀" class="headerlink" title="延伸閱讀"></a>延伸閱讀</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.explainthis.io/zh-hant/swe/a-philosophy-of-software-design/part3">《A Philosophy of Software Design》心得 3 — 寫程式時該寫註解 (comments) 嗎？如果要的話該怎麼寫？</a></li>
<li><a target="_blank" rel="noopener" href="https://www.facebook.com/darkthread.net/photos/a.345323768929153/1185728258222029/">【程序員的日常】程式註解該寫多細？</a></li>
</ul>

      </div>
      
      
      

<div>
  <script type="text/javascript">
    document.write(
      "<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/kyomind/button?referrer=" +
      encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");
  </script>
<div>

<div>
  <a href="https://portaly.cc/kyomind/support" target="_blank" class="cta">
    <span>支持我的創作</span>
    <svg viewBox="0 0 13 10" height="10px" width="15px">
      <path d="M1,5 L11,5"></path>
      <polyline points="8 1 12 5 8 9"></polyline>
    </svg>
  </a>
</div>
<br>

    <b style="font-size:21px">
      相關文章
    </b><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/beyond-the-basic-stuff-with-python-01/" title="《Python 功力提升的樂趣》筆記（一）Black、命名、壞味道" rel="bookmark">《Python 功力提升的樂趣》筆記（一）Black、命名、壞味道</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/beyond-the-basic-stuff-with-python-02/" title="《Python 功力提升的樂趣》筆記（二）Pythonic、行話、陷阱" rel="bookmark">《Python 功力提升的樂趣》筆記（二）Pythonic、行話、陷阱</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-title"><h3><a href="/beyond-the-basic-stuff-with-python-03/" title="《Python 功力提升的樂趣》筆記（三）函式、註解、docstring" rel="bookmark">《Python 功力提升的樂趣》筆記（三）函式、註解、docstring</a></h3></div></li></ul><footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/%E6%9B%B8/">書</a>
            <a href="/tags/Python/">Python</a>
            <a href="/tags/Clean-Code/">Clean Code</a>
            <a href="/tags/%E9%96%B1%E8%AE%80%E7%AD%86%E8%A8%98/">閱讀筆記</a>
            </div>
        
        <nav class="post-nav"><a class="next" href="/less-is-more/">
        <span class="next-text nav-default">為什麼你「不需要」所謂的人生管理系統</span>
        <span class="prev-text nav-mobile">為什麼你「不需要」所謂的人生管理系統</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    
      

<div style="background-color: #e7e9ec; border-radius: 5px;">
  <div class="categories">
    <div class="categories-tags">
      <a class="category-link" href="/categories/Django/">Django<span class="category-count">5</span></a> <a class="category-link" href="/categories/Docker/">Docker<span class="category-count">2</span></a> <a class="category-link" href="/categories/VS-Code/">VS Code<span class="category-count">9</span></a> <a class="category-link" href="/categories/Weekly-Review/">Weekly Review<span class="category-count">24</span></a> <a class="category-link" href="/categories/%E5%BF%83%E5%BE%97/">心得<span class="category-count">34</span></a> <a class="category-link" href="/categories/%E6%9B%B8%E8%A9%95-%C3%97-%E7%AD%86%E8%A8%98/">書評 × 筆記<span class="category-count">7</span></a> <a class="category-link" href="/categories/%E8%BB%9F%E9%AB%94%E9%96%8B%E7%99%BC/">軟體開發<span class="category-count">19</span></a>
    </div>
  </div>
</div>
</article></div><div class="comments" id="comments"><div id="utterances-container"></div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:odinxp@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://twitter.com/kyomind" class="iconfont icon-twitter" title="twitter"></a>
        <a target="_blank" rel="noopener" href="https://facebook.com/kyomind" class="iconfont icon-facebook" title="facebook"></a>
        <a target="_blank" rel="noopener" href="https://github.com/kyomind" class="iconfont icon-github" title="github"></a>
        <a target="_blank" rel="noopener" href="https://www.instagram.com/kyomind.tw/" class="iconfont icon-instagram" title="instagram"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">and</span>
  <span class="theme-info">
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2021 - 2024<span class="heart">
      <i class="iconfont icon-right"></i>
    </span>
    <span class="author">Kyo</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script>
    var container = document.getElementById('utterances-container')
    var script = document.createElement('script')
    script.src = 'https://utteranc.es/client.js'
    script.setAttribute('repo', 'kyomind/blog-reply')
    script.setAttribute('issue-term', 'title')
    script.setAttribute('theme', 'github-light')
    script.setAttribute('label', 'utterances')
    script.crossorigin = 'anonymous'
    script.async = true

    container.appendChild(script)
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
